var Na=Object.defineProperty;var Ba=(n,t,e)=>t in n?Na(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var Er=(n,t,e)=>Ba(n,typeof t!="symbol"?t+"":t,e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function e(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(r){if(r.ep)return;r.ep=!0;const s=e(r);fetch(r.href,s)}})();/**
 * @preserve
 * Kontra.js v10.0.2
 */function Pa(n){return n*Math.PI/180}function ka(n){return n*180/Math.PI}function La(n,t){return Math.atan2(t.y-n.y,t.x-n.x)}function Ss(n,t){let e=Math.sin(t),i=Math.cos(t);return{x:n.x*i-n.y*e,y:n.x*e+n.y*i}}function Da(n,t,e){return{x:n.x+Math.cos(t)*e,y:n.y+Math.sin(t)*e}}function Oa(n,t,e){return n*(1-e)+t*e}function Ma(n,t,e){return(e-n)/(t-n)}function ge(n,t,e){return Math.min(Math.max(n,e),t)}function Ua(n,t){t==null?localStorage.removeItem(n):localStorage.setItem(n,JSON.stringify(t))}function Fa(n){let t=localStorage.getItem(n);try{t=JSON.parse(t)}catch{}return t}function xs(n,t){let e=pe(n),i=pe(t);return n.radius&&e.width!=e.height||t.radius&&i.width!=i.height?!1:([e,i]=[e,i].map(r=>((r==e?n:t).radius&&(r.radius=r.width/2,r.x+=r.radius,r.y+=r.radius),r)),n.radius&&t.radius?Math.hypot(e.x-i.x,e.y-i.y)<e.radius+i.radius:n.radius||t.radius?As(n.radius?e:i,n.radius?t:n):e.x<i.x+i.width&&e.x+e.width>i.x&&e.y<i.y+i.height&&e.y+e.height>i.y)}function pe(n){let{x:t=0,y:e=0,width:i,height:r,radius:s}=n.world||n;return n.mapwidth&&(i=n.mapwidth,r=n.mapheight),s&&(i=s.x*2,r=s.y*2),n.anchor&&(t-=i*n.anchor.x,e-=r*n.anchor.y),i<0&&(t+=i,i*=-1),r<0&&(e+=r,r*=-1),{x:t,y:e,width:i,height:r}}function $a(n,t,e="y"){return[n,t]=[n,t].map(pe),n[e]-t[e]}let Vt=()=>{},Cs="position:absolute;width:1px;height:1px;overflow:hidden;clip:rect(0,0,0,0);",_i={preventScroll:!0};function mi(n,t){let e=t.parentNode;n.setAttribute("data-kontra",""),e?([...e.querySelectorAll(":scope > [data-kontra]")].pop()||t).after(n):t.nodeName=="CANVAS"?document.body.append(n):t.append(n)}function _e(n,t){let e=n.indexOf(t);if(e!=-1)return n.splice(e,1),!0}function As(n,t){let{x:e,y:i,width:r,height:s}=pe(t);do e-=t.sx||0,i-=t.sy||0;while(t=t.parent);let o=n.x-Math.max(e,Math.min(n.x,e+r)),a=n.y-Math.max(i,Math.min(n.y,i+s));return o*o+a*a<n.radius*n.radius}let ce={};function dt(n,t){ce[n]=ce[n]||[],ce[n].push(t)}function Ts(n,t){ce[n]=(ce[n]||[]).filter(e=>e!=t)}function Bt(n,...t){(ce[n]||[]).map(e=>e(...t))}let $t,un,Sr={get(n,t){return t=="_proxy"?!0:Vt}};function lt(){return $t}function ot(){return un}function Ha(n,{contextless:t=!1}={}){if($t=document.getElementById(n)||n||document.querySelector("canvas"),t&&($t=$t||new Proxy({},Sr)),!$t)throw Error("You must provide a canvas element for the game");return un=$t.getContext("2d")||new Proxy({},Sr),un.imageSmoothingEnabled=!1,Bt("init"),{canvas:$t,context:un}}class Ln{constructor({spriteSheet:t,frames:e,frameRate:i,loop:r=!0,name:s}){let{width:o,height:a,spacing:l=0,margin:c=0}=t.frame;Object.assign(this,{spriteSheet:t,frames:e,frameRate:i,loop:r,name:s,width:o,height:a,spacing:l,margin:c,isStopped:!1,_f:0,_a:0})}clone(){return new Ln(this)}start(){this.isStopped=!1,this.loop||this.reset()}stop(){this.isStopped=!0}reset(){this._f=0,this._a=0}update(t=1/60){if(!this.isStopped){if(!this.loop&&this._f==this.frames.length-1){this.stop();return}for(this._a+=t;this._a*this.frameRate>=1;)this._f=++this._f%this.frames.length,this._a-=1/this.frameRate}}render({x:t,y:e,width:i=this.width,height:r=this.height,context:s=ot()}){let o=this.frames[this._f]/this.spriteSheet._f|0,a=this.frames[this._f]%this.spriteSheet._f|0;s.drawImage(this.spriteSheet.image,this.margin+a*this.width+(a*2+1)*this.spacing,this.margin+o*this.height+(o*2+1)*this.spacing,this.width,this.height,t,e,i,r)}}function vs(){return new Ln(...arguments)}let qa=/(jpeg|jpg|gif|png|webp)$/,za=/(wav|mp3|ogg|aac)$/,Is=/^\//,Ya=/\/$/,Rs=new WeakMap,Ns="",Bs="",Ps="";function Dn(n,t){return new URL(n,t).href}function Ui(n,t){return[n.replace(Ya,""),n?t.replace(Is,""):t].filter(e=>e).join("/")}function Fi(n){return n.split(".").pop()}function $i(n){let t=n.replace("."+Fi(n),"");return t.split("/").length==2?t.replace(Is,""):t}function Wa(n){return{wav:n.canPlayType('audio/wav; codecs="1"'),mp3:n.canPlayType("audio/mpeg;"),ogg:n.canPlayType('audio/ogg; codecs="vorbis"'),aac:n.canPlayType("audio/aac;")}}let zt={},oe={},Yt={};function Hi(){window.__k||(window.__k={dm:Rs,u:Dn,d:Yt,i:zt})}function ja(n){Ns=n}function Ga(n){Bs=n}function Ka(n){Ps=n}function ks(n){return Hi(),new Promise((t,e)=>{let i,r,s;if(i=Ui(Ns,n),zt[i])return t(zt[i]);r=new Image,r.onload=function(){s=Dn(i,window.location.href),zt[$i(n)]=zt[i]=zt[s]=this,Bt("assetLoaded",this,n),t(this)},r.onerror=function(){e("Unable to load image "+i)},r.src=i})}function Ls(n){return new Promise((t,e)=>{let i=n,r,s,o,a;if(r=new Audio,s=Wa(r),n=[].concat(n).reduce((l,c)=>l||(s[Fi(c)]?c:null),0),!n)return e("cannot play any of the audio formats provided "+i);if(o=Ui(Bs,n),oe[o])return t(oe[o]);r.addEventListener("canplay",function(){a=Dn(o,window.location.href),oe[$i(n)]=oe[o]=oe[a]=this,Bt("assetLoaded",this,n),t(this)}),r.onerror=function(){e("Unable to load audio "+o)},r.src=o,r.load()})}function Ds(n){Hi();let t,e;return t=Ui(Ps,n),Yt[t]?Promise.resolve(Yt[t]):fetch(t).then(i=>{if(!i.ok)throw i;return i.clone().json().catch(()=>i.text())}).then(i=>(e=Dn(t,window.location.href),typeof i=="object"&&Rs.set(i,e),Yt[$i(n)]=Yt[t]=Yt[e]=i,Bt("assetLoaded",i,n),i))}function Va(...n){return Hi(),Promise.all(n.map(t=>{let e=Fi([].concat(t)[0]);return e.match(qa)?ks(t):e.match(za)?Ls(t):Ds(t)}))}class jt{constructor(t=0,e=0,i={}){t.x!=null?(this.x=t.x,this.y=t.y):(this.x=t,this.y=e),i._c&&(this.clamp(i._a,i._b,i._d,i._e),this.x=t,this.y=e)}set(t){this.x=t.x,this.y=t.y}add(t){return new jt(this.x+t.x,this.y+t.y,this)}subtract(t){return new jt(this.x-t.x,this.y-t.y,this)}scale(t){return new jt(this.x*t,this.y*t)}normalize(t=this.length()||1){return new jt(this.x/t,this.y/t)}dot(t){return this.x*t.x+this.y*t.y}length(){return Math.hypot(this.x,this.y)}distance(t){return Math.hypot(this.x-t.x,this.y-t.y)}angle(t){return Math.acos(this.dot(t)/(this.length()*t.length()))}direction(){return Math.atan2(this.y,this.x)}clamp(t,e,i,r){this._c=!0,this._a=t,this._b=e,this._d=i,this._e=r}get x(){return this._x}get y(){return this._y}set x(t){this._x=this._c?ge(this._a,this._d,t):t}set y(t){this._y=this._c?ge(this._b,this._e,t):t}}function dn(){return new jt(...arguments)}class Za{constructor(t){return this.init(t)}init(t={}){this.position=dn(),this.velocity=dn(),this.acceleration=dn(),this.ttl=1/0,Object.assign(this,t)}update(t){this.advance(t)}advance(t){let e=this.acceleration;t&&(e=e.scale(t)),this.velocity=this.velocity.add(e);let i=this.velocity;t&&(i=i.scale(t)),this.position=this.position.add(i),this._pc(),this.ttl--}get dx(){return this.velocity.x}get dy(){return this.velocity.y}set dx(t){this.velocity.x=t}set dy(t){this.velocity.y=t}get ddx(){return this.acceleration.x}get ddy(){return this.acceleration.y}set ddx(t){this.acceleration.x=t}set ddy(t){this.acceleration.y=t}isAlive(){return this.ttl>0}_pc(){}}class ve extends Za{init({width:t=0,height:e=0,context:i=ot(),render:r=this.draw,update:s=this.advance,children:o=[],anchor:a={x:0,y:0},opacity:l=1,rotation:c=0,drotation:h=0,ddrotation:u=0,scaleX:d=1,scaleY:g=1,...m}={}){this._c=[],super.init({width:t,height:e,context:i,anchor:a,opacity:l,rotation:c,drotation:h,ddrotation:u,scaleX:d,scaleY:g,...m}),this._di=!0,this._uw(),this.addChild(o),this._rf=r,this._uf=s,dt("init",()=>{this.context??(this.context=ot())})}update(t){this._uf(t),this.children.map(e=>e.update&&e.update(t))}render(){let t=this.context;t.save(),(this.x||this.y)&&t.translate(this.x,this.y),this.rotation&&t.rotate(this.rotation),(this.scaleX!=1||this.scaleY!=1)&&t.scale(this.scaleX,this.scaleY);let e=this.width,i=this.height;this.radius&&(e=i=this.radius*2);let r=-e*this.anchor.x,s=-i*this.anchor.y;(r||s)&&t.translate(r,s),this.context.globalAlpha=this.opacity,this._rf(),(r||s)&&t.translate(-r,-s),this.children.map(a=>a.render&&a.render()),t.restore()}draw(){}_pc(){this._uw(),this.children.map(t=>t._pc())}get x(){return this.position.x}get y(){return this.position.y}set x(t){this.position.x=t,this._pc()}set y(t){this.position.y=t,this._pc()}get width(){return this._w}set width(t){this._w=t,this._pc()}get height(){return this._h}set height(t){this._h=t,this._pc()}_uw(){if(!this._di)return;let{_wx:t=0,_wy:e=0,_wo:i=1,_wrot:r=0,_wsx:s=1,_wsy:o=1}=this.parent||{};this._wx=this.x,this._wy=this.y,this._ww=this.width,this._wh=this.height,this.radius&&(this._wrx=this.radius,this._wry=this.radius),this._wo=i*this.opacity,this._wsx=s*this.scaleX,this._wsy=o*this.scaleY,this._wx=this._wx*s,this._wy=this._wy*o,this._ww=this.width*this._wsx,this._wh=this.height*this._wsy,this.radius&&(this._wrx=this.radius*this._wsx,this._wry=this.radius*this._wsy),this._wrot=r+this.rotation;let{x:a,y:l}=Ss({x:this._wx,y:this._wy},r);this._wx=a,this._wy=l,this._wx+=t,this._wy+=e}get world(){return{x:this._wx,y:this._wy,width:this._ww,height:this._wh,radius:this.radius?{x:this._wrx,y:this._wry}:void 0,opacity:this._wo,rotation:this._wrot,scaleX:this._wsx,scaleY:this._wsy}}set children(t){this.removeChild(this._c),this.addChild(t)}get children(){return this._c}addChild(...t){t.flat().map(e=>{this.children.push(e),e.parent=this,e._pc=e._pc||Vt,e._pc()})}removeChild(...t){t.flat().map(e=>{_e(this.children,e)&&(e.parent=null,e._pc())})}get radius(){return this._r}set radius(t){this._r=t,this._pc()}get opacity(){return this._opa}set opacity(t){this._opa=ge(0,1,t),this._pc()}get rotation(){return this._rot}set rotation(t){this._rot=t,this._pc()}advance(t){super.advance(t),this.drotation+=this.ddrotation,this.rotation+=this.drotation}setScale(t,e=t){this.scaleX=t,this.scaleY=e}get scaleX(){return this._scx}set scaleX(t){this._scx=t,this._pc()}get scaleY(){return this._scy}set scaleY(t){this._scy=t,this._pc()}}function Ja(){return new ve(...arguments)}let qi=class extends ve{init({image:t,width:e=t?t.width:void 0,height:i=t?t.height:void 0,...r}={}){super.init({image:t,width:e,height:i,...r})}get animations(){return this._a}set animations(t){let e,i;this._a={};for(e in t)this._a[e]=t[e].clone(),i=i||this._a[e];this.currentAnimation=i,this.width=this.width||i.width,this.height=this.height||i.height}playAnimation(t){var e;(e=this.currentAnimation)==null||e.stop(),this.currentAnimation=this.animations[t],this.currentAnimation.start()}advance(t){var e;super.advance(t),(e=this.currentAnimation)==null||e.update(t)}draw(){if(this.image&&this.context.drawImage(this.image,0,0,this.image.width,this.image.height),this.currentAnimation&&this.currentAnimation.render({x:0,y:0,width:this.width,height:this.height,context:this.context}),this.color){if(this.context.fillStyle=this.color,this.radius){this.context.beginPath(),this.context.arc(this.radius,this.radius,this.radius,0,Math.PI*2),this.context.fill();return}this.context.fillRect(0,0,this.width,this.height)}}};function Xa(){return new qi(...arguments)}let Qa=/(\d+)(\w+)/;function tl(n){if(!n)return{computed:0};let t=n.match(Qa),e=+t[1],i=t[2];return{size:e,unit:i,computed:e}}class Os extends ve{init({text:t="",textAlign:e="",lineHeight:i=1,font:r=(o=>(o=ot())==null?void 0:o.font)(),...s}={}){t=""+t,super.init({text:t,textAlign:e,lineHeight:i,font:r,...s}),this.context&&this._p(),dt("init",()=>{this.font??(this.font=ot().font),this._p()})}get width(){return this._w}set width(t){this._d=!0,this._w=t,this._fw=t}get text(){return this._t}set text(t){this._d=!0,this._t=""+t}get font(){return this._f}set font(t){this._d=!0,this._f=t,this._fs=tl(t).computed}get lineHeight(){return this._lh}set lineHeight(t){this._d=!0,this._lh=t}render(){this._d&&this._p(),super.render()}_p(){this._s=[],this._d=!1;let t=this.context,e=[this.text];if(t.font=this.font,e=this.text.split(`
`),this._fw&&e.map(i=>{let r=i.split(" "),s=r.shift(),o=s;r.map(a=>{o+=" "+a,t.measureText(o).width>this._fw&&(this._s.push(s),o=a),s=o}),this._s.push(o)}),!this._s.length&&this.text.includes(`
`)){let i=0;e.map(r=>{this._s.push(r),i=Math.max(i,t.measureText(r).width)}),this._w=this._fw||i}this._s.length||(this._s.push(this.text),this._w=this._fw||t.measureText(this.text).width),this.height=this._fs+(this._s.length-1)*this._fs*this.lineHeight,this._uw()}draw(){let t=0,e=this.textAlign,i=this.context;e=this.textAlign||(i.canvas.dir=="rtl"?"right":"left"),t=e=="right"?this.width:e=="center"?this.width/2|0:0,this._s.map((r,s)=>{i.textBaseline="top",i.textAlign=e,i.fillStyle=this.color,i.font=this.font,this.strokeColor&&(i.strokeStyle=this.strokeColor,i.lineWidth=this.lineWidth??1,i.strokeText(r,t,this._fs*this.lineHeight*s)),i.fillText(r,t,this._fs*this.lineHeight*s)})}}function Ms(){return new Os(...arguments)}let Pt=new WeakMap,bn={},On={},Us={0:"left",1:"middle",2:"right"};function el(n=lt()){return Pt.get(n)}function Fs(n){let t=n._lf.length?n._lf:n._cf;for(let e=t.length-1;e>=0;e--){let i=t[e];if(i.collidesWithPointer?i.collidesWithPointer(n):As(n,i))return i}}function rt(n,t){return parseFloat(n.getPropertyValue(t))||0}function nl(n){let{canvas:t,_s:e}=n,i=t.getBoundingClientRect(),r=e.transform!="none"?e.transform.replace("matrix(","").split(","):[1,1,1,1],s=parseFloat(r[0]),o=parseFloat(r[3]),a=(rt(e,"border-left-width")+rt(e,"border-right-width"))*s,l=(rt(e,"border-top-width")+rt(e,"border-bottom-width"))*o,c=(rt(e,"padding-left")+rt(e,"padding-right"))*s,h=(rt(e,"padding-top")+rt(e,"padding-bottom"))*o;return{scaleX:(i.width-a-c)/t.width,scaleY:(i.height-l-h)/t.height,offsetX:i.left+(rt(e,"border-left-width")+rt(e,"padding-left"))*s,offsetY:i.top+(rt(e,"border-top-width")+rt(e,"padding-top"))*o}}function xr(n){let t=n.button!=null?Us[n.button]:"left";On[t]=!0,zi(n,"onDown")}function Xn(n){let t=n.button!=null?Us[n.button]:"left";On[t]=!1,zi(n,"onUp")}function Cr(n){zi(n,"onOver")}function il(n){let t=Pt.get(n.target);t._oo=null,On={}}function Ar(n,t,e){let i=Fs(n);i&&i[t]&&i[t](e),bn[t]&&bn[t](e,i),t=="onOver"&&(i!=n._oo&&n._oo&&n._oo.onOut&&n._oo.onOut(e),n._oo=i)}function zi(n,t){n.preventDefault();let e=n.target,i=Pt.get(e),{scaleX:r,scaleY:s,offsetX:o,offsetY:a}=nl(i);n.type.includes("touch")?(Array.from(n.touches).map(({clientX:c,clientY:h,identifier:u})=>{let d=i.touches[u];d||(d=i.touches[u]={start:{x:(c-o)/r,y:(h-a)/s}},i.touches.length++),d.changed=!1}),Array.from(n.changedTouches).map(({clientX:c,clientY:h,identifier:u})=>{let d=i.touches[u];d.changed=!0,d.x=i.x=(c-o)/r,d.y=i.y=(h-a)/s,Ar(i,t,n),Bt("touchChanged",n,i.touches),t=="onUp"&&(delete i.touches[u],i.touches.length--,i.touches.length||Bt("touchEnd"))})):(i.x=(n.clientX-o)/r,i.y=(n.clientY-a)/s,Ar(i,t,n))}function $s({radius:n=5,canvas:t=lt()}={}){let e=Pt.get(t);if(!e){let i=window.getComputedStyle(t);e={x:0,y:0,radius:n,touches:{length:0},canvas:t,_cf:[],_lf:[],_o:[],_oo:null,_s:i},Pt.set(t,e)}return t.addEventListener("mousedown",xr),t.addEventListener("touchstart",xr),t.addEventListener("mouseup",Xn),t.addEventListener("touchend",Xn),t.addEventListener("touchcancel",Xn),t.addEventListener("blur",il),t.addEventListener("mousemove",Cr),t.addEventListener("touchmove",Cr),e._t||(e._t=!0,dt("tick",()=>{e._lf.length=0,e._cf.map(i=>{e._lf.push(i)}),e._cf.length=0})),e}function Hs(...n){n.flat().map(t=>{let e=t.context?t.context.canvas:lt(),i=Pt.get(e);if(!i)throw new ReferenceError("Pointer events not initialized for the objects canvas");t.__r||(t.__r=t.render,t.render=function(){i._cf.push(this),this.__r()},i._o.push(t))})}function rl(...n){n.flat().map(t=>{let e=t.context?t.context.canvas:lt(),i=Pt.get(e);if(!i)throw new ReferenceError("Pointer events not initialized for the objects canvas");t.render=t.__r,t.__r=0,_e(i._o,t)})}function sl(n){let t=n.context?n.context.canvas:lt(),e=Pt.get(t);if(!e)throw new ReferenceError("Pointer events not initialized for the objects canvas");return e._o.includes(n)&&Fs(e)===n}function qs(n,t){let e=n[0].toUpperCase()+n.substr(1);bn["on"+e]=t}function zs(n){let t=n[0].toUpperCase()+n.substr(1);bn["on"+t]=0}function ol(n){return!!On[n]}class Ys extends qi{init({padX:t=0,padY:e=0,text:i,disabled:r=!1,container:s,onDown:o,onUp:a,...l}={}){super.init({padX:t,padY:e,...l}),this.textNode=Ms({...i,context:this.context}),this.width||(this.width=this.textNode.width,this.height=this.textNode.height),Hs(this),this.addChild(this.textNode),this._od=o||Vt,this._ou=a||Vt;let c=this._dn=document.createElement("button");c.style=Cs,c.textContent=this.text,r&&this.disable(),c.addEventListener("focus",()=>this.focus()),c.addEventListener("blur",()=>this.blur()),c.addEventListener("keydown",h=>this._kd(h)),c.addEventListener("keyup",h=>this._ku(h)),mi(c,s??this.context.canvas),this._uw(),this._p()}get text(){return this.textNode.text}set text(t){this._d=!0,this.textNode.text=t}get node(){return this._dn}destroy(){this._dn.remove()}_p(){this.text!=this._dn.textContent&&(this._dn.textContent=this.text),this.textNode._p();let t=this.textNode.width+this.padX*2,e=this.textNode.height+this.padY*2;this.width=Math.max(t,this.width),this.height=Math.max(e,this.height),this._uw()}render(){this._d&&this._p(),super.render()}enable(){this.disabled=this._dn.disabled=!1,this.onEnable()}disable(){this.disabled=this._dn.disabled=!0,this.onDisable()}focus(){this.disabled||(this.focused=!0,document.activeElement!=this._dn&&this._dn.focus(_i),this.onFocus())}blur(){this.focused=!1,document.activeElement==this._dn&&this._dn.blur(),this.onBlur()}onOver(){this.disabled||(this.hovered=!0)}onOut(){this.hovered=!1}onEnable(){}onDisable(){}onFocus(){}onBlur(){}onDown(){this.disabled||(this.pressed=!0,this._od())}onUp(){this.disabled||(this.pressed=!1,this._ou())}_kd(t){(t.code=="Enter"||t.code=="Space")&&this.onDown()}_ku(t){(t.code=="Enter"||t.code=="Space")&&this.onUp()}}function al(){return new Ys(...arguments)}function ll(n){let t=n.canvas;n.clearRect(0,0,t.width,t.height)}function cl({fps:n=60,clearCanvas:t=!0,update:e=Vt,render:i,context:r=ot(),blur:s=!1}={}){if(!i)throw Error("You must provide a render() function");let o=0,a=1e3/n,l=1/n,c=t?ll:Vt,h,u,d,g,m,f=!0;s||(window.addEventListener("focus",()=>{f=!0}),window.addEventListener("blur",()=>{f=!1})),dt("init",()=>{m.context??(m.context=ot())});function _(){if(u=requestAnimationFrame(_),!!f&&(d=performance.now(),g=d-h,h=d,!(g>1e3))){for(o+=g;o>=a;)Bt("tick"),m.update(l),o-=a;c(m.context),m.render()}}return m={update:e,render:i,isStopped:!0,context:r,start(){this.isStopped&&(h=performance.now(),this.isStopped=!1,requestAnimationFrame(_))},stop(){this.isStopped=!0,cancelAnimationFrame(u)},_frame:_,set _last(p){h=p}},m}let wt=[],En={},Sn={},Mn={0:"south",1:"east",2:"west",3:"north",4:"leftshoulder",5:"rightshoulder",6:"lefttrigger",7:"righttrigger",8:"select",9:"start",10:"leftstick",11:"rightstick",12:"dpadup",13:"dpaddown",14:"dpadleft",15:"dpadright"};function hl(n){wt[n.gamepad.index]={pressedButtons:{},axes:{}}}function ul(n){delete wt[n.gamepad.index]}function dl(){wt.map(n=>{n.pressedButtons={},n.axes={}})}function Ws(){let n=navigator.getGamepads?navigator.getGamepads():navigator.webkitGetGamepads?navigator.webkitGetGamepads:[];for(let t=0;t<n.length;t++){let e=n[t];if(!e)continue;e.buttons.map((r,s)=>{let o=Mn[s],{pressed:a}=r,{pressedButtons:l}=wt[e.index],c=l[o];!c&&a?[En[e.index],En].map(h=>{var u;(u=h==null?void 0:h[o])==null||u.call(h,e,r,o)}):c&&!a&&[Sn[e.index],Sn].map(h=>{var u;(u=h==null?void 0:h[o])==null||u.call(h,e,r,o)}),l[o]=a});let{axes:i}=wt[e.index];i.leftstickx=e.axes[0],i.leftsticky=e.axes[1],i.rightstickx=e.axes[2],i.rightsticky=e.axes[3]}}function js(){window.addEventListener("gamepadconnected",hl),window.addEventListener("gamepaddisconnected",ul),window.addEventListener("blur",dl),dt("tick",Ws)}function Gs(n,t,{gamepad:e,handler:i="gamepaddown"}={}){let r=i=="gamepaddown"?En:Sn;[].concat(n).map(s=>{isNaN(e)?r[s]=t:(r[e]=r[e]||{},r[e][s]=t)})}function Ks(n,{gamepad:t,handler:e="gamepaddown"}={}){let i=e=="gamepaddown"?En:Sn;[].concat(n).map(r=>{isNaN(t)?delete i[r]:(i[t]=i[t]||{},delete i[t][r])})}function fl(n,{gamepad:t}={}){return isNaN(t)?wt.some(e=>e.pressedButtons[n]):wt[t]?!!wt[t].pressedButtons[n]:!1}function gl(n,t){var e;return((e=wt[t])==null?void 0:e.axes[n])||0}let xn={},tn,Tr=!1,Cn={swipe:{touches:1,threshold:10,touchend({0:n}){let t=n.x-n.start.x,e=n.y-n.start.y,i=Math.abs(t),r=Math.abs(e);if(!(i<this.threshold&&r<this.threshold))return i>r?t<0?"left":"right":e<0?"up":"down"}},pinch:{touches:2,threshold:2,touchstart({0:n,1:t}){this.prevDist=Math.hypot(n.x-t.x,n.y-t.y)},touchmove({0:n,1:t}){let e=Math.hypot(n.x-t.x,n.y-t.y);if(Math.abs(e-this.prevDist)<this.threshold)return;let i=e>this.prevDist?"out":"in";return this.prevDist=e,i}}};function Vs(){Tr||(Tr=!0,dt("touchChanged",(n,t)=>{Object.keys(Cn).map(e=>{var s;let i=Cn[e],r;(!tn||tn==e)&&t.length==i.touches&&[...Array(t.length).keys()].every(o=>t[o])&&(r=((s=i[n.type])==null?void 0:s.call(i,t))??"")&&xn[e+r]&&(tn=e,xn[e+r](n,t))})}),dt("touchEnd",()=>{tn=0}))}function Zs(n,t){[].concat(n).map(e=>{xn[e]=t})}function Js(n){[].concat(n).map(t=>{xn[t]=0})}let pl={set(n,t,e){return t.startsWith("_")||(n._d=!0),Reflect.set(n,t,e)}},vr={start(n){return n?1:0},center(){return .5},end(n){return n?0:1}};class Xs extends ve{init({flow:t="column",align:e="start",justify:i="start",colGap:r=0,rowGap:s=0,numCols:o=1,dir:a="",breakpoints:l=[],...c}={}){return super.init({flow:t,align:e,justify:i,colGap:r,rowGap:s,numCols:o,dir:a,breakpoints:l,...c}),this._p(),new Proxy(this,pl)}addChild(t){this._d=!0,super.addChild(t)}removeChild(t){this._d=!0,super.removeChild(t)}render(){this._d&&this._p(),super.render()}destroy(){this.children.map(t=>t.destroy&&t.destroy())}_p(){this._d=!1,this.breakpoints.map(p=>{p.metric.call(this)&&this._b!==p&&(this._b=p,p.callback.call(this))});let t=this._g=[],e=this._cw=[],i=this._rh=[],r=this.children,s=this._nc=this.flow=="column"?1:this.flow=="row"?r.length:this.numCols,o=0,a=0;for(let p=0,b;b=r[p];p++){t[o]=t[o]||[],b._p&&b._p();let{width:x,height:E}=b.world||b;i[o]=Math.max(i[o]||0,E);let v=b.colSpan||1,A=v;do e[a]=Math.max(e[a]||0,x/A),t[o][a]=b;while(a++<=s&&--v);a>=s&&(a=0,o++)}for(;a>0&&a<s;)t[o][a++]=!1;let l=t.length,c=[].concat(this.colGap),h=[].concat(this.rowGap);this._w=e.reduce((p,b)=>p+=b,0);for(let p=0;p<s-1;p++)this._w+=c[p%c.length];this._h=i.reduce((p,b)=>p+=b,0);for(let p=0;p<l-1;p++)this._h+=h[p%h.length];this._uw();let d=this.context.canvas.dir=="rtl"&&!this.dir||this.dir=="rtl";this._rtl=d,d&&(this._g=t.map(p=>p.reverse()),this._cw=e.reverse(),c=c.reverse());let g=-this.anchor.y*this.height,m=[],f=[].concat(this.justify),_=[].concat(this.align);this._g.map((p,b)=>{let x=-this.anchor.x*this.width;p.map((E,v)=>{if(E&&!m.includes(E)){m.push(E);let A=vr[E.justifySelf||f[v%f.length]](this._rtl),R=vr[E.alignSelf||_[b%_.length]](),B=E.colSpan||1,U=e[v];if(B>1&&v+B<=this._nc)for(let C=1;C<B;C++)U+=e[v+C]+c[(v+C)%c.length];let P=U*A,k=i[b]*R,w=0,T=0,{width:S,height:y}=E.world||E;if(E.anchor&&(w=E.anchor.x,T=E.anchor.y),A==0)P=P+S*w;else if(A==.5){let C=w<.5?-1:w==.5?0:1;P=P+C*S*A}else P=P-S*(1-w);if(R==0)k=k+y*T;else if(R==.5){let C=T<.5?-1:T==.5?0:1;k=k+C*y*R}else k=k-y*(1-T);E.x=x+P,E.y=g+k}x+=e[v]+c[v%c.length]}),g+=i[b]+h[b%h.length]})}}function _l(){return new Xs(...arguments)}let Yi={},Wi={},Un={},It={Enter:"enter",Escape:"esc",Space:"space",ArrowLeft:"arrowleft",ArrowUp:"arrowup",ArrowRight:"arrowright",ArrowDown:"arrowdown"};function Qs(n=Vt,t){n._pd&&t.preventDefault(),n(t)}function ml(n){let t=It[n.code],e=Yi[t];Un[t]=!0,Qs(e,n)}function wl(n){let t=It[n.code],e=Wi[t];Un[t]=!1,Qs(e,n)}function yl(){Un={}}function to(){let n;for(n=0;n<26;n++)It["Key"+String.fromCharCode(n+65)]=String.fromCharCode(n+97);for(n=0;n<10;n++)It["Digit"+n]=It["Numpad"+n]=""+n;window.addEventListener("keydown",ml),window.addEventListener("keyup",wl),window.addEventListener("blur",yl)}function eo(n,t,{handler:e="keydown",preventDefault:i=!0}={}){let r=e=="keydown"?Yi:Wi;t._pd=i,[].concat(n).map(s=>r[s]=t)}function no(n,{handler:t="keydown"}={}){let e=t=="keydown"?Yi:Wi;[].concat(n).map(i=>delete e[i])}function bl(n){return!![].concat(n).some(t=>Un[t])}function An(n,t){return Object.values(t).includes(n)}function io(n){return Object.keys(Cn).some(t=>n.startsWith(t))}function El(n={}){to();let t=$s(n.pointer);return Vs(),js(),{pointer:t}}function Sl(n,t,{gamepad:e,key:i}={}){[].concat(n).map(r=>{if(An(r,Mn))Gs(r,t,e);else if(io(r))Zs(r,t);else if(An(r,It))eo(r,t,i);else if(["down","up"].includes(r))qs(r,t);else throw new TypeError(`"${r}" is not a valid input name`)})}function xl(n,{gamepad:t,key:e}={}){[].concat(n).map(i=>{An(i,Mn)?Ks(i,t):io(i)?Js(i):An(i,It)?no(i,e):["down","up"].includes(i)&&zs(i)})}function ro(n){let t=n.substr(n.search(/[A-Z]/));return t[0].toLowerCase()+t.substr(1)}function Cl(n,t){let e=n.prototype;e&&(e._inc||(e._inc={},e._bInc=function(r,s,...o){return this._inc[s].before.reduce((a,l)=>{let c=l(r,...a);return c||a},o)},e._aInc=function(r,s,o,...a){return this._inc[s].after.reduce((l,c)=>{let h=c(r,l,...a);return h||l},o)}),Object.getOwnPropertyNames(t).map(i=>{let r=ro(i);e[r]&&(e["_o"+r]||(e["_o"+r]=e[r],e[r]=function(...o){let a=this._bInc(this,r,...o),l=e["_o"+r].call(this,...a);return this._aInc(this,r,l,...o)}),e._inc[r]||(e._inc[r]={before:[],after:[]}),i.startsWith("before")?e._inc[r].before.push(t[i]):i.startsWith("after")&&e._inc[r].after.push(t[i]))}))}function Al(n,t){let e=n.prototype;!e||!e._inc||Object.getOwnPropertyNames(t).map(i=>{let r=ro(i);i.startsWith("before")?_e(e._inc[r].before,t[i]):i.startsWith("after")&&_e(e._inc[r].after,t[i])})}function Tl(n,t){let e=n.prototype;e&&Object.getOwnPropertyNames(t).map(i=>{e[i]||(e[i]=t[i])})}class so{constructor({create:t,maxSize:e=1024}={}){let i;if(!t||!(i=t())||!(i.update&&i.init&&i.isAlive&&i.render))throw Error("Must provide create() function which returns an object with init(), update(), render(), and isAlive() functions");this._c=t,this.objects=[t()],this.size=0,this.maxSize=e}get(t={}){if(this.size==this.objects.length){if(this.size==this.maxSize)return;for(let i=0;i<this.size&&this.objects.length<this.maxSize;i++)this.objects.push(this._c())}let e=this.objects[this.size];return this.size++,e.init(t),e}getAliveObjects(){return this.objects.slice(0,this.size)}clear(){this.size=this.objects.length=0,this.objects.push(this._c())}update(t){let e,i=!1;for(let r=this.size;r--;)e=this.objects[r],e.update(t),e.isAlive()||(i=!0,this.size--);i&&this.objects.sort((r,s)=>s.isAlive()-r.isAlive())}render(){for(let t=this.size;t--;)this.objects[t].render()}}function vl(){return new so(...arguments)}function Ir(n,t){let e=[],i=t.x+t.width/2,r=t.y+t.height/2,s=n.y<r,o=n.y+n.height>=r;return n.x<i&&(s&&e.push(0),o&&e.push(2)),n.x+n.width>=i&&(s&&e.push(1),o&&e.push(3)),e}class Fn{constructor({maxDepth:t=3,maxObjects:e=25,bounds:i}={}){this.maxDepth=t,this.maxObjects=e;let r=lt();this.bounds=i||{x:0,y:0,width:r.width,height:r.height},this._b=!1,this._d=0,this._o=[],this._s=[],this._p=null}clear(){this._s.map(t=>{t.clear()}),this._b=!1,this._o.length=0}get(t){let e=new Set;for(;this._s.length&&this._b;)return Ir(t,this.bounds).map(i=>{this._s[i].get(t).map(r=>e.add(r))}),Array.from(e);return this._o.filter(i=>i!==t)}add(...t){t.flat().map(e=>{if(this._b){this._a(e);return}this._o.push(e),this._o.length>this.maxObjects&&this._d<this.maxDepth&&(this._sp(),this._o.map(i=>this._a(i)),this._o.length=0)})}_a(t){Ir(t,this.bounds).map(e=>{this._s[e].add(t)})}_sp(t,e,i){if(this._b=!0,!this._s.length)for(t=this.bounds.width/2|0,e=this.bounds.height/2|0,i=0;i<4;i++)this._s[i]=new Fn({bounds:{x:this.bounds.x+(i%2==1?t:0),y:this.bounds.y+(i>=2?e:0),width:t,height:e},maxDepth:this.maxDepth,maxObjects:this.maxObjects}),this._s[i]._d=this._d+1}}function Il(){return new Fn(...arguments)}let _t;function oo(){_t??(_t=Date.now()),_t|=0,_t=_t+2654435769|0;let n=_t^_t>>>16;return n=Math.imul(n,569420461),n=n^n>>>15,n=Math.imul(n,1935289751),((n=n^n>>>15)>>>0)/4294967296}function Rl(n,t,e=oo){return(e()*(t-n+1)|0)+n}function Nl(){return _t}function Bl(n=Date.now()){if(_t=n,typeof n=="string"){for(var t=0,e=1779033703^n.length;t<n.length;t++)e=Math.imul(e^n.charCodeAt(t),3432918353),e=e<<13|e>>>19;e=Math.imul(e^e>>>16,2246822507),e=Math.imul(e^e>>>13,3266489909),_t=(e^=e>>>16)>>>0}}function wi(n){let t=[];return n._dn?t.push(n._dn):n.children&&n.children.map(e=>{t=t.concat(wi(e))}),t}class ao{constructor({id:t,name:e=t,objects:i=[],context:r=ot(),cullObjects:s=!0,cullFunction:o=xs,sortFunction:a,...l}){this._o=[],Object.assign(this,{id:t,name:e,context:r,cullObjects:s,cullFunction:o,sortFunction:a,...l});let c=this._dn=document.createElement("section");c.tabIndex=-1,c.style=Cs,c.id=t,c.setAttribute("aria-label",e);let h=this;class u extends ve{set x(g){h.sx=g-this.centerX,super.x=g}get x(){return super.x}set y(g){h.sy=g-this.centerY,super.y=g}get y(){return super.y}}this.camera=new u({context:r,anchor:{x:.5,y:.5},render:this._rf.bind(this)}),this.add(i),this._i=()=>{this.context??(this.context=ot());let d=this.context.canvas,{width:g,height:m}=d,f=g/2,_=m/2;Object.assign(this.camera,{centerX:f,centerY:_,x:f,y:_,width:g,height:m}),c.isConnected||mi(c,d)},this.context&&this._i(),dt("init",this._i)}set objects(t){this.remove(this._o),this.add(t)}get objects(){return this._o}get node(){return this._dn}add(...t){t.flat().map(e=>{this._o.push(e),e.parent=this,this._dn.append(...wi(e))})}remove(...t){t.flat().map(e=>{_e(this._o,e),e.parent=null,wi(e).map(i=>{mi(i,this.context.canvas)})})}show(){this.hidden=this._dn.hidden=!1;let t=this._o.find(e=>e.focus);t?t.focus(_i):this._dn.focus(_i),this.onShow()}hide(){this.hidden=this._dn.hidden=!0,this.onHide()}destroy(){Ts("init",this._i),this._dn.remove(),this._o.map(t=>t.destroy&&t.destroy())}lookAt(t){let{x:e,y:i}=t.world||t;this.camera.x=e,this.camera.y=i}update(t){this.hidden||this._o.map(e=>e.update&&e.update(t))}_rf(){let{_o:t,context:e,_sx:i,_sy:r,camera:s,sortFunction:o,cullObjects:a,cullFunction:l}=this;e.translate(i,r);let c=t;a&&(c=c.filter(h=>l(s,h))),o&&c.sort(o),c.map(h=>h.render&&h.render())}render(){if(!this.hidden){let{context:t,camera:e}=this,{x:i,y:r,centerX:s,centerY:o}=e;t.save(),this._sx=s-i,this._sy=o-r,t.translate(this._sx,this._sy),e.render(),t.restore()}}onShow(){}onHide(){}}function Pl(){return new ao(...arguments)}function kl(n){if(+n==n)return n;let t=[],e=n.split(".."),i=+e[0],r=+e[1],s=i;if(i<r)for(;s<=r;s++)t.push(s);else for(;s>=r;s--)t.push(s);return t}let lo=class{constructor({image:t,frameWidth:e,frameHeight:i,spacing:r=0,margin:s=0,animations:o}={}){if(!t)throw Error("You must provide an Image for the SpriteSheet");this.animations={},this.image=t,this.frame={width:e,height:i,spacing:r,margin:s},this._f=(t.width-s)/e|0,this.createAnimations(o)}createAnimations(t){let e,i;for(i in t){let{frames:r,frameRate:s,loop:o}=t[i];if(e=[],r==null)throw Error("Animation "+i+" must provide a frames property");[].concat(r).map(a=>{e=e.concat(kl(a))}),this.animations[i]=vs({spriteSheet:this,frames:e,frameRate:s,loop:o,name:i})}}};function Ll(){return new lo(...arguments)}let Rr=2147483648,Nr=1073741824,Br=536870912;function Re(n,t){return n/t|0}function Ne(n,t){return n/t|0}class co{constructor(t={}){let{width:e,height:i,tilewidth:r,tileheight:s,tilesets:o}=t,a=e*r,l=i*s,c=document.createElement("canvas");c.width=a,c.height=l,this._c=c,this._ctx=c.getContext("2d"),o.map(h=>{let{__k:u,location:d}=window,g=(u?u.dm.get(t):"")||d.href,{source:m}=h;if(m){if(!u)throw Error('You must use "load" or "loadData" to resolve tileset.source');let _=u.d[u.u(m,g)];if(!_)throw Error(`You must load the tileset source "${m}" before loading the tileset`);Object.keys(_).map(p=>{h[p]=_[p]})}let{image:f}=h;if(""+f===f){if(!u)throw Error('You must use "load" or "loadImage" to resolve tileset.image');let _=u.i[u.u(f,g)];if(!_)throw Error(`You must load the image "${f}" before loading the tileset`);h.image=_}}),Object.assign(this,{context:ot(),layerMap:{},layerCanvases:{},mapwidth:a,mapheight:l,_sx:0,_sy:0,_o:[],...t}),this.context&&this._p(),dt("init",()=>{this.context??(this.context=ot()),this._p()})}get sx(){return this._sx}get sy(){return this._sy}set sx(t){let e=Math.max(0,this.mapwidth-lt().width);this._sx=ge(0,e,t)}set sy(t){let e=Math.max(0,this.mapheight-lt().height);this._sy=ge(0,e,t)}set objects(t){this.remove(this._o),this.add(t)}get objects(){return this._o}add(...t){t.flat().map(e=>{this._o.push(e),e.parent=this})}remove(...t){t.flat().map(e=>{_e(this._o,e),e.parent=null})}getPosition(t){let e=lt().getBoundingClientRect(),i=t.x-e.x,r=t.y-e.y;return i+=this.sx,r+=this.sy,{x:i,y:r,row:Re(r,this.tileheight),col:Ne(i,this.tilewidth)}}setTileAtLayer(t,e,i){let{layerMap:r,tileheight:s,tilewidth:o,width:a}=this,{row:l,col:c,x:h,y:u}=e,d=l??Re(u,s),g=c??Ne(h,o);r[t]&&(this._d=!0,r[t]._d=!0,r[t].data[d*a+g]=i)}setLayer(t,e){let{layerMap:i}=this;i[t]&&(this._d=!0,i[t]._d=!0,i[t].data=e)}layerCollidesWith(t,e){let{tilewidth:i,tileheight:r,layerMap:s}=this,{x:o,y:a,width:l,height:c}=pe(e),h=Re(a,r),u=Ne(o,i),d=Re(a+c,r),g=Ne(o+l,i),m=s[t];for(let f=h;f<=d;f++)for(let _=u;_<=g;_++)if(m.data[_+f*this.width])return!0;return!1}tileAtLayer(t,e){let{layerMap:i,tileheight:r,tilewidth:s,width:o}=this,{row:a,col:l,x:c,y:h}=e,u=a??Re(h,r),d=l??Ne(c,s);return i[t]?i[t].data[u*o+d]:-1}render(t=this._c,e=!0){let{_d:i,context:r,sx:s=0,sy:o=0}=this;i&&this._p();let{width:a,height:l}=lt(),c=Math.min(t.width,a),h=Math.min(t.height,l);r.drawImage(t,s,o,c,h,0,0,c,h),e&&(r.save(),(s||o)&&r.translate(-s,-o),this.objects.map(u=>u.render&&u.render()),r.restore())}renderLayer(t){let{layerCanvases:e,layerMap:i}=this,r=i[t],s=e[t],o=s==null?void 0:s.getContext("2d");if(!s){let{mapwidth:a,mapheight:l}=this;s=document.createElement("canvas"),o=s.getContext("2d"),s.width=a,s.height=l,e[t]=s,this._rl(r,o)}r._d&&(r._d=!1,o.clearRect(0,0,s.width,s.height),this._rl(r,o)),this.render(s,!1)}_p(){let{_ctx:t,layers:e=[],layerMap:i}=this;this._d=!1,e.map(r=>{let{name:s,data:o,visible:a}=r;r._d=!1,i[s]=r,o&&a!=!1&&this._rl(r,t)})}_rl(t,e){let{opacity:i,data:r=[]}=t,{tilesets:s,width:o,tilewidth:a,tileheight:l}=this;e.save(),e.globalAlpha=i,r.map((c,h)=>{if(!c)return;let u=0,d=0,g=c&Rr,m=c&Nr,f=0,_=0,p=0,b=0,x=0;u=g||m,c&=~(Rr|Nr),x=c&Br,x&&(g&&m?p=1:g?f=1:m?_=1:b=1,d=f||_||p||b,c&=~Br);let E;for(let C=s.length-1;C>=0&&(E=s[C],!(c/E.firstgid>=1));C--);let{image:v,spacing:A=0,margin:R=0,firstgid:B,columns:U}=E,P=c-B,k=U??v.width/(a+A)|0,w=h%o*a,T=(h/o|0)*l,S=R+P%k*(a+A),y=R+(P/k|0)*(l+A);d?(e.save(),e.translate(w+a/2,T+l/2),_||b?e.rotate(-Math.PI/2):(f||p)&&e.rotate(Math.PI/2),(p||b)&&e.scale(-1,1),w=-a/2,T=-l/2):u&&(e.save(),e.translate(w+(g?a:0),T+(m?l:0)),e.scale(g?-1:1,m?-1:1),w=u?0:w,T=u?0:T),e.drawImage(v,S,y,a,l,w,T,a,l),(u||d)&&e.restore()}),e.restore()}}function Dl(){return new co(...arguments)}let Ol={Animation:vs,AnimationClass:Ln,imageAssets:zt,audioAssets:oe,dataAssets:Yt,setImagePath:ja,setAudioPath:Ga,setDataPath:Ka,loadImage:ks,loadAudio:Ls,loadData:Ds,load:Va,Button:al,ButtonClass:Ys,init:Ha,getCanvas:lt,getContext:ot,on:dt,off:Ts,emit:Bt,GameLoop:cl,GameObject:Ja,GameObjectClass:ve,gamepadMap:Mn,updateGamepad:Ws,initGamepad:js,onGamepad:Gs,offGamepad:Ks,gamepadPressed:fl,gamepadAxis:gl,gestureMap:Cn,initGesture:Vs,onGesture:Zs,offGesture:Js,Grid:_l,GridClass:Xs,degToRad:Pa,radToDeg:ka,angleToTarget:La,rotatePoint:Ss,movePoint:Da,lerp:Oa,inverseLerp:Ma,clamp:ge,setStoreItem:Ua,getStoreItem:Fa,collides:xs,getWorldRect:pe,depthSort:$a,initInput:El,onInput:Sl,offInput:xl,keyMap:It,initKeys:to,onKey:eo,offKey:no,keyPressed:bl,registerPlugin:Cl,unregisterPlugin:Al,extendObject:Tl,initPointer:$s,getPointer:el,track:Hs,untrack:rl,pointerOver:sl,onPointer:qs,offPointer:zs,pointerPressed:ol,Pool:vl,PoolClass:so,Quadtree:Il,QuadtreeClass:Fn,rand:oo,randInt:Rl,getSeed:Nl,seedRand:Bl,Scene:Pl,SceneClass:ao,Sprite:Xa,SpriteClass:qi,SpriteSheet:Ll,SpriteSheetClass:lo,Text:Ms,TextClass:Os,TileEngine:Dl,TileEngineClass:co,Vector:dn,VectorClass:jt};function Pr(n){if(!Number.isSafeInteger(n)||n<0)throw new Error(`positive integer expected, not ${n}`)}function Ml(n){return n instanceof Uint8Array||n!=null&&typeof n=="object"&&n.constructor.name==="Uint8Array"}function $n(n,...t){if(!Ml(n))throw new Error("Uint8Array expected");if(t.length>0&&!t.includes(n.length))throw new Error(`Uint8Array expected of length ${t}, not of length=${n.length}`)}function Ul(n){if(typeof n!="function"||typeof n.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");Pr(n.outputLen),Pr(n.blockLen)}function Tn(n,t=!0){if(n.destroyed)throw new Error("Hash instance has been destroyed");if(t&&n.finished)throw new Error("Hash#digest() has already been called")}function Fl(n,t){$n(n);const e=t.outputLen;if(n.length<e)throw new Error(`digestInto() expects output buffer of length at least ${e}`)}const Qn=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */const ti=n=>new DataView(n.buffer,n.byteOffset,n.byteLength),ut=(n,t)=>n<<32-t|n>>>t;new Uint8Array(new Uint32Array([287454020]).buffer)[0];function $l(n){if(typeof n!="string")throw new Error(`utf8ToBytes expected string, got ${typeof n}`);return new Uint8Array(new TextEncoder().encode(n))}function ji(n){return typeof n=="string"&&(n=$l(n)),$n(n),n}function Hl(...n){let t=0;for(let i=0;i<n.length;i++){const r=n[i];$n(r),t+=r.length}const e=new Uint8Array(t);for(let i=0,r=0;i<n.length;i++){const s=n[i];e.set(s,r),r+=s.length}return e}class ho{clone(){return this._cloneInto()}}function ql(n){const t=i=>n().update(ji(i)).digest(),e=n();return t.outputLen=e.outputLen,t.blockLen=e.blockLen,t.create=()=>n(),t}function uo(n=32){if(Qn&&typeof Qn.getRandomValues=="function")return Qn.getRandomValues(new Uint8Array(n));throw new Error("crypto.getRandomValues must be defined")}function zl(n,t,e,i){if(typeof n.setBigUint64=="function")return n.setBigUint64(t,e,i);const r=BigInt(32),s=BigInt(4294967295),o=Number(e>>r&s),a=Number(e&s),l=i?4:0,c=i?0:4;n.setUint32(t+l,o,i),n.setUint32(t+c,a,i)}const Yl=(n,t,e)=>n&t^~n&e,Wl=(n,t,e)=>n&t^n&e^t&e;class jl extends ho{constructor(t,e,i,r){super(),this.blockLen=t,this.outputLen=e,this.padOffset=i,this.isLE=r,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(t),this.view=ti(this.buffer)}update(t){Tn(this);const{view:e,buffer:i,blockLen:r}=this;t=ji(t);const s=t.length;for(let o=0;o<s;){const a=Math.min(r-this.pos,s-o);if(a===r){const l=ti(t);for(;r<=s-o;o+=r)this.process(l,o);continue}i.set(t.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===r&&(this.process(e,0),this.pos=0)}return this.length+=t.length,this.roundClean(),this}digestInto(t){Tn(this),Fl(t,this),this.finished=!0;const{buffer:e,view:i,blockLen:r,isLE:s}=this;let{pos:o}=this;e[o++]=128,this.buffer.subarray(o).fill(0),this.padOffset>r-o&&(this.process(i,0),o=0);for(let u=o;u<r;u++)e[u]=0;zl(i,r-8,BigInt(this.length*8),s),this.process(i,0);const a=ti(t),l=this.outputLen;if(l%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const c=l/4,h=this.get();if(c>h.length)throw new Error("_sha2: outputLen bigger than state");for(let u=0;u<c;u++)a.setUint32(4*u,h[u],s)}digest(){const{buffer:t,outputLen:e}=this;this.digestInto(t);const i=t.slice(0,e);return this.destroy(),i}_cloneInto(t){t||(t=new this.constructor),t.set(...this.get());const{blockLen:e,buffer:i,length:r,finished:s,destroyed:o,pos:a}=this;return t.length=r,t.pos=a,t.finished=s,t.destroyed=o,r%e&&t.buffer.set(i),t}}const Gl=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),xt=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Ct=new Uint32Array(64);class Kl extends jl{constructor(){super(64,32,8,!1),this.A=xt[0]|0,this.B=xt[1]|0,this.C=xt[2]|0,this.D=xt[3]|0,this.E=xt[4]|0,this.F=xt[5]|0,this.G=xt[6]|0,this.H=xt[7]|0}get(){const{A:t,B:e,C:i,D:r,E:s,F:o,G:a,H:l}=this;return[t,e,i,r,s,o,a,l]}set(t,e,i,r,s,o,a,l){this.A=t|0,this.B=e|0,this.C=i|0,this.D=r|0,this.E=s|0,this.F=o|0,this.G=a|0,this.H=l|0}process(t,e){for(let u=0;u<16;u++,e+=4)Ct[u]=t.getUint32(e,!1);for(let u=16;u<64;u++){const d=Ct[u-15],g=Ct[u-2],m=ut(d,7)^ut(d,18)^d>>>3,f=ut(g,17)^ut(g,19)^g>>>10;Ct[u]=f+Ct[u-7]+m+Ct[u-16]|0}let{A:i,B:r,C:s,D:o,E:a,F:l,G:c,H:h}=this;for(let u=0;u<64;u++){const d=ut(a,6)^ut(a,11)^ut(a,25),g=h+d+Yl(a,l,c)+Gl[u]+Ct[u]|0,f=(ut(i,2)^ut(i,13)^ut(i,22))+Wl(i,r,s)|0;h=c,c=l,l=a,a=o+g|0,o=s,s=r,r=i,i=g+f|0}i=i+this.A|0,r=r+this.B|0,s=s+this.C|0,o=o+this.D|0,a=a+this.E|0,l=l+this.F|0,c=c+this.G|0,h=h+this.H|0,this.set(i,r,s,o,a,l,c,h)}roundClean(){Ct.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}const yi=ql(()=>new Kl);class fo extends ho{constructor(t,e){super(),this.finished=!1,this.destroyed=!1,Ul(t);const i=ji(e);if(this.iHash=t.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const r=this.blockLen,s=new Uint8Array(r);s.set(i.length>r?t.create().update(i).digest():i);for(let o=0;o<s.length;o++)s[o]^=54;this.iHash.update(s),this.oHash=t.create();for(let o=0;o<s.length;o++)s[o]^=106;this.oHash.update(s),s.fill(0)}update(t){return Tn(this),this.iHash.update(t),this}digestInto(t){Tn(this),$n(t,this.outputLen),this.finished=!0,this.iHash.digestInto(t),this.oHash.update(t),this.oHash.digestInto(t),this.destroy()}digest(){const t=new Uint8Array(this.oHash.outputLen);return this.digestInto(t),t}_cloneInto(t){t||(t=Object.create(Object.getPrototypeOf(this),{}));const{oHash:e,iHash:i,finished:r,destroyed:s,blockLen:o,outputLen:a}=this;return t=t,t.finished=r,t.destroyed=s,t.blockLen=o,t.outputLen=a,t.oHash=e._cloneInto(t.oHash),t.iHash=i._cloneInto(t.iHash),t}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const go=(n,t,e)=>new fo(n,t).update(e).digest();go.create=(n,t)=>new fo(n,t);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Gi=BigInt(0),Hn=BigInt(1),Vl=BigInt(2);function Zt(n){return n instanceof Uint8Array||n!=null&&typeof n=="object"&&n.constructor.name==="Uint8Array"}function We(n){if(!Zt(n))throw new Error("Uint8Array expected")}function me(n,t){if(typeof t!="boolean")throw new Error(`${n} must be valid boolean, got "${t}".`)}const Zl=Array.from({length:256},(n,t)=>t.toString(16).padStart(2,"0"));function we(n){We(n);let t="";for(let e=0;e<n.length;e++)t+=Zl[n[e]];return t}function po(n){const t=n.toString(16);return t.length&1?`0${t}`:t}function Ki(n){if(typeof n!="string")throw new Error("hex string expected, got "+typeof n);return BigInt(n===""?"0":`0x${n}`)}const gt={_0:48,_9:57,_A:65,_F:70,_a:97,_f:102};function kr(n){if(n>=gt._0&&n<=gt._9)return n-gt._0;if(n>=gt._A&&n<=gt._F)return n-(gt._A-10);if(n>=gt._a&&n<=gt._f)return n-(gt._a-10)}function ye(n){if(typeof n!="string")throw new Error("hex string expected, got "+typeof n);const t=n.length,e=t/2;if(t%2)throw new Error("padded hex string expected, got unpadded hex of length "+t);const i=new Uint8Array(e);for(let r=0,s=0;r<e;r++,s+=2){const o=kr(n.charCodeAt(s)),a=kr(n.charCodeAt(s+1));if(o===void 0||a===void 0){const l=n[s]+n[s+1];throw new Error('hex string expected, got non-hex character "'+l+'" at index '+s)}i[r]=o*16+a}return i}function yt(n){return Ki(we(n))}function Vi(n){return We(n),Ki(we(Uint8Array.from(n).reverse()))}function kt(n,t){return ye(n.toString(16).padStart(t*2,"0"))}function Zi(n,t){return kt(n,t).reverse()}function Jl(n){return ye(po(n))}function et(n,t,e){let i;if(typeof t=="string")try{i=ye(t)}catch(s){throw new Error(`${n} must be valid hex string, got "${t}". Cause: ${s}`)}else if(Zt(t))i=Uint8Array.from(t);else throw new Error(`${n} must be hex string or Uint8Array`);const r=i.length;if(typeof e=="number"&&r!==e)throw new Error(`${n} expected ${e} bytes, got ${r}`);return i}function Jt(...n){let t=0;for(let i=0;i<n.length;i++){const r=n[i];We(r),t+=r.length}const e=new Uint8Array(t);for(let i=0,r=0;i<n.length;i++){const s=n[i];e.set(s,r),r+=s.length}return e}function Xl(n,t){if(n.length!==t.length)return!1;let e=0;for(let i=0;i<n.length;i++)e|=n[i]^t[i];return e===0}function Ql(n){if(typeof n!="string")throw new Error(`utf8ToBytes expected string, got ${typeof n}`);return new Uint8Array(new TextEncoder().encode(n))}const ei=n=>typeof n=="bigint"&&Gi<=n;function be(n,t,e){return ei(n)&&ei(t)&&ei(e)&&t<=n&&n<e}function Rt(n,t,e,i){if(!be(t,e,i))throw new Error(`expected valid ${n}: ${e} <= n < ${i}, got ${typeof t} ${t}`)}function tc(n){let t;for(t=0;n>Gi;n>>=Hn,t+=1);return t}function ec(n,t){return n>>BigInt(t)&Hn}function nc(n,t,e){return n|(e?Hn:Gi)<<BigInt(t)}const Ji=n=>(Vl<<BigInt(n-1))-Hn,ni=n=>new Uint8Array(n),Lr=n=>Uint8Array.from(n);function _o(n,t,e){if(typeof n!="number"||n<2)throw new Error("hashLen must be a number");if(typeof t!="number"||t<2)throw new Error("qByteLen must be a number");if(typeof e!="function")throw new Error("hmacFn must be a function");let i=ni(n),r=ni(n),s=0;const o=()=>{i.fill(1),r.fill(0),s=0},a=(...u)=>e(r,i,...u),l=(u=ni())=>{r=a(Lr([0]),u),i=a(),u.length!==0&&(r=a(Lr([1]),u),i=a())},c=()=>{if(s++>=1e3)throw new Error("drbg: tried 1000 values");let u=0;const d=[];for(;u<t;){i=a();const g=i.slice();d.push(g),u+=i.length}return Jt(...d)};return(u,d)=>{o(),l(u);let g;for(;!(g=d(c()));)l();return o(),g}}const ic={bigint:n=>typeof n=="bigint",function:n=>typeof n=="function",boolean:n=>typeof n=="boolean",string:n=>typeof n=="string",stringOrUint8Array:n=>typeof n=="string"||Zt(n),isSafeInteger:n=>Number.isSafeInteger(n),array:n=>Array.isArray(n),field:(n,t)=>t.Fp.isValid(n),hash:n=>typeof n=="function"&&Number.isSafeInteger(n.outputLen)};function je(n,t,e={}){const i=(r,s,o)=>{const a=ic[s];if(typeof a!="function")throw new Error(`Invalid validator "${s}", expected function`);const l=n[r];if(!(o&&l===void 0)&&!a(l,n))throw new Error(`Invalid param ${String(r)}=${l} (${typeof l}), expected ${s}`)};for(const[r,s]of Object.entries(t))i(r,s,!1);for(const[r,s]of Object.entries(e))i(r,s,!0);return n}const rc=()=>{throw new Error("not implemented")};function bi(n){const t=new WeakMap;return(e,...i)=>{const r=t.get(e);if(r!==void 0)return r;const s=n(e,...i);return t.set(e,s),s}}const sc=Object.freeze(Object.defineProperty({__proto__:null,aInRange:Rt,abool:me,abytes:We,bitGet:ec,bitLen:tc,bitMask:Ji,bitSet:nc,bytesToHex:we,bytesToNumberBE:yt,bytesToNumberLE:Vi,concatBytes:Jt,createHmacDrbg:_o,ensureBytes:et,equalBytes:Xl,hexToBytes:ye,hexToNumber:Ki,inRange:be,isBytes:Zt,memoized:bi,notImplemented:rc,numberToBytesBE:kt,numberToBytesLE:Zi,numberToHexUnpadded:po,numberToVarBytesBE:Jl,utf8ToBytes:Ql,validateObject:je},Symbol.toStringTag,{value:"Module"}));/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const X=BigInt(0),K=BigInt(1),Wt=BigInt(2),oc=BigInt(3),Ei=BigInt(4),Dr=BigInt(5),Or=BigInt(8);BigInt(9);BigInt(16);function Q(n,t){const e=n%t;return e>=X?e:t+e}function ac(n,t,e){if(e<=X||t<X)throw new Error("Expected power/modulo > 0");if(e===K)return X;let i=K;for(;t>X;)t&K&&(i=i*n%e),n=n*n%e,t>>=K;return i}function st(n,t,e){let i=n;for(;t-- >X;)i*=i,i%=e;return i}function Si(n,t){if(n===X||t<=X)throw new Error(`invert: expected positive integers, got n=${n} mod=${t}`);let e=Q(n,t),i=t,r=X,s=K;for(;e!==X;){const a=i/e,l=i%e,c=r-s*a;i=e,e=l,r=s,s=c}if(i!==K)throw new Error("invert: does not exist");return Q(r,t)}function lc(n){const t=(n-K)/Wt;let e,i,r;for(e=n-K,i=0;e%Wt===X;e/=Wt,i++);for(r=Wt;r<n&&ac(r,t,n)!==n-K;r++);if(i===1){const o=(n+K)/Ei;return function(l,c){const h=l.pow(c,o);if(!l.eql(l.sqr(h),c))throw new Error("Cannot find square root");return h}}const s=(e+K)/Wt;return function(a,l){if(a.pow(l,t)===a.neg(a.ONE))throw new Error("Cannot find square root");let c=i,h=a.pow(a.mul(a.ONE,r),e),u=a.pow(l,s),d=a.pow(l,e);for(;!a.eql(d,a.ONE);){if(a.eql(d,a.ZERO))return a.ZERO;let g=1;for(let f=a.sqr(d);g<c&&!a.eql(f,a.ONE);g++)f=a.sqr(f);const m=a.pow(h,K<<BigInt(c-g-1));h=a.sqr(m),u=a.mul(u,m),d=a.mul(d,h),c=g}return u}}function cc(n){if(n%Ei===oc){const t=(n+K)/Ei;return function(i,r){const s=i.pow(r,t);if(!i.eql(i.sqr(s),r))throw new Error("Cannot find square root");return s}}if(n%Or===Dr){const t=(n-Dr)/Or;return function(i,r){const s=i.mul(r,Wt),o=i.pow(s,t),a=i.mul(r,o),l=i.mul(i.mul(a,Wt),o),c=i.mul(a,i.sub(l,i.ONE));if(!i.eql(i.sqr(c),r))throw new Error("Cannot find square root");return c}}return lc(n)}const hc=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function uc(n){const t={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},e=hc.reduce((i,r)=>(i[r]="function",i),t);return je(n,e)}function dc(n,t,e){if(e<X)throw new Error("Expected power > 0");if(e===X)return n.ONE;if(e===K)return t;let i=n.ONE,r=t;for(;e>X;)e&K&&(i=n.mul(i,r)),r=n.sqr(r),e>>=K;return i}function fc(n,t){const e=new Array(t.length),i=t.reduce((s,o,a)=>n.is0(o)?s:(e[a]=s,n.mul(s,o)),n.ONE),r=n.inv(i);return t.reduceRight((s,o,a)=>n.is0(o)?s:(e[a]=n.mul(s,e[a]),n.mul(s,o)),r),e}function mo(n,t){const e=t!==void 0?t:n.toString(2).length,i=Math.ceil(e/8);return{nBitLength:e,nByteLength:i}}function gc(n,t,e=!1,i={}){if(n<=X)throw new Error(`Expected Field ORDER > 0, got ${n}`);const{nBitLength:r,nByteLength:s}=mo(n,t);if(s>2048)throw new Error("Field lengths over 2048 bytes are not supported");const o=cc(n),a=Object.freeze({ORDER:n,BITS:r,BYTES:s,MASK:Ji(r),ZERO:X,ONE:K,create:l=>Q(l,n),isValid:l=>{if(typeof l!="bigint")throw new Error(`Invalid field element: expected bigint, got ${typeof l}`);return X<=l&&l<n},is0:l=>l===X,isOdd:l=>(l&K)===K,neg:l=>Q(-l,n),eql:(l,c)=>l===c,sqr:l=>Q(l*l,n),add:(l,c)=>Q(l+c,n),sub:(l,c)=>Q(l-c,n),mul:(l,c)=>Q(l*c,n),pow:(l,c)=>dc(a,l,c),div:(l,c)=>Q(l*Si(c,n),n),sqrN:l=>l*l,addN:(l,c)=>l+c,subN:(l,c)=>l-c,mulN:(l,c)=>l*c,inv:l=>Si(l,n),sqrt:i.sqrt||(l=>o(a,l)),invertBatch:l=>fc(a,l),cmov:(l,c,h)=>h?c:l,toBytes:l=>e?Zi(l,s):kt(l,s),fromBytes:l=>{if(l.length!==s)throw new Error(`Fp.fromBytes: expected ${s}, got ${l.length}`);return e?Vi(l):yt(l)}});return Object.freeze(a)}function wo(n){if(typeof n!="bigint")throw new Error("field order must be bigint");const t=n.toString(2).length;return Math.ceil(t/8)}function yo(n){const t=wo(n);return t+Math.ceil(t/2)}function pc(n,t,e=!1){const i=n.length,r=wo(t),s=yo(t);if(i<16||i<s||i>1024)throw new Error(`expected ${s}-1024 bytes of input, got ${i}`);const o=e?yt(n):Vi(n),a=Q(o,t-K)+K;return e?Zi(a,r):kt(a,r)}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const _c=BigInt(0),ii=BigInt(1),ri=new WeakMap,Mr=new WeakMap;function mc(n,t){const e=(s,o)=>{const a=o.negate();return s?a:o},i=s=>{if(!Number.isSafeInteger(s)||s<=0||s>t)throw new Error(`Wrong window size=${s}, should be [1..${t}]`)},r=s=>{i(s);const o=Math.ceil(t/s)+1,a=2**(s-1);return{windows:o,windowSize:a}};return{constTimeNegate:e,unsafeLadder(s,o){let a=n.ZERO,l=s;for(;o>_c;)o&ii&&(a=a.add(l)),l=l.double(),o>>=ii;return a},precomputeWindow(s,o){const{windows:a,windowSize:l}=r(o),c=[];let h=s,u=h;for(let d=0;d<a;d++){u=h,c.push(u);for(let g=1;g<l;g++)u=u.add(h),c.push(u);h=u.double()}return c},wNAF(s,o,a){const{windows:l,windowSize:c}=r(s);let h=n.ZERO,u=n.BASE;const d=BigInt(2**s-1),g=2**s,m=BigInt(s);for(let f=0;f<l;f++){const _=f*c;let p=Number(a&d);a>>=m,p>c&&(p-=g,a+=ii);const b=_,x=_+Math.abs(p)-1,E=f%2!==0,v=p<0;p===0?u=u.add(e(E,o[b])):h=h.add(e(v,o[x]))}return{p:h,f:u}},wNAFCached(s,o,a){const l=Mr.get(s)||1;let c=ri.get(s);return c||(c=this.precomputeWindow(s,l),l!==1&&ri.set(s,a(c))),this.wNAF(l,c,o)},setWindowSize(s,o){i(o),Mr.set(s,o),ri.delete(s)}}}function bo(n){return uc(n.Fp),je(n,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...mo(n.n,n.nBitLength),...n,p:n.Fp.ORDER})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function Ur(n){n.lowS!==void 0&&me("lowS",n.lowS),n.prehash!==void 0&&me("prehash",n.prehash)}function wc(n){const t=bo(n);je(t,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});const{endo:e,Fp:i,a:r}=t;if(e){if(!i.eql(r,i.ZERO))throw new Error("Endomorphism can only be defined for Koblitz curves that have a=0");if(typeof e!="object"||typeof e.beta!="bigint"||typeof e.splitScalar!="function")throw new Error("Expected endomorphism with beta: bigint and splitScalar: function")}return Object.freeze({...t})}const{bytesToNumberBE:yc,hexToBytes:bc}=sc,Gt={Err:class extends Error{constructor(t=""){super(t)}},_parseInt(n){const{Err:t}=Gt;if(n.length<2||n[0]!==2)throw new t("Invalid signature integer tag");const e=n[1],i=n.subarray(2,e+2);if(!e||i.length!==e)throw new t("Invalid signature integer: wrong length");if(i[0]&128)throw new t("Invalid signature integer: negative");if(i[0]===0&&!(i[1]&128))throw new t("Invalid signature integer: unnecessary leading zero");return{d:yc(i),l:n.subarray(e+2)}},toSig(n){const{Err:t}=Gt,e=typeof n=="string"?bc(n):n;We(e);let i=e.length;if(i<2||e[0]!=48)throw new t("Invalid signature tag");if(e[1]!==i-2)throw new t("Invalid signature: incorrect length");const{d:r,l:s}=Gt._parseInt(e.subarray(2)),{d:o,l:a}=Gt._parseInt(s);if(a.length)throw new t("Invalid signature: left bytes after parsing");return{r,s:o}},hexFromSig(n){const t=c=>Number.parseInt(c[0],16)&8?"00"+c:c,e=c=>{const h=c.toString(16);return h.length&1?`0${h}`:h},i=t(e(n.s)),r=t(e(n.r)),s=i.length/2,o=r.length/2,a=e(s),l=e(o);return`30${e(o+s+4)}02${l}${r}02${a}${i}`}},At=BigInt(0),J=BigInt(1);BigInt(2);const Fr=BigInt(3);BigInt(4);function Ec(n){const t=wc(n),{Fp:e}=t,i=t.toBytes||((m,f,_)=>{const p=f.toAffine();return Jt(Uint8Array.from([4]),e.toBytes(p.x),e.toBytes(p.y))}),r=t.fromBytes||(m=>{const f=m.subarray(1),_=e.fromBytes(f.subarray(0,e.BYTES)),p=e.fromBytes(f.subarray(e.BYTES,2*e.BYTES));return{x:_,y:p}});function s(m){const{a:f,b:_}=t,p=e.sqr(m),b=e.mul(p,m);return e.add(e.add(b,e.mul(m,f)),_)}if(!e.eql(e.sqr(t.Gy),s(t.Gx)))throw new Error("bad generator point: equation left != right");function o(m){return be(m,J,t.n)}function a(m){const{allowedPrivateKeyLengths:f,nByteLength:_,wrapPrivateKey:p,n:b}=t;if(f&&typeof m!="bigint"){if(Zt(m)&&(m=we(m)),typeof m!="string"||!f.includes(m.length))throw new Error("Invalid key");m=m.padStart(_*2,"0")}let x;try{x=typeof m=="bigint"?m:yt(et("private key",m,_))}catch{throw new Error(`private key must be ${_} bytes, hex or bigint, not ${typeof m}`)}return p&&(x=Q(x,b)),Rt("private key",x,J,b),x}function l(m){if(!(m instanceof u))throw new Error("ProjectivePoint expected")}const c=bi((m,f)=>{const{px:_,py:p,pz:b}=m;if(e.eql(b,e.ONE))return{x:_,y:p};const x=m.is0();f==null&&(f=x?e.ONE:e.inv(b));const E=e.mul(_,f),v=e.mul(p,f),A=e.mul(b,f);if(x)return{x:e.ZERO,y:e.ZERO};if(!e.eql(A,e.ONE))throw new Error("invZ was invalid");return{x:E,y:v}}),h=bi(m=>{if(m.is0()){if(t.allowInfinityPoint&&!e.is0(m.py))return;throw new Error("bad point: ZERO")}const{x:f,y:_}=m.toAffine();if(!e.isValid(f)||!e.isValid(_))throw new Error("bad point: x or y not FE");const p=e.sqr(_),b=s(f);if(!e.eql(p,b))throw new Error("bad point: equation left != right");if(!m.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});class u{constructor(f,_,p){if(this.px=f,this.py=_,this.pz=p,f==null||!e.isValid(f))throw new Error("x required");if(_==null||!e.isValid(_))throw new Error("y required");if(p==null||!e.isValid(p))throw new Error("z required");Object.freeze(this)}static fromAffine(f){const{x:_,y:p}=f||{};if(!f||!e.isValid(_)||!e.isValid(p))throw new Error("invalid affine point");if(f instanceof u)throw new Error("projective point not allowed");const b=x=>e.eql(x,e.ZERO);return b(_)&&b(p)?u.ZERO:new u(_,p,e.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(f){const _=e.invertBatch(f.map(p=>p.pz));return f.map((p,b)=>p.toAffine(_[b])).map(u.fromAffine)}static fromHex(f){const _=u.fromAffine(r(et("pointHex",f)));return _.assertValidity(),_}static fromPrivateKey(f){return u.BASE.multiply(a(f))}_setWindowSize(f){g.setWindowSize(this,f)}assertValidity(){h(this)}hasEvenY(){const{y:f}=this.toAffine();if(e.isOdd)return!e.isOdd(f);throw new Error("Field doesn't support isOdd")}equals(f){l(f);const{px:_,py:p,pz:b}=this,{px:x,py:E,pz:v}=f,A=e.eql(e.mul(_,v),e.mul(x,b)),R=e.eql(e.mul(p,v),e.mul(E,b));return A&&R}negate(){return new u(this.px,e.neg(this.py),this.pz)}double(){const{a:f,b:_}=t,p=e.mul(_,Fr),{px:b,py:x,pz:E}=this;let v=e.ZERO,A=e.ZERO,R=e.ZERO,B=e.mul(b,b),U=e.mul(x,x),P=e.mul(E,E),k=e.mul(b,x);return k=e.add(k,k),R=e.mul(b,E),R=e.add(R,R),v=e.mul(f,R),A=e.mul(p,P),A=e.add(v,A),v=e.sub(U,A),A=e.add(U,A),A=e.mul(v,A),v=e.mul(k,v),R=e.mul(p,R),P=e.mul(f,P),k=e.sub(B,P),k=e.mul(f,k),k=e.add(k,R),R=e.add(B,B),B=e.add(R,B),B=e.add(B,P),B=e.mul(B,k),A=e.add(A,B),P=e.mul(x,E),P=e.add(P,P),B=e.mul(P,k),v=e.sub(v,B),R=e.mul(P,U),R=e.add(R,R),R=e.add(R,R),new u(v,A,R)}add(f){l(f);const{px:_,py:p,pz:b}=this,{px:x,py:E,pz:v}=f;let A=e.ZERO,R=e.ZERO,B=e.ZERO;const U=t.a,P=e.mul(t.b,Fr);let k=e.mul(_,x),w=e.mul(p,E),T=e.mul(b,v),S=e.add(_,p),y=e.add(x,E);S=e.mul(S,y),y=e.add(k,w),S=e.sub(S,y),y=e.add(_,b);let C=e.add(x,v);return y=e.mul(y,C),C=e.add(k,T),y=e.sub(y,C),C=e.add(p,b),A=e.add(E,v),C=e.mul(C,A),A=e.add(w,T),C=e.sub(C,A),B=e.mul(U,y),A=e.mul(P,T),B=e.add(A,B),A=e.sub(w,B),B=e.add(w,B),R=e.mul(A,B),w=e.add(k,k),w=e.add(w,k),T=e.mul(U,T),y=e.mul(P,y),w=e.add(w,T),T=e.sub(k,T),T=e.mul(U,T),y=e.add(y,T),k=e.mul(w,y),R=e.add(R,k),k=e.mul(C,y),A=e.mul(S,A),A=e.sub(A,k),k=e.mul(S,w),B=e.mul(C,B),B=e.add(B,k),new u(A,R,B)}subtract(f){return this.add(f.negate())}is0(){return this.equals(u.ZERO)}wNAF(f){return g.wNAFCached(this,f,u.normalizeZ)}multiplyUnsafe(f){Rt("scalar",f,At,t.n);const _=u.ZERO;if(f===At)return _;if(f===J)return this;const{endo:p}=t;if(!p)return g.unsafeLadder(this,f);let{k1neg:b,k1:x,k2neg:E,k2:v}=p.splitScalar(f),A=_,R=_,B=this;for(;x>At||v>At;)x&J&&(A=A.add(B)),v&J&&(R=R.add(B)),B=B.double(),x>>=J,v>>=J;return b&&(A=A.negate()),E&&(R=R.negate()),R=new u(e.mul(R.px,p.beta),R.py,R.pz),A.add(R)}multiply(f){const{endo:_,n:p}=t;Rt("scalar",f,J,p);let b,x;if(_){const{k1neg:E,k1:v,k2neg:A,k2:R}=_.splitScalar(f);let{p:B,f:U}=this.wNAF(v),{p:P,f:k}=this.wNAF(R);B=g.constTimeNegate(E,B),P=g.constTimeNegate(A,P),P=new u(e.mul(P.px,_.beta),P.py,P.pz),b=B.add(P),x=U.add(k)}else{const{p:E,f:v}=this.wNAF(f);b=E,x=v}return u.normalizeZ([b,x])[0]}multiplyAndAddUnsafe(f,_,p){const b=u.BASE,x=(v,A)=>A===At||A===J||!v.equals(b)?v.multiplyUnsafe(A):v.multiply(A),E=x(this,_).add(x(f,p));return E.is0()?void 0:E}toAffine(f){return c(this,f)}isTorsionFree(){const{h:f,isTorsionFree:_}=t;if(f===J)return!0;if(_)return _(u,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:f,clearCofactor:_}=t;return f===J?this:_?_(u,this):this.multiplyUnsafe(t.h)}toRawBytes(f=!0){return me("isCompressed",f),this.assertValidity(),i(u,this,f)}toHex(f=!0){return me("isCompressed",f),we(this.toRawBytes(f))}}u.BASE=new u(t.Gx,t.Gy,e.ONE),u.ZERO=new u(e.ZERO,e.ONE,e.ZERO);const d=t.nBitLength,g=mc(u,t.endo?Math.ceil(d/2):d);return{CURVE:t,ProjectivePoint:u,normPrivateKeyToScalar:a,weierstrassEquation:s,isWithinCurveOrder:o}}function Sc(n){const t=bo(n);return je(t,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...t})}function xc(n){const t=Sc(n),{Fp:e,n:i}=t,r=e.BYTES+1,s=2*e.BYTES+1;function o(S){return Q(S,i)}function a(S){return Si(S,i)}const{ProjectivePoint:l,normPrivateKeyToScalar:c,weierstrassEquation:h,isWithinCurveOrder:u}=Ec({...t,toBytes(S,y,C){const I=y.toAffine(),N=e.toBytes(I.x),L=Jt;return me("isCompressed",C),C?L(Uint8Array.from([y.hasEvenY()?2:3]),N):L(Uint8Array.from([4]),N,e.toBytes(I.y))},fromBytes(S){const y=S.length,C=S[0],I=S.subarray(1);if(y===r&&(C===2||C===3)){const N=yt(I);if(!be(N,J,e.ORDER))throw new Error("Point is not on curve");const L=h(N);let M;try{M=e.sqrt(L)}catch(D){const Y=D instanceof Error?": "+D.message:"";throw new Error("Point is not on curve"+Y)}const F=(M&J)===J;return(C&1)===1!==F&&(M=e.neg(M)),{x:N,y:M}}else if(y===s&&C===4){const N=e.fromBytes(I.subarray(0,e.BYTES)),L=e.fromBytes(I.subarray(e.BYTES,2*e.BYTES));return{x:N,y:L}}else throw new Error(`Point of length ${y} was invalid. Expected ${r} compressed bytes or ${s} uncompressed bytes`)}}),d=S=>we(kt(S,t.nByteLength));function g(S){const y=i>>J;return S>y}function m(S){return g(S)?o(-S):S}const f=(S,y,C)=>yt(S.slice(y,C));class _{constructor(y,C,I){this.r=y,this.s=C,this.recovery=I,this.assertValidity()}static fromCompact(y){const C=t.nByteLength;return y=et("compactSignature",y,C*2),new _(f(y,0,C),f(y,C,2*C))}static fromDER(y){const{r:C,s:I}=Gt.toSig(et("DER",y));return new _(C,I)}assertValidity(){Rt("r",this.r,J,i),Rt("s",this.s,J,i)}addRecoveryBit(y){return new _(this.r,this.s,y)}recoverPublicKey(y){const{r:C,s:I,recovery:N}=this,L=A(et("msgHash",y));if(N==null||![0,1,2,3].includes(N))throw new Error("recovery id invalid");const M=N===2||N===3?C+t.n:C;if(M>=e.ORDER)throw new Error("recovery id 2 or 3 invalid");const F=N&1?"03":"02",V=l.fromHex(F+d(M)),D=a(M),Y=o(-L*D),tt=o(I*D),W=l.BASE.multiplyAndAddUnsafe(V,Y,tt);if(!W)throw new Error("point at infinify");return W.assertValidity(),W}hasHighS(){return g(this.s)}normalizeS(){return this.hasHighS()?new _(this.r,o(-this.s),this.recovery):this}toDERRawBytes(){return ye(this.toDERHex())}toDERHex(){return Gt.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return ye(this.toCompactHex())}toCompactHex(){return d(this.r)+d(this.s)}}const p={isValidPrivateKey(S){try{return c(S),!0}catch{return!1}},normPrivateKeyToScalar:c,randomPrivateKey:()=>{const S=yo(t.n);return pc(t.randomBytes(S),t.n)},precompute(S=8,y=l.BASE){return y._setWindowSize(S),y.multiply(BigInt(3)),y}};function b(S,y=!0){return l.fromPrivateKey(S).toRawBytes(y)}function x(S){const y=Zt(S),C=typeof S=="string",I=(y||C)&&S.length;return y?I===r||I===s:C?I===2*r||I===2*s:S instanceof l}function E(S,y,C=!0){if(x(S))throw new Error("first arg must be private key");if(!x(y))throw new Error("second arg must be public key");return l.fromHex(y).multiply(c(S)).toRawBytes(C)}const v=t.bits2int||function(S){const y=yt(S),C=S.length*8-t.nBitLength;return C>0?y>>BigInt(C):y},A=t.bits2int_modN||function(S){return o(v(S))},R=Ji(t.nBitLength);function B(S){return Rt(`num < 2^${t.nBitLength}`,S,At,R),kt(S,t.nByteLength)}function U(S,y,C=P){if(["recovered","canonical"].some(G=>G in C))throw new Error("sign() legacy options not supported");const{hash:I,randomBytes:N}=t;let{lowS:L,prehash:M,extraEntropy:F}=C;L==null&&(L=!0),S=et("msgHash",S),Ur(C),M&&(S=et("prehashed msgHash",I(S)));const V=A(S),D=c(y),Y=[B(D),B(V)];if(F!=null&&F!==!1){const G=F===!0?N(e.BYTES):F;Y.push(et("extraEntropy",G))}const tt=Jt(...Y),W=V;function at(G){const z=v(G);if(!u(z))return;const Z=a(z),H=l.BASE.multiply(z).toAffine(),q=o(H.x);if(q===At)return;const ht=o(Z*o(W+q*D));if(ht===At)return;let Mt=(H.x===q?0:2)|Number(H.y&J),Jn=ht;return L&&g(ht)&&(Jn=m(ht),Mt^=1),new _(q,Jn,Mt)}return{seed:tt,k2sig:at}}const P={lowS:t.lowS,prehash:!1},k={lowS:t.lowS,prehash:!1};function w(S,y,C=P){const{seed:I,k2sig:N}=U(S,y,C),L=t;return _o(L.hash.outputLen,L.nByteLength,L.hmac)(I,N)}l.BASE._setWindowSize(8);function T(S,y,C,I=k){var H;const N=S;if(y=et("msgHash",y),C=et("publicKey",C),"strict"in I)throw new Error("options.strict was renamed to lowS");Ur(I);const{lowS:L,prehash:M}=I;let F,V;try{if(typeof N=="string"||Zt(N))try{F=_.fromDER(N)}catch(q){if(!(q instanceof Gt.Err))throw q;F=_.fromCompact(N)}else if(typeof N=="object"&&typeof N.r=="bigint"&&typeof N.s=="bigint"){const{r:q,s:ht}=N;F=new _(q,ht)}else throw new Error("PARSE");V=l.fromHex(C)}catch(q){if(q.message==="PARSE")throw new Error("signature must be Signature instance, Uint8Array or hex string");return!1}if(L&&F.hasHighS())return!1;M&&(y=t.hash(y));const{r:D,s:Y}=F,tt=A(y),W=a(Y),at=o(tt*W),G=o(D*W),z=(H=l.BASE.multiplyAndAddUnsafe(V,at,G))==null?void 0:H.toAffine();return z?o(z.x)===D:!1}return{CURVE:t,getPublicKey:b,getSharedSecret:E,sign:w,verify:T,ProjectivePoint:l,Signature:_,utils:p}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function Cc(n){return{hash:n,hmac:(t,...e)=>go(n,t,Hl(...e)),randomBytes:uo}}function Ac(n,t){const e=i=>xc({...n,...Cc(i)});return Object.freeze({...e(t),create:e})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Ge=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),vn=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),Le=BigInt(1),In=BigInt(2),$r=(n,t)=>(n+t/In)/t;function Eo(n){const t=Ge,e=BigInt(3),i=BigInt(6),r=BigInt(11),s=BigInt(22),o=BigInt(23),a=BigInt(44),l=BigInt(88),c=n*n*n%t,h=c*c*n%t,u=st(h,e,t)*h%t,d=st(u,e,t)*h%t,g=st(d,In,t)*c%t,m=st(g,r,t)*g%t,f=st(m,s,t)*m%t,_=st(f,a,t)*f%t,p=st(_,l,t)*_%t,b=st(p,a,t)*f%t,x=st(b,e,t)*h%t,E=st(x,o,t)*m%t,v=st(E,i,t)*c%t,A=st(v,In,t);if(!xi.eql(xi.sqr(A),n))throw new Error("Cannot find square root");return A}const xi=gc(Ge,void 0,void 0,{sqrt:Eo}),Xi=Ac({a:BigInt(0),b:BigInt(7),Fp:xi,n:vn,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:n=>{const t=vn,e=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),i=-Le*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),r=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),s=e,o=BigInt("0x100000000000000000000000000000000"),a=$r(s*n,t),l=$r(-i*n,t);let c=Q(n-a*e-l*r,t),h=Q(-a*i-l*s,t);const u=c>o,d=h>o;if(u&&(c=t-c),d&&(h=t-h),c>o||h>o)throw new Error("splitScalar: Endomorphism failed, k="+n);return{k1neg:u,k1:c,k2neg:d,k2:h}}}},yi),So=BigInt(0),Hr={};function Rn(n,...t){let e=Hr[n];if(e===void 0){const i=yi(Uint8Array.from(n,r=>r.charCodeAt(0)));e=Jt(i,i),Hr[n]=e}return yi(Jt(e,...t))}const Qi=n=>n.toRawBytes(!0).slice(1),Ci=n=>kt(n,32),si=n=>Q(n,Ge),De=n=>Q(n,vn),tr=Xi.ProjectivePoint,Tc=(n,t,e)=>tr.BASE.multiplyAndAddUnsafe(n,t,e);function Ai(n){let t=Xi.utils.normPrivateKeyToScalar(n),e=tr.fromPrivateKey(t);return{scalar:e.hasEvenY()?t:De(-t),bytes:Qi(e)}}function xo(n){Rt("x",n,Le,Ge);const t=si(n*n),e=si(t*n+BigInt(7));let i=Eo(e);i%In!==So&&(i=si(-i));const r=new tr(n,i,Le);return r.assertValidity(),r}const he=yt;function Co(...n){return De(he(Rn("BIP0340/challenge",...n)))}function vc(n){return Ai(n).bytes}function Ic(n,t,e=uo(32)){const i=et("message",n),{bytes:r,scalar:s}=Ai(t),o=et("auxRand",e,32),a=Ci(s^he(Rn("BIP0340/aux",o))),l=Rn("BIP0340/nonce",a,r,i),c=De(he(l));if(c===So)throw new Error("sign failed: k is zero");const{bytes:h,scalar:u}=Ai(c),d=Co(h,r,i),g=new Uint8Array(64);if(g.set(h,0),g.set(Ci(De(u+d*s)),32),!Ao(g,i,r))throw new Error("sign: Invalid signature produced");return g}function Ao(n,t,e){const i=et("signature",n,64),r=et("message",t),s=et("publicKey",e,32);try{const o=xo(he(s)),a=he(i.subarray(0,32));if(!be(a,Le,Ge))return!1;const l=he(i.subarray(32,64));if(!be(l,Le,vn))return!1;const c=Co(Ci(a),Qi(o),r),h=Tc(o,l,De(-c));return!(!h||!h.hasEvenY()||h.toAffine().x!==a)}catch{return!1}}const er={getPublicKey:vc,sign:Ic,verify:Ao,utils:{randomPrivateKey:Xi.utils.randomPrivateKey,lift_x:xo,pointToBytes:Qi,numberToBytesBE:kt,bytesToNumberBE:yt,taggedHash:Rn,mod:Q}},Oe="Trystero",Me=(n,t)=>Array(n).fill().map(t),qr="0123456789AaBbCcDdEeFfGgHhIiJjKkLlMmNnOoPpQqRrSsTtUuVvWwXxYyZz",Ti=n=>Me(n,()=>qr[Math.floor(Math.random()*qr.length)]).join(""),ae=Ti(20),le=Promise.all.bind(Promise),nr=typeof window<"u",{entries:zr,fromEntries:Rc,keys:Nc}=Object,Ht=()=>{},mt=n=>new Error(`${Oe}: ${n}`),Bc=new TextEncoder,Pc=new TextDecoder,Kt=n=>Bc.encode(n),fn=n=>Pc.decode(n),vi=n=>n.reduce((t,e)=>t+e.toString(16).padStart(2,"0"),""),en=(...n)=>n.join("@"),kc=(n,t,e)=>(n.relayUrls||t).slice(0,n.relayUrls?n.relayUrls.length:n.relayRedundancy||e),Et=JSON.stringify,Nn=JSON.parse,Yr=3333,re={},Lc=(n,t)=>{const e={},i=()=>{const r=new WebSocket(n);r.onclose=()=>{re[n]??(re[n]=Yr),setTimeout(i,re[n]),re[n]*=2},r.onmessage=s=>t(s.data),e.socket=r,e.url=r.url,e.ready=new Promise(s=>r.onopen=()=>{s(e),re[n]=Yr}),e.send=s=>{r.readyState===1&&r.send(s)}};return i(),e},ir="AES-GCM",oi={},Dc=n=>btoa(String.fromCharCode.apply(null,new Uint8Array(n))),Oc=n=>{const t=atob(n);return new Uint8Array(t.length).map((e,i)=>t.charCodeAt(i)).buffer},nn=async n=>{if(oi[n])return oi[n];const t=Array.from(new Uint8Array(await crypto.subtle.digest("SHA-1",Kt(n)))).map(e=>e.toString(36)).join("");return oi[n]=t,t},Mc=async(n,t,e)=>crypto.subtle.importKey("raw",await crypto.subtle.digest({name:"SHA-256"},Kt(`${n}:${t}:${e}`)),{name:ir},!1,["encrypt","decrypt"]),To="$",vo=",",Uc=async(n,t)=>{const e=crypto.getRandomValues(new Uint8Array(16));return e.join(vo)+To+Dc(await crypto.subtle.encrypt({name:ir,iv:e},await n,Kt(t)))},Fc=async(n,t)=>{const[e,i]=t.split(To);return fn(await crypto.subtle.decrypt({name:ir,iv:new Uint8Array(e.split(vo))},await n,Oc(i)))};function Io(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var Ii={exports:{}},ai,Wr;function $c(){if(Wr)return ai;Wr=1;var n=1e3,t=n*60,e=t*60,i=e*24,r=i*7,s=i*365.25;ai=function(h,u){u=u||{};var d=typeof h;if(d==="string"&&h.length>0)return o(h);if(d==="number"&&isFinite(h))return u.long?l(h):a(h);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(h))};function o(h){if(h=String(h),!(h.length>100)){var u=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(h);if(u){var d=parseFloat(u[1]),g=(u[2]||"ms").toLowerCase();switch(g){case"years":case"year":case"yrs":case"yr":case"y":return d*s;case"weeks":case"week":case"w":return d*r;case"days":case"day":case"d":return d*i;case"hours":case"hour":case"hrs":case"hr":case"h":return d*e;case"minutes":case"minute":case"mins":case"min":case"m":return d*t;case"seconds":case"second":case"secs":case"sec":case"s":return d*n;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return d;default:return}}}}function a(h){var u=Math.abs(h);return u>=i?Math.round(h/i)+"d":u>=e?Math.round(h/e)+"h":u>=t?Math.round(h/t)+"m":u>=n?Math.round(h/n)+"s":h+"ms"}function l(h){var u=Math.abs(h);return u>=i?c(h,u,i,"day"):u>=e?c(h,u,e,"hour"):u>=t?c(h,u,t,"minute"):u>=n?c(h,u,n,"second"):h+" ms"}function c(h,u,d,g){var m=u>=d*1.5;return Math.round(h/d)+" "+g+(m?"s":"")}return ai}function Hc(n){e.debug=e,e.default=e,e.coerce=l,e.disable=s,e.enable=r,e.enabled=o,e.humanize=$c(),e.destroy=c,Object.keys(n).forEach(h=>{e[h]=n[h]}),e.names=[],e.skips=[],e.formatters={};function t(h){let u=0;for(let d=0;d<h.length;d++)u=(u<<5)-u+h.charCodeAt(d),u|=0;return e.colors[Math.abs(u)%e.colors.length]}e.selectColor=t;function e(h){let u,d=null,g,m;function f(..._){if(!f.enabled)return;const p=f,b=Number(new Date),x=b-(u||b);p.diff=x,p.prev=u,p.curr=b,u=b,_[0]=e.coerce(_[0]),typeof _[0]!="string"&&_.unshift("%O");let E=0;_[0]=_[0].replace(/%([a-zA-Z%])/g,(A,R)=>{if(A==="%%")return"%";E++;const B=e.formatters[R];if(typeof B=="function"){const U=_[E];A=B.call(p,U),_.splice(E,1),E--}return A}),e.formatArgs.call(p,_),(p.log||e.log).apply(p,_)}return f.namespace=h,f.useColors=e.useColors(),f.color=e.selectColor(h),f.extend=i,f.destroy=e.destroy,Object.defineProperty(f,"enabled",{enumerable:!0,configurable:!1,get:()=>d!==null?d:(g!==e.namespaces&&(g=e.namespaces,m=e.enabled(h)),m),set:_=>{d=_}}),typeof e.init=="function"&&e.init(f),f}function i(h,u){const d=e(this.namespace+(typeof u>"u"?":":u)+h);return d.log=this.log,d}function r(h){e.save(h),e.namespaces=h,e.names=[],e.skips=[];let u;const d=(typeof h=="string"?h:"").split(/[\s,]+/),g=d.length;for(u=0;u<g;u++)d[u]&&(h=d[u].replace(/\*/g,".*?"),h[0]==="-"?e.skips.push(new RegExp("^"+h.slice(1)+"$")):e.names.push(new RegExp("^"+h+"$")))}function s(){const h=[...e.names.map(a),...e.skips.map(a).map(u=>"-"+u)].join(",");return e.enable(""),h}function o(h){if(h[h.length-1]==="*")return!0;let u,d;for(u=0,d=e.skips.length;u<d;u++)if(e.skips[u].test(h))return!1;for(u=0,d=e.names.length;u<d;u++)if(e.names[u].test(h))return!0;return!1}function a(h){return h.toString().substring(2,h.toString().length-2).replace(/\.\*\?$/,"*")}function l(h){return h instanceof Error?h.stack||h.message:h}function c(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return e.enable(e.load()),e}var qc=Hc;(function(n,t){var e={};t.formatArgs=r,t.save=s,t.load=o,t.useColors=i,t.storage=a(),t.destroy=(()=>{let c=!1;return()=>{c||(c=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function i(){if(typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))return!0;if(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let c;return typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&(c=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(c[1],10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function r(c){if(c[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+c[0]+(this.useColors?"%c ":" ")+"+"+n.exports.humanize(this.diff),!this.useColors)return;const h="color: "+this.color;c.splice(1,0,h,"color: inherit");let u=0,d=0;c[0].replace(/%[a-zA-Z%]/g,g=>{g!=="%%"&&(u++,g==="%c"&&(d=u))}),c.splice(d,0,h)}t.log=console.debug||console.log||(()=>{});function s(c){try{c?t.storage.setItem("debug",c):t.storage.removeItem("debug")}catch{}}function o(){let c;try{c=t.storage.getItem("debug")}catch{}return!c&&typeof process<"u"&&"env"in process&&(c=e.DEBUG),c}function a(){try{return localStorage}catch{}}n.exports=qc(t);const{formatters:l}=n.exports;l.j=function(c){try{return JSON.stringify(c)}catch(h){return"[UnexpectedJSONParseError]: "+h.message}}})(Ii,Ii.exports);var zc=Ii.exports;const Yc=Io(zc),bt=typeof window<"u"?window:self,Ri=bt.RTCPeerConnection||bt.mozRTCPeerConnection||bt.webkitRTCPeerConnection,Wc=bt.RTCSessionDescription||bt.mozRTCSessionDescription||bt.webkitRTCSessionDescription,jc=bt.RTCIceCandidate||bt.mozRTCIceCandidate||bt.webkitRTCIceCandidate;var rr={exports:{}},ue=typeof Reflect=="object"?Reflect:null,jr=ue&&typeof ue.apply=="function"?ue.apply:function(t,e,i){return Function.prototype.apply.call(t,e,i)},gn;ue&&typeof ue.ownKeys=="function"?gn=ue.ownKeys:Object.getOwnPropertySymbols?gn=function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:gn=function(t){return Object.getOwnPropertyNames(t)};function Gc(n){console&&console.warn&&console.warn(n)}var Ro=Number.isNaN||function(t){return t!==t};function $(){$.init.call(this)}rr.exports=$;rr.exports.once=Jc;$.EventEmitter=$;$.prototype._events=void 0;$.prototype._eventsCount=0;$.prototype._maxListeners=void 0;var Gr=10;function qn(n){if(typeof n!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof n)}Object.defineProperty($,"defaultMaxListeners",{enumerable:!0,get:function(){return Gr},set:function(n){if(typeof n!="number"||n<0||Ro(n))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+n+".");Gr=n}});$.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};$.prototype.setMaxListeners=function(t){if(typeof t!="number"||t<0||Ro(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this};function No(n){return n._maxListeners===void 0?$.defaultMaxListeners:n._maxListeners}$.prototype.getMaxListeners=function(){return No(this)};$.prototype.emit=function(t){for(var e=[],i=1;i<arguments.length;i++)e.push(arguments[i]);var r=t==="error",s=this._events;if(s!==void 0)r=r&&s.error===void 0;else if(!r)return!1;if(r){var o;if(e.length>0&&(o=e[0]),o instanceof Error)throw o;var a=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw a.context=o,a}var l=s[t];if(l===void 0)return!1;if(typeof l=="function")jr(l,this,e);else for(var c=l.length,h=Do(l,c),i=0;i<c;++i)jr(h[i],this,e);return!0};function Bo(n,t,e,i){var r,s,o;if(qn(e),s=n._events,s===void 0?(s=n._events=Object.create(null),n._eventsCount=0):(s.newListener!==void 0&&(n.emit("newListener",t,e.listener?e.listener:e),s=n._events),o=s[t]),o===void 0)o=s[t]=e,++n._eventsCount;else if(typeof o=="function"?o=s[t]=i?[e,o]:[o,e]:i?o.unshift(e):o.push(e),r=No(n),r>0&&o.length>r&&!o.warned){o.warned=!0;var a=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");a.name="MaxListenersExceededWarning",a.emitter=n,a.type=t,a.count=o.length,Gc(a)}return n}$.prototype.addListener=function(t,e){return Bo(this,t,e,!1)};$.prototype.on=$.prototype.addListener;$.prototype.prependListener=function(t,e){return Bo(this,t,e,!0)};function Kc(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function Po(n,t,e){var i={fired:!1,wrapFn:void 0,target:n,type:t,listener:e},r=Kc.bind(i);return r.listener=e,i.wrapFn=r,r}$.prototype.once=function(t,e){return qn(e),this.on(t,Po(this,t,e)),this};$.prototype.prependOnceListener=function(t,e){return qn(e),this.prependListener(t,Po(this,t,e)),this};$.prototype.removeListener=function(t,e){var i,r,s,o,a;if(qn(e),r=this._events,r===void 0)return this;if(i=r[t],i===void 0)return this;if(i===e||i.listener===e)--this._eventsCount===0?this._events=Object.create(null):(delete r[t],r.removeListener&&this.emit("removeListener",t,i.listener||e));else if(typeof i!="function"){for(s=-1,o=i.length-1;o>=0;o--)if(i[o]===e||i[o].listener===e){a=i[o].listener,s=o;break}if(s<0)return this;s===0?i.shift():Vc(i,s),i.length===1&&(r[t]=i[0]),r.removeListener!==void 0&&this.emit("removeListener",t,a||e)}return this};$.prototype.off=$.prototype.removeListener;$.prototype.removeAllListeners=function(t){var e,i,r;if(i=this._events,i===void 0)return this;if(i.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):i[t]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete i[t]),this;if(arguments.length===0){var s=Object.keys(i),o;for(r=0;r<s.length;++r)o=s[r],o!=="removeListener"&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(e=i[t],typeof e=="function")this.removeListener(t,e);else if(e!==void 0)for(r=e.length-1;r>=0;r--)this.removeListener(t,e[r]);return this};function ko(n,t,e){var i=n._events;if(i===void 0)return[];var r=i[t];return r===void 0?[]:typeof r=="function"?e?[r.listener||r]:[r]:e?Zc(r):Do(r,r.length)}$.prototype.listeners=function(t){return ko(this,t,!0)};$.prototype.rawListeners=function(t){return ko(this,t,!1)};$.listenerCount=function(n,t){return typeof n.listenerCount=="function"?n.listenerCount(t):Lo.call(n,t)};$.prototype.listenerCount=Lo;function Lo(n){var t=this._events;if(t!==void 0){var e=t[n];if(typeof e=="function")return 1;if(e!==void 0)return e.length}return 0}$.prototype.eventNames=function(){return this._eventsCount>0?gn(this._events):[]};function Do(n,t){for(var e=new Array(t),i=0;i<t;++i)e[i]=n[i];return e}function Vc(n,t){for(;t+1<n.length;t++)n[t]=n[t+1];n.pop()}function Zc(n){for(var t=new Array(n.length),e=0;e<t.length;++e)t[e]=n[e].listener||n[e];return t}function Jc(n,t){return new Promise(function(e,i){function r(o){n.removeListener(t,s),i(o)}function s(){typeof n.removeListener=="function"&&n.removeListener("error",r),e([].slice.call(arguments))}Oo(n,t,s,{once:!0}),t!=="error"&&Xc(n,r,{once:!0})})}function Xc(n,t,e){typeof n.on=="function"&&Oo(n,"error",t,e)}function Oo(n,t,e,i){if(typeof n.on=="function")i.once?n.once(t,e):n.on(t,e);else if(typeof n.addEventListener=="function")n.addEventListener(t,function r(s){i.once&&n.removeEventListener(t,r),e(s)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof n)}var Qc=rr.exports,th=typeof queueMicrotask=="function"?queueMicrotask:n=>Promise.resolve().then(n),eh=class{constructor(t){if(!(t>0)||t-1&t)throw new Error("Max size for a FixedFIFO should be a power of two");this.buffer=new Array(t),this.mask=t-1,this.top=0,this.btm=0,this.next=null}clear(){this.top=this.btm=0,this.next=null,this.buffer.fill(void 0)}push(t){return this.buffer[this.top]!==void 0?!1:(this.buffer[this.top]=t,this.top=this.top+1&this.mask,!0)}shift(){const t=this.buffer[this.btm];if(t!==void 0)return this.buffer[this.btm]=void 0,this.btm=this.btm+1&this.mask,t}peek(){return this.buffer[this.btm]}isEmpty(){return this.buffer[this.btm]===void 0}};const Kr=eh;var nh=class{constructor(t){this.hwm=t||16,this.head=new Kr(this.hwm),this.tail=this.head,this.length=0}clear(){this.head=this.tail,this.head.clear(),this.length=0}push(t){if(this.length++,!this.head.push(t)){const e=this.head;this.head=e.next=new Kr(2*this.head.buffer.length),this.head.push(t)}}shift(){this.length!==0&&this.length--;const t=this.tail.shift();if(t===void 0&&this.tail.next){const e=this.tail.next;return this.tail.next=null,this.tail=e,this.tail.shift()}return t}peek(){const t=this.tail.peek();return t===void 0&&this.tail.next?this.tail.next.peek():t}isEmpty(){return this.length===0}},Mo=class{constructor(t){this.decoder=new TextDecoder(t==="utf16le"?"utf16-le":t)}decode(t){return this.decoder.decode(t,{stream:!0})}flush(){return this.decoder.decode(new Uint8Array(0))}};const ih=Mo,rh=Mo;var sh=class{constructor(t="utf8"){switch(this.encoding=oh(t),this.encoding){case"utf8":this.decoder=new rh;break;case"utf16le":case"base64":throw new Error("Unsupported encoding: "+this.encoding);default:this.decoder=new ih(this.encoding)}}push(t){return typeof t=="string"?t:this.decoder.decode(t)}write(t){return this.push(t)}end(t){let e="";return t&&(e=this.push(t)),e+=this.decoder.flush(),e}};function oh(n){switch(n=n.toLowerCase(),n){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return n;default:throw new Error("Unknown encoding: "+n)}}const{EventEmitter:ah}=Qc,zn=new Error("Stream was destroyed"),li=new Error("Premature close"),Uo=th,Fo=nh,lh=sh,j=(1<<29)-1,ne=1,sr=2,Xt=4,Ue=8,$o=j^ne,ch=j^sr,Ke=16,Fe=32,Ie=64,Nt=128,Ve=256,or=512,Qt=1024,Ni=2048,ar=4096,lr=8192,ct=16384,de=32768,Yn=65536,te=131072,Ho=Ve|or,hh=Ke|Yn,uh=Ie|Ke,dh=ar|Nt,cr=Ve|te,fh=j^Ke,gh=j^Ie,ph=j^(Ie|Yn),_h=j^Yn,mh=j^Ve,wh=j^(Nt|lr),yh=j^Qt,Vr=j^Ho,qo=j^de,bh=j^Fe,zo=j^te,Eh=j^cr,Dt=1<<18,Ee=2<<18,Ze=4<<18,ee=8<<18,Je=16<<18,ie=32<<18,Bi=64<<18,fe=128<<18,hr=256<<18,Se=512<<18,Wn=1024<<18,Yo=j^(Dt|hr),Wo=j^Ze,Sh=j^Se,xh=j^Je,Ch=j^ee,jo=j^fe,Ah=j^Ee,Go=j^Wn,$e=Ke|Dt,Ko=j^$e,ur=ct|ie,St=Xt|Ue|sr,nt=St|ne,Vo=St|ur,Th=Wo&gh,dr=fe|de,vh=dr&Ko,Zo=nt|vh,Ih=nt|Qt|ct,Zr=nt|ct|Nt,Rh=nt|Qt|Nt,Nh=nt|ar|Nt|lr,Bh=nt|Ke|Qt|ct|Yn|te,Ph=St|Qt|ct,kh=Fe|nt|de|Ie,Lh=nt|Se|ie,Dh=ee|Je,Jo=ee|Dt,Oh=ee|Je|nt|Dt,Jr=nt|Dt|ee|Wn,Mh=Ze|Dt,Uh=Dt|hr,Fh=nt|Se|Jo|ie,$h=Je|St|Se|ie,Hh=Ee|nt|fe|Ze,rn=Symbol.asyncIterator||Symbol("asyncIterator");class Xo{constructor(t,{highWaterMark:e=16384,map:i=null,mapWritable:r,byteLength:s,byteLengthWritable:o}={}){this.stream=t,this.queue=new Fo,this.highWaterMark=e,this.buffered=0,this.error=null,this.pipeline=null,this.drains=null,this.byteLength=o||s||sa,this.map=r||i,this.afterWrite=Gh.bind(this),this.afterUpdateNextTick=Zh.bind(this)}get ended(){return(this.stream._duplexState&ie)!==0}push(t){return this.map!==null&&(t=this.map(t)),this.buffered+=this.byteLength(t),this.queue.push(t),this.buffered<this.highWaterMark?(this.stream._duplexState|=ee,!0):(this.stream._duplexState|=Dh,!1)}shift(){const t=this.queue.shift();return this.buffered-=this.byteLength(t),this.buffered===0&&(this.stream._duplexState&=Ch),t}end(t){typeof t=="function"?this.stream.once("finish",t):t!=null&&this.push(t),this.stream._duplexState=(this.stream._duplexState|Se)&Wo}autoBatch(t,e){const i=[],r=this.stream;for(i.push(t);(r._duplexState&Jr)===Jo;)i.push(r._writableState.shift());if(r._duplexState&nt)return e(null);r._writev(i,e)}update(){const t=this.stream;t._duplexState|=Ee;do{for(;(t._duplexState&Jr)===ee;){const e=this.shift();t._duplexState|=Uh,t._write(e,this.afterWrite)}t._duplexState&Mh||this.updateNonPrimary()}while(this.continueUpdate()===!0);t._duplexState&=Ah}updateNonPrimary(){const t=this.stream;if((t._duplexState&Fh)===Se){t._duplexState=(t._duplexState|Dt)&Sh,t._final(jh.bind(this));return}if((t._duplexState&St)===Xt){t._duplexState&dr||(t._duplexState|=$e,t._destroy(Qo.bind(this)));return}(t._duplexState&Zo)===ne&&(t._duplexState=(t._duplexState|$e)&$o,t._open(ta.bind(this)))}continueUpdate(){return this.stream._duplexState&fe?(this.stream._duplexState&=jo,!0):!1}updateCallback(){(this.stream._duplexState&Hh)===Ze?this.update():this.updateNextTick()}updateNextTick(){this.stream._duplexState&fe||(this.stream._duplexState|=fe,this.stream._duplexState&Ee||Uo(this.afterUpdateNextTick))}}class qh{constructor(t,{highWaterMark:e=16384,map:i=null,mapReadable:r,byteLength:s,byteLengthReadable:o}={}){this.stream=t,this.queue=new Fo,this.highWaterMark=e===0?1:e,this.buffered=0,this.readAhead=e>0,this.error=null,this.pipeline=null,this.byteLength=o||s||sa,this.map=r||i,this.pipeTo=null,this.afterRead=Kh.bind(this),this.afterUpdateNextTick=Vh.bind(this)}get ended(){return(this.stream._duplexState&ct)!==0}pipe(t,e){if(this.pipeTo!==null)throw new Error("Can only pipe to one destination");if(typeof e!="function"&&(e=null),this.stream._duplexState|=or,this.pipeTo=t,this.pipeline=new Yh(this.stream,t,e),e&&this.stream.on("error",Xr),qe(t))t._writableState.pipeline=this.pipeline,e&&t.on("error",Xr),t.on("finish",this.pipeline.finished.bind(this.pipeline));else{const i=this.pipeline.done.bind(this.pipeline,t),r=this.pipeline.done.bind(this.pipeline,t,null);t.on("error",i),t.on("close",r),t.on("finish",this.pipeline.finished.bind(this.pipeline))}t.on("drain",Wh.bind(this)),this.stream.emit("piping",t),t.emit("pipe",this.stream)}push(t){const e=this.stream;return t===null?(this.highWaterMark=0,e._duplexState=(e._duplexState|Qt)&ph,!1):this.map!==null&&(t=this.map(t),t===null)?this.buffered<this.highWaterMark:(this.buffered+=this.byteLength(t),this.queue.push(t),e._duplexState=(e._duplexState|Nt)&_h,this.buffered<this.highWaterMark)}shift(){const t=this.queue.shift();return this.buffered-=this.byteLength(t),this.buffered===0&&(this.stream._duplexState&=wh),t}unshift(t){const e=[this.map!==null?this.map(t):t];for(;this.buffered>0;)e.push(this.shift());for(let i=0;i<e.length-1;i++){const r=e[i];this.buffered+=this.byteLength(r),this.queue.push(r)}this.push(e[e.length-1])}read(){const t=this.stream;if((t._duplexState&Zr)===Nt){const e=this.shift();return this.pipeTo!==null&&this.pipeTo.write(e)===!1&&(t._duplexState&=Vr),t._duplexState&Ni&&t.emit("data",e),e}return this.readAhead===!1&&(t._duplexState|=te,this.updateNextTick()),null}drain(){const t=this.stream;for(;(t._duplexState&Zr)===Nt&&t._duplexState&Ho;){const e=this.shift();this.pipeTo!==null&&this.pipeTo.write(e)===!1&&(t._duplexState&=Vr),t._duplexState&Ni&&t.emit("data",e)}}update(){const t=this.stream;t._duplexState|=Fe;do{for(this.drain();this.buffered<this.highWaterMark&&(t._duplexState&Bh)===te;)t._duplexState|=hh,t._read(this.afterRead),this.drain();(t._duplexState&Nh)===dh&&(t._duplexState|=lr,t.emit("readable")),t._duplexState&uh||this.updateNonPrimary()}while(this.continueUpdate()===!0);t._duplexState&=bh}updateNonPrimary(){const t=this.stream;if((t._duplexState&Rh)===Qt&&(t._duplexState=(t._duplexState|ct)&yh,t.emit("end"),(t._duplexState&Vo)===ur&&(t._duplexState|=Xt),this.pipeTo!==null&&this.pipeTo.end()),(t._duplexState&St)===Xt){t._duplexState&dr||(t._duplexState|=$e,t._destroy(Qo.bind(this)));return}(t._duplexState&Zo)===ne&&(t._duplexState=(t._duplexState|$e)&$o,t._open(ta.bind(this)))}continueUpdate(){return this.stream._duplexState&de?(this.stream._duplexState&=qo,!0):!1}updateCallback(){(this.stream._duplexState&kh)===Ie?this.update():this.updateNextTick()}updateNextTick(){this.stream._duplexState&de||(this.stream._duplexState|=de,this.stream._duplexState&Fe||Uo(this.afterUpdateNextTick))}}class zh{constructor(t){this.data=null,this.afterTransform=Xh.bind(t),this.afterFinal=null}}class Yh{constructor(t,e,i){this.from=t,this.to=e,this.afterPipe=i,this.error=null,this.pipeToFinished=!1}finished(){this.pipeToFinished=!0}done(t,e){if(e&&(this.error=e),t===this.to&&(this.to=null,this.from!==null)){(!(this.from._duplexState&ct)||!this.pipeToFinished)&&this.from.destroy(this.error||new Error("Writable stream closed prematurely"));return}if(t===this.from&&(this.from=null,this.to!==null)){t._duplexState&ct||this.to.destroy(this.error||new Error("Readable stream closed before ending"));return}this.afterPipe!==null&&this.afterPipe(this.error),this.to=this.from=this.afterPipe=null}}function Wh(){this.stream._duplexState|=or,this.updateCallback()}function jh(n){const t=this.stream;n&&t.destroy(n),t._duplexState&St||(t._duplexState|=ie,t.emit("finish")),(t._duplexState&Vo)===ur&&(t._duplexState|=Xt),t._duplexState&=Yo,t._duplexState&Ee?this.updateNextTick():this.update()}function Qo(n){const t=this.stream;!n&&this.error!==zn&&(n=this.error),n&&t.emit("error",n),t._duplexState|=Ue,t.emit("close");const e=t._readableState,i=t._writableState;if(e!==null&&e.pipeline!==null&&e.pipeline.done(t,n),i!==null){for(;i.drains!==null&&i.drains.length>0;)i.drains.shift().resolve(!1);i.pipeline!==null&&i.pipeline.done(t,n)}}function Gh(n){const t=this.stream;n&&t.destroy(n),t._duplexState&=Yo,this.drains!==null&&Jh(this.drains),(t._duplexState&Oh)===Je&&(t._duplexState&=xh,(t._duplexState&Bi)===Bi&&t.emit("drain")),this.updateCallback()}function Kh(n){n&&this.stream.destroy(n),this.stream._duplexState&=fh,this.readAhead===!1&&!(this.stream._duplexState&Ve)&&(this.stream._duplexState&=zo),this.updateCallback()}function Vh(){this.stream._duplexState&Fe||(this.stream._duplexState&=qo,this.update())}function Zh(){this.stream._duplexState&Ee||(this.stream._duplexState&=jo,this.update())}function Jh(n){for(let t=0;t<n.length;t++)--n[t].writes===0&&(n.shift().resolve(!0),t--)}function ta(n){const t=this.stream;n&&t.destroy(n),t._duplexState&Xt||(t._duplexState&Ih||(t._duplexState|=Ie),t._duplexState&Lh||(t._duplexState|=Ze),t.emit("open")),t._duplexState&=Ko,t._writableState!==null&&t._writableState.updateCallback(),t._readableState!==null&&t._readableState.updateCallback()}function Xh(n,t){t!=null&&this.push(t),this._writableState.afterWrite(n)}function Qh(n){this._readableState!==null&&(n==="data"&&(this._duplexState|=Ni|cr,this._readableState.updateNextTick()),n==="readable"&&(this._duplexState|=ar,this._readableState.updateNextTick())),this._writableState!==null&&n==="drain"&&(this._duplexState|=Bi,this._writableState.updateNextTick())}class fr extends ah{constructor(t){super(),this._duplexState=0,this._readableState=null,this._writableState=null,t&&(t.open&&(this._open=t.open),t.destroy&&(this._destroy=t.destroy),t.predestroy&&(this._predestroy=t.predestroy),t.signal&&t.signal.addEventListener("abort",au.bind(this))),this.on("newListener",Qh)}_open(t){t(null)}_destroy(t){t(null)}_predestroy(){}get readable(){return this._readableState!==null?!0:void 0}get writable(){return this._writableState!==null?!0:void 0}get destroyed(){return(this._duplexState&Ue)!==0}get destroying(){return(this._duplexState&St)!==0}destroy(t){this._duplexState&St||(t||(t=zn),this._duplexState=(this._duplexState|Xt)&Th,this._readableState!==null&&(this._readableState.highWaterMark=0,this._readableState.error=t),this._writableState!==null&&(this._writableState.highWaterMark=0,this._writableState.error=t),this._duplexState|=sr,this._predestroy(),this._duplexState&=ch,this._readableState!==null&&this._readableState.updateNextTick(),this._writableState!==null&&this._writableState.updateNextTick())}}class He extends fr{constructor(t){super(t),this._duplexState|=ne|ie|te,this._readableState=new qh(this,t),t&&(this._readableState.readAhead===!1&&(this._duplexState&=zo),t.read&&(this._read=t.read),t.eagerOpen&&this._readableState.updateNextTick(),t.encoding&&this.setEncoding(t.encoding))}setEncoding(t){const e=new lh(t),i=this._readableState.map||iu;return this._readableState.map=r,this;function r(s){const o=e.push(s);return o===""?null:i(o)}}_read(t){t(null)}pipe(t,e){return this._readableState.updateNextTick(),this._readableState.pipe(t,e),t}read(){return this._readableState.updateNextTick(),this._readableState.read()}push(t){return this._readableState.updateNextTick(),this._readableState.push(t)}unshift(t){return this._readableState.updateNextTick(),this._readableState.unshift(t)}resume(){return this._duplexState|=cr,this._readableState.updateNextTick(),this}pause(){return this._duplexState&=this._readableState.readAhead===!1?Eh:mh,this}static _fromAsyncIterator(t,e){let i;const r=new He({...e,read(o){t.next().then(s).then(o.bind(null,null)).catch(o)},predestroy(){i=t.return()},destroy(o){if(!i)return o(null);i.then(o.bind(null,null)).catch(o)}});return r;function s(o){o.done?r.push(null):r.push(o.value)}}static from(t,e){if(su(t))return t;if(t[rn])return this._fromAsyncIterator(t[rn](),e);Array.isArray(t)||(t=t===void 0?[]:[t]);let i=0;return new He({...e,read(r){this.push(i===t.length?null:t[i++]),r(null)}})}static isBackpressured(t){return(t._duplexState&Ph)!==0||t._readableState.buffered>=t._readableState.highWaterMark}static isPaused(t){return(t._duplexState&Ve)===0}[rn](){const t=this;let e=null,i=null,r=null;return this.on("error",c=>{e=c}),this.on("readable",s),this.on("close",o),{[rn](){return this},next(){return new Promise(function(c,h){i=c,r=h;const u=t.read();u!==null?a(u):t._duplexState&Ue&&a(null)})},return(){return l(null)},throw(c){return l(c)}};function s(){i!==null&&a(t.read())}function o(){i!==null&&a(null)}function a(c){r!==null&&(e?r(e):c===null&&!(t._duplexState&ct)?r(zn):i({value:c,done:c===null}),r=i=null)}function l(c){return t.destroy(c),new Promise((h,u)=>{if(t._duplexState&Ue)return h({value:void 0,done:!0});t.once("close",function(){c?u(c):h({value:void 0,done:!0})})})}}}class ea extends fr{constructor(t){super(t),this._duplexState|=ne|ct,this._writableState=new Xo(this,t),t&&(t.writev&&(this._writev=t.writev),t.write&&(this._write=t.write),t.final&&(this._final=t.final),t.eagerOpen&&this._writableState.updateNextTick())}cork(){this._duplexState|=Wn}uncork(){this._duplexState&=Go,this._writableState.updateNextTick()}_writev(t,e){e(null)}_write(t,e){this._writableState.autoBatch(t,e)}_final(t){t(null)}static isBackpressured(t){return(t._duplexState&$h)!==0}static drained(t){if(t.destroyed)return Promise.resolve(!1);const e=t._writableState,r=(lu(t)?Math.min(1,e.queue.length):e.queue.length)+(t._duplexState&hr?1:0);return r===0?Promise.resolve(!0):(e.drains===null&&(e.drains=[]),new Promise(s=>{e.drains.push({writes:r,resolve:s})}))}write(t){return this._writableState.updateNextTick(),this._writableState.push(t)}end(t){return this._writableState.updateNextTick(),this._writableState.end(t),this}}class gr extends He{constructor(t){super(t),this._duplexState=ne|this._duplexState&te,this._writableState=new Xo(this,t),t&&(t.writev&&(this._writev=t.writev),t.write&&(this._write=t.write),t.final&&(this._final=t.final))}cork(){this._duplexState|=Wn}uncork(){this._duplexState&=Go,this._writableState.updateNextTick()}_writev(t,e){e(null)}_write(t,e){this._writableState.autoBatch(t,e)}_final(t){t(null)}write(t){return this._writableState.updateNextTick(),this._writableState.push(t)}end(t){return this._writableState.updateNextTick(),this._writableState.end(t),this}}class na extends gr{constructor(t){super(t),this._transformState=new zh(this),t&&(t.transform&&(this._transform=t.transform),t.flush&&(this._flush=t.flush))}_write(t,e){this._readableState.buffered>=this._readableState.highWaterMark?this._transformState.data=t:this._transform(t,this._transformState.afterTransform)}_read(t){if(this._transformState.data!==null){const e=this._transformState.data;this._transformState.data=null,t(null),this._transform(e,this._transformState.afterTransform)}else t(null)}destroy(t){super.destroy(t),this._transformState.data!==null&&(this._transformState.data=null,this._transformState.afterTransform())}_transform(t,e){e(null,t)}_flush(t){t(null)}_final(t){this._transformState.afterFinal=t,this._flush(eu.bind(this))}}class tu extends na{}function eu(n,t){const e=this._transformState.afterFinal;if(n)return e(n);t!=null&&this.push(t),this.push(null),e(null)}function nu(...n){return new Promise((t,e)=>ia(...n,i=>{if(i)return e(i);t()}))}function ia(n,...t){const e=Array.isArray(n)?[...n,...t]:[n,...t],i=e.length&&typeof e[e.length-1]=="function"?e.pop():null;if(e.length<2)throw new Error("Pipeline requires at least 2 streams");let r=e[0],s=null,o=null;for(let c=1;c<e.length;c++)s=e[c],qe(r)?r.pipe(s,l):(a(r,!0,c>1,l),r.pipe(s)),r=s;if(i){let c=!1;const h=qe(s)||!!(s._writableState&&s._writableState.autoDestroy);s.on("error",u=>{o===null&&(o=u)}),s.on("finish",()=>{c=!0,h||i(o)}),h&&s.on("close",()=>i(o||(c?null:li)))}return s;function a(c,h,u,d){c.on("error",d),c.on("close",g);function g(){if(c._readableState&&!c._readableState.ended||u&&c._writableState&&!c._writableState.ended)return d(li)}}function l(c){if(!(!c||o)){o=c;for(const h of e)h.destroy(c)}}}function iu(n){return n}function ra(n){return!!n._readableState||!!n._writableState}function qe(n){return typeof n._duplexState=="number"&&ra(n)}function ru(n,t={}){const e=n._readableState&&n._readableState.error||n._writableState&&n._writableState.error;return!t.all&&e===zn?null:e}function su(n){return qe(n)&&n.readable}function ou(n){return typeof n=="object"&&n!==null&&typeof n.byteLength=="number"}function sa(n){return ou(n)?n.byteLength:1024}function Xr(){}function au(){this.destroy(new Error("Stream aborted."))}function lu(n){return n._writev!==ea.prototype._writev&&n._writev!==gr.prototype._writev}var cu={pipeline:ia,pipelinePromise:nu,isStream:ra,isStreamx:qe,getStreamError:ru,Stream:fr,Writable:ea,Readable:He,Duplex:gr,Transform:na,PassThrough:tu};function Qr(n,t){for(const e in t)Object.defineProperty(n,e,{value:t[e],enumerable:!0,configurable:!0});return n}function hu(n,t,e){if(!n||typeof n=="string")throw new TypeError("Please pass an Error to err-code");e||(e={}),typeof t=="object"&&(e=t,t=""),t&&(e.code=t);try{return Qr(n,e)}catch{e.message=n.message,e.stack=n.stack;const r=function(){};return r.prototype=Object.create(Object.getPrototypeOf(n)),Qr(new r,e)}}var uu=hu;const O=Io(uu);/* Common package for dealing with hex/string/uint8 conversions (and sha1 hashing)
*
* @author   Jimmy Wrting <jimmy@warting.se> (https://jimmy.warting.se/opensource)
* @license  MIT
*/const ts="0123456789abcdef",oa=[];for(let n=0;n<256;n++)oa[n]=ts[n>>4&15]+ts[n&15];const es=n=>{const t=n.length;let e="",i=0;for(;i<t;)e+=oa[n[i++]];return e};var ns="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",du=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(var sn=0;sn<ns.length;sn++)du[ns.charCodeAt(sn)]=sn;new TextDecoder;const fu=new TextEncoder,gu=n=>fu.encode(n),is=typeof window<"u"?window:self,Pi=is.crypto||is.msCrypto||{};Pi.subtle||Pi.webkitSubtle;const rs=n=>{const t=new Uint8Array(n);return Pi.getRandomValues(t)};/*! simple-peer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */const pu=Yc("simple-peer"),ci=64*1024,_u=5*1e3,mu=5*1e3;function ss(n){return n.replace(/a=ice-options:trickle\s\n/g,"")}function wu(n){console.warn(n)}let jn=class ki extends cu.Duplex{constructor(e){e=Object.assign({allowHalfOpen:!1},e);super(e);Er(this,"_pc");if(this.__objectMode=!!e.objectMode,this._id=es(rs(4)).slice(0,7),this._debug("new peer %o",e),this.channelName=e.initiator?e.channelName||es(rs(20)):null,this.initiator=e.initiator||!1,this.channelConfig=e.channelConfig||ki.channelConfig,this.channelNegotiated=this.channelConfig.negotiated,this.config=Object.assign({},ki.config,e.config),this.offerOptions=e.offerOptions||{},this.answerOptions=e.answerOptions||{},this.sdpTransform=e.sdpTransform||(i=>i),this.trickle=e.trickle!==void 0?e.trickle:!0,this.allowHalfTrickle=e.allowHalfTrickle!==void 0?e.allowHalfTrickle:!1,this.iceCompleteTimeout=e.iceCompleteTimeout||_u,this._destroying=!1,this._connected=!1,this.remoteAddress=void 0,this.remoteFamily=void 0,this.remotePort=void 0,this.localAddress=void 0,this.localFamily=void 0,this.localPort=void 0,!Ri)throw O(typeof window>"u"?new Error("No WebRTC support: Specify `opts.wrtc` option in this environment"):new Error("No WebRTC support: Not a supported browser"),"ERR_WEBRTC_SUPPORT");this._pcReady=!1,this._channelReady=!1,this._iceComplete=!1,this._iceCompleteTimer=null,this._channel=null,this._pendingCandidates=[],this._isNegotiating=!1,this._firstNegotiation=!0,this._batchedNegotiation=!1,this._queuedNegotiation=!1,this._sendersAwaitingStable=[],this._closingInterval=null,this._remoteTracks=[],this._remoteStreams=[],this._chunk=null,this._cb=null,this._interval=null;try{this._pc=new Ri(this.config)}catch(i){this.__destroy(O(i,"ERR_PC_CONSTRUCTOR"));return}this._isReactNativeWebrtc=typeof this._pc._peerConnectionId=="number",this._pc.oniceconnectionstatechange=()=>{this._onIceStateChange()},this._pc.onicegatheringstatechange=()=>{this._onIceStateChange()},this._pc.onconnectionstatechange=()=>{this._onConnectionStateChange()},this._pc.onsignalingstatechange=()=>{this._onSignalingStateChange()},this._pc.onicecandidate=i=>{this._onIceCandidate(i)},typeof this._pc.peerIdentity=="object"&&this._pc.peerIdentity.catch(i=>{this.__destroy(O(i,"ERR_PC_PEER_IDENTITY"))}),this.initiator||this.channelNegotiated?this._setupData({channel:this._pc.createDataChannel(this.channelName,this.channelConfig)}):this._pc.ondatachannel=i=>{this._setupData(i)},this._debug("initial negotiation"),this._needsNegotiation(),this._onFinishBound=()=>{this._onFinish()},this.once("finish",this._onFinishBound)}get bufferSize(){return this._channel&&this._channel.bufferedAmount||0}get connected(){return this._connected&&this._channel.readyState==="open"}address(){return{port:this.localPort,family:this.localFamily,address:this.localAddress}}signal(e){if(!this._destroying){if(this.destroyed)throw O(new Error("cannot signal after peer is destroyed"),"ERR_DESTROYED");if(typeof e=="string")try{e=JSON.parse(e)}catch{e={}}this._debug("signal()"),e.renegotiate&&this.initiator&&(this._debug("got request to renegotiate"),this._needsNegotiation()),e.transceiverRequest&&this.initiator&&(this._debug("got request for transceiver"),this.addTransceiver(e.transceiverRequest.kind,e.transceiverRequest.init)),e.candidate&&(this._pc.remoteDescription&&this._pc.remoteDescription.type?this._addIceCandidate(e.candidate):this._pendingCandidates.push(e.candidate)),e.sdp&&this._pc.setRemoteDescription(new Wc(e)).then(()=>{this.destroyed||(this._pendingCandidates.forEach(i=>{this._addIceCandidate(i)}),this._pendingCandidates=[],this._pc.remoteDescription.type==="offer"&&this._createAnswer())}).catch(i=>{this.__destroy(O(i,"ERR_SET_REMOTE_DESCRIPTION"))}),!e.sdp&&!e.candidate&&!e.renegotiate&&!e.transceiverRequest&&this.__destroy(O(new Error("signal() called with invalid signal data"),"ERR_SIGNALING"))}}_addIceCandidate(e){const i=new jc(e);this._pc.addIceCandidate(i).catch(r=>{!i.address||i.address.endsWith(".local")?wu("Ignoring unsupported ICE candidate."):this.__destroy(O(r,"ERR_ADD_ICE_CANDIDATE"))})}send(e){if(!this._destroying){if(this.destroyed)throw O(new Error("cannot send after peer is destroyed"),"ERR_DESTROYED");this._channel.send(e)}}_needsNegotiation(){this._debug("_needsNegotiation"),!this._batchedNegotiation&&(this._batchedNegotiation=!0,queueMicrotask(()=>{this._batchedNegotiation=!1,this.initiator||!this._firstNegotiation?(this._debug("starting batched negotiation"),this.negotiate()):this._debug("non-initiator initial negotiation request discarded"),this._firstNegotiation=!1}))}negotiate(){if(!this._destroying){if(this.destroyed)throw O(new Error("cannot negotiate after peer is destroyed"),"ERR_DESTROYED");this.initiator?this._isNegotiating?(this._queuedNegotiation=!0,this._debug("already negotiating, queueing")):(this._debug("start negotiation"),setTimeout(()=>{this._createOffer()},0)):this._isNegotiating?(this._queuedNegotiation=!0,this._debug("already negotiating, queueing")):(this._debug("requesting negotiation from initiator"),this.emit("signal",{type:"renegotiate",renegotiate:!0})),this._isNegotiating=!0}}_final(e){this._readableState.ended||this.push(null),e(null)}__destroy(e){this.end(),this._destroy(()=>{},e)}_destroy(e,i){this.destroyed||this._destroying||(this._destroying=!0,this._debug("destroying (error: %s)",i&&(i.message||i)),setTimeout(()=>{if(this._connected=!1,this._pcReady=!1,this._channelReady=!1,this._remoteTracks=null,this._remoteStreams=null,this._senderMap=null,clearInterval(this._closingInterval),this._closingInterval=null,clearInterval(this._interval),this._interval=null,this._chunk=null,this._cb=null,this._onFinishBound&&this.removeListener("finish",this._onFinishBound),this._onFinishBound=null,this._channel){try{this._channel.close()}catch{}this._channel.onmessage=null,this._channel.onopen=null,this._channel.onclose=null,this._channel.onerror=null}if(this._pc){try{this._pc.close()}catch{}this._pc.oniceconnectionstatechange=null,this._pc.onicegatheringstatechange=null,this._pc.onsignalingstatechange=null,this._pc.onicecandidate=null,this._pc.ontrack=null,this._pc.ondatachannel=null}this._pc=null,this._channel=null,i&&this.emit("error",i),e()},0))}_setupData(e){if(!e.channel)return this.__destroy(O(new Error("Data channel event is missing `channel` property"),"ERR_DATA_CHANNEL"));this._channel=e.channel,this._channel.binaryType="arraybuffer",typeof this._channel.bufferedAmountLowThreshold=="number"&&(this._channel.bufferedAmountLowThreshold=ci),this.channelName=this._channel.label,this._channel.onmessage=r=>{this._onChannelMessage(r)},this._channel.onbufferedamountlow=()=>{this._onChannelBufferedAmountLow()},this._channel.onopen=()=>{this._onChannelOpen()},this._channel.onclose=()=>{this._onChannelClose()},this._channel.onerror=r=>{const s=r.error instanceof Error?r.error:new Error(`Datachannel error: ${r.message} ${r.filename}:${r.lineno}:${r.colno}`);this.__destroy(O(s,"ERR_DATA_CHANNEL"))};let i=!1;this._closingInterval=setInterval(()=>{this._channel&&this._channel.readyState==="closing"?(i&&this._onChannelClose(),i=!0):i=!1},mu)}_write(e,i){if(this.destroyed)return i(O(new Error("cannot write after peer is destroyed"),"ERR_DATA_CHANNEL"));if(this._connected){try{this.send(e)}catch(r){return this.__destroy(O(r,"ERR_DATA_CHANNEL"))}this._channel.bufferedAmount>ci?(this._debug("start backpressure: bufferedAmount %d",this._channel.bufferedAmount),this._cb=i):i(null)}else this._debug("write before connect"),this._chunk=e,this._cb=i}_onFinish(){if(this.destroyed)return;const e=()=>{setTimeout(()=>this.__destroy(),1e3)};this._connected?e():this.once("connect",e)}_startIceCompleteTimeout(){this.destroyed||this._iceCompleteTimer||(this._debug("started iceComplete timeout"),this._iceCompleteTimer=setTimeout(()=>{this._iceComplete||(this._iceComplete=!0,this._debug("iceComplete timeout completed"),this.emit("iceTimeout"),this.emit("_iceComplete"))},this.iceCompleteTimeout))}_createOffer(){this.destroyed||this._pc.createOffer(this.offerOptions).then(e=>{if(this.destroyed)return;!this.trickle&&!this.allowHalfTrickle&&(e.sdp=ss(e.sdp)),e.sdp=this.sdpTransform(e.sdp);const i=()=>{if(this.destroyed)return;const o=this._pc.localDescription||e;this._debug("signal"),this.emit("signal",{type:o.type,sdp:o.sdp})},r=()=>{this._debug("createOffer success"),!this.destroyed&&(this.trickle||this._iceComplete?i():this.once("_iceComplete",i))},s=o=>{this.__destroy(O(o,"ERR_SET_LOCAL_DESCRIPTION"))};this._pc.setLocalDescription(e).then(r).catch(s)}).catch(e=>{this.__destroy(O(e,"ERR_CREATE_OFFER"))})}_createAnswer(){this.destroyed||this._pc.createAnswer(this.answerOptions).then(e=>{if(this.destroyed)return;!this.trickle&&!this.allowHalfTrickle&&(e.sdp=ss(e.sdp)),e.sdp=this.sdpTransform(e.sdp);const i=()=>{var a;if(this.destroyed)return;const o=this._pc.localDescription||e;this._debug("signal"),this.emit("signal",{type:o.type,sdp:o.sdp}),this.initiator||(a=this._requestMissingTransceivers)==null||a.call(this)},r=()=>{this.destroyed||(this.trickle||this._iceComplete?i():this.once("_iceComplete",i))},s=o=>{this.__destroy(O(o,"ERR_SET_LOCAL_DESCRIPTION"))};this._pc.setLocalDescription(e).then(r).catch(s)}).catch(e=>{this.__destroy(O(e,"ERR_CREATE_ANSWER"))})}_onConnectionStateChange(){this.destroyed||this._destroying||this._pc.connectionState==="failed"&&this.__destroy(O(new Error("Connection failed."),"ERR_CONNECTION_FAILURE"))}_onIceStateChange(){if(this.destroyed)return;const e=this._pc.iceConnectionState,i=this._pc.iceGatheringState;this._debug("iceStateChange (connection: %s) (gathering: %s)",e,i),this.emit("iceStateChange",e,i),(e==="connected"||e==="completed")&&(this._pcReady=!0,this._maybeReady()),e==="failed"&&this.__destroy(O(new Error("Ice connection failed."),"ERR_ICE_CONNECTION_FAILURE")),e==="closed"&&this.__destroy(O(new Error("Ice connection closed."),"ERR_ICE_CONNECTION_CLOSED"))}getStats(e){const i=r=>(Object.prototype.toString.call(r.values)==="[object Array]"&&r.values.forEach(s=>{Object.assign(r,s)}),r);this._pc.getStats.length===0||this._isReactNativeWebrtc?this._pc.getStats().then(r=>{const s=[];r.forEach(o=>{s.push(i(o))}),e(null,s)},r=>e(r)):this._pc.getStats.length>0?this._pc.getStats(r=>{if(this.destroyed)return;const s=[];r.result().forEach(o=>{const a={};o.names().forEach(l=>{a[l]=o.stat(l)}),a.id=o.id,a.type=o.type,a.timestamp=o.timestamp,s.push(i(a))}),e(null,s)},r=>e(r)):e(null,[])}_maybeReady(){if(this._debug("maybeReady pc %s channel %s",this._pcReady,this._channelReady),this._connected||this._connecting||!this._pcReady||!this._channelReady)return;this._connecting=!0;const e=()=>{this.destroyed||this._destroying||this.getStats((i,r)=>{if(this.destroyed||this._destroying)return;i&&(r=[]);const s={},o={},a={};let l=!1;r.forEach(h=>{(h.type==="remotecandidate"||h.type==="remote-candidate")&&(s[h.id]=h),(h.type==="localcandidate"||h.type==="local-candidate")&&(o[h.id]=h),(h.type==="candidatepair"||h.type==="candidate-pair")&&(a[h.id]=h)});const c=h=>{l=!0;let u=o[h.localCandidateId];u&&(u.ip||u.address)?(this.localAddress=u.ip||u.address,this.localPort=Number(u.port)):u&&u.ipAddress?(this.localAddress=u.ipAddress,this.localPort=Number(u.portNumber)):typeof h.googLocalAddress=="string"&&(u=h.googLocalAddress.split(":"),this.localAddress=u[0],this.localPort=Number(u[1])),this.localAddress&&(this.localFamily=this.localAddress.includes(":")?"IPv6":"IPv4");let d=s[h.remoteCandidateId];d&&(d.ip||d.address)?(this.remoteAddress=d.ip||d.address,this.remotePort=Number(d.port)):d&&d.ipAddress?(this.remoteAddress=d.ipAddress,this.remotePort=Number(d.portNumber)):typeof h.googRemoteAddress=="string"&&(d=h.googRemoteAddress.split(":"),this.remoteAddress=d[0],this.remotePort=Number(d[1])),this.remoteAddress&&(this.remoteFamily=this.remoteAddress.includes(":")?"IPv6":"IPv4"),this._debug("connect local: %s:%s remote: %s:%s",this.localAddress,this.localPort,this.remoteAddress,this.remotePort)};if(r.forEach(h=>{h.type==="transport"&&h.selectedCandidatePairId&&c(a[h.selectedCandidatePairId]),(h.type==="googCandidatePair"&&h.googActiveConnection==="true"||(h.type==="candidatepair"||h.type==="candidate-pair")&&h.selected)&&c(h)}),!l&&(!Object.keys(a).length||Object.keys(o).length)){setTimeout(e,100);return}else this._connecting=!1,this._connected=!0;if(this._chunk){try{this.send(this._chunk)}catch(u){return this.__destroy(O(u,"ERR_DATA_CHANNEL"))}this._chunk=null,this._debug('sent chunk from "write before connect"');const h=this._cb;this._cb=null,h(null)}typeof this._channel.bufferedAmountLowThreshold!="number"&&(this._interval=setInterval(()=>this._onInterval(),150),this._interval.unref&&this._interval.unref()),this._debug("connect"),this.emit("connect")})};e()}_onInterval(){!this._cb||!this._channel||this._channel.bufferedAmount>ci||this._onChannelBufferedAmountLow()}_onSignalingStateChange(){this.destroyed||(this._pc.signalingState==="stable"&&(this._isNegotiating=!1,this._debug("flushing sender queue",this._sendersAwaitingStable),this._sendersAwaitingStable.forEach(e=>{this._pc.removeTrack(e),this._queuedNegotiation=!0}),this._sendersAwaitingStable=[],this._queuedNegotiation?(this._debug("flushing negotiation queue"),this._queuedNegotiation=!1,this._needsNegotiation()):(this._debug("negotiated"),this.emit("negotiated"))),this._debug("signalingStateChange %s",this._pc.signalingState),this.emit("signalingStateChange",this._pc.signalingState))}_onIceCandidate(e){this.destroyed||(e.candidate&&this.trickle?this.emit("signal",{type:"candidate",candidate:{candidate:e.candidate.candidate,sdpMLineIndex:e.candidate.sdpMLineIndex,sdpMid:e.candidate.sdpMid}}):!e.candidate&&!this._iceComplete&&(this._iceComplete=!0,this.emit("_iceComplete")),e.candidate&&this._startIceCompleteTimeout())}_onChannelMessage(e){if(this.destroyed)return;let i=e.data;i instanceof ArrayBuffer?i=new Uint8Array(i):this.__objectMode===!1&&(i=gu(i)),this.push(i)}_onChannelBufferedAmountLow(){if(this.destroyed||!this._cb)return;this._debug("ending backpressure: bufferedAmount %d",this._channel.bufferedAmount);const e=this._cb;this._cb=null,e(null)}_onChannelOpen(){this._connected||this.destroyed||(this._debug("on channel open"),this._channelReady=!0,this._maybeReady())}_onChannelClose(){this.destroyed||(this._debug("on channel close"),this.__destroy())}_debug(){const e=[].slice.call(arguments);e[0]="["+this._id+"] "+e[0],pu.apply(null,e)}};jn.WEBRTC_SUPPORT=!!Ri;jn.config={iceServers:[{urls:["stun:stun.l.google.com:19302","stun:global.stun.twilio.com:3478"]}],sdpSemantics:"unified-plan"};jn.channelConfig={};/*! simple-peer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */class yu extends jn{constructor(t={}){super(t),this._pc&&(this.streams=t.streams||(t.stream?[t.stream]:[]),this._senderMap=new Map,this.streams&&this.streams.forEach(e=>{this.addStream(e)}),this._pc.ontrack=e=>{this._onTrack(e)})}addTransceiver(t,e){if(!this._destroying){if(this.destroyed)throw O(new Error("cannot addTransceiver after peer is destroyed"),"ERR_DESTROYED");if(this._debug("addTransceiver()"),this.initiator)try{this._pc.addTransceiver(t,e),this._needsNegotiation()}catch(i){this.__destroy(O(i,"ERR_ADD_TRANSCEIVER"))}else this.emit("signal",{type:"transceiverRequest",transceiverRequest:{kind:t,init:e}})}}addStream(t){if(!this._destroying){if(this.destroyed)throw O(new Error("cannot addStream after peer is destroyed"),"ERR_DESTROYED");this._debug("addStream()"),t.getTracks().forEach(e=>{this.addTrack(e,t)})}}addTrack(t,e){if(this._destroying)return;if(this.destroyed)throw O(new Error("cannot addTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("addTrack()");const i=this._senderMap.get(t)||new Map;let r=i.get(e);if(!r)r=this._pc.addTrack(t,e),i.set(e,r),this._senderMap.set(t,i),this._needsNegotiation();else throw r.removed?O(new Error("Track has been removed. You should enable/disable tracks that you want to re-add."),"ERR_SENDER_REMOVED"):O(new Error("Track has already been added to that stream."),"ERR_SENDER_ALREADY_ADDED")}replaceTrack(t,e,i){if(this._destroying)return;if(this.destroyed)throw O(new Error("cannot replaceTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("replaceTrack()");const r=this._senderMap.get(t),s=r?r.get(i):null;if(!s)throw O(new Error("Cannot replace track that was never added."),"ERR_TRACK_NOT_ADDED");e&&this._senderMap.set(e,r),s.replaceTrack!=null?s.replaceTrack(e):this.__destroy(O(new Error("replaceTrack is not supported in this browser"),"ERR_UNSUPPORTED_REPLACETRACK"))}removeTrack(t,e){if(this._destroying)return;if(this.destroyed)throw O(new Error("cannot removeTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("removeSender()");const i=this._senderMap.get(t),r=i?i.get(e):null;if(!r)throw O(new Error("Cannot remove track that was never added."),"ERR_TRACK_NOT_ADDED");try{r.removed=!0,this._pc.removeTrack(r)}catch(s){s.name==="NS_ERROR_UNEXPECTED"?this._sendersAwaitingStable.push(r):this.__destroy(O(s,"ERR_REMOVE_TRACK"))}this._needsNegotiation()}removeStream(t){if(!this._destroying){if(this.destroyed)throw O(new Error("cannot removeStream after peer is destroyed"),"ERR_DESTROYED");this._debug("removeSenders()"),t.getTracks().forEach(e=>{this.removeTrack(e,t)})}}_requestMissingTransceivers(){this._pc.getTransceivers&&this._pc.getTransceivers().forEach(t=>{!t.mid&&t.sender.track&&!t.requested&&(t.requested=!0,this.addTransceiver(t.sender.track.kind))})}_onTrack(t){this.destroyed||t.streams.forEach(e=>{this._debug("on track"),this.emit("track",t.track,e),this._remoteTracks.push({track:t.track,stream:e}),!this._remoteStreams.some(i=>i.id===e.id)&&(this._remoteStreams.push(e),queueMicrotask(()=>{this._debug("on stream"),this.emit("stream",e)}))})}}const os="data",as="signal",ls=(n,t)=>{const e=new yu({iceServers:[{urls:bu}],...t,initiator:n,trickle:!1}),i=s=>r.push(s);let r=[];return e.on(os,i),{id:e._id,created:Date.now(),connection:e._pc,get channel(){return e._channel},get isDead(){return e.destroyed},signal:s=>new Promise(o=>{n||e.on(as,o),e.signal(s)}),sendData:s=>e.send(s),destroy:()=>e.destroy(),setHandlers:s=>Object.entries(s).forEach(([o,a])=>e.on(o,a)),offerPromise:n?new Promise(s=>e.on(as,s)):Promise.resolve(),addStream:s=>e.addStream(s),removeStream:s=>e.removeStream(s),addTrack:(s,o)=>e.addTrack(s,o),removeTrack:(s,o)=>e.removeTrack(s,o),replaceTrack:(s,o,a)=>e.replaceTrack(s,o,a),drainEarlyData:s=>{e.off(os,i),r.forEach(s),r=null}}},bu=[...Me(5,(n,t)=>`stun:stun${t||""}.l.google.com:19302`),"stun:global.stun.twilio.com:3478"],Eu=Object.getPrototypeOf(Uint8Array),pn=12,aa=0,_n=aa+pn,mn=_n+1,Be=mn+1,Pe=Be+1,Ut=16*2**10-Pe,on=255,cs="bufferedamountlow",se=n=>"@_"+n,Su=(n,t,e)=>{const i={},r={},s={},o={},a={},l={},c={},h={onPeerJoin:Ht,onPeerLeave:Ht,onPeerStream:Ht,onPeerTrack:Ht},u=(w,T)=>(w?Array.isArray(w)?w:[w]:Nc(i)).flatMap(S=>{const y=i[S];return y?T(S,y):(console.warn(`${Oe}: no peer with id ${S} found`),[])}),d=w=>{i[w]&&(delete i[w],delete o[w],delete a[w],h.onPeerLeave(w),t(w))},g=w=>{if(r[w])return s[w];if(!w)throw mt("action type argument is required");const T=Kt(w);if(T.byteLength>pn)throw mt(`action type string "${w}" (${T.byteLength}b) exceeds byte limit (${pn}). Hint: choose a shorter name.`);const S=new Uint8Array(pn);S.set(T);let y=0;return r[w]={onComplete:Ht,onProgress:Ht,setOnComplete:C=>r[w]={...r[w],onComplete:C},setOnProgress:C=>r[w]={...r[w],onProgress:C},send:async(C,I,N,L)=>{if(N&&typeof N!="object")throw mt("action meta argument must be an object");const M=typeof C;if(M==="undefined")throw mt("action data cannot be undefined");const F=M!=="string",V=C instanceof Blob,D=V||C instanceof ArrayBuffer||C instanceof Eu;if(N&&!D)throw mt("action meta argument can only be used with binary data");const Y=D?new Uint8Array(V?await C.arrayBuffer():C):Kt(F?Et(C):C),tt=N?Kt(Et(N)):null,W=Math.ceil(Y.byteLength/Ut)+(N?1:0)||1,at=Me(W,(G,z)=>{const Z=z===W-1,H=N&&z===0,q=new Uint8Array(Pe+(H?tt.byteLength:Z?Y.byteLength-Ut*(W-(N?2:1)):Ut));return q.set(S),q.set([y],_n),q.set([Z|H<<1|D<<2|F<<3],mn),q.set([Math.round((z+1)/W*on)],Be),q.set(N?H?tt:Y.subarray((z-1)*Ut,z*Ut):Y.subarray(z*Ut,(z+1)*Ut),Pe),q});return y=y+1&on,le(u(I,async(G,z)=>{const{channel:Z}=z;let H=0;for(;H<W;){const q=at[H];if(Z.bufferedAmount>Z.bufferedAmountLowThreshold&&await new Promise(ht=>{const Mt=()=>{Z.removeEventListener(cs,Mt),ht()};Z.addEventListener(cs,Mt)}),!i[G])break;z.sendData(q),H++,L==null||L(q[Be]/on,G,N)}}))}},s[w]||(s[w]=[r[w].send,r[w].setOnComplete,r[w].setOnProgress])},m=(w,T)=>{var W,at;const S=new Uint8Array(T),y=fn(S.subarray(aa,_n)).replaceAll("\0",""),[C]=S.subarray(_n,mn),[I]=S.subarray(mn,Be),[N]=S.subarray(Be,Pe),L=S.subarray(Pe),M=!!(I&1),F=!!(I&2),V=!!(I&4),D=!!(I&8);if(!r[y]){console.warn(`${Oe}: received message with unregistered type (${y})`);return}o[w]||(o[w]={}),(W=o[w])[y]||(W[y]={});const Y=(at=o[w][y])[C]||(at[C]={chunks:[]});if(F?Y.meta=Nn(fn(L)):Y.chunks.push(L),r[y].onProgress(N/on,w,Y.meta),!M)return;const tt=new Uint8Array(Y.chunks.reduce((G,z)=>G+z.byteLength,0));if(Y.chunks.reduce((G,z)=>(tt.set(z,G),G+z.byteLength),0),delete o[w][y][C],V)r[y].onComplete(tt,w,Y.meta);else{const G=fn(tt);r[y].onComplete(D?Nn(G):G,w)}},f=async()=>{await P(""),await new Promise(w=>setTimeout(w,99)),zr(i).forEach(([w,T])=>{T.destroy(),delete i[w]}),e()},[_,p]=g(se("ping")),[b,x]=g(se("pong")),[E,v]=g(se("signal")),[A,R]=g(se("stream")),[B,U]=g(se("track")),[P,k]=g(se("leave"));return n((w,T)=>{var S;i[T]||(i[T]=w,w.setHandlers({data:y=>m(T,y),stream:y=>{h.onPeerStream(y,T,l[T]),delete l[T]},track:(y,C)=>{h.onPeerTrack(y,C,T,c[T]),delete c[T]},signal:y=>E(y,T),close:()=>d(T),error:()=>d(T)}),h.onPeerJoin(T),(S=w.drainEarlyData)==null||S.call(w,y=>m(T,y)))}),p((w,T)=>b("",T)),x((w,T)=>{var S;(S=a[T])==null||S.call(a),delete a[T]}),v((w,T)=>{var S;return(S=i[T])==null?void 0:S.signal(w)}),R((w,T)=>l[T]=w),U((w,T)=>c[T]=w),k((w,T)=>d(T)),nr&&addEventListener("beforeunload",f),{makeAction:g,leave:f,ping:async w=>{if(!w)throw mt("ping() must be called with target peer ID");const T=Date.now();return _("",w),await new Promise(S=>a[w]=S),Date.now()-T},getPeers:()=>Rc(zr(i).map(([w,T])=>[w,T.connection])),addStream:(w,T,S)=>u(T,async(y,C)=>{S&&await A(S,y),C.addStream(w)}),removeStream:(w,T)=>u(T,(S,y)=>y.removeStream(w)),addTrack:(w,T,S,y)=>u(S,async(C,I)=>{y&&await B(y,C),I.addTrack(w,T)}),removeTrack:(w,T,S)=>u(S,(y,C)=>C.removeTrack(w,T)),replaceTrack:(w,T,S,y,C)=>u(y,async(I,N)=>{C&&await B(C,I),N.replaceTrack(w,T,S)}),onPeerJoin:w=>h.onPeerJoin=w,onPeerLeave:w=>h.onPeerLeave=w,onPeerStream:w=>h.onPeerStream=w,onPeerTrack:w=>h.onPeerTrack=w}},xu=20,Cu=5333,hs=57333,Au=({init:n,subscribe:t,announce:e})=>{const i={};let r=!1,s,o,a;return(l,c,h)=>{var C;const{appId:u}=l;if((C=i[u])!=null&&C[c])return i[u][c];const d={},g={},m=en(Oe,u,c),f=nn(m),_=nn(en(m,ae)),p=Mc(l.password||"",u,c),b=I=>async N=>({type:N.type,sdp:await I(p,N.sdp)}),x=b(Fc),E=b(Uc),v=()=>ls(!0,l.rtcConfig),A=(I,N,L)=>{var M;if(g[N]){g[N]!==I&&I.destroy();return}g[N]=I,y(I,N),(M=d[N])==null||M.forEach((F,V)=>{V!==L&&F.destroy()}),delete d[N]},R=(I,N)=>{g[N]===I&&delete g[N]},B=(I,N)=>{var M;if(g[I])return;const L=(M=d[I])==null?void 0:M[N];L&&(delete d[I][N],L.destroy())},U=I=>(o.push(...Me(I,v)),le(o.splice(0,I).map(N=>N.offerPromise.then(E).then(L=>({peer:N,offer:L}))))),P=(I,N)=>h==null?void 0:h({error:`incorrect password (${l.password}) when decrypting ${N}`,appId:u,peerId:I,roomId:c}),k=I=>async(N,L,M)=>{var at,G,z;const[F,V]=await le([f,_]);if(N!==F&&N!==V)return;const{peerId:D,offer:Y,answer:tt,peer:W}=typeof L=="string"?Nn(L):L;if(!(D===ae||g[D])){if(D&&!Y&&!tt){if((at=d[D])!=null&&at[I])return;const[[{peer:Z,offer:H}],q]=await le([U(1),nn(en(m,D))]);d[D]||(d[D]=[]),d[D][I]=Z,setTimeout(()=>B(D,I),w[I]*.9),Z.setHandlers({connect:()=>A(Z,D,I),close:()=>R(Z,D)}),M(q,Et({peerId:ae,offer:H}))}else if(Y){if(((G=d[D])==null?void 0:G[I])&&ae>D)return;const H=ls(!1,l.rtcConfig);H.setHandlers({connect:()=>A(H,D,I),close:()=>R(H,D)});let q;try{q=await x(Y)}catch{P(D,"offer");return}if(H.isDead)return;const[ht,Mt]=await le([nn(en(m,D)),H.signal(q)]);M(ht,Et({peerId:ae,answer:await E(Mt)}))}else if(tt){let Z;try{Z=await x(tt)}catch{P(D,"answer");return}if(W)W.setHandlers({connect:()=>A(W,D,I),close:()=>R(W,D)}),W.signal(Z);else{const H=(z=d[D])==null?void 0:z[I];H&&!H.isDead&&H.signal(Z)}}}};if(!l)throw mt("requires a config map as the first argument");if(!u&&!l.firebaseApp)throw mt("config map is missing appId field");if(!c)throw mt("roomId argument required");if(!r){const I=n(l);o=Me(xu,v),s=Array.isArray(I)?I:[I],r=!0,a=setInterval(()=>o=o.filter(N=>{const L=Date.now()-N.created<hs;return L||N.destroy(),L}),hs*1.03)}const w=s.map(()=>Cu),T=[],S=s.map(async(I,N)=>t(await I,await f,await _,k(N),U));le([f,_]).then(([I,N])=>{const L=async(M,F)=>{const V=await e(M,I,N);typeof V=="number"&&(w[F]=V),T[F]=setTimeout(()=>L(M,F),w[F])};S.forEach(async(M,F)=>{await M,L(await s[F],F)})});let y=Ht;return i[u]||(i[u]={}),i[u][c]=Su(I=>y=I,I=>delete g[I],()=>{delete i[u][c],T.forEach(clearTimeout),S.forEach(async I=>(await I)()),clearInterval(a)})}},Tu=5,la=29333,ca="x",ha="EVENT",ua=nr&&er.utils.randomPrivateKey(),vu=nr&&vi(er.getPublicKey(ua)),pr={},Ft={},da=()=>Math.floor(Date.now()/1e3),us=async(n,t)=>{const e={kind:la,content:t,pubkey:vu,created_at:da(),tags:[[ca,n]]},i=vi(new Uint8Array(await crypto.subtle.digest("SHA-256",Kt(Et([0,e.pubkey,e.created_at,e.kind,e.tags,e.content])))));return Et([ha,{...e,id:i,sig:vi(await er.sign(i,ua))}])},ds=(n,t)=>(pr[n]=t,Et(["REQ",n,{kinds:[la],since:da(),["#"+ca]:[t]}])),fs=n=>(delete pr[n],Et(["CLOSE",n])),Iu=Au({init:n=>kc(n,Ru,Tu).map(t=>{const e=Lc(t,i=>{var l;const[r,s,o,a]=Nn(i);if(r!==ha){const c=`${Oe}: relay failure from ${e.url} - `;r==="NOTICE"?console.warn(c+s):r==="OK"&&!o&&console.warn(c+a);return}(l=Ft[s])==null||l.call(Ft,pr[s],o.content)});return e.ready}),subscribe:(n,t,e,i)=>{const r=Ti(64),s=Ti(64);return Ft[r]=Ft[s]=(o,a)=>i(o,a,async(l,c)=>n.send(await us(l,c))),n.send(ds(r,t)),n.send(ds(s,e)),()=>{n.send(fs(r)),n.send(fs(s)),delete Ft[r],delete Ft[s]}},announce:async(n,t)=>n.send(await us(t,Et({peerId:ae})))}),Ru=["relay.nostr.net","relay.snort.social","relay.piazza.today","relay.exit.pub","nostr.lu.ke","nostr.mom","relay.urbanzap.space","nostr.data.haus","nostr.sathoarder.com","relay.nostromo.social","relay.nostr.bg","nostr.stakey.net","nostr.vulpem.com","a.nos.lol","eu.purplerelay.com","nostr2.sanhauf.com","e.nos.lol"].map(n=>"wss://"+n);var Xe={},Nu=function(){return typeof Promise=="function"&&Promise.prototype&&Promise.prototype.then},fa={},it={};let _r;const Bu=[0,26,44,70,100,134,172,196,242,292,346,404,466,532,581,655,733,815,901,991,1085,1156,1258,1364,1474,1588,1706,1828,1921,2051,2185,2323,2465,2611,2761,2876,3034,3196,3362,3532,3706];it.getSymbolSize=function(t){if(!t)throw new Error('"version" cannot be null or undefined');if(t<1||t>40)throw new Error('"version" should be in range from 1 to 40');return t*4+17};it.getSymbolTotalCodewords=function(t){return Bu[t]};it.getBCHDigit=function(n){let t=0;for(;n!==0;)t++,n>>>=1;return t};it.setToSJISFunction=function(t){if(typeof t!="function")throw new Error('"toSJISFunc" is not a valid function.');_r=t};it.isKanjiModeEnabled=function(){return typeof _r<"u"};it.toSJIS=function(t){return _r(t)};var Gn={};(function(n){n.L={bit:1},n.M={bit:0},n.Q={bit:3},n.H={bit:2};function t(e){if(typeof e!="string")throw new Error("Param is not a string");switch(e.toLowerCase()){case"l":case"low":return n.L;case"m":case"medium":return n.M;case"q":case"quartile":return n.Q;case"h":case"high":return n.H;default:throw new Error("Unknown EC Level: "+e)}}n.isValid=function(i){return i&&typeof i.bit<"u"&&i.bit>=0&&i.bit<4},n.from=function(i,r){if(n.isValid(i))return i;try{return t(i)}catch{return r}}})(Gn);function ga(){this.buffer=[],this.length=0}ga.prototype={get:function(n){const t=Math.floor(n/8);return(this.buffer[t]>>>7-n%8&1)===1},put:function(n,t){for(let e=0;e<t;e++)this.putBit((n>>>t-e-1&1)===1)},getLengthInBits:function(){return this.length},putBit:function(n){const t=Math.floor(this.length/8);this.buffer.length<=t&&this.buffer.push(0),n&&(this.buffer[t]|=128>>>this.length%8),this.length++}};var Pu=ga;function Qe(n){if(!n||n<1)throw new Error("BitMatrix size must be defined and greater than 0");this.size=n,this.data=new Uint8Array(n*n),this.reservedBit=new Uint8Array(n*n)}Qe.prototype.set=function(n,t,e,i){const r=n*this.size+t;this.data[r]=e,i&&(this.reservedBit[r]=!0)};Qe.prototype.get=function(n,t){return this.data[n*this.size+t]};Qe.prototype.xor=function(n,t,e){this.data[n*this.size+t]^=e};Qe.prototype.isReserved=function(n,t){return this.reservedBit[n*this.size+t]};var ku=Qe,pa={};(function(n){const t=it.getSymbolSize;n.getRowColCoords=function(i){if(i===1)return[];const r=Math.floor(i/7)+2,s=t(i),o=s===145?26:Math.ceil((s-13)/(2*r-2))*2,a=[s-7];for(let l=1;l<r-1;l++)a[l]=a[l-1]-o;return a.push(6),a.reverse()},n.getPositions=function(i){const r=[],s=n.getRowColCoords(i),o=s.length;for(let a=0;a<o;a++)for(let l=0;l<o;l++)a===0&&l===0||a===0&&l===o-1||a===o-1&&l===0||r.push([s[a],s[l]]);return r}})(pa);var _a={};const Lu=it.getSymbolSize,gs=7;_a.getPositions=function(t){const e=Lu(t);return[[0,0],[e-gs,0],[0,e-gs]]};var ma={};(function(n){n.Patterns={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7};const t={N1:3,N2:3,N3:40,N4:10};n.isValid=function(r){return r!=null&&r!==""&&!isNaN(r)&&r>=0&&r<=7},n.from=function(r){return n.isValid(r)?parseInt(r,10):void 0},n.getPenaltyN1=function(r){const s=r.size;let o=0,a=0,l=0,c=null,h=null;for(let u=0;u<s;u++){a=l=0,c=h=null;for(let d=0;d<s;d++){let g=r.get(u,d);g===c?a++:(a>=5&&(o+=t.N1+(a-5)),c=g,a=1),g=r.get(d,u),g===h?l++:(l>=5&&(o+=t.N1+(l-5)),h=g,l=1)}a>=5&&(o+=t.N1+(a-5)),l>=5&&(o+=t.N1+(l-5))}return o},n.getPenaltyN2=function(r){const s=r.size;let o=0;for(let a=0;a<s-1;a++)for(let l=0;l<s-1;l++){const c=r.get(a,l)+r.get(a,l+1)+r.get(a+1,l)+r.get(a+1,l+1);(c===4||c===0)&&o++}return o*t.N2},n.getPenaltyN3=function(r){const s=r.size;let o=0,a=0,l=0;for(let c=0;c<s;c++){a=l=0;for(let h=0;h<s;h++)a=a<<1&2047|r.get(c,h),h>=10&&(a===1488||a===93)&&o++,l=l<<1&2047|r.get(h,c),h>=10&&(l===1488||l===93)&&o++}return o*t.N3},n.getPenaltyN4=function(r){let s=0;const o=r.data.length;for(let l=0;l<o;l++)s+=r.data[l];return Math.abs(Math.ceil(s*100/o/5)-10)*t.N4};function e(i,r,s){switch(i){case n.Patterns.PATTERN000:return(r+s)%2===0;case n.Patterns.PATTERN001:return r%2===0;case n.Patterns.PATTERN010:return s%3===0;case n.Patterns.PATTERN011:return(r+s)%3===0;case n.Patterns.PATTERN100:return(Math.floor(r/2)+Math.floor(s/3))%2===0;case n.Patterns.PATTERN101:return r*s%2+r*s%3===0;case n.Patterns.PATTERN110:return(r*s%2+r*s%3)%2===0;case n.Patterns.PATTERN111:return(r*s%3+(r+s)%2)%2===0;default:throw new Error("bad maskPattern:"+i)}}n.applyMask=function(r,s){const o=s.size;for(let a=0;a<o;a++)for(let l=0;l<o;l++)s.isReserved(l,a)||s.xor(l,a,e(r,l,a))},n.getBestMask=function(r,s){const o=Object.keys(n.Patterns).length;let a=0,l=1/0;for(let c=0;c<o;c++){s(c),n.applyMask(c,r);const h=n.getPenaltyN1(r)+n.getPenaltyN2(r)+n.getPenaltyN3(r)+n.getPenaltyN4(r);n.applyMask(c,r),h<l&&(l=h,a=c)}return a}})(ma);var Kn={};const Tt=Gn,an=[1,1,1,1,1,1,1,1,1,1,2,2,1,2,2,4,1,2,4,4,2,4,4,4,2,4,6,5,2,4,6,6,2,5,8,8,4,5,8,8,4,5,8,11,4,8,10,11,4,9,12,16,4,9,16,16,6,10,12,18,6,10,17,16,6,11,16,19,6,13,18,21,7,14,21,25,8,16,20,25,8,17,23,25,9,17,23,34,9,18,25,30,10,20,27,32,12,21,29,35,12,23,34,37,12,25,34,40,13,26,35,42,14,28,38,45,15,29,40,48,16,31,43,51,17,33,45,54,18,35,48,57,19,37,51,60,19,38,53,63,20,40,56,66,21,43,59,70,22,45,62,74,24,47,65,77,25,49,68,81],ln=[7,10,13,17,10,16,22,28,15,26,36,44,20,36,52,64,26,48,72,88,36,64,96,112,40,72,108,130,48,88,132,156,60,110,160,192,72,130,192,224,80,150,224,264,96,176,260,308,104,198,288,352,120,216,320,384,132,240,360,432,144,280,408,480,168,308,448,532,180,338,504,588,196,364,546,650,224,416,600,700,224,442,644,750,252,476,690,816,270,504,750,900,300,560,810,960,312,588,870,1050,336,644,952,1110,360,700,1020,1200,390,728,1050,1260,420,784,1140,1350,450,812,1200,1440,480,868,1290,1530,510,924,1350,1620,540,980,1440,1710,570,1036,1530,1800,570,1064,1590,1890,600,1120,1680,1980,630,1204,1770,2100,660,1260,1860,2220,720,1316,1950,2310,750,1372,2040,2430];Kn.getBlocksCount=function(t,e){switch(e){case Tt.L:return an[(t-1)*4+0];case Tt.M:return an[(t-1)*4+1];case Tt.Q:return an[(t-1)*4+2];case Tt.H:return an[(t-1)*4+3];default:return}};Kn.getTotalCodewordsCount=function(t,e){switch(e){case Tt.L:return ln[(t-1)*4+0];case Tt.M:return ln[(t-1)*4+1];case Tt.Q:return ln[(t-1)*4+2];case Tt.H:return ln[(t-1)*4+3];default:return}};var wa={},Vn={};const ke=new Uint8Array(512),Bn=new Uint8Array(256);(function(){let t=1;for(let e=0;e<255;e++)ke[e]=t,Bn[t]=e,t<<=1,t&256&&(t^=285);for(let e=255;e<512;e++)ke[e]=ke[e-255]})();Vn.log=function(t){if(t<1)throw new Error("log("+t+")");return Bn[t]};Vn.exp=function(t){return ke[t]};Vn.mul=function(t,e){return t===0||e===0?0:ke[Bn[t]+Bn[e]]};(function(n){const t=Vn;n.mul=function(i,r){const s=new Uint8Array(i.length+r.length-1);for(let o=0;o<i.length;o++)for(let a=0;a<r.length;a++)s[o+a]^=t.mul(i[o],r[a]);return s},n.mod=function(i,r){let s=new Uint8Array(i);for(;s.length-r.length>=0;){const o=s[0];for(let l=0;l<r.length;l++)s[l]^=t.mul(r[l],o);let a=0;for(;a<s.length&&s[a]===0;)a++;s=s.slice(a)}return s},n.generateECPolynomial=function(i){let r=new Uint8Array([1]);for(let s=0;s<i;s++)r=n.mul(r,new Uint8Array([1,t.exp(s)]));return r}})(wa);const ya=wa;function mr(n){this.genPoly=void 0,this.degree=n,this.degree&&this.initialize(this.degree)}mr.prototype.initialize=function(t){this.degree=t,this.genPoly=ya.generateECPolynomial(this.degree)};mr.prototype.encode=function(t){if(!this.genPoly)throw new Error("Encoder not initialized");const e=new Uint8Array(t.length+this.degree);e.set(t);const i=ya.mod(e,this.genPoly),r=this.degree-i.length;if(r>0){const s=new Uint8Array(this.degree);return s.set(i,r),s}return i};var Du=mr,ba={},Ot={},wr={};wr.isValid=function(t){return!isNaN(t)&&t>=1&&t<=40};var ft={};const Ea="[0-9]+",Ou="[A-Z $%*+\\-./:]+";let ze="(?:[u3000-u303F]|[u3040-u309F]|[u30A0-u30FF]|[uFF00-uFFEF]|[u4E00-u9FAF]|[u2605-u2606]|[u2190-u2195]|u203B|[u2010u2015u2018u2019u2025u2026u201Cu201Du2225u2260]|[u0391-u0451]|[u00A7u00A8u00B1u00B4u00D7u00F7])+";ze=ze.replace(/u/g,"\\u");const Mu="(?:(?![A-Z0-9 $%*+\\-./:]|"+ze+`)(?:.|[\r
]))+`;ft.KANJI=new RegExp(ze,"g");ft.BYTE_KANJI=new RegExp("[^A-Z0-9 $%*+\\-./:]+","g");ft.BYTE=new RegExp(Mu,"g");ft.NUMERIC=new RegExp(Ea,"g");ft.ALPHANUMERIC=new RegExp(Ou,"g");const Uu=new RegExp("^"+ze+"$"),Fu=new RegExp("^"+Ea+"$"),$u=new RegExp("^[A-Z0-9 $%*+\\-./:]+$");ft.testKanji=function(t){return Uu.test(t)};ft.testNumeric=function(t){return Fu.test(t)};ft.testAlphanumeric=function(t){return $u.test(t)};(function(n){const t=wr,e=ft;n.NUMERIC={id:"Numeric",bit:1,ccBits:[10,12,14]},n.ALPHANUMERIC={id:"Alphanumeric",bit:2,ccBits:[9,11,13]},n.BYTE={id:"Byte",bit:4,ccBits:[8,16,16]},n.KANJI={id:"Kanji",bit:8,ccBits:[8,10,12]},n.MIXED={bit:-1},n.getCharCountIndicator=function(s,o){if(!s.ccBits)throw new Error("Invalid mode: "+s);if(!t.isValid(o))throw new Error("Invalid version: "+o);return o>=1&&o<10?s.ccBits[0]:o<27?s.ccBits[1]:s.ccBits[2]},n.getBestModeForData=function(s){return e.testNumeric(s)?n.NUMERIC:e.testAlphanumeric(s)?n.ALPHANUMERIC:e.testKanji(s)?n.KANJI:n.BYTE},n.toString=function(s){if(s&&s.id)return s.id;throw new Error("Invalid mode")},n.isValid=function(s){return s&&s.bit&&s.ccBits};function i(r){if(typeof r!="string")throw new Error("Param is not a string");switch(r.toLowerCase()){case"numeric":return n.NUMERIC;case"alphanumeric":return n.ALPHANUMERIC;case"kanji":return n.KANJI;case"byte":return n.BYTE;default:throw new Error("Unknown mode: "+r)}}n.from=function(s,o){if(n.isValid(s))return s;try{return i(s)}catch{return o}}})(Ot);(function(n){const t=it,e=Kn,i=Gn,r=Ot,s=wr,o=7973,a=t.getBCHDigit(o);function l(d,g,m){for(let f=1;f<=40;f++)if(g<=n.getCapacity(f,m,d))return f}function c(d,g){return r.getCharCountIndicator(d,g)+4}function h(d,g){let m=0;return d.forEach(function(f){const _=c(f.mode,g);m+=_+f.getBitsLength()}),m}function u(d,g){for(let m=1;m<=40;m++)if(h(d,m)<=n.getCapacity(m,g,r.MIXED))return m}n.from=function(g,m){return s.isValid(g)?parseInt(g,10):m},n.getCapacity=function(g,m,f){if(!s.isValid(g))throw new Error("Invalid QR Code version");typeof f>"u"&&(f=r.BYTE);const _=t.getSymbolTotalCodewords(g),p=e.getTotalCodewordsCount(g,m),b=(_-p)*8;if(f===r.MIXED)return b;const x=b-c(f,g);switch(f){case r.NUMERIC:return Math.floor(x/10*3);case r.ALPHANUMERIC:return Math.floor(x/11*2);case r.KANJI:return Math.floor(x/13);case r.BYTE:default:return Math.floor(x/8)}},n.getBestVersionForData=function(g,m){let f;const _=i.from(m,i.M);if(Array.isArray(g)){if(g.length>1)return u(g,_);if(g.length===0)return 1;f=g[0]}else f=g;return l(f.mode,f.getLength(),_)},n.getEncodedBits=function(g){if(!s.isValid(g)||g<7)throw new Error("Invalid QR Code version");let m=g<<12;for(;t.getBCHDigit(m)-a>=0;)m^=o<<t.getBCHDigit(m)-a;return g<<12|m}})(ba);var Sa={};const Li=it,xa=1335,Hu=21522,ps=Li.getBCHDigit(xa);Sa.getEncodedBits=function(t,e){const i=t.bit<<3|e;let r=i<<10;for(;Li.getBCHDigit(r)-ps>=0;)r^=xa<<Li.getBCHDigit(r)-ps;return(i<<10|r)^Hu};var Ca={};const qu=Ot;function xe(n){this.mode=qu.NUMERIC,this.data=n.toString()}xe.getBitsLength=function(t){return 10*Math.floor(t/3)+(t%3?t%3*3+1:0)};xe.prototype.getLength=function(){return this.data.length};xe.prototype.getBitsLength=function(){return xe.getBitsLength(this.data.length)};xe.prototype.write=function(t){let e,i,r;for(e=0;e+3<=this.data.length;e+=3)i=this.data.substr(e,3),r=parseInt(i,10),t.put(r,10);const s=this.data.length-e;s>0&&(i=this.data.substr(e),r=parseInt(i,10),t.put(r,s*3+1))};var zu=xe;const Yu=Ot,hi=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"," ","$","%","*","+","-",".","/",":"];function Ce(n){this.mode=Yu.ALPHANUMERIC,this.data=n}Ce.getBitsLength=function(t){return 11*Math.floor(t/2)+6*(t%2)};Ce.prototype.getLength=function(){return this.data.length};Ce.prototype.getBitsLength=function(){return Ce.getBitsLength(this.data.length)};Ce.prototype.write=function(t){let e;for(e=0;e+2<=this.data.length;e+=2){let i=hi.indexOf(this.data[e])*45;i+=hi.indexOf(this.data[e+1]),t.put(i,11)}this.data.length%2&&t.put(hi.indexOf(this.data[e]),6)};var Wu=Ce;const ju=Ot;function Ae(n){this.mode=ju.BYTE,typeof n=="string"?this.data=new TextEncoder().encode(n):this.data=new Uint8Array(n)}Ae.getBitsLength=function(t){return t*8};Ae.prototype.getLength=function(){return this.data.length};Ae.prototype.getBitsLength=function(){return Ae.getBitsLength(this.data.length)};Ae.prototype.write=function(n){for(let t=0,e=this.data.length;t<e;t++)n.put(this.data[t],8)};var Gu=Ae;const Ku=Ot,Vu=it;function Te(n){this.mode=Ku.KANJI,this.data=n}Te.getBitsLength=function(t){return t*13};Te.prototype.getLength=function(){return this.data.length};Te.prototype.getBitsLength=function(){return Te.getBitsLength(this.data.length)};Te.prototype.write=function(n){let t;for(t=0;t<this.data.length;t++){let e=Vu.toSJIS(this.data[t]);if(e>=33088&&e<=40956)e-=33088;else if(e>=57408&&e<=60351)e-=49472;else throw new Error("Invalid SJIS character: "+this.data[t]+`
Make sure your charset is UTF-8`);e=(e>>>8&255)*192+(e&255),n.put(e,13)}};var Zu=Te,Aa={exports:{}};(function(n){var t={single_source_shortest_paths:function(e,i,r){var s={},o={};o[i]=0;var a=t.PriorityQueue.make();a.push(i,0);for(var l,c,h,u,d,g,m,f,_;!a.empty();){l=a.pop(),c=l.value,u=l.cost,d=e[c]||{};for(h in d)d.hasOwnProperty(h)&&(g=d[h],m=u+g,f=o[h],_=typeof o[h]>"u",(_||f>m)&&(o[h]=m,a.push(h,m),s[h]=c))}if(typeof r<"u"&&typeof o[r]>"u"){var p=["Could not find a path from ",i," to ",r,"."].join("");throw new Error(p)}return s},extract_shortest_path_from_predecessor_list:function(e,i){for(var r=[],s=i;s;)r.push(s),e[s],s=e[s];return r.reverse(),r},find_path:function(e,i,r){var s=t.single_source_shortest_paths(e,i,r);return t.extract_shortest_path_from_predecessor_list(s,r)},PriorityQueue:{make:function(e){var i=t.PriorityQueue,r={},s;e=e||{};for(s in i)i.hasOwnProperty(s)&&(r[s]=i[s]);return r.queue=[],r.sorter=e.sorter||i.default_sorter,r},default_sorter:function(e,i){return e.cost-i.cost},push:function(e,i){var r={value:e,cost:i};this.queue.push(r),this.queue.sort(this.sorter)},pop:function(){return this.queue.shift()},empty:function(){return this.queue.length===0}}};n.exports=t})(Aa);var Ju=Aa.exports;(function(n){const t=Ot,e=zu,i=Wu,r=Gu,s=Zu,o=ft,a=it,l=Ju;function c(p){return unescape(encodeURIComponent(p)).length}function h(p,b,x){const E=[];let v;for(;(v=p.exec(x))!==null;)E.push({data:v[0],index:v.index,mode:b,length:v[0].length});return E}function u(p){const b=h(o.NUMERIC,t.NUMERIC,p),x=h(o.ALPHANUMERIC,t.ALPHANUMERIC,p);let E,v;return a.isKanjiModeEnabled()?(E=h(o.BYTE,t.BYTE,p),v=h(o.KANJI,t.KANJI,p)):(E=h(o.BYTE_KANJI,t.BYTE,p),v=[]),b.concat(x,E,v).sort(function(R,B){return R.index-B.index}).map(function(R){return{data:R.data,mode:R.mode,length:R.length}})}function d(p,b){switch(b){case t.NUMERIC:return e.getBitsLength(p);case t.ALPHANUMERIC:return i.getBitsLength(p);case t.KANJI:return s.getBitsLength(p);case t.BYTE:return r.getBitsLength(p)}}function g(p){return p.reduce(function(b,x){const E=b.length-1>=0?b[b.length-1]:null;return E&&E.mode===x.mode?(b[b.length-1].data+=x.data,b):(b.push(x),b)},[])}function m(p){const b=[];for(let x=0;x<p.length;x++){const E=p[x];switch(E.mode){case t.NUMERIC:b.push([E,{data:E.data,mode:t.ALPHANUMERIC,length:E.length},{data:E.data,mode:t.BYTE,length:E.length}]);break;case t.ALPHANUMERIC:b.push([E,{data:E.data,mode:t.BYTE,length:E.length}]);break;case t.KANJI:b.push([E,{data:E.data,mode:t.BYTE,length:c(E.data)}]);break;case t.BYTE:b.push([{data:E.data,mode:t.BYTE,length:c(E.data)}])}}return b}function f(p,b){const x={},E={start:{}};let v=["start"];for(let A=0;A<p.length;A++){const R=p[A],B=[];for(let U=0;U<R.length;U++){const P=R[U],k=""+A+U;B.push(k),x[k]={node:P,lastCount:0},E[k]={};for(let w=0;w<v.length;w++){const T=v[w];x[T]&&x[T].node.mode===P.mode?(E[T][k]=d(x[T].lastCount+P.length,P.mode)-d(x[T].lastCount,P.mode),x[T].lastCount+=P.length):(x[T]&&(x[T].lastCount=P.length),E[T][k]=d(P.length,P.mode)+4+t.getCharCountIndicator(P.mode,b))}}v=B}for(let A=0;A<v.length;A++)E[v[A]].end=0;return{map:E,table:x}}function _(p,b){let x;const E=t.getBestModeForData(p);if(x=t.from(b,E),x!==t.BYTE&&x.bit<E.bit)throw new Error('"'+p+'" cannot be encoded with mode '+t.toString(x)+`.
 Suggested mode is: `+t.toString(E));switch(x===t.KANJI&&!a.isKanjiModeEnabled()&&(x=t.BYTE),x){case t.NUMERIC:return new e(p);case t.ALPHANUMERIC:return new i(p);case t.KANJI:return new s(p);case t.BYTE:return new r(p)}}n.fromArray=function(b){return b.reduce(function(x,E){return typeof E=="string"?x.push(_(E,null)):E.data&&x.push(_(E.data,E.mode)),x},[])},n.fromString=function(b,x){const E=u(b,a.isKanjiModeEnabled()),v=m(E),A=f(v,x),R=l.find_path(A.map,"start","end"),B=[];for(let U=1;U<R.length-1;U++)B.push(A.table[R[U]].node);return n.fromArray(g(B))},n.rawSplit=function(b){return n.fromArray(u(b,a.isKanjiModeEnabled()))}})(Ca);const Zn=it,ui=Gn,Xu=Pu,Qu=ku,td=pa,ed=_a,Di=ma,Oi=Kn,nd=Du,Pn=ba,id=Sa,rd=Ot,di=Ca;function sd(n,t){const e=n.size,i=ed.getPositions(t);for(let r=0;r<i.length;r++){const s=i[r][0],o=i[r][1];for(let a=-1;a<=7;a++)if(!(s+a<=-1||e<=s+a))for(let l=-1;l<=7;l++)o+l<=-1||e<=o+l||(a>=0&&a<=6&&(l===0||l===6)||l>=0&&l<=6&&(a===0||a===6)||a>=2&&a<=4&&l>=2&&l<=4?n.set(s+a,o+l,!0,!0):n.set(s+a,o+l,!1,!0))}}function od(n){const t=n.size;for(let e=8;e<t-8;e++){const i=e%2===0;n.set(e,6,i,!0),n.set(6,e,i,!0)}}function ad(n,t){const e=td.getPositions(t);for(let i=0;i<e.length;i++){const r=e[i][0],s=e[i][1];for(let o=-2;o<=2;o++)for(let a=-2;a<=2;a++)o===-2||o===2||a===-2||a===2||o===0&&a===0?n.set(r+o,s+a,!0,!0):n.set(r+o,s+a,!1,!0)}}function ld(n,t){const e=n.size,i=Pn.getEncodedBits(t);let r,s,o;for(let a=0;a<18;a++)r=Math.floor(a/3),s=a%3+e-8-3,o=(i>>a&1)===1,n.set(r,s,o,!0),n.set(s,r,o,!0)}function fi(n,t,e){const i=n.size,r=id.getEncodedBits(t,e);let s,o;for(s=0;s<15;s++)o=(r>>s&1)===1,s<6?n.set(s,8,o,!0):s<8?n.set(s+1,8,o,!0):n.set(i-15+s,8,o,!0),s<8?n.set(8,i-s-1,o,!0):s<9?n.set(8,15-s-1+1,o,!0):n.set(8,15-s-1,o,!0);n.set(i-8,8,1,!0)}function cd(n,t){const e=n.size;let i=-1,r=e-1,s=7,o=0;for(let a=e-1;a>0;a-=2)for(a===6&&a--;;){for(let l=0;l<2;l++)if(!n.isReserved(r,a-l)){let c=!1;o<t.length&&(c=(t[o]>>>s&1)===1),n.set(r,a-l,c),s--,s===-1&&(o++,s=7)}if(r+=i,r<0||e<=r){r-=i,i=-i;break}}}function hd(n,t,e){const i=new Xu;e.forEach(function(l){i.put(l.mode.bit,4),i.put(l.getLength(),rd.getCharCountIndicator(l.mode,n)),l.write(i)});const r=Zn.getSymbolTotalCodewords(n),s=Oi.getTotalCodewordsCount(n,t),o=(r-s)*8;for(i.getLengthInBits()+4<=o&&i.put(0,4);i.getLengthInBits()%8!==0;)i.putBit(0);const a=(o-i.getLengthInBits())/8;for(let l=0;l<a;l++)i.put(l%2?17:236,8);return ud(i,n,t)}function ud(n,t,e){const i=Zn.getSymbolTotalCodewords(t),r=Oi.getTotalCodewordsCount(t,e),s=i-r,o=Oi.getBlocksCount(t,e),a=i%o,l=o-a,c=Math.floor(i/o),h=Math.floor(s/o),u=h+1,d=c-h,g=new nd(d);let m=0;const f=new Array(o),_=new Array(o);let p=0;const b=new Uint8Array(n.buffer);for(let R=0;R<o;R++){const B=R<l?h:u;f[R]=b.slice(m,m+B),_[R]=g.encode(f[R]),m+=B,p=Math.max(p,B)}const x=new Uint8Array(i);let E=0,v,A;for(v=0;v<p;v++)for(A=0;A<o;A++)v<f[A].length&&(x[E++]=f[A][v]);for(v=0;v<d;v++)for(A=0;A<o;A++)x[E++]=_[A][v];return x}function dd(n,t,e,i){let r;if(Array.isArray(n))r=di.fromArray(n);else if(typeof n=="string"){let c=t;if(!c){const h=di.rawSplit(n);c=Pn.getBestVersionForData(h,e)}r=di.fromString(n,c||40)}else throw new Error("Invalid data");const s=Pn.getBestVersionForData(r,e);if(!s)throw new Error("The amount of data is too big to be stored in a QR Code");if(!t)t=s;else if(t<s)throw new Error(`
The chosen QR Code version cannot contain this amount of data.
Minimum version required to store current data is: `+s+`.
`);const o=hd(t,e,r),a=Zn.getSymbolSize(t),l=new Qu(a);return sd(l,t),od(l),ad(l,t),fi(l,e,0),t>=7&&ld(l,t),cd(l,o),isNaN(i)&&(i=Di.getBestMask(l,fi.bind(null,l,e))),Di.applyMask(i,l),fi(l,e,i),{modules:l,version:t,errorCorrectionLevel:e,maskPattern:i,segments:r}}fa.create=function(t,e){if(typeof t>"u"||t==="")throw new Error("No input text");let i=ui.M,r,s;return typeof e<"u"&&(i=ui.from(e.errorCorrectionLevel,ui.M),r=Pn.from(e.version),s=Di.from(e.maskPattern),e.toSJISFunc&&Zn.setToSJISFunction(e.toSJISFunc)),dd(t,r,i,s)};var Ta={},yr={};(function(n){function t(e){if(typeof e=="number"&&(e=e.toString()),typeof e!="string")throw new Error("Color should be defined as hex string");let i=e.slice().replace("#","").split("");if(i.length<3||i.length===5||i.length>8)throw new Error("Invalid hex color: "+e);(i.length===3||i.length===4)&&(i=Array.prototype.concat.apply([],i.map(function(s){return[s,s]}))),i.length===6&&i.push("F","F");const r=parseInt(i.join(""),16);return{r:r>>24&255,g:r>>16&255,b:r>>8&255,a:r&255,hex:"#"+i.slice(0,6).join("")}}n.getOptions=function(i){i||(i={}),i.color||(i.color={});const r=typeof i.margin>"u"||i.margin===null||i.margin<0?4:i.margin,s=i.width&&i.width>=21?i.width:void 0,o=i.scale||4;return{width:s,scale:s?4:o,margin:r,color:{dark:t(i.color.dark||"#000000ff"),light:t(i.color.light||"#ffffffff")},type:i.type,rendererOpts:i.rendererOpts||{}}},n.getScale=function(i,r){return r.width&&r.width>=i+r.margin*2?r.width/(i+r.margin*2):r.scale},n.getImageWidth=function(i,r){const s=n.getScale(i,r);return Math.floor((i+r.margin*2)*s)},n.qrToImageData=function(i,r,s){const o=r.modules.size,a=r.modules.data,l=n.getScale(o,s),c=Math.floor((o+s.margin*2)*l),h=s.margin*l,u=[s.color.light,s.color.dark];for(let d=0;d<c;d++)for(let g=0;g<c;g++){let m=(d*c+g)*4,f=s.color.light;if(d>=h&&g>=h&&d<c-h&&g<c-h){const _=Math.floor((d-h)/l),p=Math.floor((g-h)/l);f=u[a[_*o+p]?1:0]}i[m++]=f.r,i[m++]=f.g,i[m++]=f.b,i[m]=f.a}}})(yr);(function(n){const t=yr;function e(r,s,o){r.clearRect(0,0,s.width,s.height),s.style||(s.style={}),s.height=o,s.width=o,s.style.height=o+"px",s.style.width=o+"px"}function i(){try{return document.createElement("canvas")}catch{throw new Error("You need to specify a canvas element")}}n.render=function(s,o,a){let l=a,c=o;typeof l>"u"&&(!o||!o.getContext)&&(l=o,o=void 0),o||(c=i()),l=t.getOptions(l);const h=t.getImageWidth(s.modules.size,l),u=c.getContext("2d"),d=u.createImageData(h,h);return t.qrToImageData(d.data,s,l),e(u,c,h),u.putImageData(d,0,0),c},n.renderToDataURL=function(s,o,a){let l=a;typeof l>"u"&&(!o||!o.getContext)&&(l=o,o=void 0),l||(l={});const c=n.render(s,o,l),h=l.type||"image/png",u=l.rendererOpts||{};return c.toDataURL(h,u.quality)}})(Ta);var va={};const fd=yr;function _s(n,t){const e=n.a/255,i=t+'="'+n.hex+'"';return e<1?i+" "+t+'-opacity="'+e.toFixed(2).slice(1)+'"':i}function gi(n,t,e){let i=n+t;return typeof e<"u"&&(i+=" "+e),i}function gd(n,t,e){let i="",r=0,s=!1,o=0;for(let a=0;a<n.length;a++){const l=Math.floor(a%t),c=Math.floor(a/t);!l&&!s&&(s=!0),n[a]?(o++,a>0&&l>0&&n[a-1]||(i+=s?gi("M",l+e,.5+c+e):gi("m",r,0),r=0,s=!1),l+1<t&&n[a+1]||(i+=gi("h",o),o=0)):r++}return i}va.render=function(t,e,i){const r=fd.getOptions(e),s=t.modules.size,o=t.modules.data,a=s+r.margin*2,l=r.color.light.a?"<path "+_s(r.color.light,"fill")+' d="M0 0h'+a+"v"+a+'H0z"/>':"",c="<path "+_s(r.color.dark,"stroke")+' d="'+gd(o,s,r.margin)+'"/>',h='viewBox="0 0 '+a+" "+a+'"',d='<svg xmlns="http://www.w3.org/2000/svg" '+(r.width?'width="'+r.width+'" height="'+r.width+'" ':"")+h+' shape-rendering="crispEdges">'+l+c+`</svg>
`;return typeof i=="function"&&i(null,d),d};const pd=Nu,Mi=fa,Ia=Ta,_d=va;function br(n,t,e,i,r){const s=[].slice.call(arguments,1),o=s.length,a=typeof s[o-1]=="function";if(!a&&!pd())throw new Error("Callback required as last argument");if(a){if(o<2)throw new Error("Too few arguments provided");o===2?(r=e,e=t,t=i=void 0):o===3&&(t.getContext&&typeof r>"u"?(r=i,i=void 0):(r=i,i=e,e=t,t=void 0))}else{if(o<1)throw new Error("Too few arguments provided");return o===1?(e=t,t=i=void 0):o===2&&!t.getContext&&(i=e,e=t,t=void 0),new Promise(function(l,c){try{const h=Mi.create(e,i);l(n(h,t,i))}catch(h){c(h)}})}try{const l=Mi.create(e,i);r(null,n(l,t,i))}catch(l){r(l)}}Xe.create=Mi.create;Xe.toCanvas=br.bind(null,Ia.render);Xe.toDataURL=br.bind(null,Ia.renderToDataURL);Xe.toString=br.bind(null,function(n,t,e){return _d.render(n,e)});const md="/gifshooter/assets/01.28-D_5FERI8.png",wd="/gifshooter/assets/02.20-BoBji87-.png",yd="/gifshooter/assets/03.14-DvrilD0J.png",bd="/gifshooter/assets/04.62-ClpOCGaf.png";let{init:ms,Sprite:Ed,SpriteSheet:Sd,keyPressed:xd,GameLoop:ws,initKeys:Cd,pointerPressed:Ad,onInput:qd,initPointer:Td,getPointer:vd}=Ol,wn=[];const Ra=new URLSearchParams(window.location.search);let Lt=Ra.get("room")||"notinitialized";console.log(Lt);let yn=Ra.get("present")=="true";var Id=document.getElementById("qr");Xe.toCanvas(Id,window.location.href.split("?")[0]+`?${Lt}`,function(n){n&&console.error(n),console.log("success!")});const Rd=()=>(window.open(window.location.href.split("?")[0],"_self"),!1),Nd=()=>(Lt=document.getElementById("room").value,yn=document.getElementById("present").checked,console.log(yn),window.open(window.location.href.split("?")[0]+`?room=${Lt}&present=${yn}`,"_self"),!1);let kn=0;const Bd={appId:"gifshootah"},Ye=Iu(Bd,Lt);Ye.onPeerJoin(n=>{kn+=1,document.getElementById("online").textContent=`${kn} peers`});Ye.onPeerLeave(n=>{kn-=1,document.getElementById("online").textContent=`${kn} peers`});const[ys,Pd]=Ye.makeAction("shoot");Pd((n,t)=>{wn.push(n),console.log(n.x,n.y)});Lt&&Lt!="notinitialized"?(document.getElementById("setting").style.display="none",document.getElementById("home").style.display="block",document.getElementById("home").onclick=Rd):document.getElementById("go").onclick=Nd;const cn={};let hn=0;const pi=[],qt=[md,wd,yd,bd];let pt=Math.floor(Math.random()*qt.length);const kd=n=>{var t=n.split("."),e=parseInt(t[t.length-2]);return new Promise(function(i,r){if(cn[n])return i(cn[n]);{let s=new Image;s.src=n,s.onload=function(){let o=Sd({image:s,frameWidth:s.width/e,frameHeight:s.height,animations:{walk:{frames:`0..${e-1}`,frameRate:15}}});return cn[n]=o,i(cn[n])}}})};let vt={};const bs=async(n,t)=>{if(vt[n]&&vt[n].url==t)return vt[n].sprite;let e=await kd(t),i=Ed({x:-1e3,y:-1e3,dx:0,dy:0,ddx:0,ddy:0,anchor:{x:.5,y:.5},animations:e.animations});return vt[n]={url:t,sprite:i},i};if(yn){var Es=new Date/10;let{canvas:n,context:t}=ms("game");Td(),Cd();let e=document.getElementById("qr");e.style.display="block",t.canvas.width=window.innerWidth,t.canvas.height=window.innerHeight;for(let r=0;r<120;r++){const s=new OffscreenCanvas(n.width,n.height);pi.push(s)}ws({clearCanvas:!0,update:function(){const r=new Date/10;if(wn.length&&r+100>Es){Es=r+100;const s=wn.pop();bs(s.peerId,qt[s.spriteUrlIndex]).then(o=>{console.log("raw",s.x,s.y),o.x=s.x*t.canvas.width/2+t.canvas.width/2,o.y=s.y*t.canvas.height/2+t.canvas.height/2,console.log(o.x,o.y)})}if(xd("enter")&&(pt=(pt+1)%qt.length),Ad("left")){let s=vd();const o={spriteUrlIndex:pt,peerId:Ye.selfId,x:s.x/t.canvas.width,y:s.ycontext.canvas.height};ys(o),wn.push(o)}for(let s of Object.keys(vt))vt[s].sprite.update()},render:function(){hn++,hn=hn%pi.length;let r=pi[hn];t.drawImage(r,0,0);for(let s of Object.keys(vt))vt[s].sprite.render();r.getContext("2d").drawImage(n,0,0)}}).start()}else if(Lt!="notinitialized"){document.getElementById("phone").style.display="block";let n,t;document.getElementById("reset").onclick=()=>{n=null,t=null};let e,{canvasShoot:i,contextShoot:r}=ms("shootbutton"),s=document.getElementById("shootbutton"),o=document.getElementById("expand");s.width=o.clientWidth,s.height=o.clientHeight,console.log(i,r,"canvas"),document.getElementById("nextgif").onclick=()=>{pt=(pt+1)%qt.length},document.getElementById("previousgif").onclick=()=>{pt=(pt+qt.length-1)%qt.length};let a=!1;s.ontouchstart=()=>{a=!0},s.ontouchend=()=>{a=!1},window.addEventListener("deviceorientation",async c=>{if(n||(n=c.alpha,t=c.gamma),c.alpha-n,c.gamma-t,a){const h={spriteUrlIndex:pt,peerId:Ye.selfId,x:c.alpha,y:c.gamma};console.log(h),ys(h)}}),ws({clearCanvas:!0,update:function(){bs("preview",qt[pt]).then(c=>{c.x=s.width/3+s.width/6,c.y=s.height/2,c.width=o.clientWidth/2,c.height=o.clientHeight/2,e=c}),e&&e.update()},render:function(){e&&e.render()}}).start()}
