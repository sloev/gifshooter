var Ra=Object.defineProperty;var Na=(n,t,e)=>t in n?Ra(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var Es=(n,t,e)=>Na(n,typeof t!="symbol"?t+"":t,e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function e(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(s){if(s.ep)return;s.ep=!0;const r=e(s);fetch(s.href,r)}})();/**
 * @preserve
 * Kontra.js v10.0.2
 */function Ba(n){return n*Math.PI/180}function Pa(n){return n*180/Math.PI}function ka(n,t){return Math.atan2(t.y-n.y,t.x-n.x)}function Er(n,t){let e=Math.sin(t),i=Math.cos(t);return{x:n.x*i-n.y*e,y:n.x*e+n.y*i}}function La(n,t,e){return{x:n.x+Math.cos(t)*e,y:n.y+Math.sin(t)*e}}function Da(n,t,e){return n*(1-e)+t*e}function Oa(n,t,e){return(e-n)/(t-n)}function pe(n,t,e){return Math.min(Math.max(n,e),t)}function Ma(n,t){t==null?localStorage.removeItem(n):localStorage.setItem(n,JSON.stringify(t))}function Ua(n){let t=localStorage.getItem(n);try{t=JSON.parse(t)}catch{}return t}function xr(n,t){let e=_e(n),i=_e(t);return n.radius&&e.width!=e.height||t.radius&&i.width!=i.height?!1:([e,i]=[e,i].map(s=>((s==e?n:t).radius&&(s.radius=s.width/2,s.x+=s.radius,s.y+=s.radius),s)),n.radius&&t.radius?Math.hypot(e.x-i.x,e.y-i.y)<e.radius+i.radius:n.radius||t.radius?Cr(n.radius?e:i,n.radius?t:n):e.x<i.x+i.width&&e.x+e.width>i.x&&e.y<i.y+i.height&&e.y+e.height>i.y)}function _e(n){let{x:t=0,y:e=0,width:i,height:s,radius:r}=n.world||n;return n.mapwidth&&(i=n.mapwidth,s=n.mapheight),r&&(i=r.x*2,s=r.y*2),n.anchor&&(t-=i*n.anchor.x,e-=s*n.anchor.y),i<0&&(t+=i,i*=-1),s<0&&(e+=s,s*=-1),{x:t,y:e,width:i,height:s}}function Fa(n,t,e="y"){return[n,t]=[n,t].map(_e),n[e]-t[e]}let Vt=()=>{},Sr="position:absolute;width:1px;height:1px;overflow:hidden;clip:rect(0,0,0,0);",_i={preventScroll:!0};function mi(n,t){let e=t.parentNode;n.setAttribute("data-kontra",""),e?([...e.querySelectorAll(":scope > [data-kontra]")].pop()||t).after(n):t.nodeName=="CANVAS"?document.body.append(n):t.append(n)}function me(n,t){let e=n.indexOf(t);if(e!=-1)return n.splice(e,1),!0}function Cr(n,t){let{x:e,y:i,width:s,height:r}=_e(t);do e-=t.sx||0,i-=t.sy||0;while(t=t.parent);let o=n.x-Math.max(e,Math.min(n.x,e+s)),a=n.y-Math.max(i,Math.min(n.y,i+r));return o*o+a*a<n.radius*n.radius}let he={};function dt(n,t){he[n]=he[n]||[],he[n].push(t)}function Ar(n,t){he[n]=(he[n]||[]).filter(e=>e!=t)}function Pt(n,...t){(he[n]||[]).map(e=>e(...t))}let Ht,dn,xs={get(n,t){return t=="_proxy"?!0:Vt}};function lt(){return Ht}function ot(){return dn}function $a(n,{contextless:t=!1}={}){if(Ht=document.getElementById(n)||n||document.querySelector("canvas"),t&&(Ht=Ht||new Proxy({},xs)),!Ht)throw Error("You must provide a canvas element for the game");return dn=Ht.getContext("2d")||new Proxy({},xs),dn.imageSmoothingEnabled=!1,Pt("init"),{canvas:Ht,context:dn}}class Ln{constructor({spriteSheet:t,frames:e,frameRate:i,loop:s=!0,name:r}){let{width:o,height:a,spacing:l=0,margin:c=0}=t.frame;Object.assign(this,{spriteSheet:t,frames:e,frameRate:i,loop:s,name:r,width:o,height:a,spacing:l,margin:c,isStopped:!1,_f:0,_a:0})}clone(){return new Ln(this)}start(){this.isStopped=!1,this.loop||this.reset()}stop(){this.isStopped=!0}reset(){this._f=0,this._a=0}update(t=1/60){if(!this.isStopped){if(!this.loop&&this._f==this.frames.length-1){this.stop();return}for(this._a+=t;this._a*this.frameRate>=1;)this._f=++this._f%this.frames.length,this._a-=1/this.frameRate}}render({x:t,y:e,width:i=this.width,height:s=this.height,context:r=ot()}){let o=this.frames[this._f]/this.spriteSheet._f|0,a=this.frames[this._f]%this.spriteSheet._f|0;r.drawImage(this.spriteSheet.image,this.margin+a*this.width+(a*2+1)*this.spacing,this.margin+o*this.height+(o*2+1)*this.spacing,this.width,this.height,t,e,i,s)}}function Tr(){return new Ln(...arguments)}let Ha=/(jpeg|jpg|gif|png|webp)$/,qa=/(wav|mp3|ogg|aac)$/,vr=/^\//,za=/\/$/,Ir=new WeakMap,Rr="",Nr="",Br="";function Dn(n,t){return new URL(n,t).href}function Ui(n,t){return[n.replace(za,""),n?t.replace(vr,""):t].filter(e=>e).join("/")}function Fi(n){return n.split(".").pop()}function $i(n){let t=n.replace("."+Fi(n),"");return t.split("/").length==2?t.replace(vr,""):t}function Ya(n){return{wav:n.canPlayType('audio/wav; codecs="1"'),mp3:n.canPlayType("audio/mpeg;"),ogg:n.canPlayType('audio/ogg; codecs="vorbis"'),aac:n.canPlayType("audio/aac;")}}let zt={},oe={},Yt={};function Hi(){window.__k||(window.__k={dm:Ir,u:Dn,d:Yt,i:zt})}function Wa(n){Rr=n}function ja(n){Nr=n}function Ga(n){Br=n}function Pr(n){return Hi(),new Promise((t,e)=>{let i,s,r;if(i=Ui(Rr,n),zt[i])return t(zt[i]);s=new Image,s.onload=function(){r=Dn(i,window.location.href),zt[$i(n)]=zt[i]=zt[r]=this,Pt("assetLoaded",this,n),t(this)},s.onerror=function(){e("Unable to load image "+i)},s.src=i})}function kr(n){return new Promise((t,e)=>{let i=n,s,r,o,a;if(s=new Audio,r=Ya(s),n=[].concat(n).reduce((l,c)=>l||(r[Fi(c)]?c:null),0),!n)return e("cannot play any of the audio formats provided "+i);if(o=Ui(Nr,n),oe[o])return t(oe[o]);s.addEventListener("canplay",function(){a=Dn(o,window.location.href),oe[$i(n)]=oe[o]=oe[a]=this,Pt("assetLoaded",this,n),t(this)}),s.onerror=function(){e("Unable to load audio "+o)},s.src=o,s.load()})}function Lr(n){Hi();let t,e;return t=Ui(Br,n),Yt[t]?Promise.resolve(Yt[t]):fetch(t).then(i=>{if(!i.ok)throw i;return i.clone().json().catch(()=>i.text())}).then(i=>(e=Dn(t,window.location.href),typeof i=="object"&&Ir.set(i,e),Yt[$i(n)]=Yt[t]=Yt[e]=i,Pt("assetLoaded",i,n),i))}function Ka(...n){return Hi(),Promise.all(n.map(t=>{let e=Fi([].concat(t)[0]);return e.match(Ha)?Pr(t):e.match(qa)?kr(t):Lr(t)}))}class jt{constructor(t=0,e=0,i={}){t.x!=null?(this.x=t.x,this.y=t.y):(this.x=t,this.y=e),i._c&&(this.clamp(i._a,i._b,i._d,i._e),this.x=t,this.y=e)}set(t){this.x=t.x,this.y=t.y}add(t){return new jt(this.x+t.x,this.y+t.y,this)}subtract(t){return new jt(this.x-t.x,this.y-t.y,this)}scale(t){return new jt(this.x*t,this.y*t)}normalize(t=this.length()||1){return new jt(this.x/t,this.y/t)}dot(t){return this.x*t.x+this.y*t.y}length(){return Math.hypot(this.x,this.y)}distance(t){return Math.hypot(this.x-t.x,this.y-t.y)}angle(t){return Math.acos(this.dot(t)/(this.length()*t.length()))}direction(){return Math.atan2(this.y,this.x)}clamp(t,e,i,s){this._c=!0,this._a=t,this._b=e,this._d=i,this._e=s}get x(){return this._x}get y(){return this._y}set x(t){this._x=this._c?pe(this._a,this._d,t):t}set y(t){this._y=this._c?pe(this._b,this._e,t):t}}function fn(){return new jt(...arguments)}class Va{constructor(t){return this.init(t)}init(t={}){this.position=fn(),this.velocity=fn(),this.acceleration=fn(),this.ttl=1/0,Object.assign(this,t)}update(t){this.advance(t)}advance(t){let e=this.acceleration;t&&(e=e.scale(t)),this.velocity=this.velocity.add(e);let i=this.velocity;t&&(i=i.scale(t)),this.position=this.position.add(i),this._pc(),this.ttl--}get dx(){return this.velocity.x}get dy(){return this.velocity.y}set dx(t){this.velocity.x=t}set dy(t){this.velocity.y=t}get ddx(){return this.acceleration.x}get ddy(){return this.acceleration.y}set ddx(t){this.acceleration.x=t}set ddy(t){this.acceleration.y=t}isAlive(){return this.ttl>0}_pc(){}}class Re extends Va{init({width:t=0,height:e=0,context:i=ot(),render:s=this.draw,update:r=this.advance,children:o=[],anchor:a={x:0,y:0},opacity:l=1,rotation:c=0,drotation:h=0,ddrotation:u=0,scaleX:d=1,scaleY:g=1,...m}={}){this._c=[],super.init({width:t,height:e,context:i,anchor:a,opacity:l,rotation:c,drotation:h,ddrotation:u,scaleX:d,scaleY:g,...m}),this._di=!0,this._uw(),this.addChild(o),this._rf=s,this._uf=r,dt("init",()=>{this.context??(this.context=ot())})}update(t){this._uf(t),this.children.map(e=>e.update&&e.update(t))}render(){let t=this.context;t.save(),(this.x||this.y)&&t.translate(this.x,this.y),this.rotation&&t.rotate(this.rotation),(this.scaleX!=1||this.scaleY!=1)&&t.scale(this.scaleX,this.scaleY);let e=this.width,i=this.height;this.radius&&(e=i=this.radius*2);let s=-e*this.anchor.x,r=-i*this.anchor.y;(s||r)&&t.translate(s,r),this.context.globalAlpha=this.opacity,this._rf(),(s||r)&&t.translate(-s,-r),this.children.map(a=>a.render&&a.render()),t.restore()}draw(){}_pc(){this._uw(),this.children.map(t=>t._pc())}get x(){return this.position.x}get y(){return this.position.y}set x(t){this.position.x=t,this._pc()}set y(t){this.position.y=t,this._pc()}get width(){return this._w}set width(t){this._w=t,this._pc()}get height(){return this._h}set height(t){this._h=t,this._pc()}_uw(){if(!this._di)return;let{_wx:t=0,_wy:e=0,_wo:i=1,_wrot:s=0,_wsx:r=1,_wsy:o=1}=this.parent||{};this._wx=this.x,this._wy=this.y,this._ww=this.width,this._wh=this.height,this.radius&&(this._wrx=this.radius,this._wry=this.radius),this._wo=i*this.opacity,this._wsx=r*this.scaleX,this._wsy=o*this.scaleY,this._wx=this._wx*r,this._wy=this._wy*o,this._ww=this.width*this._wsx,this._wh=this.height*this._wsy,this.radius&&(this._wrx=this.radius*this._wsx,this._wry=this.radius*this._wsy),this._wrot=s+this.rotation;let{x:a,y:l}=Er({x:this._wx,y:this._wy},s);this._wx=a,this._wy=l,this._wx+=t,this._wy+=e}get world(){return{x:this._wx,y:this._wy,width:this._ww,height:this._wh,radius:this.radius?{x:this._wrx,y:this._wry}:void 0,opacity:this._wo,rotation:this._wrot,scaleX:this._wsx,scaleY:this._wsy}}set children(t){this.removeChild(this._c),this.addChild(t)}get children(){return this._c}addChild(...t){t.flat().map(e=>{this.children.push(e),e.parent=this,e._pc=e._pc||Vt,e._pc()})}removeChild(...t){t.flat().map(e=>{me(this.children,e)&&(e.parent=null,e._pc())})}get radius(){return this._r}set radius(t){this._r=t,this._pc()}get opacity(){return this._opa}set opacity(t){this._opa=pe(0,1,t),this._pc()}get rotation(){return this._rot}set rotation(t){this._rot=t,this._pc()}advance(t){super.advance(t),this.drotation+=this.ddrotation,this.rotation+=this.drotation}setScale(t,e=t){this.scaleX=t,this.scaleY=e}get scaleX(){return this._scx}set scaleX(t){this._scx=t,this._pc()}get scaleY(){return this._scy}set scaleY(t){this._scy=t,this._pc()}}function Za(){return new Re(...arguments)}let qi=class extends Re{init({image:t,width:e=t?t.width:void 0,height:i=t?t.height:void 0,...s}={}){super.init({image:t,width:e,height:i,...s})}get animations(){return this._a}set animations(t){let e,i;this._a={};for(e in t)this._a[e]=t[e].clone(),i=i||this._a[e];this.currentAnimation=i,this.width=this.width||i.width,this.height=this.height||i.height}playAnimation(t){var e;(e=this.currentAnimation)==null||e.stop(),this.currentAnimation=this.animations[t],this.currentAnimation.start()}advance(t){var e;super.advance(t),(e=this.currentAnimation)==null||e.update(t)}draw(){if(this.image&&this.context.drawImage(this.image,0,0,this.image.width,this.image.height),this.currentAnimation&&this.currentAnimation.render({x:0,y:0,width:this.width,height:this.height,context:this.context}),this.color){if(this.context.fillStyle=this.color,this.radius){this.context.beginPath(),this.context.arc(this.radius,this.radius,this.radius,0,Math.PI*2),this.context.fill();return}this.context.fillRect(0,0,this.width,this.height)}}};function Ja(){return new qi(...arguments)}let Xa=/(\d+)(\w+)/;function Qa(n){if(!n)return{computed:0};let t=n.match(Xa),e=+t[1],i=t[2];return{size:e,unit:i,computed:e}}class Dr extends Re{init({text:t="",textAlign:e="",lineHeight:i=1,font:s=(o=>(o=ot())==null?void 0:o.font)(),...r}={}){t=""+t,super.init({text:t,textAlign:e,lineHeight:i,font:s,...r}),this.context&&this._p(),dt("init",()=>{this.font??(this.font=ot().font),this._p()})}get width(){return this._w}set width(t){this._d=!0,this._w=t,this._fw=t}get text(){return this._t}set text(t){this._d=!0,this._t=""+t}get font(){return this._f}set font(t){this._d=!0,this._f=t,this._fs=Qa(t).computed}get lineHeight(){return this._lh}set lineHeight(t){this._d=!0,this._lh=t}render(){this._d&&this._p(),super.render()}_p(){this._s=[],this._d=!1;let t=this.context,e=[this.text];if(t.font=this.font,e=this.text.split(`
`),this._fw&&e.map(i=>{let s=i.split(" "),r=s.shift(),o=r;s.map(a=>{o+=" "+a,t.measureText(o).width>this._fw&&(this._s.push(r),o=a),r=o}),this._s.push(o)}),!this._s.length&&this.text.includes(`
`)){let i=0;e.map(s=>{this._s.push(s),i=Math.max(i,t.measureText(s).width)}),this._w=this._fw||i}this._s.length||(this._s.push(this.text),this._w=this._fw||t.measureText(this.text).width),this.height=this._fs+(this._s.length-1)*this._fs*this.lineHeight,this._uw()}draw(){let t=0,e=this.textAlign,i=this.context;e=this.textAlign||(i.canvas.dir=="rtl"?"right":"left"),t=e=="right"?this.width:e=="center"?this.width/2|0:0,this._s.map((s,r)=>{i.textBaseline="top",i.textAlign=e,i.fillStyle=this.color,i.font=this.font,this.strokeColor&&(i.strokeStyle=this.strokeColor,i.lineWidth=this.lineWidth??1,i.strokeText(s,t,this._fs*this.lineHeight*r)),i.fillText(s,t,this._fs*this.lineHeight*r)})}}function Or(){return new Dr(...arguments)}let kt=new WeakMap,bn={},On={},Mr={0:"left",1:"middle",2:"right"};function tl(n=lt()){return kt.get(n)}function Ur(n){let t=n._lf.length?n._lf:n._cf;for(let e=t.length-1;e>=0;e--){let i=t[e];if(i.collidesWithPointer?i.collidesWithPointer(n):Cr(n,i))return i}}function st(n,t){return parseFloat(n.getPropertyValue(t))||0}function el(n){let{canvas:t,_s:e}=n,i=t.getBoundingClientRect(),s=e.transform!="none"?e.transform.replace("matrix(","").split(","):[1,1,1,1],r=parseFloat(s[0]),o=parseFloat(s[3]),a=(st(e,"border-left-width")+st(e,"border-right-width"))*r,l=(st(e,"border-top-width")+st(e,"border-bottom-width"))*o,c=(st(e,"padding-left")+st(e,"padding-right"))*r,h=(st(e,"padding-top")+st(e,"padding-bottom"))*o;return{scaleX:(i.width-a-c)/t.width,scaleY:(i.height-l-h)/t.height,offsetX:i.left+(st(e,"border-left-width")+st(e,"padding-left"))*r,offsetY:i.top+(st(e,"border-top-width")+st(e,"padding-top"))*o}}function Ss(n){let t=n.button!=null?Mr[n.button]:"left";On[t]=!0,zi(n,"onDown")}function Xn(n){let t=n.button!=null?Mr[n.button]:"left";On[t]=!1,zi(n,"onUp")}function Cs(n){zi(n,"onOver")}function nl(n){let t=kt.get(n.target);t._oo=null,On={}}function As(n,t,e){let i=Ur(n);i&&i[t]&&i[t](e),bn[t]&&bn[t](e,i),t=="onOver"&&(i!=n._oo&&n._oo&&n._oo.onOut&&n._oo.onOut(e),n._oo=i)}function zi(n,t){n.preventDefault();let e=n.target,i=kt.get(e),{scaleX:s,scaleY:r,offsetX:o,offsetY:a}=el(i);n.type.includes("touch")?(Array.from(n.touches).map(({clientX:c,clientY:h,identifier:u})=>{let d=i.touches[u];d||(d=i.touches[u]={start:{x:(c-o)/s,y:(h-a)/r}},i.touches.length++),d.changed=!1}),Array.from(n.changedTouches).map(({clientX:c,clientY:h,identifier:u})=>{let d=i.touches[u];d.changed=!0,d.x=i.x=(c-o)/s,d.y=i.y=(h-a)/r,As(i,t,n),Pt("touchChanged",n,i.touches),t=="onUp"&&(delete i.touches[u],i.touches.length--,i.touches.length||Pt("touchEnd"))})):(i.x=(n.clientX-o)/s,i.y=(n.clientY-a)/r,As(i,t,n))}function Fr({radius:n=5,canvas:t=lt()}={}){let e=kt.get(t);if(!e){let i=window.getComputedStyle(t);e={x:0,y:0,radius:n,touches:{length:0},canvas:t,_cf:[],_lf:[],_o:[],_oo:null,_s:i},kt.set(t,e)}return t.addEventListener("mousedown",Ss),t.addEventListener("touchstart",Ss),t.addEventListener("mouseup",Xn),t.addEventListener("touchend",Xn),t.addEventListener("touchcancel",Xn),t.addEventListener("blur",nl),t.addEventListener("mousemove",Cs),t.addEventListener("touchmove",Cs),e._t||(e._t=!0,dt("tick",()=>{e._lf.length=0,e._cf.map(i=>{e._lf.push(i)}),e._cf.length=0})),e}function $r(...n){n.flat().map(t=>{let e=t.context?t.context.canvas:lt(),i=kt.get(e);if(!i)throw new ReferenceError("Pointer events not initialized for the objects canvas");t.__r||(t.__r=t.render,t.render=function(){i._cf.push(this),this.__r()},i._o.push(t))})}function il(...n){n.flat().map(t=>{let e=t.context?t.context.canvas:lt(),i=kt.get(e);if(!i)throw new ReferenceError("Pointer events not initialized for the objects canvas");t.render=t.__r,t.__r=0,me(i._o,t)})}function sl(n){let t=n.context?n.context.canvas:lt(),e=kt.get(t);if(!e)throw new ReferenceError("Pointer events not initialized for the objects canvas");return e._o.includes(n)&&Ur(e)===n}function Hr(n,t){let e=n[0].toUpperCase()+n.substr(1);bn["on"+e]=t}function qr(n){let t=n[0].toUpperCase()+n.substr(1);bn["on"+t]=0}function rl(n){return!!On[n]}class zr extends qi{init({padX:t=0,padY:e=0,text:i,disabled:s=!1,container:r,onDown:o,onUp:a,...l}={}){super.init({padX:t,padY:e,...l}),this.textNode=Or({...i,context:this.context}),this.width||(this.width=this.textNode.width,this.height=this.textNode.height),$r(this),this.addChild(this.textNode),this._od=o||Vt,this._ou=a||Vt;let c=this._dn=document.createElement("button");c.style=Sr,c.textContent=this.text,s&&this.disable(),c.addEventListener("focus",()=>this.focus()),c.addEventListener("blur",()=>this.blur()),c.addEventListener("keydown",h=>this._kd(h)),c.addEventListener("keyup",h=>this._ku(h)),mi(c,r??this.context.canvas),this._uw(),this._p()}get text(){return this.textNode.text}set text(t){this._d=!0,this.textNode.text=t}get node(){return this._dn}destroy(){this._dn.remove()}_p(){this.text!=this._dn.textContent&&(this._dn.textContent=this.text),this.textNode._p();let t=this.textNode.width+this.padX*2,e=this.textNode.height+this.padY*2;this.width=Math.max(t,this.width),this.height=Math.max(e,this.height),this._uw()}render(){this._d&&this._p(),super.render()}enable(){this.disabled=this._dn.disabled=!1,this.onEnable()}disable(){this.disabled=this._dn.disabled=!0,this.onDisable()}focus(){this.disabled||(this.focused=!0,document.activeElement!=this._dn&&this._dn.focus(_i),this.onFocus())}blur(){this.focused=!1,document.activeElement==this._dn&&this._dn.blur(),this.onBlur()}onOver(){this.disabled||(this.hovered=!0)}onOut(){this.hovered=!1}onEnable(){}onDisable(){}onFocus(){}onBlur(){}onDown(){this.disabled||(this.pressed=!0,this._od())}onUp(){this.disabled||(this.pressed=!1,this._ou())}_kd(t){(t.code=="Enter"||t.code=="Space")&&this.onDown()}_ku(t){(t.code=="Enter"||t.code=="Space")&&this.onUp()}}function ol(){return new zr(...arguments)}function al(n){let t=n.canvas;n.clearRect(0,0,t.width,t.height)}function ll({fps:n=60,clearCanvas:t=!0,update:e=Vt,render:i,context:s=ot(),blur:r=!1}={}){if(!i)throw Error("You must provide a render() function");let o=0,a=1e3/n,l=1/n,c=t?al:Vt,h,u,d,g,m,f=!0;r||(window.addEventListener("focus",()=>{f=!0}),window.addEventListener("blur",()=>{f=!1})),dt("init",()=>{m.context??(m.context=ot())});function _(){if(u=requestAnimationFrame(_),!!f&&(d=performance.now(),g=d-h,h=d,!(g>1e3))){for(o+=g;o>=a;)Pt("tick"),m.update(l),o-=a;c(m.context),m.render()}}return m={update:e,render:i,isStopped:!0,context:s,start(){this.isStopped&&(h=performance.now(),this.isStopped=!1,requestAnimationFrame(_))},stop(){this.isStopped=!0,cancelAnimationFrame(u)},_frame:_,set _last(p){h=p}},m}let wt=[],En={},xn={},Mn={0:"south",1:"east",2:"west",3:"north",4:"leftshoulder",5:"rightshoulder",6:"lefttrigger",7:"righttrigger",8:"select",9:"start",10:"leftstick",11:"rightstick",12:"dpadup",13:"dpaddown",14:"dpadleft",15:"dpadright"};function cl(n){wt[n.gamepad.index]={pressedButtons:{},axes:{}}}function hl(n){delete wt[n.gamepad.index]}function ul(){wt.map(n=>{n.pressedButtons={},n.axes={}})}function Yr(){let n=navigator.getGamepads?navigator.getGamepads():navigator.webkitGetGamepads?navigator.webkitGetGamepads:[];for(let t=0;t<n.length;t++){let e=n[t];if(!e)continue;e.buttons.map((s,r)=>{let o=Mn[r],{pressed:a}=s,{pressedButtons:l}=wt[e.index],c=l[o];!c&&a?[En[e.index],En].map(h=>{var u;(u=h==null?void 0:h[o])==null||u.call(h,e,s,o)}):c&&!a&&[xn[e.index],xn].map(h=>{var u;(u=h==null?void 0:h[o])==null||u.call(h,e,s,o)}),l[o]=a});let{axes:i}=wt[e.index];i.leftstickx=e.axes[0],i.leftsticky=e.axes[1],i.rightstickx=e.axes[2],i.rightsticky=e.axes[3]}}function Wr(){window.addEventListener("gamepadconnected",cl),window.addEventListener("gamepaddisconnected",hl),window.addEventListener("blur",ul),dt("tick",Yr)}function jr(n,t,{gamepad:e,handler:i="gamepaddown"}={}){let s=i=="gamepaddown"?En:xn;[].concat(n).map(r=>{isNaN(e)?s[r]=t:(s[e]=s[e]||{},s[e][r]=t)})}function Gr(n,{gamepad:t,handler:e="gamepaddown"}={}){let i=e=="gamepaddown"?En:xn;[].concat(n).map(s=>{isNaN(t)?delete i[s]:(i[t]=i[t]||{},delete i[t][s])})}function dl(n,{gamepad:t}={}){return isNaN(t)?wt.some(e=>e.pressedButtons[n]):wt[t]?!!wt[t].pressedButtons[n]:!1}function fl(n,t){var e;return((e=wt[t])==null?void 0:e.axes[n])||0}let Sn={},en,Ts=!1,Cn={swipe:{touches:1,threshold:10,touchend({0:n}){let t=n.x-n.start.x,e=n.y-n.start.y,i=Math.abs(t),s=Math.abs(e);if(!(i<this.threshold&&s<this.threshold))return i>s?t<0?"left":"right":e<0?"up":"down"}},pinch:{touches:2,threshold:2,touchstart({0:n,1:t}){this.prevDist=Math.hypot(n.x-t.x,n.y-t.y)},touchmove({0:n,1:t}){let e=Math.hypot(n.x-t.x,n.y-t.y);if(Math.abs(e-this.prevDist)<this.threshold)return;let i=e>this.prevDist?"out":"in";return this.prevDist=e,i}}};function Kr(){Ts||(Ts=!0,dt("touchChanged",(n,t)=>{Object.keys(Cn).map(e=>{var r;let i=Cn[e],s;(!en||en==e)&&t.length==i.touches&&[...Array(t.length).keys()].every(o=>t[o])&&(s=((r=i[n.type])==null?void 0:r.call(i,t))??"")&&Sn[e+s]&&(en=e,Sn[e+s](n,t))})}),dt("touchEnd",()=>{en=0}))}function Vr(n,t){[].concat(n).map(e=>{Sn[e]=t})}function Zr(n){[].concat(n).map(t=>{Sn[t]=0})}let gl={set(n,t,e){return t.startsWith("_")||(n._d=!0),Reflect.set(n,t,e)}},vs={start(n){return n?1:0},center(){return .5},end(n){return n?0:1}};class Jr extends Re{init({flow:t="column",align:e="start",justify:i="start",colGap:s=0,rowGap:r=0,numCols:o=1,dir:a="",breakpoints:l=[],...c}={}){return super.init({flow:t,align:e,justify:i,colGap:s,rowGap:r,numCols:o,dir:a,breakpoints:l,...c}),this._p(),new Proxy(this,gl)}addChild(t){this._d=!0,super.addChild(t)}removeChild(t){this._d=!0,super.removeChild(t)}render(){this._d&&this._p(),super.render()}destroy(){this.children.map(t=>t.destroy&&t.destroy())}_p(){this._d=!1,this.breakpoints.map(p=>{p.metric.call(this)&&this._b!==p&&(this._b=p,p.callback.call(this))});let t=this._g=[],e=this._cw=[],i=this._rh=[],s=this.children,r=this._nc=this.flow=="column"?1:this.flow=="row"?s.length:this.numCols,o=0,a=0;for(let p=0,b;b=s[p];p++){t[o]=t[o]||[],b._p&&b._p();let{width:S,height:E}=b.world||b;i[o]=Math.max(i[o]||0,E);let v=b.colSpan||1,A=v;do e[a]=Math.max(e[a]||0,S/A),t[o][a]=b;while(a++<=r&&--v);a>=r&&(a=0,o++)}for(;a>0&&a<r;)t[o][a++]=!1;let l=t.length,c=[].concat(this.colGap),h=[].concat(this.rowGap);this._w=e.reduce((p,b)=>p+=b,0);for(let p=0;p<r-1;p++)this._w+=c[p%c.length];this._h=i.reduce((p,b)=>p+=b,0);for(let p=0;p<l-1;p++)this._h+=h[p%h.length];this._uw();let d=this.context.canvas.dir=="rtl"&&!this.dir||this.dir=="rtl";this._rtl=d,d&&(this._g=t.map(p=>p.reverse()),this._cw=e.reverse(),c=c.reverse());let g=-this.anchor.y*this.height,m=[],f=[].concat(this.justify),_=[].concat(this.align);this._g.map((p,b)=>{let S=-this.anchor.x*this.width;p.map((E,v)=>{if(E&&!m.includes(E)){m.push(E);let A=vs[E.justifySelf||f[v%f.length]](this._rtl),R=vs[E.alignSelf||_[b%_.length]](),B=E.colSpan||1,U=e[v];if(B>1&&v+B<=this._nc)for(let C=1;C<B;C++)U+=e[v+C]+c[(v+C)%c.length];let P=U*A,k=i[b]*R,w=0,T=0,{width:x,height:y}=E.world||E;if(E.anchor&&(w=E.anchor.x,T=E.anchor.y),A==0)P=P+x*w;else if(A==.5){let C=w<.5?-1:w==.5?0:1;P=P+C*x*A}else P=P-x*(1-w);if(R==0)k=k+y*T;else if(R==.5){let C=T<.5?-1:T==.5?0:1;k=k+C*y*R}else k=k-y*(1-T);E.x=S+P,E.y=g+k}S+=e[v]+c[v%c.length]}),g+=i[b]+h[b%h.length]})}}function pl(){return new Jr(...arguments)}let Yi={},Wi={},Un={},Rt={Enter:"enter",Escape:"esc",Space:"space",ArrowLeft:"arrowleft",ArrowUp:"arrowup",ArrowRight:"arrowright",ArrowDown:"arrowdown"};function Xr(n=Vt,t){n._pd&&t.preventDefault(),n(t)}function _l(n){let t=Rt[n.code],e=Yi[t];Un[t]=!0,Xr(e,n)}function ml(n){let t=Rt[n.code],e=Wi[t];Un[t]=!1,Xr(e,n)}function wl(){Un={}}function Qr(){let n;for(n=0;n<26;n++)Rt["Key"+String.fromCharCode(n+65)]=String.fromCharCode(n+97);for(n=0;n<10;n++)Rt["Digit"+n]=Rt["Numpad"+n]=""+n;window.addEventListener("keydown",_l),window.addEventListener("keyup",ml),window.addEventListener("blur",wl)}function to(n,t,{handler:e="keydown",preventDefault:i=!0}={}){let s=e=="keydown"?Yi:Wi;t._pd=i,[].concat(n).map(r=>s[r]=t)}function eo(n,{handler:t="keydown"}={}){let e=t=="keydown"?Yi:Wi;[].concat(n).map(i=>delete e[i])}function yl(n){return!![].concat(n).some(t=>Un[t])}function An(n,t){return Object.values(t).includes(n)}function no(n){return Object.keys(Cn).some(t=>n.startsWith(t))}function bl(n={}){Qr();let t=Fr(n.pointer);return Kr(),Wr(),{pointer:t}}function El(n,t,{gamepad:e,key:i}={}){[].concat(n).map(s=>{if(An(s,Mn))jr(s,t,e);else if(no(s))Vr(s,t);else if(An(s,Rt))to(s,t,i);else if(["down","up"].includes(s))Hr(s,t);else throw new TypeError(`"${s}" is not a valid input name`)})}function xl(n,{gamepad:t,key:e}={}){[].concat(n).map(i=>{An(i,Mn)?Gr(i,t):no(i)?Zr(i):An(i,Rt)?eo(i,e):["down","up"].includes(i)&&qr(i)})}function io(n){let t=n.substr(n.search(/[A-Z]/));return t[0].toLowerCase()+t.substr(1)}function Sl(n,t){let e=n.prototype;e&&(e._inc||(e._inc={},e._bInc=function(s,r,...o){return this._inc[r].before.reduce((a,l)=>{let c=l(s,...a);return c||a},o)},e._aInc=function(s,r,o,...a){return this._inc[r].after.reduce((l,c)=>{let h=c(s,l,...a);return h||l},o)}),Object.getOwnPropertyNames(t).map(i=>{let s=io(i);e[s]&&(e["_o"+s]||(e["_o"+s]=e[s],e[s]=function(...o){let a=this._bInc(this,s,...o),l=e["_o"+s].call(this,...a);return this._aInc(this,s,l,...o)}),e._inc[s]||(e._inc[s]={before:[],after:[]}),i.startsWith("before")?e._inc[s].before.push(t[i]):i.startsWith("after")&&e._inc[s].after.push(t[i]))}))}function Cl(n,t){let e=n.prototype;!e||!e._inc||Object.getOwnPropertyNames(t).map(i=>{let s=io(i);i.startsWith("before")?me(e._inc[s].before,t[i]):i.startsWith("after")&&me(e._inc[s].after,t[i])})}function Al(n,t){let e=n.prototype;e&&Object.getOwnPropertyNames(t).map(i=>{e[i]||(e[i]=t[i])})}class so{constructor({create:t,maxSize:e=1024}={}){let i;if(!t||!(i=t())||!(i.update&&i.init&&i.isAlive&&i.render))throw Error("Must provide create() function which returns an object with init(), update(), render(), and isAlive() functions");this._c=t,this.objects=[t()],this.size=0,this.maxSize=e}get(t={}){if(this.size==this.objects.length){if(this.size==this.maxSize)return;for(let i=0;i<this.size&&this.objects.length<this.maxSize;i++)this.objects.push(this._c())}let e=this.objects[this.size];return this.size++,e.init(t),e}getAliveObjects(){return this.objects.slice(0,this.size)}clear(){this.size=this.objects.length=0,this.objects.push(this._c())}update(t){let e,i=!1;for(let s=this.size;s--;)e=this.objects[s],e.update(t),e.isAlive()||(i=!0,this.size--);i&&this.objects.sort((s,r)=>r.isAlive()-s.isAlive())}render(){for(let t=this.size;t--;)this.objects[t].render()}}function Tl(){return new so(...arguments)}function Is(n,t){let e=[],i=t.x+t.width/2,s=t.y+t.height/2,r=n.y<s,o=n.y+n.height>=s;return n.x<i&&(r&&e.push(0),o&&e.push(2)),n.x+n.width>=i&&(r&&e.push(1),o&&e.push(3)),e}class Fn{constructor({maxDepth:t=3,maxObjects:e=25,bounds:i}={}){this.maxDepth=t,this.maxObjects=e;let s=lt();this.bounds=i||{x:0,y:0,width:s.width,height:s.height},this._b=!1,this._d=0,this._o=[],this._s=[],this._p=null}clear(){this._s.map(t=>{t.clear()}),this._b=!1,this._o.length=0}get(t){let e=new Set;for(;this._s.length&&this._b;)return Is(t,this.bounds).map(i=>{this._s[i].get(t).map(s=>e.add(s))}),Array.from(e);return this._o.filter(i=>i!==t)}add(...t){t.flat().map(e=>{if(this._b){this._a(e);return}this._o.push(e),this._o.length>this.maxObjects&&this._d<this.maxDepth&&(this._sp(),this._o.map(i=>this._a(i)),this._o.length=0)})}_a(t){Is(t,this.bounds).map(e=>{this._s[e].add(t)})}_sp(t,e,i){if(this._b=!0,!this._s.length)for(t=this.bounds.width/2|0,e=this.bounds.height/2|0,i=0;i<4;i++)this._s[i]=new Fn({bounds:{x:this.bounds.x+(i%2==1?t:0),y:this.bounds.y+(i>=2?e:0),width:t,height:e},maxDepth:this.maxDepth,maxObjects:this.maxObjects}),this._s[i]._d=this._d+1}}function vl(){return new Fn(...arguments)}let _t;function ro(){_t??(_t=Date.now()),_t|=0,_t=_t+2654435769|0;let n=_t^_t>>>16;return n=Math.imul(n,569420461),n=n^n>>>15,n=Math.imul(n,1935289751),((n=n^n>>>15)>>>0)/4294967296}function Il(n,t,e=ro){return(e()*(t-n+1)|0)+n}function Rl(){return _t}function Nl(n=Date.now()){if(_t=n,typeof n=="string"){for(var t=0,e=1779033703^n.length;t<n.length;t++)e=Math.imul(e^n.charCodeAt(t),3432918353),e=e<<13|e>>>19;e=Math.imul(e^e>>>16,2246822507),e=Math.imul(e^e>>>13,3266489909),_t=(e^=e>>>16)>>>0}}function wi(n){let t=[];return n._dn?t.push(n._dn):n.children&&n.children.map(e=>{t=t.concat(wi(e))}),t}class oo{constructor({id:t,name:e=t,objects:i=[],context:s=ot(),cullObjects:r=!0,cullFunction:o=xr,sortFunction:a,...l}){this._o=[],Object.assign(this,{id:t,name:e,context:s,cullObjects:r,cullFunction:o,sortFunction:a,...l});let c=this._dn=document.createElement("section");c.tabIndex=-1,c.style=Sr,c.id=t,c.setAttribute("aria-label",e);let h=this;class u extends Re{set x(g){h.sx=g-this.centerX,super.x=g}get x(){return super.x}set y(g){h.sy=g-this.centerY,super.y=g}get y(){return super.y}}this.camera=new u({context:s,anchor:{x:.5,y:.5},render:this._rf.bind(this)}),this.add(i),this._i=()=>{this.context??(this.context=ot());let d=this.context.canvas,{width:g,height:m}=d,f=g/2,_=m/2;Object.assign(this.camera,{centerX:f,centerY:_,x:f,y:_,width:g,height:m}),c.isConnected||mi(c,d)},this.context&&this._i(),dt("init",this._i)}set objects(t){this.remove(this._o),this.add(t)}get objects(){return this._o}get node(){return this._dn}add(...t){t.flat().map(e=>{this._o.push(e),e.parent=this,this._dn.append(...wi(e))})}remove(...t){t.flat().map(e=>{me(this._o,e),e.parent=null,wi(e).map(i=>{mi(i,this.context.canvas)})})}show(){this.hidden=this._dn.hidden=!1;let t=this._o.find(e=>e.focus);t?t.focus(_i):this._dn.focus(_i),this.onShow()}hide(){this.hidden=this._dn.hidden=!0,this.onHide()}destroy(){Ar("init",this._i),this._dn.remove(),this._o.map(t=>t.destroy&&t.destroy())}lookAt(t){let{x:e,y:i}=t.world||t;this.camera.x=e,this.camera.y=i}update(t){this.hidden||this._o.map(e=>e.update&&e.update(t))}_rf(){let{_o:t,context:e,_sx:i,_sy:s,camera:r,sortFunction:o,cullObjects:a,cullFunction:l}=this;e.translate(i,s);let c=t;a&&(c=c.filter(h=>l(r,h))),o&&c.sort(o),c.map(h=>h.render&&h.render())}render(){if(!this.hidden){let{context:t,camera:e}=this,{x:i,y:s,centerX:r,centerY:o}=e;t.save(),this._sx=r-i,this._sy=o-s,t.translate(this._sx,this._sy),e.render(),t.restore()}}onShow(){}onHide(){}}function Bl(){return new oo(...arguments)}function Pl(n){if(+n==n)return n;let t=[],e=n.split(".."),i=+e[0],s=+e[1],r=i;if(i<s)for(;r<=s;r++)t.push(r);else for(;r>=s;r--)t.push(r);return t}let ao=class{constructor({image:t,frameWidth:e,frameHeight:i,spacing:s=0,margin:r=0,animations:o}={}){if(!t)throw Error("You must provide an Image for the SpriteSheet");this.animations={},this.image=t,this.frame={width:e,height:i,spacing:s,margin:r},this._f=(t.width-r)/e|0,this.createAnimations(o)}createAnimations(t){let e,i;for(i in t){let{frames:s,frameRate:r,loop:o}=t[i];if(e=[],s==null)throw Error("Animation "+i+" must provide a frames property");[].concat(s).map(a=>{e=e.concat(Pl(a))}),this.animations[i]=Tr({spriteSheet:this,frames:e,frameRate:r,loop:o,name:i})}}};function kl(){return new ao(...arguments)}let Rs=2147483648,Ns=1073741824,Bs=536870912;function Be(n,t){return n/t|0}function Pe(n,t){return n/t|0}class lo{constructor(t={}){let{width:e,height:i,tilewidth:s,tileheight:r,tilesets:o}=t,a=e*s,l=i*r,c=document.createElement("canvas");c.width=a,c.height=l,this._c=c,this._ctx=c.getContext("2d"),o.map(h=>{let{__k:u,location:d}=window,g=(u?u.dm.get(t):"")||d.href,{source:m}=h;if(m){if(!u)throw Error('You must use "load" or "loadData" to resolve tileset.source');let _=u.d[u.u(m,g)];if(!_)throw Error(`You must load the tileset source "${m}" before loading the tileset`);Object.keys(_).map(p=>{h[p]=_[p]})}let{image:f}=h;if(""+f===f){if(!u)throw Error('You must use "load" or "loadImage" to resolve tileset.image');let _=u.i[u.u(f,g)];if(!_)throw Error(`You must load the image "${f}" before loading the tileset`);h.image=_}}),Object.assign(this,{context:ot(),layerMap:{},layerCanvases:{},mapwidth:a,mapheight:l,_sx:0,_sy:0,_o:[],...t}),this.context&&this._p(),dt("init",()=>{this.context??(this.context=ot()),this._p()})}get sx(){return this._sx}get sy(){return this._sy}set sx(t){let e=Math.max(0,this.mapwidth-lt().width);this._sx=pe(0,e,t)}set sy(t){let e=Math.max(0,this.mapheight-lt().height);this._sy=pe(0,e,t)}set objects(t){this.remove(this._o),this.add(t)}get objects(){return this._o}add(...t){t.flat().map(e=>{this._o.push(e),e.parent=this})}remove(...t){t.flat().map(e=>{me(this._o,e),e.parent=null})}getPosition(t){let e=lt().getBoundingClientRect(),i=t.x-e.x,s=t.y-e.y;return i+=this.sx,s+=this.sy,{x:i,y:s,row:Be(s,this.tileheight),col:Pe(i,this.tilewidth)}}setTileAtLayer(t,e,i){let{layerMap:s,tileheight:r,tilewidth:o,width:a}=this,{row:l,col:c,x:h,y:u}=e,d=l??Be(u,r),g=c??Pe(h,o);s[t]&&(this._d=!0,s[t]._d=!0,s[t].data[d*a+g]=i)}setLayer(t,e){let{layerMap:i}=this;i[t]&&(this._d=!0,i[t]._d=!0,i[t].data=e)}layerCollidesWith(t,e){let{tilewidth:i,tileheight:s,layerMap:r}=this,{x:o,y:a,width:l,height:c}=_e(e),h=Be(a,s),u=Pe(o,i),d=Be(a+c,s),g=Pe(o+l,i),m=r[t];for(let f=h;f<=d;f++)for(let _=u;_<=g;_++)if(m.data[_+f*this.width])return!0;return!1}tileAtLayer(t,e){let{layerMap:i,tileheight:s,tilewidth:r,width:o}=this,{row:a,col:l,x:c,y:h}=e,u=a??Be(h,s),d=l??Pe(c,r);return i[t]?i[t].data[u*o+d]:-1}render(t=this._c,e=!0){let{_d:i,context:s,sx:r=0,sy:o=0}=this;i&&this._p();let{width:a,height:l}=lt(),c=Math.min(t.width,a),h=Math.min(t.height,l);s.drawImage(t,r,o,c,h,0,0,c,h),e&&(s.save(),(r||o)&&s.translate(-r,-o),this.objects.map(u=>u.render&&u.render()),s.restore())}renderLayer(t){let{layerCanvases:e,layerMap:i}=this,s=i[t],r=e[t],o=r==null?void 0:r.getContext("2d");if(!r){let{mapwidth:a,mapheight:l}=this;r=document.createElement("canvas"),o=r.getContext("2d"),r.width=a,r.height=l,e[t]=r,this._rl(s,o)}s._d&&(s._d=!1,o.clearRect(0,0,r.width,r.height),this._rl(s,o)),this.render(r,!1)}_p(){let{_ctx:t,layers:e=[],layerMap:i}=this;this._d=!1,e.map(s=>{let{name:r,data:o,visible:a}=s;s._d=!1,i[r]=s,o&&a!=!1&&this._rl(s,t)})}_rl(t,e){let{opacity:i,data:s=[]}=t,{tilesets:r,width:o,tilewidth:a,tileheight:l}=this;e.save(),e.globalAlpha=i,s.map((c,h)=>{if(!c)return;let u=0,d=0,g=c&Rs,m=c&Ns,f=0,_=0,p=0,b=0,S=0;u=g||m,c&=~(Rs|Ns),S=c&Bs,S&&(g&&m?p=1:g?f=1:m?_=1:b=1,d=f||_||p||b,c&=~Bs);let E;for(let C=r.length-1;C>=0&&(E=r[C],!(c/E.firstgid>=1));C--);let{image:v,spacing:A=0,margin:R=0,firstgid:B,columns:U}=E,P=c-B,k=U??v.width/(a+A)|0,w=h%o*a,T=(h/o|0)*l,x=R+P%k*(a+A),y=R+(P/k|0)*(l+A);d?(e.save(),e.translate(w+a/2,T+l/2),_||b?e.rotate(-Math.PI/2):(f||p)&&e.rotate(Math.PI/2),(p||b)&&e.scale(-1,1),w=-a/2,T=-l/2):u&&(e.save(),e.translate(w+(g?a:0),T+(m?l:0)),e.scale(g?-1:1,m?-1:1),w=u?0:w,T=u?0:T),e.drawImage(v,x,y,a,l,w,T,a,l),(u||d)&&e.restore()}),e.restore()}}function Ll(){return new lo(...arguments)}let Dl={Animation:Tr,AnimationClass:Ln,imageAssets:zt,audioAssets:oe,dataAssets:Yt,setImagePath:Wa,setAudioPath:ja,setDataPath:Ga,loadImage:Pr,loadAudio:kr,loadData:Lr,load:Ka,Button:ol,ButtonClass:zr,init:$a,getCanvas:lt,getContext:ot,on:dt,off:Ar,emit:Pt,GameLoop:ll,GameObject:Za,GameObjectClass:Re,gamepadMap:Mn,updateGamepad:Yr,initGamepad:Wr,onGamepad:jr,offGamepad:Gr,gamepadPressed:dl,gamepadAxis:fl,gestureMap:Cn,initGesture:Kr,onGesture:Vr,offGesture:Zr,Grid:pl,GridClass:Jr,degToRad:Ba,radToDeg:Pa,angleToTarget:ka,rotatePoint:Er,movePoint:La,lerp:Da,inverseLerp:Oa,clamp:pe,setStoreItem:Ma,getStoreItem:Ua,collides:xr,getWorldRect:_e,depthSort:Fa,initInput:bl,onInput:El,offInput:xl,keyMap:Rt,initKeys:Qr,onKey:to,offKey:eo,keyPressed:yl,registerPlugin:Sl,unregisterPlugin:Cl,extendObject:Al,initPointer:Fr,getPointer:tl,track:$r,untrack:il,pointerOver:sl,onPointer:Hr,offPointer:qr,pointerPressed:rl,Pool:Tl,PoolClass:so,Quadtree:vl,QuadtreeClass:Fn,rand:ro,randInt:Il,getSeed:Rl,seedRand:Nl,Scene:Bl,SceneClass:oo,Sprite:Ja,SpriteClass:qi,SpriteSheet:kl,SpriteSheetClass:ao,Text:Or,TextClass:Dr,TileEngine:Ll,TileEngineClass:lo,Vector:fn,VectorClass:jt};function Ps(n){if(!Number.isSafeInteger(n)||n<0)throw new Error(`positive integer expected, not ${n}`)}function Ol(n){return n instanceof Uint8Array||n!=null&&typeof n=="object"&&n.constructor.name==="Uint8Array"}function $n(n,...t){if(!Ol(n))throw new Error("Uint8Array expected");if(t.length>0&&!t.includes(n.length))throw new Error(`Uint8Array expected of length ${t}, not of length=${n.length}`)}function Ml(n){if(typeof n!="function"||typeof n.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");Ps(n.outputLen),Ps(n.blockLen)}function Tn(n,t=!0){if(n.destroyed)throw new Error("Hash instance has been destroyed");if(t&&n.finished)throw new Error("Hash#digest() has already been called")}function Ul(n,t){$n(n);const e=t.outputLen;if(n.length<e)throw new Error(`digestInto() expects output buffer of length at least ${e}`)}const Qn=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */const ti=n=>new DataView(n.buffer,n.byteOffset,n.byteLength),ut=(n,t)=>n<<32-t|n>>>t;new Uint8Array(new Uint32Array([287454020]).buffer)[0];function Fl(n){if(typeof n!="string")throw new Error(`utf8ToBytes expected string, got ${typeof n}`);return new Uint8Array(new TextEncoder().encode(n))}function ji(n){return typeof n=="string"&&(n=Fl(n)),$n(n),n}function $l(...n){let t=0;for(let i=0;i<n.length;i++){const s=n[i];$n(s),t+=s.length}const e=new Uint8Array(t);for(let i=0,s=0;i<n.length;i++){const r=n[i];e.set(r,s),s+=r.length}return e}class co{clone(){return this._cloneInto()}}function Hl(n){const t=i=>n().update(ji(i)).digest(),e=n();return t.outputLen=e.outputLen,t.blockLen=e.blockLen,t.create=()=>n(),t}function ho(n=32){if(Qn&&typeof Qn.getRandomValues=="function")return Qn.getRandomValues(new Uint8Array(n));throw new Error("crypto.getRandomValues must be defined")}function ql(n,t,e,i){if(typeof n.setBigUint64=="function")return n.setBigUint64(t,e,i);const s=BigInt(32),r=BigInt(4294967295),o=Number(e>>s&r),a=Number(e&r),l=i?4:0,c=i?0:4;n.setUint32(t+l,o,i),n.setUint32(t+c,a,i)}const zl=(n,t,e)=>n&t^~n&e,Yl=(n,t,e)=>n&t^n&e^t&e;class Wl extends co{constructor(t,e,i,s){super(),this.blockLen=t,this.outputLen=e,this.padOffset=i,this.isLE=s,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(t),this.view=ti(this.buffer)}update(t){Tn(this);const{view:e,buffer:i,blockLen:s}=this;t=ji(t);const r=t.length;for(let o=0;o<r;){const a=Math.min(s-this.pos,r-o);if(a===s){const l=ti(t);for(;s<=r-o;o+=s)this.process(l,o);continue}i.set(t.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===s&&(this.process(e,0),this.pos=0)}return this.length+=t.length,this.roundClean(),this}digestInto(t){Tn(this),Ul(t,this),this.finished=!0;const{buffer:e,view:i,blockLen:s,isLE:r}=this;let{pos:o}=this;e[o++]=128,this.buffer.subarray(o).fill(0),this.padOffset>s-o&&(this.process(i,0),o=0);for(let u=o;u<s;u++)e[u]=0;ql(i,s-8,BigInt(this.length*8),r),this.process(i,0);const a=ti(t),l=this.outputLen;if(l%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const c=l/4,h=this.get();if(c>h.length)throw new Error("_sha2: outputLen bigger than state");for(let u=0;u<c;u++)a.setUint32(4*u,h[u],r)}digest(){const{buffer:t,outputLen:e}=this;this.digestInto(t);const i=t.slice(0,e);return this.destroy(),i}_cloneInto(t){t||(t=new this.constructor),t.set(...this.get());const{blockLen:e,buffer:i,length:s,finished:r,destroyed:o,pos:a}=this;return t.length=s,t.pos=a,t.finished=r,t.destroyed=o,s%e&&t.buffer.set(i),t}}const jl=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),St=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Ct=new Uint32Array(64);class Gl extends Wl{constructor(){super(64,32,8,!1),this.A=St[0]|0,this.B=St[1]|0,this.C=St[2]|0,this.D=St[3]|0,this.E=St[4]|0,this.F=St[5]|0,this.G=St[6]|0,this.H=St[7]|0}get(){const{A:t,B:e,C:i,D:s,E:r,F:o,G:a,H:l}=this;return[t,e,i,s,r,o,a,l]}set(t,e,i,s,r,o,a,l){this.A=t|0,this.B=e|0,this.C=i|0,this.D=s|0,this.E=r|0,this.F=o|0,this.G=a|0,this.H=l|0}process(t,e){for(let u=0;u<16;u++,e+=4)Ct[u]=t.getUint32(e,!1);for(let u=16;u<64;u++){const d=Ct[u-15],g=Ct[u-2],m=ut(d,7)^ut(d,18)^d>>>3,f=ut(g,17)^ut(g,19)^g>>>10;Ct[u]=f+Ct[u-7]+m+Ct[u-16]|0}let{A:i,B:s,C:r,D:o,E:a,F:l,G:c,H:h}=this;for(let u=0;u<64;u++){const d=ut(a,6)^ut(a,11)^ut(a,25),g=h+d+zl(a,l,c)+jl[u]+Ct[u]|0,f=(ut(i,2)^ut(i,13)^ut(i,22))+Yl(i,s,r)|0;h=c,c=l,l=a,a=o+g|0,o=r,r=s,s=i,i=g+f|0}i=i+this.A|0,s=s+this.B|0,r=r+this.C|0,o=o+this.D|0,a=a+this.E|0,l=l+this.F|0,c=c+this.G|0,h=h+this.H|0,this.set(i,s,r,o,a,l,c,h)}roundClean(){Ct.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}const yi=Hl(()=>new Gl);class uo extends co{constructor(t,e){super(),this.finished=!1,this.destroyed=!1,Ml(t);const i=ji(e);if(this.iHash=t.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const s=this.blockLen,r=new Uint8Array(s);r.set(i.length>s?t.create().update(i).digest():i);for(let o=0;o<r.length;o++)r[o]^=54;this.iHash.update(r),this.oHash=t.create();for(let o=0;o<r.length;o++)r[o]^=106;this.oHash.update(r),r.fill(0)}update(t){return Tn(this),this.iHash.update(t),this}digestInto(t){Tn(this),$n(t,this.outputLen),this.finished=!0,this.iHash.digestInto(t),this.oHash.update(t),this.oHash.digestInto(t),this.destroy()}digest(){const t=new Uint8Array(this.oHash.outputLen);return this.digestInto(t),t}_cloneInto(t){t||(t=Object.create(Object.getPrototypeOf(this),{}));const{oHash:e,iHash:i,finished:s,destroyed:r,blockLen:o,outputLen:a}=this;return t=t,t.finished=s,t.destroyed=r,t.blockLen=o,t.outputLen=a,t.oHash=e._cloneInto(t.oHash),t.iHash=i._cloneInto(t.iHash),t}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const fo=(n,t,e)=>new uo(n,t).update(e).digest();fo.create=(n,t)=>new uo(n,t);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Gi=BigInt(0),Hn=BigInt(1),Kl=BigInt(2);function Zt(n){return n instanceof Uint8Array||n!=null&&typeof n=="object"&&n.constructor.name==="Uint8Array"}function je(n){if(!Zt(n))throw new Error("Uint8Array expected")}function we(n,t){if(typeof t!="boolean")throw new Error(`${n} must be valid boolean, got "${t}".`)}const Vl=Array.from({length:256},(n,t)=>t.toString(16).padStart(2,"0"));function ye(n){je(n);let t="";for(let e=0;e<n.length;e++)t+=Vl[n[e]];return t}function go(n){const t=n.toString(16);return t.length&1?`0${t}`:t}function Ki(n){if(typeof n!="string")throw new Error("hex string expected, got "+typeof n);return BigInt(n===""?"0":`0x${n}`)}const gt={_0:48,_9:57,_A:65,_F:70,_a:97,_f:102};function ks(n){if(n>=gt._0&&n<=gt._9)return n-gt._0;if(n>=gt._A&&n<=gt._F)return n-(gt._A-10);if(n>=gt._a&&n<=gt._f)return n-(gt._a-10)}function be(n){if(typeof n!="string")throw new Error("hex string expected, got "+typeof n);const t=n.length,e=t/2;if(t%2)throw new Error("padded hex string expected, got unpadded hex of length "+t);const i=new Uint8Array(e);for(let s=0,r=0;s<e;s++,r+=2){const o=ks(n.charCodeAt(r)),a=ks(n.charCodeAt(r+1));if(o===void 0||a===void 0){const l=n[r]+n[r+1];throw new Error('hex string expected, got non-hex character "'+l+'" at index '+r)}i[s]=o*16+a}return i}function yt(n){return Ki(ye(n))}function Vi(n){return je(n),Ki(ye(Uint8Array.from(n).reverse()))}function Lt(n,t){return be(n.toString(16).padStart(t*2,"0"))}function Zi(n,t){return Lt(n,t).reverse()}function Zl(n){return be(go(n))}function et(n,t,e){let i;if(typeof t=="string")try{i=be(t)}catch(r){throw new Error(`${n} must be valid hex string, got "${t}". Cause: ${r}`)}else if(Zt(t))i=Uint8Array.from(t);else throw new Error(`${n} must be hex string or Uint8Array`);const s=i.length;if(typeof e=="number"&&s!==e)throw new Error(`${n} expected ${e} bytes, got ${s}`);return i}function Jt(...n){let t=0;for(let i=0;i<n.length;i++){const s=n[i];je(s),t+=s.length}const e=new Uint8Array(t);for(let i=0,s=0;i<n.length;i++){const r=n[i];e.set(r,s),s+=r.length}return e}function Jl(n,t){if(n.length!==t.length)return!1;let e=0;for(let i=0;i<n.length;i++)e|=n[i]^t[i];return e===0}function Xl(n){if(typeof n!="string")throw new Error(`utf8ToBytes expected string, got ${typeof n}`);return new Uint8Array(new TextEncoder().encode(n))}const ei=n=>typeof n=="bigint"&&Gi<=n;function Ee(n,t,e){return ei(n)&&ei(t)&&ei(e)&&t<=n&&n<e}function Nt(n,t,e,i){if(!Ee(t,e,i))throw new Error(`expected valid ${n}: ${e} <= n < ${i}, got ${typeof t} ${t}`)}function Ql(n){let t;for(t=0;n>Gi;n>>=Hn,t+=1);return t}function tc(n,t){return n>>BigInt(t)&Hn}function ec(n,t,e){return n|(e?Hn:Gi)<<BigInt(t)}const Ji=n=>(Kl<<BigInt(n-1))-Hn,ni=n=>new Uint8Array(n),Ls=n=>Uint8Array.from(n);function po(n,t,e){if(typeof n!="number"||n<2)throw new Error("hashLen must be a number");if(typeof t!="number"||t<2)throw new Error("qByteLen must be a number");if(typeof e!="function")throw new Error("hmacFn must be a function");let i=ni(n),s=ni(n),r=0;const o=()=>{i.fill(1),s.fill(0),r=0},a=(...u)=>e(s,i,...u),l=(u=ni())=>{s=a(Ls([0]),u),i=a(),u.length!==0&&(s=a(Ls([1]),u),i=a())},c=()=>{if(r++>=1e3)throw new Error("drbg: tried 1000 values");let u=0;const d=[];for(;u<t;){i=a();const g=i.slice();d.push(g),u+=i.length}return Jt(...d)};return(u,d)=>{o(),l(u);let g;for(;!(g=d(c()));)l();return o(),g}}const nc={bigint:n=>typeof n=="bigint",function:n=>typeof n=="function",boolean:n=>typeof n=="boolean",string:n=>typeof n=="string",stringOrUint8Array:n=>typeof n=="string"||Zt(n),isSafeInteger:n=>Number.isSafeInteger(n),array:n=>Array.isArray(n),field:(n,t)=>t.Fp.isValid(n),hash:n=>typeof n=="function"&&Number.isSafeInteger(n.outputLen)};function Ge(n,t,e={}){const i=(s,r,o)=>{const a=nc[r];if(typeof a!="function")throw new Error(`Invalid validator "${r}", expected function`);const l=n[s];if(!(o&&l===void 0)&&!a(l,n))throw new Error(`Invalid param ${String(s)}=${l} (${typeof l}), expected ${r}`)};for(const[s,r]of Object.entries(t))i(s,r,!1);for(const[s,r]of Object.entries(e))i(s,r,!0);return n}const ic=()=>{throw new Error("not implemented")};function bi(n){const t=new WeakMap;return(e,...i)=>{const s=t.get(e);if(s!==void 0)return s;const r=n(e,...i);return t.set(e,r),r}}const sc=Object.freeze(Object.defineProperty({__proto__:null,aInRange:Nt,abool:we,abytes:je,bitGet:tc,bitLen:Ql,bitMask:Ji,bitSet:ec,bytesToHex:ye,bytesToNumberBE:yt,bytesToNumberLE:Vi,concatBytes:Jt,createHmacDrbg:po,ensureBytes:et,equalBytes:Jl,hexToBytes:be,hexToNumber:Ki,inRange:Ee,isBytes:Zt,memoized:bi,notImplemented:ic,numberToBytesBE:Lt,numberToBytesLE:Zi,numberToHexUnpadded:go,numberToVarBytesBE:Zl,utf8ToBytes:Xl,validateObject:Ge},Symbol.toStringTag,{value:"Module"}));/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const X=BigInt(0),K=BigInt(1),Wt=BigInt(2),rc=BigInt(3),Ei=BigInt(4),Ds=BigInt(5),Os=BigInt(8);BigInt(9);BigInt(16);function Q(n,t){const e=n%t;return e>=X?e:t+e}function oc(n,t,e){if(e<=X||t<X)throw new Error("Expected power/modulo > 0");if(e===K)return X;let i=K;for(;t>X;)t&K&&(i=i*n%e),n=n*n%e,t>>=K;return i}function rt(n,t,e){let i=n;for(;t-- >X;)i*=i,i%=e;return i}function xi(n,t){if(n===X||t<=X)throw new Error(`invert: expected positive integers, got n=${n} mod=${t}`);let e=Q(n,t),i=t,s=X,r=K;for(;e!==X;){const a=i/e,l=i%e,c=s-r*a;i=e,e=l,s=r,r=c}if(i!==K)throw new Error("invert: does not exist");return Q(s,t)}function ac(n){const t=(n-K)/Wt;let e,i,s;for(e=n-K,i=0;e%Wt===X;e/=Wt,i++);for(s=Wt;s<n&&oc(s,t,n)!==n-K;s++);if(i===1){const o=(n+K)/Ei;return function(l,c){const h=l.pow(c,o);if(!l.eql(l.sqr(h),c))throw new Error("Cannot find square root");return h}}const r=(e+K)/Wt;return function(a,l){if(a.pow(l,t)===a.neg(a.ONE))throw new Error("Cannot find square root");let c=i,h=a.pow(a.mul(a.ONE,s),e),u=a.pow(l,r),d=a.pow(l,e);for(;!a.eql(d,a.ONE);){if(a.eql(d,a.ZERO))return a.ZERO;let g=1;for(let f=a.sqr(d);g<c&&!a.eql(f,a.ONE);g++)f=a.sqr(f);const m=a.pow(h,K<<BigInt(c-g-1));h=a.sqr(m),u=a.mul(u,m),d=a.mul(d,h),c=g}return u}}function lc(n){if(n%Ei===rc){const t=(n+K)/Ei;return function(i,s){const r=i.pow(s,t);if(!i.eql(i.sqr(r),s))throw new Error("Cannot find square root");return r}}if(n%Os===Ds){const t=(n-Ds)/Os;return function(i,s){const r=i.mul(s,Wt),o=i.pow(r,t),a=i.mul(s,o),l=i.mul(i.mul(a,Wt),o),c=i.mul(a,i.sub(l,i.ONE));if(!i.eql(i.sqr(c),s))throw new Error("Cannot find square root");return c}}return ac(n)}const cc=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function hc(n){const t={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},e=cc.reduce((i,s)=>(i[s]="function",i),t);return Ge(n,e)}function uc(n,t,e){if(e<X)throw new Error("Expected power > 0");if(e===X)return n.ONE;if(e===K)return t;let i=n.ONE,s=t;for(;e>X;)e&K&&(i=n.mul(i,s)),s=n.sqr(s),e>>=K;return i}function dc(n,t){const e=new Array(t.length),i=t.reduce((r,o,a)=>n.is0(o)?r:(e[a]=r,n.mul(r,o)),n.ONE),s=n.inv(i);return t.reduceRight((r,o,a)=>n.is0(o)?r:(e[a]=n.mul(r,e[a]),n.mul(r,o)),s),e}function _o(n,t){const e=t!==void 0?t:n.toString(2).length,i=Math.ceil(e/8);return{nBitLength:e,nByteLength:i}}function fc(n,t,e=!1,i={}){if(n<=X)throw new Error(`Expected Field ORDER > 0, got ${n}`);const{nBitLength:s,nByteLength:r}=_o(n,t);if(r>2048)throw new Error("Field lengths over 2048 bytes are not supported");const o=lc(n),a=Object.freeze({ORDER:n,BITS:s,BYTES:r,MASK:Ji(s),ZERO:X,ONE:K,create:l=>Q(l,n),isValid:l=>{if(typeof l!="bigint")throw new Error(`Invalid field element: expected bigint, got ${typeof l}`);return X<=l&&l<n},is0:l=>l===X,isOdd:l=>(l&K)===K,neg:l=>Q(-l,n),eql:(l,c)=>l===c,sqr:l=>Q(l*l,n),add:(l,c)=>Q(l+c,n),sub:(l,c)=>Q(l-c,n),mul:(l,c)=>Q(l*c,n),pow:(l,c)=>uc(a,l,c),div:(l,c)=>Q(l*xi(c,n),n),sqrN:l=>l*l,addN:(l,c)=>l+c,subN:(l,c)=>l-c,mulN:(l,c)=>l*c,inv:l=>xi(l,n),sqrt:i.sqrt||(l=>o(a,l)),invertBatch:l=>dc(a,l),cmov:(l,c,h)=>h?c:l,toBytes:l=>e?Zi(l,r):Lt(l,r),fromBytes:l=>{if(l.length!==r)throw new Error(`Fp.fromBytes: expected ${r}, got ${l.length}`);return e?Vi(l):yt(l)}});return Object.freeze(a)}function mo(n){if(typeof n!="bigint")throw new Error("field order must be bigint");const t=n.toString(2).length;return Math.ceil(t/8)}function wo(n){const t=mo(n);return t+Math.ceil(t/2)}function gc(n,t,e=!1){const i=n.length,s=mo(t),r=wo(t);if(i<16||i<r||i>1024)throw new Error(`expected ${r}-1024 bytes of input, got ${i}`);const o=e?yt(n):Vi(n),a=Q(o,t-K)+K;return e?Zi(a,s):Lt(a,s)}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const pc=BigInt(0),ii=BigInt(1),si=new WeakMap,Ms=new WeakMap;function _c(n,t){const e=(r,o)=>{const a=o.negate();return r?a:o},i=r=>{if(!Number.isSafeInteger(r)||r<=0||r>t)throw new Error(`Wrong window size=${r}, should be [1..${t}]`)},s=r=>{i(r);const o=Math.ceil(t/r)+1,a=2**(r-1);return{windows:o,windowSize:a}};return{constTimeNegate:e,unsafeLadder(r,o){let a=n.ZERO,l=r;for(;o>pc;)o&ii&&(a=a.add(l)),l=l.double(),o>>=ii;return a},precomputeWindow(r,o){const{windows:a,windowSize:l}=s(o),c=[];let h=r,u=h;for(let d=0;d<a;d++){u=h,c.push(u);for(let g=1;g<l;g++)u=u.add(h),c.push(u);h=u.double()}return c},wNAF(r,o,a){const{windows:l,windowSize:c}=s(r);let h=n.ZERO,u=n.BASE;const d=BigInt(2**r-1),g=2**r,m=BigInt(r);for(let f=0;f<l;f++){const _=f*c;let p=Number(a&d);a>>=m,p>c&&(p-=g,a+=ii);const b=_,S=_+Math.abs(p)-1,E=f%2!==0,v=p<0;p===0?u=u.add(e(E,o[b])):h=h.add(e(v,o[S]))}return{p:h,f:u}},wNAFCached(r,o,a){const l=Ms.get(r)||1;let c=si.get(r);return c||(c=this.precomputeWindow(r,l),l!==1&&si.set(r,a(c))),this.wNAF(l,c,o)},setWindowSize(r,o){i(o),Ms.set(r,o),si.delete(r)}}}function yo(n){return hc(n.Fp),Ge(n,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({..._o(n.n,n.nBitLength),...n,p:n.Fp.ORDER})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function Us(n){n.lowS!==void 0&&we("lowS",n.lowS),n.prehash!==void 0&&we("prehash",n.prehash)}function mc(n){const t=yo(n);Ge(t,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});const{endo:e,Fp:i,a:s}=t;if(e){if(!i.eql(s,i.ZERO))throw new Error("Endomorphism can only be defined for Koblitz curves that have a=0");if(typeof e!="object"||typeof e.beta!="bigint"||typeof e.splitScalar!="function")throw new Error("Expected endomorphism with beta: bigint and splitScalar: function")}return Object.freeze({...t})}const{bytesToNumberBE:wc,hexToBytes:yc}=sc,Gt={Err:class extends Error{constructor(t=""){super(t)}},_parseInt(n){const{Err:t}=Gt;if(n.length<2||n[0]!==2)throw new t("Invalid signature integer tag");const e=n[1],i=n.subarray(2,e+2);if(!e||i.length!==e)throw new t("Invalid signature integer: wrong length");if(i[0]&128)throw new t("Invalid signature integer: negative");if(i[0]===0&&!(i[1]&128))throw new t("Invalid signature integer: unnecessary leading zero");return{d:wc(i),l:n.subarray(e+2)}},toSig(n){const{Err:t}=Gt,e=typeof n=="string"?yc(n):n;je(e);let i=e.length;if(i<2||e[0]!=48)throw new t("Invalid signature tag");if(e[1]!==i-2)throw new t("Invalid signature: incorrect length");const{d:s,l:r}=Gt._parseInt(e.subarray(2)),{d:o,l:a}=Gt._parseInt(r);if(a.length)throw new t("Invalid signature: left bytes after parsing");return{r:s,s:o}},hexFromSig(n){const t=c=>Number.parseInt(c[0],16)&8?"00"+c:c,e=c=>{const h=c.toString(16);return h.length&1?`0${h}`:h},i=t(e(n.s)),s=t(e(n.r)),r=i.length/2,o=s.length/2,a=e(r),l=e(o);return`30${e(o+r+4)}02${l}${s}02${a}${i}`}},Tt=BigInt(0),J=BigInt(1);BigInt(2);const Fs=BigInt(3);BigInt(4);function bc(n){const t=mc(n),{Fp:e}=t,i=t.toBytes||((m,f,_)=>{const p=f.toAffine();return Jt(Uint8Array.from([4]),e.toBytes(p.x),e.toBytes(p.y))}),s=t.fromBytes||(m=>{const f=m.subarray(1),_=e.fromBytes(f.subarray(0,e.BYTES)),p=e.fromBytes(f.subarray(e.BYTES,2*e.BYTES));return{x:_,y:p}});function r(m){const{a:f,b:_}=t,p=e.sqr(m),b=e.mul(p,m);return e.add(e.add(b,e.mul(m,f)),_)}if(!e.eql(e.sqr(t.Gy),r(t.Gx)))throw new Error("bad generator point: equation left != right");function o(m){return Ee(m,J,t.n)}function a(m){const{allowedPrivateKeyLengths:f,nByteLength:_,wrapPrivateKey:p,n:b}=t;if(f&&typeof m!="bigint"){if(Zt(m)&&(m=ye(m)),typeof m!="string"||!f.includes(m.length))throw new Error("Invalid key");m=m.padStart(_*2,"0")}let S;try{S=typeof m=="bigint"?m:yt(et("private key",m,_))}catch{throw new Error(`private key must be ${_} bytes, hex or bigint, not ${typeof m}`)}return p&&(S=Q(S,b)),Nt("private key",S,J,b),S}function l(m){if(!(m instanceof u))throw new Error("ProjectivePoint expected")}const c=bi((m,f)=>{const{px:_,py:p,pz:b}=m;if(e.eql(b,e.ONE))return{x:_,y:p};const S=m.is0();f==null&&(f=S?e.ONE:e.inv(b));const E=e.mul(_,f),v=e.mul(p,f),A=e.mul(b,f);if(S)return{x:e.ZERO,y:e.ZERO};if(!e.eql(A,e.ONE))throw new Error("invZ was invalid");return{x:E,y:v}}),h=bi(m=>{if(m.is0()){if(t.allowInfinityPoint&&!e.is0(m.py))return;throw new Error("bad point: ZERO")}const{x:f,y:_}=m.toAffine();if(!e.isValid(f)||!e.isValid(_))throw new Error("bad point: x or y not FE");const p=e.sqr(_),b=r(f);if(!e.eql(p,b))throw new Error("bad point: equation left != right");if(!m.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});class u{constructor(f,_,p){if(this.px=f,this.py=_,this.pz=p,f==null||!e.isValid(f))throw new Error("x required");if(_==null||!e.isValid(_))throw new Error("y required");if(p==null||!e.isValid(p))throw new Error("z required");Object.freeze(this)}static fromAffine(f){const{x:_,y:p}=f||{};if(!f||!e.isValid(_)||!e.isValid(p))throw new Error("invalid affine point");if(f instanceof u)throw new Error("projective point not allowed");const b=S=>e.eql(S,e.ZERO);return b(_)&&b(p)?u.ZERO:new u(_,p,e.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(f){const _=e.invertBatch(f.map(p=>p.pz));return f.map((p,b)=>p.toAffine(_[b])).map(u.fromAffine)}static fromHex(f){const _=u.fromAffine(s(et("pointHex",f)));return _.assertValidity(),_}static fromPrivateKey(f){return u.BASE.multiply(a(f))}_setWindowSize(f){g.setWindowSize(this,f)}assertValidity(){h(this)}hasEvenY(){const{y:f}=this.toAffine();if(e.isOdd)return!e.isOdd(f);throw new Error("Field doesn't support isOdd")}equals(f){l(f);const{px:_,py:p,pz:b}=this,{px:S,py:E,pz:v}=f,A=e.eql(e.mul(_,v),e.mul(S,b)),R=e.eql(e.mul(p,v),e.mul(E,b));return A&&R}negate(){return new u(this.px,e.neg(this.py),this.pz)}double(){const{a:f,b:_}=t,p=e.mul(_,Fs),{px:b,py:S,pz:E}=this;let v=e.ZERO,A=e.ZERO,R=e.ZERO,B=e.mul(b,b),U=e.mul(S,S),P=e.mul(E,E),k=e.mul(b,S);return k=e.add(k,k),R=e.mul(b,E),R=e.add(R,R),v=e.mul(f,R),A=e.mul(p,P),A=e.add(v,A),v=e.sub(U,A),A=e.add(U,A),A=e.mul(v,A),v=e.mul(k,v),R=e.mul(p,R),P=e.mul(f,P),k=e.sub(B,P),k=e.mul(f,k),k=e.add(k,R),R=e.add(B,B),B=e.add(R,B),B=e.add(B,P),B=e.mul(B,k),A=e.add(A,B),P=e.mul(S,E),P=e.add(P,P),B=e.mul(P,k),v=e.sub(v,B),R=e.mul(P,U),R=e.add(R,R),R=e.add(R,R),new u(v,A,R)}add(f){l(f);const{px:_,py:p,pz:b}=this,{px:S,py:E,pz:v}=f;let A=e.ZERO,R=e.ZERO,B=e.ZERO;const U=t.a,P=e.mul(t.b,Fs);let k=e.mul(_,S),w=e.mul(p,E),T=e.mul(b,v),x=e.add(_,p),y=e.add(S,E);x=e.mul(x,y),y=e.add(k,w),x=e.sub(x,y),y=e.add(_,b);let C=e.add(S,v);return y=e.mul(y,C),C=e.add(k,T),y=e.sub(y,C),C=e.add(p,b),A=e.add(E,v),C=e.mul(C,A),A=e.add(w,T),C=e.sub(C,A),B=e.mul(U,y),A=e.mul(P,T),B=e.add(A,B),A=e.sub(w,B),B=e.add(w,B),R=e.mul(A,B),w=e.add(k,k),w=e.add(w,k),T=e.mul(U,T),y=e.mul(P,y),w=e.add(w,T),T=e.sub(k,T),T=e.mul(U,T),y=e.add(y,T),k=e.mul(w,y),R=e.add(R,k),k=e.mul(C,y),A=e.mul(x,A),A=e.sub(A,k),k=e.mul(x,w),B=e.mul(C,B),B=e.add(B,k),new u(A,R,B)}subtract(f){return this.add(f.negate())}is0(){return this.equals(u.ZERO)}wNAF(f){return g.wNAFCached(this,f,u.normalizeZ)}multiplyUnsafe(f){Nt("scalar",f,Tt,t.n);const _=u.ZERO;if(f===Tt)return _;if(f===J)return this;const{endo:p}=t;if(!p)return g.unsafeLadder(this,f);let{k1neg:b,k1:S,k2neg:E,k2:v}=p.splitScalar(f),A=_,R=_,B=this;for(;S>Tt||v>Tt;)S&J&&(A=A.add(B)),v&J&&(R=R.add(B)),B=B.double(),S>>=J,v>>=J;return b&&(A=A.negate()),E&&(R=R.negate()),R=new u(e.mul(R.px,p.beta),R.py,R.pz),A.add(R)}multiply(f){const{endo:_,n:p}=t;Nt("scalar",f,J,p);let b,S;if(_){const{k1neg:E,k1:v,k2neg:A,k2:R}=_.splitScalar(f);let{p:B,f:U}=this.wNAF(v),{p:P,f:k}=this.wNAF(R);B=g.constTimeNegate(E,B),P=g.constTimeNegate(A,P),P=new u(e.mul(P.px,_.beta),P.py,P.pz),b=B.add(P),S=U.add(k)}else{const{p:E,f:v}=this.wNAF(f);b=E,S=v}return u.normalizeZ([b,S])[0]}multiplyAndAddUnsafe(f,_,p){const b=u.BASE,S=(v,A)=>A===Tt||A===J||!v.equals(b)?v.multiplyUnsafe(A):v.multiply(A),E=S(this,_).add(S(f,p));return E.is0()?void 0:E}toAffine(f){return c(this,f)}isTorsionFree(){const{h:f,isTorsionFree:_}=t;if(f===J)return!0;if(_)return _(u,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:f,clearCofactor:_}=t;return f===J?this:_?_(u,this):this.multiplyUnsafe(t.h)}toRawBytes(f=!0){return we("isCompressed",f),this.assertValidity(),i(u,this,f)}toHex(f=!0){return we("isCompressed",f),ye(this.toRawBytes(f))}}u.BASE=new u(t.Gx,t.Gy,e.ONE),u.ZERO=new u(e.ZERO,e.ONE,e.ZERO);const d=t.nBitLength,g=_c(u,t.endo?Math.ceil(d/2):d);return{CURVE:t,ProjectivePoint:u,normPrivateKeyToScalar:a,weierstrassEquation:r,isWithinCurveOrder:o}}function Ec(n){const t=yo(n);return Ge(t,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...t})}function xc(n){const t=Ec(n),{Fp:e,n:i}=t,s=e.BYTES+1,r=2*e.BYTES+1;function o(x){return Q(x,i)}function a(x){return xi(x,i)}const{ProjectivePoint:l,normPrivateKeyToScalar:c,weierstrassEquation:h,isWithinCurveOrder:u}=bc({...t,toBytes(x,y,C){const I=y.toAffine(),N=e.toBytes(I.x),L=Jt;return we("isCompressed",C),C?L(Uint8Array.from([y.hasEvenY()?2:3]),N):L(Uint8Array.from([4]),N,e.toBytes(I.y))},fromBytes(x){const y=x.length,C=x[0],I=x.subarray(1);if(y===s&&(C===2||C===3)){const N=yt(I);if(!Ee(N,J,e.ORDER))throw new Error("Point is not on curve");const L=h(N);let M;try{M=e.sqrt(L)}catch(D){const Y=D instanceof Error?": "+D.message:"";throw new Error("Point is not on curve"+Y)}const F=(M&J)===J;return(C&1)===1!==F&&(M=e.neg(M)),{x:N,y:M}}else if(y===r&&C===4){const N=e.fromBytes(I.subarray(0,e.BYTES)),L=e.fromBytes(I.subarray(e.BYTES,2*e.BYTES));return{x:N,y:L}}else throw new Error(`Point of length ${y} was invalid. Expected ${s} compressed bytes or ${r} uncompressed bytes`)}}),d=x=>ye(Lt(x,t.nByteLength));function g(x){const y=i>>J;return x>y}function m(x){return g(x)?o(-x):x}const f=(x,y,C)=>yt(x.slice(y,C));class _{constructor(y,C,I){this.r=y,this.s=C,this.recovery=I,this.assertValidity()}static fromCompact(y){const C=t.nByteLength;return y=et("compactSignature",y,C*2),new _(f(y,0,C),f(y,C,2*C))}static fromDER(y){const{r:C,s:I}=Gt.toSig(et("DER",y));return new _(C,I)}assertValidity(){Nt("r",this.r,J,i),Nt("s",this.s,J,i)}addRecoveryBit(y){return new _(this.r,this.s,y)}recoverPublicKey(y){const{r:C,s:I,recovery:N}=this,L=A(et("msgHash",y));if(N==null||![0,1,2,3].includes(N))throw new Error("recovery id invalid");const M=N===2||N===3?C+t.n:C;if(M>=e.ORDER)throw new Error("recovery id 2 or 3 invalid");const F=N&1?"03":"02",V=l.fromHex(F+d(M)),D=a(M),Y=o(-L*D),tt=o(I*D),W=l.BASE.multiplyAndAddUnsafe(V,Y,tt);if(!W)throw new Error("point at infinify");return W.assertValidity(),W}hasHighS(){return g(this.s)}normalizeS(){return this.hasHighS()?new _(this.r,o(-this.s),this.recovery):this}toDERRawBytes(){return be(this.toDERHex())}toDERHex(){return Gt.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return be(this.toCompactHex())}toCompactHex(){return d(this.r)+d(this.s)}}const p={isValidPrivateKey(x){try{return c(x),!0}catch{return!1}},normPrivateKeyToScalar:c,randomPrivateKey:()=>{const x=wo(t.n);return gc(t.randomBytes(x),t.n)},precompute(x=8,y=l.BASE){return y._setWindowSize(x),y.multiply(BigInt(3)),y}};function b(x,y=!0){return l.fromPrivateKey(x).toRawBytes(y)}function S(x){const y=Zt(x),C=typeof x=="string",I=(y||C)&&x.length;return y?I===s||I===r:C?I===2*s||I===2*r:x instanceof l}function E(x,y,C=!0){if(S(x))throw new Error("first arg must be private key");if(!S(y))throw new Error("second arg must be public key");return l.fromHex(y).multiply(c(x)).toRawBytes(C)}const v=t.bits2int||function(x){const y=yt(x),C=x.length*8-t.nBitLength;return C>0?y>>BigInt(C):y},A=t.bits2int_modN||function(x){return o(v(x))},R=Ji(t.nBitLength);function B(x){return Nt(`num < 2^${t.nBitLength}`,x,Tt,R),Lt(x,t.nByteLength)}function U(x,y,C=P){if(["recovered","canonical"].some(G=>G in C))throw new Error("sign() legacy options not supported");const{hash:I,randomBytes:N}=t;let{lowS:L,prehash:M,extraEntropy:F}=C;L==null&&(L=!0),x=et("msgHash",x),Us(C),M&&(x=et("prehashed msgHash",I(x)));const V=A(x),D=c(y),Y=[B(D),B(V)];if(F!=null&&F!==!1){const G=F===!0?N(e.BYTES):F;Y.push(et("extraEntropy",G))}const tt=Jt(...Y),W=V;function at(G){const z=v(G);if(!u(z))return;const Z=a(z),H=l.BASE.multiply(z).toAffine(),q=o(H.x);if(q===Tt)return;const ht=o(Z*o(W+q*D));if(ht===Tt)return;let Ut=(H.x===q?0:2)|Number(H.y&J),Jn=ht;return L&&g(ht)&&(Jn=m(ht),Ut^=1),new _(q,Jn,Ut)}return{seed:tt,k2sig:at}}const P={lowS:t.lowS,prehash:!1},k={lowS:t.lowS,prehash:!1};function w(x,y,C=P){const{seed:I,k2sig:N}=U(x,y,C),L=t;return po(L.hash.outputLen,L.nByteLength,L.hmac)(I,N)}l.BASE._setWindowSize(8);function T(x,y,C,I=k){var H;const N=x;if(y=et("msgHash",y),C=et("publicKey",C),"strict"in I)throw new Error("options.strict was renamed to lowS");Us(I);const{lowS:L,prehash:M}=I;let F,V;try{if(typeof N=="string"||Zt(N))try{F=_.fromDER(N)}catch(q){if(!(q instanceof Gt.Err))throw q;F=_.fromCompact(N)}else if(typeof N=="object"&&typeof N.r=="bigint"&&typeof N.s=="bigint"){const{r:q,s:ht}=N;F=new _(q,ht)}else throw new Error("PARSE");V=l.fromHex(C)}catch(q){if(q.message==="PARSE")throw new Error("signature must be Signature instance, Uint8Array or hex string");return!1}if(L&&F.hasHighS())return!1;M&&(y=t.hash(y));const{r:D,s:Y}=F,tt=A(y),W=a(Y),at=o(tt*W),G=o(D*W),z=(H=l.BASE.multiplyAndAddUnsafe(V,at,G))==null?void 0:H.toAffine();return z?o(z.x)===D:!1}return{CURVE:t,getPublicKey:b,getSharedSecret:E,sign:w,verify:T,ProjectivePoint:l,Signature:_,utils:p}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function Sc(n){return{hash:n,hmac:(t,...e)=>fo(n,t,$l(...e)),randomBytes:ho}}function Cc(n,t){const e=i=>xc({...n,...Sc(i)});return Object.freeze({...e(t),create:e})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Ke=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),vn=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),Oe=BigInt(1),In=BigInt(2),$s=(n,t)=>(n+t/In)/t;function bo(n){const t=Ke,e=BigInt(3),i=BigInt(6),s=BigInt(11),r=BigInt(22),o=BigInt(23),a=BigInt(44),l=BigInt(88),c=n*n*n%t,h=c*c*n%t,u=rt(h,e,t)*h%t,d=rt(u,e,t)*h%t,g=rt(d,In,t)*c%t,m=rt(g,s,t)*g%t,f=rt(m,r,t)*m%t,_=rt(f,a,t)*f%t,p=rt(_,l,t)*_%t,b=rt(p,a,t)*f%t,S=rt(b,e,t)*h%t,E=rt(S,o,t)*m%t,v=rt(E,i,t)*c%t,A=rt(v,In,t);if(!Si.eql(Si.sqr(A),n))throw new Error("Cannot find square root");return A}const Si=fc(Ke,void 0,void 0,{sqrt:bo}),Xi=Cc({a:BigInt(0),b:BigInt(7),Fp:Si,n:vn,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:n=>{const t=vn,e=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),i=-Oe*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),s=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),r=e,o=BigInt("0x100000000000000000000000000000000"),a=$s(r*n,t),l=$s(-i*n,t);let c=Q(n-a*e-l*s,t),h=Q(-a*i-l*r,t);const u=c>o,d=h>o;if(u&&(c=t-c),d&&(h=t-h),c>o||h>o)throw new Error("splitScalar: Endomorphism failed, k="+n);return{k1neg:u,k1:c,k2neg:d,k2:h}}}},yi),Eo=BigInt(0),Hs={};function Rn(n,...t){let e=Hs[n];if(e===void 0){const i=yi(Uint8Array.from(n,s=>s.charCodeAt(0)));e=Jt(i,i),Hs[n]=e}return yi(Jt(e,...t))}const Qi=n=>n.toRawBytes(!0).slice(1),Ci=n=>Lt(n,32),ri=n=>Q(n,Ke),Me=n=>Q(n,vn),ts=Xi.ProjectivePoint,Ac=(n,t,e)=>ts.BASE.multiplyAndAddUnsafe(n,t,e);function Ai(n){let t=Xi.utils.normPrivateKeyToScalar(n),e=ts.fromPrivateKey(t);return{scalar:e.hasEvenY()?t:Me(-t),bytes:Qi(e)}}function xo(n){Nt("x",n,Oe,Ke);const t=ri(n*n),e=ri(t*n+BigInt(7));let i=bo(e);i%In!==Eo&&(i=ri(-i));const s=new ts(n,i,Oe);return s.assertValidity(),s}const ue=yt;function So(...n){return Me(ue(Rn("BIP0340/challenge",...n)))}function Tc(n){return Ai(n).bytes}function vc(n,t,e=ho(32)){const i=et("message",n),{bytes:s,scalar:r}=Ai(t),o=et("auxRand",e,32),a=Ci(r^ue(Rn("BIP0340/aux",o))),l=Rn("BIP0340/nonce",a,s,i),c=Me(ue(l));if(c===Eo)throw new Error("sign failed: k is zero");const{bytes:h,scalar:u}=Ai(c),d=So(h,s,i),g=new Uint8Array(64);if(g.set(h,0),g.set(Ci(Me(u+d*r)),32),!Co(g,i,s))throw new Error("sign: Invalid signature produced");return g}function Co(n,t,e){const i=et("signature",n,64),s=et("message",t),r=et("publicKey",e,32);try{const o=xo(ue(r)),a=ue(i.subarray(0,32));if(!Ee(a,Oe,Ke))return!1;const l=ue(i.subarray(32,64));if(!Ee(l,Oe,vn))return!1;const c=So(Ci(a),Qi(o),s),h=Ac(o,l,Me(-c));return!(!h||!h.hasEvenY()||h.toAffine().x!==a)}catch{return!1}}const es={getPublicKey:Tc,sign:vc,verify:Co,utils:{randomPrivateKey:Xi.utils.randomPrivateKey,lift_x:xo,pointToBytes:Qi,numberToBytesBE:Lt,bytesToNumberBE:yt,taggedHash:Rn,mod:Q}},Ue="Trystero",Fe=(n,t)=>Array(n).fill().map(t),qs="0123456789AaBbCcDdEeFfGgHhIiJjKkLlMmNnOoPpQqRrSsTtUuVvWwXxYyZz",Ti=n=>Fe(n,()=>qs[Math.floor(Math.random()*qs.length)]).join(""),ae=Ti(20),le=Promise.all.bind(Promise),ns=typeof window<"u",{entries:zs,fromEntries:Ic,keys:Rc}=Object,qt=()=>{},mt=n=>new Error(`${Ue}: ${n}`),Nc=new TextEncoder,Bc=new TextDecoder,Kt=n=>Nc.encode(n),gn=n=>Bc.decode(n),vi=n=>n.reduce((t,e)=>t+e.toString(16).padStart(2,"0"),""),nn=(...n)=>n.join("@"),Pc=(n,t,e)=>(n.relayUrls||t).slice(0,n.relayUrls?n.relayUrls.length:n.relayRedundancy||e),Et=JSON.stringify,Nn=JSON.parse,Ys=3333,se={},kc=(n,t)=>{const e={},i=()=>{const s=new WebSocket(n);s.onclose=()=>{se[n]??(se[n]=Ys),setTimeout(i,se[n]),se[n]*=2},s.onmessage=r=>t(r.data),e.socket=s,e.url=s.url,e.ready=new Promise(r=>s.onopen=()=>{r(e),se[n]=Ys}),e.send=r=>{s.readyState===1&&s.send(r)}};return i(),e},is="AES-GCM",oi={},Lc=n=>btoa(String.fromCharCode.apply(null,new Uint8Array(n))),Dc=n=>{const t=atob(n);return new Uint8Array(t.length).map((e,i)=>t.charCodeAt(i)).buffer},sn=async n=>{if(oi[n])return oi[n];const t=Array.from(new Uint8Array(await crypto.subtle.digest("SHA-1",Kt(n)))).map(e=>e.toString(36)).join("");return oi[n]=t,t},Oc=async(n,t,e)=>crypto.subtle.importKey("raw",await crypto.subtle.digest({name:"SHA-256"},Kt(`${n}:${t}:${e}`)),{name:is},!1,["encrypt","decrypt"]),Ao="$",To=",",Mc=async(n,t)=>{const e=crypto.getRandomValues(new Uint8Array(16));return e.join(To)+Ao+Lc(await crypto.subtle.encrypt({name:is,iv:e},await n,Kt(t)))},Uc=async(n,t)=>{const[e,i]=t.split(Ao);return gn(await crypto.subtle.decrypt({name:is,iv:new Uint8Array(e.split(To))},await n,Dc(i)))};function vo(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var Ii={exports:{}},ai,Ws;function Fc(){if(Ws)return ai;Ws=1;var n=1e3,t=n*60,e=t*60,i=e*24,s=i*7,r=i*365.25;ai=function(h,u){u=u||{};var d=typeof h;if(d==="string"&&h.length>0)return o(h);if(d==="number"&&isFinite(h))return u.long?l(h):a(h);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(h))};function o(h){if(h=String(h),!(h.length>100)){var u=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(h);if(u){var d=parseFloat(u[1]),g=(u[2]||"ms").toLowerCase();switch(g){case"years":case"year":case"yrs":case"yr":case"y":return d*r;case"weeks":case"week":case"w":return d*s;case"days":case"day":case"d":return d*i;case"hours":case"hour":case"hrs":case"hr":case"h":return d*e;case"minutes":case"minute":case"mins":case"min":case"m":return d*t;case"seconds":case"second":case"secs":case"sec":case"s":return d*n;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return d;default:return}}}}function a(h){var u=Math.abs(h);return u>=i?Math.round(h/i)+"d":u>=e?Math.round(h/e)+"h":u>=t?Math.round(h/t)+"m":u>=n?Math.round(h/n)+"s":h+"ms"}function l(h){var u=Math.abs(h);return u>=i?c(h,u,i,"day"):u>=e?c(h,u,e,"hour"):u>=t?c(h,u,t,"minute"):u>=n?c(h,u,n,"second"):h+" ms"}function c(h,u,d,g){var m=u>=d*1.5;return Math.round(h/d)+" "+g+(m?"s":"")}return ai}function $c(n){e.debug=e,e.default=e,e.coerce=l,e.disable=r,e.enable=s,e.enabled=o,e.humanize=Fc(),e.destroy=c,Object.keys(n).forEach(h=>{e[h]=n[h]}),e.names=[],e.skips=[],e.formatters={};function t(h){let u=0;for(let d=0;d<h.length;d++)u=(u<<5)-u+h.charCodeAt(d),u|=0;return e.colors[Math.abs(u)%e.colors.length]}e.selectColor=t;function e(h){let u,d=null,g,m;function f(..._){if(!f.enabled)return;const p=f,b=Number(new Date),S=b-(u||b);p.diff=S,p.prev=u,p.curr=b,u=b,_[0]=e.coerce(_[0]),typeof _[0]!="string"&&_.unshift("%O");let E=0;_[0]=_[0].replace(/%([a-zA-Z%])/g,(A,R)=>{if(A==="%%")return"%";E++;const B=e.formatters[R];if(typeof B=="function"){const U=_[E];A=B.call(p,U),_.splice(E,1),E--}return A}),e.formatArgs.call(p,_),(p.log||e.log).apply(p,_)}return f.namespace=h,f.useColors=e.useColors(),f.color=e.selectColor(h),f.extend=i,f.destroy=e.destroy,Object.defineProperty(f,"enabled",{enumerable:!0,configurable:!1,get:()=>d!==null?d:(g!==e.namespaces&&(g=e.namespaces,m=e.enabled(h)),m),set:_=>{d=_}}),typeof e.init=="function"&&e.init(f),f}function i(h,u){const d=e(this.namespace+(typeof u>"u"?":":u)+h);return d.log=this.log,d}function s(h){e.save(h),e.namespaces=h,e.names=[],e.skips=[];let u;const d=(typeof h=="string"?h:"").split(/[\s,]+/),g=d.length;for(u=0;u<g;u++)d[u]&&(h=d[u].replace(/\*/g,".*?"),h[0]==="-"?e.skips.push(new RegExp("^"+h.slice(1)+"$")):e.names.push(new RegExp("^"+h+"$")))}function r(){const h=[...e.names.map(a),...e.skips.map(a).map(u=>"-"+u)].join(",");return e.enable(""),h}function o(h){if(h[h.length-1]==="*")return!0;let u,d;for(u=0,d=e.skips.length;u<d;u++)if(e.skips[u].test(h))return!1;for(u=0,d=e.names.length;u<d;u++)if(e.names[u].test(h))return!0;return!1}function a(h){return h.toString().substring(2,h.toString().length-2).replace(/\.\*\?$/,"*")}function l(h){return h instanceof Error?h.stack||h.message:h}function c(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return e.enable(e.load()),e}var Hc=$c;(function(n,t){var e={};t.formatArgs=s,t.save=r,t.load=o,t.useColors=i,t.storage=a(),t.destroy=(()=>{let c=!1;return()=>{c||(c=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function i(){if(typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))return!0;if(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let c;return typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&(c=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(c[1],10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function s(c){if(c[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+c[0]+(this.useColors?"%c ":" ")+"+"+n.exports.humanize(this.diff),!this.useColors)return;const h="color: "+this.color;c.splice(1,0,h,"color: inherit");let u=0,d=0;c[0].replace(/%[a-zA-Z%]/g,g=>{g!=="%%"&&(u++,g==="%c"&&(d=u))}),c.splice(d,0,h)}t.log=console.debug||console.log||(()=>{});function r(c){try{c?t.storage.setItem("debug",c):t.storage.removeItem("debug")}catch{}}function o(){let c;try{c=t.storage.getItem("debug")}catch{}return!c&&typeof process<"u"&&"env"in process&&(c=e.DEBUG),c}function a(){try{return localStorage}catch{}}n.exports=Hc(t);const{formatters:l}=n.exports;l.j=function(c){try{return JSON.stringify(c)}catch(h){return"[UnexpectedJSONParseError]: "+h.message}}})(Ii,Ii.exports);var qc=Ii.exports;const zc=vo(qc),bt=typeof window<"u"?window:self,Ri=bt.RTCPeerConnection||bt.mozRTCPeerConnection||bt.webkitRTCPeerConnection,Yc=bt.RTCSessionDescription||bt.mozRTCSessionDescription||bt.webkitRTCSessionDescription,Wc=bt.RTCIceCandidate||bt.mozRTCIceCandidate||bt.webkitRTCIceCandidate;var ss={exports:{}},de=typeof Reflect=="object"?Reflect:null,js=de&&typeof de.apply=="function"?de.apply:function(t,e,i){return Function.prototype.apply.call(t,e,i)},pn;de&&typeof de.ownKeys=="function"?pn=de.ownKeys:Object.getOwnPropertySymbols?pn=function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:pn=function(t){return Object.getOwnPropertyNames(t)};function jc(n){console&&console.warn&&console.warn(n)}var Io=Number.isNaN||function(t){return t!==t};function $(){$.init.call(this)}ss.exports=$;ss.exports.once=Zc;$.EventEmitter=$;$.prototype._events=void 0;$.prototype._eventsCount=0;$.prototype._maxListeners=void 0;var Gs=10;function qn(n){if(typeof n!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof n)}Object.defineProperty($,"defaultMaxListeners",{enumerable:!0,get:function(){return Gs},set:function(n){if(typeof n!="number"||n<0||Io(n))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+n+".");Gs=n}});$.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};$.prototype.setMaxListeners=function(t){if(typeof t!="number"||t<0||Io(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this};function Ro(n){return n._maxListeners===void 0?$.defaultMaxListeners:n._maxListeners}$.prototype.getMaxListeners=function(){return Ro(this)};$.prototype.emit=function(t){for(var e=[],i=1;i<arguments.length;i++)e.push(arguments[i]);var s=t==="error",r=this._events;if(r!==void 0)s=s&&r.error===void 0;else if(!s)return!1;if(s){var o;if(e.length>0&&(o=e[0]),o instanceof Error)throw o;var a=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw a.context=o,a}var l=r[t];if(l===void 0)return!1;if(typeof l=="function")js(l,this,e);else for(var c=l.length,h=Lo(l,c),i=0;i<c;++i)js(h[i],this,e);return!0};function No(n,t,e,i){var s,r,o;if(qn(e),r=n._events,r===void 0?(r=n._events=Object.create(null),n._eventsCount=0):(r.newListener!==void 0&&(n.emit("newListener",t,e.listener?e.listener:e),r=n._events),o=r[t]),o===void 0)o=r[t]=e,++n._eventsCount;else if(typeof o=="function"?o=r[t]=i?[e,o]:[o,e]:i?o.unshift(e):o.push(e),s=Ro(n),s>0&&o.length>s&&!o.warned){o.warned=!0;var a=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");a.name="MaxListenersExceededWarning",a.emitter=n,a.type=t,a.count=o.length,jc(a)}return n}$.prototype.addListener=function(t,e){return No(this,t,e,!1)};$.prototype.on=$.prototype.addListener;$.prototype.prependListener=function(t,e){return No(this,t,e,!0)};function Gc(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function Bo(n,t,e){var i={fired:!1,wrapFn:void 0,target:n,type:t,listener:e},s=Gc.bind(i);return s.listener=e,i.wrapFn=s,s}$.prototype.once=function(t,e){return qn(e),this.on(t,Bo(this,t,e)),this};$.prototype.prependOnceListener=function(t,e){return qn(e),this.prependListener(t,Bo(this,t,e)),this};$.prototype.removeListener=function(t,e){var i,s,r,o,a;if(qn(e),s=this._events,s===void 0)return this;if(i=s[t],i===void 0)return this;if(i===e||i.listener===e)--this._eventsCount===0?this._events=Object.create(null):(delete s[t],s.removeListener&&this.emit("removeListener",t,i.listener||e));else if(typeof i!="function"){for(r=-1,o=i.length-1;o>=0;o--)if(i[o]===e||i[o].listener===e){a=i[o].listener,r=o;break}if(r<0)return this;r===0?i.shift():Kc(i,r),i.length===1&&(s[t]=i[0]),s.removeListener!==void 0&&this.emit("removeListener",t,a||e)}return this};$.prototype.off=$.prototype.removeListener;$.prototype.removeAllListeners=function(t){var e,i,s;if(i=this._events,i===void 0)return this;if(i.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):i[t]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete i[t]),this;if(arguments.length===0){var r=Object.keys(i),o;for(s=0;s<r.length;++s)o=r[s],o!=="removeListener"&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(e=i[t],typeof e=="function")this.removeListener(t,e);else if(e!==void 0)for(s=e.length-1;s>=0;s--)this.removeListener(t,e[s]);return this};function Po(n,t,e){var i=n._events;if(i===void 0)return[];var s=i[t];return s===void 0?[]:typeof s=="function"?e?[s.listener||s]:[s]:e?Vc(s):Lo(s,s.length)}$.prototype.listeners=function(t){return Po(this,t,!0)};$.prototype.rawListeners=function(t){return Po(this,t,!1)};$.listenerCount=function(n,t){return typeof n.listenerCount=="function"?n.listenerCount(t):ko.call(n,t)};$.prototype.listenerCount=ko;function ko(n){var t=this._events;if(t!==void 0){var e=t[n];if(typeof e=="function")return 1;if(e!==void 0)return e.length}return 0}$.prototype.eventNames=function(){return this._eventsCount>0?pn(this._events):[]};function Lo(n,t){for(var e=new Array(t),i=0;i<t;++i)e[i]=n[i];return e}function Kc(n,t){for(;t+1<n.length;t++)n[t]=n[t+1];n.pop()}function Vc(n){for(var t=new Array(n.length),e=0;e<t.length;++e)t[e]=n[e].listener||n[e];return t}function Zc(n,t){return new Promise(function(e,i){function s(o){n.removeListener(t,r),i(o)}function r(){typeof n.removeListener=="function"&&n.removeListener("error",s),e([].slice.call(arguments))}Do(n,t,r,{once:!0}),t!=="error"&&Jc(n,s,{once:!0})})}function Jc(n,t,e){typeof n.on=="function"&&Do(n,"error",t,e)}function Do(n,t,e,i){if(typeof n.on=="function")i.once?n.once(t,e):n.on(t,e);else if(typeof n.addEventListener=="function")n.addEventListener(t,function s(r){i.once&&n.removeEventListener(t,s),e(r)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof n)}var Xc=ss.exports,Qc=typeof queueMicrotask=="function"?queueMicrotask:n=>Promise.resolve().then(n),th=class{constructor(t){if(!(t>0)||t-1&t)throw new Error("Max size for a FixedFIFO should be a power of two");this.buffer=new Array(t),this.mask=t-1,this.top=0,this.btm=0,this.next=null}clear(){this.top=this.btm=0,this.next=null,this.buffer.fill(void 0)}push(t){return this.buffer[this.top]!==void 0?!1:(this.buffer[this.top]=t,this.top=this.top+1&this.mask,!0)}shift(){const t=this.buffer[this.btm];if(t!==void 0)return this.buffer[this.btm]=void 0,this.btm=this.btm+1&this.mask,t}peek(){return this.buffer[this.btm]}isEmpty(){return this.buffer[this.btm]===void 0}};const Ks=th;var eh=class{constructor(t){this.hwm=t||16,this.head=new Ks(this.hwm),this.tail=this.head,this.length=0}clear(){this.head=this.tail,this.head.clear(),this.length=0}push(t){if(this.length++,!this.head.push(t)){const e=this.head;this.head=e.next=new Ks(2*this.head.buffer.length),this.head.push(t)}}shift(){this.length!==0&&this.length--;const t=this.tail.shift();if(t===void 0&&this.tail.next){const e=this.tail.next;return this.tail.next=null,this.tail=e,this.tail.shift()}return t}peek(){const t=this.tail.peek();return t===void 0&&this.tail.next?this.tail.next.peek():t}isEmpty(){return this.length===0}},Oo=class{constructor(t){this.decoder=new TextDecoder(t==="utf16le"?"utf16-le":t)}decode(t){return this.decoder.decode(t,{stream:!0})}flush(){return this.decoder.decode(new Uint8Array(0))}};const nh=Oo,ih=Oo;var sh=class{constructor(t="utf8"){switch(this.encoding=rh(t),this.encoding){case"utf8":this.decoder=new ih;break;case"utf16le":case"base64":throw new Error("Unsupported encoding: "+this.encoding);default:this.decoder=new nh(this.encoding)}}push(t){return typeof t=="string"?t:this.decoder.decode(t)}write(t){return this.push(t)}end(t){let e="";return t&&(e=this.push(t)),e+=this.decoder.flush(),e}};function rh(n){switch(n=n.toLowerCase(),n){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return n;default:throw new Error("Unknown encoding: "+n)}}const{EventEmitter:oh}=Xc,zn=new Error("Stream was destroyed"),li=new Error("Premature close"),Mo=Qc,Uo=eh,ah=sh,j=(1<<29)-1,ne=1,rs=2,Xt=4,$e=8,Fo=j^ne,lh=j^rs,Ve=16,He=32,Ne=64,Bt=128,Ze=256,os=512,Qt=1024,Ni=2048,as=4096,ls=8192,ct=16384,fe=32768,Yn=65536,te=131072,$o=Ze|os,ch=Ve|Yn,hh=Ne|Ve,uh=as|Bt,cs=Ze|te,dh=j^Ve,fh=j^Ne,gh=j^(Ne|Yn),ph=j^Yn,_h=j^Ze,mh=j^(Bt|ls),wh=j^Qt,Vs=j^$o,Ho=j^fe,yh=j^He,qo=j^te,bh=j^cs,Ot=1<<18,xe=2<<18,Je=4<<18,ee=8<<18,Xe=16<<18,ie=32<<18,Bi=64<<18,ge=128<<18,hs=256<<18,Se=512<<18,Wn=1024<<18,zo=j^(Ot|hs),Yo=j^Je,Eh=j^Se,xh=j^Xe,Sh=j^ee,Wo=j^ge,Ch=j^xe,jo=j^Wn,qe=Ve|Ot,Go=j^qe,us=ct|ie,xt=Xt|$e|rs,nt=xt|ne,Ko=xt|us,Ah=Yo&fh,ds=ge|fe,Th=ds&Go,Vo=nt|Th,vh=nt|Qt|ct,Zs=nt|ct|Bt,Ih=nt|Qt|Bt,Rh=nt|as|Bt|ls,Nh=nt|Ve|Qt|ct|Yn|te,Bh=xt|Qt|ct,Ph=He|nt|fe|Ne,kh=nt|Se|ie,Lh=ee|Xe,Zo=ee|Ot,Dh=ee|Xe|nt|Ot,Js=nt|Ot|ee|Wn,Oh=Je|Ot,Mh=Ot|hs,Uh=nt|Se|Zo|ie,Fh=Xe|xt|Se|ie,$h=xe|nt|ge|Je,rn=Symbol.asyncIterator||Symbol("asyncIterator");class Jo{constructor(t,{highWaterMark:e=16384,map:i=null,mapWritable:s,byteLength:r,byteLengthWritable:o}={}){this.stream=t,this.queue=new Uo,this.highWaterMark=e,this.buffered=0,this.error=null,this.pipeline=null,this.drains=null,this.byteLength=o||r||sa,this.map=s||i,this.afterWrite=jh.bind(this),this.afterUpdateNextTick=Vh.bind(this)}get ended(){return(this.stream._duplexState&ie)!==0}push(t){return this.map!==null&&(t=this.map(t)),this.buffered+=this.byteLength(t),this.queue.push(t),this.buffered<this.highWaterMark?(this.stream._duplexState|=ee,!0):(this.stream._duplexState|=Lh,!1)}shift(){const t=this.queue.shift();return this.buffered-=this.byteLength(t),this.buffered===0&&(this.stream._duplexState&=Sh),t}end(t){typeof t=="function"?this.stream.once("finish",t):t!=null&&this.push(t),this.stream._duplexState=(this.stream._duplexState|Se)&Yo}autoBatch(t,e){const i=[],s=this.stream;for(i.push(t);(s._duplexState&Js)===Zo;)i.push(s._writableState.shift());if(s._duplexState&nt)return e(null);s._writev(i,e)}update(){const t=this.stream;t._duplexState|=xe;do{for(;(t._duplexState&Js)===ee;){const e=this.shift();t._duplexState|=Mh,t._write(e,this.afterWrite)}t._duplexState&Oh||this.updateNonPrimary()}while(this.continueUpdate()===!0);t._duplexState&=Ch}updateNonPrimary(){const t=this.stream;if((t._duplexState&Uh)===Se){t._duplexState=(t._duplexState|Ot)&Eh,t._final(Wh.bind(this));return}if((t._duplexState&xt)===Xt){t._duplexState&ds||(t._duplexState|=qe,t._destroy(Xo.bind(this)));return}(t._duplexState&Vo)===ne&&(t._duplexState=(t._duplexState|qe)&Fo,t._open(Qo.bind(this)))}continueUpdate(){return this.stream._duplexState&ge?(this.stream._duplexState&=Wo,!0):!1}updateCallback(){(this.stream._duplexState&$h)===Je?this.update():this.updateNextTick()}updateNextTick(){this.stream._duplexState&ge||(this.stream._duplexState|=ge,this.stream._duplexState&xe||Mo(this.afterUpdateNextTick))}}class Hh{constructor(t,{highWaterMark:e=16384,map:i=null,mapReadable:s,byteLength:r,byteLengthReadable:o}={}){this.stream=t,this.queue=new Uo,this.highWaterMark=e===0?1:e,this.buffered=0,this.readAhead=e>0,this.error=null,this.pipeline=null,this.byteLength=o||r||sa,this.map=s||i,this.pipeTo=null,this.afterRead=Gh.bind(this),this.afterUpdateNextTick=Kh.bind(this)}get ended(){return(this.stream._duplexState&ct)!==0}pipe(t,e){if(this.pipeTo!==null)throw new Error("Can only pipe to one destination");if(typeof e!="function"&&(e=null),this.stream._duplexState|=os,this.pipeTo=t,this.pipeline=new zh(this.stream,t,e),e&&this.stream.on("error",Xs),Ye(t))t._writableState.pipeline=this.pipeline,e&&t.on("error",Xs),t.on("finish",this.pipeline.finished.bind(this.pipeline));else{const i=this.pipeline.done.bind(this.pipeline,t),s=this.pipeline.done.bind(this.pipeline,t,null);t.on("error",i),t.on("close",s),t.on("finish",this.pipeline.finished.bind(this.pipeline))}t.on("drain",Yh.bind(this)),this.stream.emit("piping",t),t.emit("pipe",this.stream)}push(t){const e=this.stream;return t===null?(this.highWaterMark=0,e._duplexState=(e._duplexState|Qt)&gh,!1):this.map!==null&&(t=this.map(t),t===null)?this.buffered<this.highWaterMark:(this.buffered+=this.byteLength(t),this.queue.push(t),e._duplexState=(e._duplexState|Bt)&ph,this.buffered<this.highWaterMark)}shift(){const t=this.queue.shift();return this.buffered-=this.byteLength(t),this.buffered===0&&(this.stream._duplexState&=mh),t}unshift(t){const e=[this.map!==null?this.map(t):t];for(;this.buffered>0;)e.push(this.shift());for(let i=0;i<e.length-1;i++){const s=e[i];this.buffered+=this.byteLength(s),this.queue.push(s)}this.push(e[e.length-1])}read(){const t=this.stream;if((t._duplexState&Zs)===Bt){const e=this.shift();return this.pipeTo!==null&&this.pipeTo.write(e)===!1&&(t._duplexState&=Vs),t._duplexState&Ni&&t.emit("data",e),e}return this.readAhead===!1&&(t._duplexState|=te,this.updateNextTick()),null}drain(){const t=this.stream;for(;(t._duplexState&Zs)===Bt&&t._duplexState&$o;){const e=this.shift();this.pipeTo!==null&&this.pipeTo.write(e)===!1&&(t._duplexState&=Vs),t._duplexState&Ni&&t.emit("data",e)}}update(){const t=this.stream;t._duplexState|=He;do{for(this.drain();this.buffered<this.highWaterMark&&(t._duplexState&Nh)===te;)t._duplexState|=ch,t._read(this.afterRead),this.drain();(t._duplexState&Rh)===uh&&(t._duplexState|=ls,t.emit("readable")),t._duplexState&hh||this.updateNonPrimary()}while(this.continueUpdate()===!0);t._duplexState&=yh}updateNonPrimary(){const t=this.stream;if((t._duplexState&Ih)===Qt&&(t._duplexState=(t._duplexState|ct)&wh,t.emit("end"),(t._duplexState&Ko)===us&&(t._duplexState|=Xt),this.pipeTo!==null&&this.pipeTo.end()),(t._duplexState&xt)===Xt){t._duplexState&ds||(t._duplexState|=qe,t._destroy(Xo.bind(this)));return}(t._duplexState&Vo)===ne&&(t._duplexState=(t._duplexState|qe)&Fo,t._open(Qo.bind(this)))}continueUpdate(){return this.stream._duplexState&fe?(this.stream._duplexState&=Ho,!0):!1}updateCallback(){(this.stream._duplexState&Ph)===Ne?this.update():this.updateNextTick()}updateNextTick(){this.stream._duplexState&fe||(this.stream._duplexState|=fe,this.stream._duplexState&He||Mo(this.afterUpdateNextTick))}}class qh{constructor(t){this.data=null,this.afterTransform=Jh.bind(t),this.afterFinal=null}}class zh{constructor(t,e,i){this.from=t,this.to=e,this.afterPipe=i,this.error=null,this.pipeToFinished=!1}finished(){this.pipeToFinished=!0}done(t,e){if(e&&(this.error=e),t===this.to&&(this.to=null,this.from!==null)){(!(this.from._duplexState&ct)||!this.pipeToFinished)&&this.from.destroy(this.error||new Error("Writable stream closed prematurely"));return}if(t===this.from&&(this.from=null,this.to!==null)){t._duplexState&ct||this.to.destroy(this.error||new Error("Readable stream closed before ending"));return}this.afterPipe!==null&&this.afterPipe(this.error),this.to=this.from=this.afterPipe=null}}function Yh(){this.stream._duplexState|=os,this.updateCallback()}function Wh(n){const t=this.stream;n&&t.destroy(n),t._duplexState&xt||(t._duplexState|=ie,t.emit("finish")),(t._duplexState&Ko)===us&&(t._duplexState|=Xt),t._duplexState&=zo,t._duplexState&xe?this.updateNextTick():this.update()}function Xo(n){const t=this.stream;!n&&this.error!==zn&&(n=this.error),n&&t.emit("error",n),t._duplexState|=$e,t.emit("close");const e=t._readableState,i=t._writableState;if(e!==null&&e.pipeline!==null&&e.pipeline.done(t,n),i!==null){for(;i.drains!==null&&i.drains.length>0;)i.drains.shift().resolve(!1);i.pipeline!==null&&i.pipeline.done(t,n)}}function jh(n){const t=this.stream;n&&t.destroy(n),t._duplexState&=zo,this.drains!==null&&Zh(this.drains),(t._duplexState&Dh)===Xe&&(t._duplexState&=xh,(t._duplexState&Bi)===Bi&&t.emit("drain")),this.updateCallback()}function Gh(n){n&&this.stream.destroy(n),this.stream._duplexState&=dh,this.readAhead===!1&&!(this.stream._duplexState&Ze)&&(this.stream._duplexState&=qo),this.updateCallback()}function Kh(){this.stream._duplexState&He||(this.stream._duplexState&=Ho,this.update())}function Vh(){this.stream._duplexState&xe||(this.stream._duplexState&=Wo,this.update())}function Zh(n){for(let t=0;t<n.length;t++)--n[t].writes===0&&(n.shift().resolve(!0),t--)}function Qo(n){const t=this.stream;n&&t.destroy(n),t._duplexState&Xt||(t._duplexState&vh||(t._duplexState|=Ne),t._duplexState&kh||(t._duplexState|=Je),t.emit("open")),t._duplexState&=Go,t._writableState!==null&&t._writableState.updateCallback(),t._readableState!==null&&t._readableState.updateCallback()}function Jh(n,t){t!=null&&this.push(t),this._writableState.afterWrite(n)}function Xh(n){this._readableState!==null&&(n==="data"&&(this._duplexState|=Ni|cs,this._readableState.updateNextTick()),n==="readable"&&(this._duplexState|=as,this._readableState.updateNextTick())),this._writableState!==null&&n==="drain"&&(this._duplexState|=Bi,this._writableState.updateNextTick())}class fs extends oh{constructor(t){super(),this._duplexState=0,this._readableState=null,this._writableState=null,t&&(t.open&&(this._open=t.open),t.destroy&&(this._destroy=t.destroy),t.predestroy&&(this._predestroy=t.predestroy),t.signal&&t.signal.addEventListener("abort",ou.bind(this))),this.on("newListener",Xh)}_open(t){t(null)}_destroy(t){t(null)}_predestroy(){}get readable(){return this._readableState!==null?!0:void 0}get writable(){return this._writableState!==null?!0:void 0}get destroyed(){return(this._duplexState&$e)!==0}get destroying(){return(this._duplexState&xt)!==0}destroy(t){this._duplexState&xt||(t||(t=zn),this._duplexState=(this._duplexState|Xt)&Ah,this._readableState!==null&&(this._readableState.highWaterMark=0,this._readableState.error=t),this._writableState!==null&&(this._writableState.highWaterMark=0,this._writableState.error=t),this._duplexState|=rs,this._predestroy(),this._duplexState&=lh,this._readableState!==null&&this._readableState.updateNextTick(),this._writableState!==null&&this._writableState.updateNextTick())}}class ze extends fs{constructor(t){super(t),this._duplexState|=ne|ie|te,this._readableState=new Hh(this,t),t&&(this._readableState.readAhead===!1&&(this._duplexState&=qo),t.read&&(this._read=t.read),t.eagerOpen&&this._readableState.updateNextTick(),t.encoding&&this.setEncoding(t.encoding))}setEncoding(t){const e=new ah(t),i=this._readableState.map||nu;return this._readableState.map=s,this;function s(r){const o=e.push(r);return o===""?null:i(o)}}_read(t){t(null)}pipe(t,e){return this._readableState.updateNextTick(),this._readableState.pipe(t,e),t}read(){return this._readableState.updateNextTick(),this._readableState.read()}push(t){return this._readableState.updateNextTick(),this._readableState.push(t)}unshift(t){return this._readableState.updateNextTick(),this._readableState.unshift(t)}resume(){return this._duplexState|=cs,this._readableState.updateNextTick(),this}pause(){return this._duplexState&=this._readableState.readAhead===!1?bh:_h,this}static _fromAsyncIterator(t,e){let i;const s=new ze({...e,read(o){t.next().then(r).then(o.bind(null,null)).catch(o)},predestroy(){i=t.return()},destroy(o){if(!i)return o(null);i.then(o.bind(null,null)).catch(o)}});return s;function r(o){o.done?s.push(null):s.push(o.value)}}static from(t,e){if(su(t))return t;if(t[rn])return this._fromAsyncIterator(t[rn](),e);Array.isArray(t)||(t=t===void 0?[]:[t]);let i=0;return new ze({...e,read(s){this.push(i===t.length?null:t[i++]),s(null)}})}static isBackpressured(t){return(t._duplexState&Bh)!==0||t._readableState.buffered>=t._readableState.highWaterMark}static isPaused(t){return(t._duplexState&Ze)===0}[rn](){const t=this;let e=null,i=null,s=null;return this.on("error",c=>{e=c}),this.on("readable",r),this.on("close",o),{[rn](){return this},next(){return new Promise(function(c,h){i=c,s=h;const u=t.read();u!==null?a(u):t._duplexState&$e&&a(null)})},return(){return l(null)},throw(c){return l(c)}};function r(){i!==null&&a(t.read())}function o(){i!==null&&a(null)}function a(c){s!==null&&(e?s(e):c===null&&!(t._duplexState&ct)?s(zn):i({value:c,done:c===null}),s=i=null)}function l(c){return t.destroy(c),new Promise((h,u)=>{if(t._duplexState&$e)return h({value:void 0,done:!0});t.once("close",function(){c?u(c):h({value:void 0,done:!0})})})}}}class ta extends fs{constructor(t){super(t),this._duplexState|=ne|ct,this._writableState=new Jo(this,t),t&&(t.writev&&(this._writev=t.writev),t.write&&(this._write=t.write),t.final&&(this._final=t.final),t.eagerOpen&&this._writableState.updateNextTick())}cork(){this._duplexState|=Wn}uncork(){this._duplexState&=jo,this._writableState.updateNextTick()}_writev(t,e){e(null)}_write(t,e){this._writableState.autoBatch(t,e)}_final(t){t(null)}static isBackpressured(t){return(t._duplexState&Fh)!==0}static drained(t){if(t.destroyed)return Promise.resolve(!1);const e=t._writableState,s=(au(t)?Math.min(1,e.queue.length):e.queue.length)+(t._duplexState&hs?1:0);return s===0?Promise.resolve(!0):(e.drains===null&&(e.drains=[]),new Promise(r=>{e.drains.push({writes:s,resolve:r})}))}write(t){return this._writableState.updateNextTick(),this._writableState.push(t)}end(t){return this._writableState.updateNextTick(),this._writableState.end(t),this}}class gs extends ze{constructor(t){super(t),this._duplexState=ne|this._duplexState&te,this._writableState=new Jo(this,t),t&&(t.writev&&(this._writev=t.writev),t.write&&(this._write=t.write),t.final&&(this._final=t.final))}cork(){this._duplexState|=Wn}uncork(){this._duplexState&=jo,this._writableState.updateNextTick()}_writev(t,e){e(null)}_write(t,e){this._writableState.autoBatch(t,e)}_final(t){t(null)}write(t){return this._writableState.updateNextTick(),this._writableState.push(t)}end(t){return this._writableState.updateNextTick(),this._writableState.end(t),this}}class ea extends gs{constructor(t){super(t),this._transformState=new qh(this),t&&(t.transform&&(this._transform=t.transform),t.flush&&(this._flush=t.flush))}_write(t,e){this._readableState.buffered>=this._readableState.highWaterMark?this._transformState.data=t:this._transform(t,this._transformState.afterTransform)}_read(t){if(this._transformState.data!==null){const e=this._transformState.data;this._transformState.data=null,t(null),this._transform(e,this._transformState.afterTransform)}else t(null)}destroy(t){super.destroy(t),this._transformState.data!==null&&(this._transformState.data=null,this._transformState.afterTransform())}_transform(t,e){e(null,t)}_flush(t){t(null)}_final(t){this._transformState.afterFinal=t,this._flush(tu.bind(this))}}class Qh extends ea{}function tu(n,t){const e=this._transformState.afterFinal;if(n)return e(n);t!=null&&this.push(t),this.push(null),e(null)}function eu(...n){return new Promise((t,e)=>na(...n,i=>{if(i)return e(i);t()}))}function na(n,...t){const e=Array.isArray(n)?[...n,...t]:[n,...t],i=e.length&&typeof e[e.length-1]=="function"?e.pop():null;if(e.length<2)throw new Error("Pipeline requires at least 2 streams");let s=e[0],r=null,o=null;for(let c=1;c<e.length;c++)r=e[c],Ye(s)?s.pipe(r,l):(a(s,!0,c>1,l),s.pipe(r)),s=r;if(i){let c=!1;const h=Ye(r)||!!(r._writableState&&r._writableState.autoDestroy);r.on("error",u=>{o===null&&(o=u)}),r.on("finish",()=>{c=!0,h||i(o)}),h&&r.on("close",()=>i(o||(c?null:li)))}return r;function a(c,h,u,d){c.on("error",d),c.on("close",g);function g(){if(c._readableState&&!c._readableState.ended||u&&c._writableState&&!c._writableState.ended)return d(li)}}function l(c){if(!(!c||o)){o=c;for(const h of e)h.destroy(c)}}}function nu(n){return n}function ia(n){return!!n._readableState||!!n._writableState}function Ye(n){return typeof n._duplexState=="number"&&ia(n)}function iu(n,t={}){const e=n._readableState&&n._readableState.error||n._writableState&&n._writableState.error;return!t.all&&e===zn?null:e}function su(n){return Ye(n)&&n.readable}function ru(n){return typeof n=="object"&&n!==null&&typeof n.byteLength=="number"}function sa(n){return ru(n)?n.byteLength:1024}function Xs(){}function ou(){this.destroy(new Error("Stream aborted."))}function au(n){return n._writev!==ta.prototype._writev&&n._writev!==gs.prototype._writev}var lu={pipeline:na,pipelinePromise:eu,isStream:ia,isStreamx:Ye,getStreamError:iu,Stream:fs,Writable:ta,Readable:ze,Duplex:gs,Transform:ea,PassThrough:Qh};function Qs(n,t){for(const e in t)Object.defineProperty(n,e,{value:t[e],enumerable:!0,configurable:!0});return n}function cu(n,t,e){if(!n||typeof n=="string")throw new TypeError("Please pass an Error to err-code");e||(e={}),typeof t=="object"&&(e=t,t=""),t&&(e.code=t);try{return Qs(n,e)}catch{e.message=n.message,e.stack=n.stack;const s=function(){};return s.prototype=Object.create(Object.getPrototypeOf(n)),Qs(new s,e)}}var hu=cu;const O=vo(hu);/* Common package for dealing with hex/string/uint8 conversions (and sha1 hashing)
*
* @author   Jimmy Wärting <jimmy@warting.se> (https://jimmy.warting.se/opensource)
* @license  MIT
*/const tr="0123456789abcdef",ra=[];for(let n=0;n<256;n++)ra[n]=tr[n>>4&15]+tr[n&15];const er=n=>{const t=n.length;let e="",i=0;for(;i<t;)e+=ra[n[i++]];return e};var nr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",uu=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(var on=0;on<nr.length;on++)uu[nr.charCodeAt(on)]=on;new TextDecoder;const du=new TextEncoder,fu=n=>du.encode(n),ir=typeof window<"u"?window:self,Pi=ir.crypto||ir.msCrypto||{};Pi.subtle||Pi.webkitSubtle;const sr=n=>{const t=new Uint8Array(n);return Pi.getRandomValues(t)};/*! simple-peer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */const gu=zc("simple-peer"),ci=64*1024,pu=5*1e3,_u=5*1e3;function rr(n){return n.replace(/a=ice-options:trickle\s\n/g,"")}function mu(n){console.warn(n)}let jn=class ki extends lu.Duplex{constructor(e){e=Object.assign({allowHalfOpen:!1},e);super(e);Es(this,"_pc");if(this.__objectMode=!!e.objectMode,this._id=er(sr(4)).slice(0,7),this._debug("new peer %o",e),this.channelName=e.initiator?e.channelName||er(sr(20)):null,this.initiator=e.initiator||!1,this.channelConfig=e.channelConfig||ki.channelConfig,this.channelNegotiated=this.channelConfig.negotiated,this.config=Object.assign({},ki.config,e.config),this.offerOptions=e.offerOptions||{},this.answerOptions=e.answerOptions||{},this.sdpTransform=e.sdpTransform||(i=>i),this.trickle=e.trickle!==void 0?e.trickle:!0,this.allowHalfTrickle=e.allowHalfTrickle!==void 0?e.allowHalfTrickle:!1,this.iceCompleteTimeout=e.iceCompleteTimeout||pu,this._destroying=!1,this._connected=!1,this.remoteAddress=void 0,this.remoteFamily=void 0,this.remotePort=void 0,this.localAddress=void 0,this.localFamily=void 0,this.localPort=void 0,!Ri)throw O(typeof window>"u"?new Error("No WebRTC support: Specify `opts.wrtc` option in this environment"):new Error("No WebRTC support: Not a supported browser"),"ERR_WEBRTC_SUPPORT");this._pcReady=!1,this._channelReady=!1,this._iceComplete=!1,this._iceCompleteTimer=null,this._channel=null,this._pendingCandidates=[],this._isNegotiating=!1,this._firstNegotiation=!0,this._batchedNegotiation=!1,this._queuedNegotiation=!1,this._sendersAwaitingStable=[],this._closingInterval=null,this._remoteTracks=[],this._remoteStreams=[],this._chunk=null,this._cb=null,this._interval=null;try{this._pc=new Ri(this.config)}catch(i){this.__destroy(O(i,"ERR_PC_CONSTRUCTOR"));return}this._isReactNativeWebrtc=typeof this._pc._peerConnectionId=="number",this._pc.oniceconnectionstatechange=()=>{this._onIceStateChange()},this._pc.onicegatheringstatechange=()=>{this._onIceStateChange()},this._pc.onconnectionstatechange=()=>{this._onConnectionStateChange()},this._pc.onsignalingstatechange=()=>{this._onSignalingStateChange()},this._pc.onicecandidate=i=>{this._onIceCandidate(i)},typeof this._pc.peerIdentity=="object"&&this._pc.peerIdentity.catch(i=>{this.__destroy(O(i,"ERR_PC_PEER_IDENTITY"))}),this.initiator||this.channelNegotiated?this._setupData({channel:this._pc.createDataChannel(this.channelName,this.channelConfig)}):this._pc.ondatachannel=i=>{this._setupData(i)},this._debug("initial negotiation"),this._needsNegotiation(),this._onFinishBound=()=>{this._onFinish()},this.once("finish",this._onFinishBound)}get bufferSize(){return this._channel&&this._channel.bufferedAmount||0}get connected(){return this._connected&&this._channel.readyState==="open"}address(){return{port:this.localPort,family:this.localFamily,address:this.localAddress}}signal(e){if(!this._destroying){if(this.destroyed)throw O(new Error("cannot signal after peer is destroyed"),"ERR_DESTROYED");if(typeof e=="string")try{e=JSON.parse(e)}catch{e={}}this._debug("signal()"),e.renegotiate&&this.initiator&&(this._debug("got request to renegotiate"),this._needsNegotiation()),e.transceiverRequest&&this.initiator&&(this._debug("got request for transceiver"),this.addTransceiver(e.transceiverRequest.kind,e.transceiverRequest.init)),e.candidate&&(this._pc.remoteDescription&&this._pc.remoteDescription.type?this._addIceCandidate(e.candidate):this._pendingCandidates.push(e.candidate)),e.sdp&&this._pc.setRemoteDescription(new Yc(e)).then(()=>{this.destroyed||(this._pendingCandidates.forEach(i=>{this._addIceCandidate(i)}),this._pendingCandidates=[],this._pc.remoteDescription.type==="offer"&&this._createAnswer())}).catch(i=>{this.__destroy(O(i,"ERR_SET_REMOTE_DESCRIPTION"))}),!e.sdp&&!e.candidate&&!e.renegotiate&&!e.transceiverRequest&&this.__destroy(O(new Error("signal() called with invalid signal data"),"ERR_SIGNALING"))}}_addIceCandidate(e){const i=new Wc(e);this._pc.addIceCandidate(i).catch(s=>{!i.address||i.address.endsWith(".local")?mu("Ignoring unsupported ICE candidate."):this.__destroy(O(s,"ERR_ADD_ICE_CANDIDATE"))})}send(e){if(!this._destroying){if(this.destroyed)throw O(new Error("cannot send after peer is destroyed"),"ERR_DESTROYED");this._channel.send(e)}}_needsNegotiation(){this._debug("_needsNegotiation"),!this._batchedNegotiation&&(this._batchedNegotiation=!0,queueMicrotask(()=>{this._batchedNegotiation=!1,this.initiator||!this._firstNegotiation?(this._debug("starting batched negotiation"),this.negotiate()):this._debug("non-initiator initial negotiation request discarded"),this._firstNegotiation=!1}))}negotiate(){if(!this._destroying){if(this.destroyed)throw O(new Error("cannot negotiate after peer is destroyed"),"ERR_DESTROYED");this.initiator?this._isNegotiating?(this._queuedNegotiation=!0,this._debug("already negotiating, queueing")):(this._debug("start negotiation"),setTimeout(()=>{this._createOffer()},0)):this._isNegotiating?(this._queuedNegotiation=!0,this._debug("already negotiating, queueing")):(this._debug("requesting negotiation from initiator"),this.emit("signal",{type:"renegotiate",renegotiate:!0})),this._isNegotiating=!0}}_final(e){this._readableState.ended||this.push(null),e(null)}__destroy(e){this.end(),this._destroy(()=>{},e)}_destroy(e,i){this.destroyed||this._destroying||(this._destroying=!0,this._debug("destroying (error: %s)",i&&(i.message||i)),setTimeout(()=>{if(this._connected=!1,this._pcReady=!1,this._channelReady=!1,this._remoteTracks=null,this._remoteStreams=null,this._senderMap=null,clearInterval(this._closingInterval),this._closingInterval=null,clearInterval(this._interval),this._interval=null,this._chunk=null,this._cb=null,this._onFinishBound&&this.removeListener("finish",this._onFinishBound),this._onFinishBound=null,this._channel){try{this._channel.close()}catch{}this._channel.onmessage=null,this._channel.onopen=null,this._channel.onclose=null,this._channel.onerror=null}if(this._pc){try{this._pc.close()}catch{}this._pc.oniceconnectionstatechange=null,this._pc.onicegatheringstatechange=null,this._pc.onsignalingstatechange=null,this._pc.onicecandidate=null,this._pc.ontrack=null,this._pc.ondatachannel=null}this._pc=null,this._channel=null,i&&this.emit("error",i),e()},0))}_setupData(e){if(!e.channel)return this.__destroy(O(new Error("Data channel event is missing `channel` property"),"ERR_DATA_CHANNEL"));this._channel=e.channel,this._channel.binaryType="arraybuffer",typeof this._channel.bufferedAmountLowThreshold=="number"&&(this._channel.bufferedAmountLowThreshold=ci),this.channelName=this._channel.label,this._channel.onmessage=s=>{this._onChannelMessage(s)},this._channel.onbufferedamountlow=()=>{this._onChannelBufferedAmountLow()},this._channel.onopen=()=>{this._onChannelOpen()},this._channel.onclose=()=>{this._onChannelClose()},this._channel.onerror=s=>{const r=s.error instanceof Error?s.error:new Error(`Datachannel error: ${s.message} ${s.filename}:${s.lineno}:${s.colno}`);this.__destroy(O(r,"ERR_DATA_CHANNEL"))};let i=!1;this._closingInterval=setInterval(()=>{this._channel&&this._channel.readyState==="closing"?(i&&this._onChannelClose(),i=!0):i=!1},_u)}_write(e,i){if(this.destroyed)return i(O(new Error("cannot write after peer is destroyed"),"ERR_DATA_CHANNEL"));if(this._connected){try{this.send(e)}catch(s){return this.__destroy(O(s,"ERR_DATA_CHANNEL"))}this._channel.bufferedAmount>ci?(this._debug("start backpressure: bufferedAmount %d",this._channel.bufferedAmount),this._cb=i):i(null)}else this._debug("write before connect"),this._chunk=e,this._cb=i}_onFinish(){if(this.destroyed)return;const e=()=>{setTimeout(()=>this.__destroy(),1e3)};this._connected?e():this.once("connect",e)}_startIceCompleteTimeout(){this.destroyed||this._iceCompleteTimer||(this._debug("started iceComplete timeout"),this._iceCompleteTimer=setTimeout(()=>{this._iceComplete||(this._iceComplete=!0,this._debug("iceComplete timeout completed"),this.emit("iceTimeout"),this.emit("_iceComplete"))},this.iceCompleteTimeout))}_createOffer(){this.destroyed||this._pc.createOffer(this.offerOptions).then(e=>{if(this.destroyed)return;!this.trickle&&!this.allowHalfTrickle&&(e.sdp=rr(e.sdp)),e.sdp=this.sdpTransform(e.sdp);const i=()=>{if(this.destroyed)return;const o=this._pc.localDescription||e;this._debug("signal"),this.emit("signal",{type:o.type,sdp:o.sdp})},s=()=>{this._debug("createOffer success"),!this.destroyed&&(this.trickle||this._iceComplete?i():this.once("_iceComplete",i))},r=o=>{this.__destroy(O(o,"ERR_SET_LOCAL_DESCRIPTION"))};this._pc.setLocalDescription(e).then(s).catch(r)}).catch(e=>{this.__destroy(O(e,"ERR_CREATE_OFFER"))})}_createAnswer(){this.destroyed||this._pc.createAnswer(this.answerOptions).then(e=>{if(this.destroyed)return;!this.trickle&&!this.allowHalfTrickle&&(e.sdp=rr(e.sdp)),e.sdp=this.sdpTransform(e.sdp);const i=()=>{var a;if(this.destroyed)return;const o=this._pc.localDescription||e;this._debug("signal"),this.emit("signal",{type:o.type,sdp:o.sdp}),this.initiator||(a=this._requestMissingTransceivers)==null||a.call(this)},s=()=>{this.destroyed||(this.trickle||this._iceComplete?i():this.once("_iceComplete",i))},r=o=>{this.__destroy(O(o,"ERR_SET_LOCAL_DESCRIPTION"))};this._pc.setLocalDescription(e).then(s).catch(r)}).catch(e=>{this.__destroy(O(e,"ERR_CREATE_ANSWER"))})}_onConnectionStateChange(){this.destroyed||this._destroying||this._pc.connectionState==="failed"&&this.__destroy(O(new Error("Connection failed."),"ERR_CONNECTION_FAILURE"))}_onIceStateChange(){if(this.destroyed)return;const e=this._pc.iceConnectionState,i=this._pc.iceGatheringState;this._debug("iceStateChange (connection: %s) (gathering: %s)",e,i),this.emit("iceStateChange",e,i),(e==="connected"||e==="completed")&&(this._pcReady=!0,this._maybeReady()),e==="failed"&&this.__destroy(O(new Error("Ice connection failed."),"ERR_ICE_CONNECTION_FAILURE")),e==="closed"&&this.__destroy(O(new Error("Ice connection closed."),"ERR_ICE_CONNECTION_CLOSED"))}getStats(e){const i=s=>(Object.prototype.toString.call(s.values)==="[object Array]"&&s.values.forEach(r=>{Object.assign(s,r)}),s);this._pc.getStats.length===0||this._isReactNativeWebrtc?this._pc.getStats().then(s=>{const r=[];s.forEach(o=>{r.push(i(o))}),e(null,r)},s=>e(s)):this._pc.getStats.length>0?this._pc.getStats(s=>{if(this.destroyed)return;const r=[];s.result().forEach(o=>{const a={};o.names().forEach(l=>{a[l]=o.stat(l)}),a.id=o.id,a.type=o.type,a.timestamp=o.timestamp,r.push(i(a))}),e(null,r)},s=>e(s)):e(null,[])}_maybeReady(){if(this._debug("maybeReady pc %s channel %s",this._pcReady,this._channelReady),this._connected||this._connecting||!this._pcReady||!this._channelReady)return;this._connecting=!0;const e=()=>{this.destroyed||this._destroying||this.getStats((i,s)=>{if(this.destroyed||this._destroying)return;i&&(s=[]);const r={},o={},a={};let l=!1;s.forEach(h=>{(h.type==="remotecandidate"||h.type==="remote-candidate")&&(r[h.id]=h),(h.type==="localcandidate"||h.type==="local-candidate")&&(o[h.id]=h),(h.type==="candidatepair"||h.type==="candidate-pair")&&(a[h.id]=h)});const c=h=>{l=!0;let u=o[h.localCandidateId];u&&(u.ip||u.address)?(this.localAddress=u.ip||u.address,this.localPort=Number(u.port)):u&&u.ipAddress?(this.localAddress=u.ipAddress,this.localPort=Number(u.portNumber)):typeof h.googLocalAddress=="string"&&(u=h.googLocalAddress.split(":"),this.localAddress=u[0],this.localPort=Number(u[1])),this.localAddress&&(this.localFamily=this.localAddress.includes(":")?"IPv6":"IPv4");let d=r[h.remoteCandidateId];d&&(d.ip||d.address)?(this.remoteAddress=d.ip||d.address,this.remotePort=Number(d.port)):d&&d.ipAddress?(this.remoteAddress=d.ipAddress,this.remotePort=Number(d.portNumber)):typeof h.googRemoteAddress=="string"&&(d=h.googRemoteAddress.split(":"),this.remoteAddress=d[0],this.remotePort=Number(d[1])),this.remoteAddress&&(this.remoteFamily=this.remoteAddress.includes(":")?"IPv6":"IPv4"),this._debug("connect local: %s:%s remote: %s:%s",this.localAddress,this.localPort,this.remoteAddress,this.remotePort)};if(s.forEach(h=>{h.type==="transport"&&h.selectedCandidatePairId&&c(a[h.selectedCandidatePairId]),(h.type==="googCandidatePair"&&h.googActiveConnection==="true"||(h.type==="candidatepair"||h.type==="candidate-pair")&&h.selected)&&c(h)}),!l&&(!Object.keys(a).length||Object.keys(o).length)){setTimeout(e,100);return}else this._connecting=!1,this._connected=!0;if(this._chunk){try{this.send(this._chunk)}catch(u){return this.__destroy(O(u,"ERR_DATA_CHANNEL"))}this._chunk=null,this._debug('sent chunk from "write before connect"');const h=this._cb;this._cb=null,h(null)}typeof this._channel.bufferedAmountLowThreshold!="number"&&(this._interval=setInterval(()=>this._onInterval(),150),this._interval.unref&&this._interval.unref()),this._debug("connect"),this.emit("connect")})};e()}_onInterval(){!this._cb||!this._channel||this._channel.bufferedAmount>ci||this._onChannelBufferedAmountLow()}_onSignalingStateChange(){this.destroyed||(this._pc.signalingState==="stable"&&(this._isNegotiating=!1,this._debug("flushing sender queue",this._sendersAwaitingStable),this._sendersAwaitingStable.forEach(e=>{this._pc.removeTrack(e),this._queuedNegotiation=!0}),this._sendersAwaitingStable=[],this._queuedNegotiation?(this._debug("flushing negotiation queue"),this._queuedNegotiation=!1,this._needsNegotiation()):(this._debug("negotiated"),this.emit("negotiated"))),this._debug("signalingStateChange %s",this._pc.signalingState),this.emit("signalingStateChange",this._pc.signalingState))}_onIceCandidate(e){this.destroyed||(e.candidate&&this.trickle?this.emit("signal",{type:"candidate",candidate:{candidate:e.candidate.candidate,sdpMLineIndex:e.candidate.sdpMLineIndex,sdpMid:e.candidate.sdpMid}}):!e.candidate&&!this._iceComplete&&(this._iceComplete=!0,this.emit("_iceComplete")),e.candidate&&this._startIceCompleteTimeout())}_onChannelMessage(e){if(this.destroyed)return;let i=e.data;i instanceof ArrayBuffer?i=new Uint8Array(i):this.__objectMode===!1&&(i=fu(i)),this.push(i)}_onChannelBufferedAmountLow(){if(this.destroyed||!this._cb)return;this._debug("ending backpressure: bufferedAmount %d",this._channel.bufferedAmount);const e=this._cb;this._cb=null,e(null)}_onChannelOpen(){this._connected||this.destroyed||(this._debug("on channel open"),this._channelReady=!0,this._maybeReady())}_onChannelClose(){this.destroyed||(this._debug("on channel close"),this.__destroy())}_debug(){const e=[].slice.call(arguments);e[0]="["+this._id+"] "+e[0],gu.apply(null,e)}};jn.WEBRTC_SUPPORT=!!Ri;jn.config={iceServers:[{urls:["stun:stun.l.google.com:19302","stun:global.stun.twilio.com:3478"]}],sdpSemantics:"unified-plan"};jn.channelConfig={};/*! simple-peer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */class wu extends jn{constructor(t={}){super(t),this._pc&&(this.streams=t.streams||(t.stream?[t.stream]:[]),this._senderMap=new Map,this.streams&&this.streams.forEach(e=>{this.addStream(e)}),this._pc.ontrack=e=>{this._onTrack(e)})}addTransceiver(t,e){if(!this._destroying){if(this.destroyed)throw O(new Error("cannot addTransceiver after peer is destroyed"),"ERR_DESTROYED");if(this._debug("addTransceiver()"),this.initiator)try{this._pc.addTransceiver(t,e),this._needsNegotiation()}catch(i){this.__destroy(O(i,"ERR_ADD_TRANSCEIVER"))}else this.emit("signal",{type:"transceiverRequest",transceiverRequest:{kind:t,init:e}})}}addStream(t){if(!this._destroying){if(this.destroyed)throw O(new Error("cannot addStream after peer is destroyed"),"ERR_DESTROYED");this._debug("addStream()"),t.getTracks().forEach(e=>{this.addTrack(e,t)})}}addTrack(t,e){if(this._destroying)return;if(this.destroyed)throw O(new Error("cannot addTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("addTrack()");const i=this._senderMap.get(t)||new Map;let s=i.get(e);if(!s)s=this._pc.addTrack(t,e),i.set(e,s),this._senderMap.set(t,i),this._needsNegotiation();else throw s.removed?O(new Error("Track has been removed. You should enable/disable tracks that you want to re-add."),"ERR_SENDER_REMOVED"):O(new Error("Track has already been added to that stream."),"ERR_SENDER_ALREADY_ADDED")}replaceTrack(t,e,i){if(this._destroying)return;if(this.destroyed)throw O(new Error("cannot replaceTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("replaceTrack()");const s=this._senderMap.get(t),r=s?s.get(i):null;if(!r)throw O(new Error("Cannot replace track that was never added."),"ERR_TRACK_NOT_ADDED");e&&this._senderMap.set(e,s),r.replaceTrack!=null?r.replaceTrack(e):this.__destroy(O(new Error("replaceTrack is not supported in this browser"),"ERR_UNSUPPORTED_REPLACETRACK"))}removeTrack(t,e){if(this._destroying)return;if(this.destroyed)throw O(new Error("cannot removeTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("removeSender()");const i=this._senderMap.get(t),s=i?i.get(e):null;if(!s)throw O(new Error("Cannot remove track that was never added."),"ERR_TRACK_NOT_ADDED");try{s.removed=!0,this._pc.removeTrack(s)}catch(r){r.name==="NS_ERROR_UNEXPECTED"?this._sendersAwaitingStable.push(s):this.__destroy(O(r,"ERR_REMOVE_TRACK"))}this._needsNegotiation()}removeStream(t){if(!this._destroying){if(this.destroyed)throw O(new Error("cannot removeStream after peer is destroyed"),"ERR_DESTROYED");this._debug("removeSenders()"),t.getTracks().forEach(e=>{this.removeTrack(e,t)})}}_requestMissingTransceivers(){this._pc.getTransceivers&&this._pc.getTransceivers().forEach(t=>{!t.mid&&t.sender.track&&!t.requested&&(t.requested=!0,this.addTransceiver(t.sender.track.kind))})}_onTrack(t){this.destroyed||t.streams.forEach(e=>{this._debug("on track"),this.emit("track",t.track,e),this._remoteTracks.push({track:t.track,stream:e}),!this._remoteStreams.some(i=>i.id===e.id)&&(this._remoteStreams.push(e),queueMicrotask(()=>{this._debug("on stream"),this.emit("stream",e)}))})}}const or="data",ar="signal",lr=(n,t)=>{const e=new wu({iceServers:[{urls:yu}],...t,initiator:n,trickle:!1}),i=r=>s.push(r);let s=[];return e.on(or,i),{id:e._id,created:Date.now(),connection:e._pc,get channel(){return e._channel},get isDead(){return e.destroyed},signal:r=>new Promise(o=>{n||e.on(ar,o),e.signal(r)}),sendData:r=>e.send(r),destroy:()=>e.destroy(),setHandlers:r=>Object.entries(r).forEach(([o,a])=>e.on(o,a)),offerPromise:n?new Promise(r=>e.on(ar,r)):Promise.resolve(),addStream:r=>e.addStream(r),removeStream:r=>e.removeStream(r),addTrack:(r,o)=>e.addTrack(r,o),removeTrack:(r,o)=>e.removeTrack(r,o),replaceTrack:(r,o,a)=>e.replaceTrack(r,o,a),drainEarlyData:r=>{e.off(or,i),s.forEach(r),s=null}}},yu=[...Fe(5,(n,t)=>`stun:stun${t||""}.l.google.com:19302`),"stun:global.stun.twilio.com:3478"],bu=Object.getPrototypeOf(Uint8Array),_n=12,oa=0,mn=oa+_n,wn=mn+1,ke=wn+1,Le=ke+1,Ft=16*2**10-Le,an=255,cr="bufferedamountlow",re=n=>"@_"+n,Eu=(n,t,e)=>{const i={},s={},r={},o={},a={},l={},c={},h={onPeerJoin:qt,onPeerLeave:qt,onPeerStream:qt,onPeerTrack:qt},u=(w,T)=>(w?Array.isArray(w)?w:[w]:Rc(i)).flatMap(x=>{const y=i[x];return y?T(x,y):(console.warn(`${Ue}: no peer with id ${x} found`),[])}),d=w=>{i[w]&&(delete i[w],delete o[w],delete a[w],h.onPeerLeave(w),t(w))},g=w=>{if(s[w])return r[w];if(!w)throw mt("action type argument is required");const T=Kt(w);if(T.byteLength>_n)throw mt(`action type string "${w}" (${T.byteLength}b) exceeds byte limit (${_n}). Hint: choose a shorter name.`);const x=new Uint8Array(_n);x.set(T);let y=0;return s[w]={onComplete:qt,onProgress:qt,setOnComplete:C=>s[w]={...s[w],onComplete:C},setOnProgress:C=>s[w]={...s[w],onProgress:C},send:async(C,I,N,L)=>{if(N&&typeof N!="object")throw mt("action meta argument must be an object");const M=typeof C;if(M==="undefined")throw mt("action data cannot be undefined");const F=M!=="string",V=C instanceof Blob,D=V||C instanceof ArrayBuffer||C instanceof bu;if(N&&!D)throw mt("action meta argument can only be used with binary data");const Y=D?new Uint8Array(V?await C.arrayBuffer():C):Kt(F?Et(C):C),tt=N?Kt(Et(N)):null,W=Math.ceil(Y.byteLength/Ft)+(N?1:0)||1,at=Fe(W,(G,z)=>{const Z=z===W-1,H=N&&z===0,q=new Uint8Array(Le+(H?tt.byteLength:Z?Y.byteLength-Ft*(W-(N?2:1)):Ft));return q.set(x),q.set([y],mn),q.set([Z|H<<1|D<<2|F<<3],wn),q.set([Math.round((z+1)/W*an)],ke),q.set(N?H?tt:Y.subarray((z-1)*Ft,z*Ft):Y.subarray(z*Ft,(z+1)*Ft),Le),q});return y=y+1&an,le(u(I,async(G,z)=>{const{channel:Z}=z;let H=0;for(;H<W;){const q=at[H];if(Z.bufferedAmount>Z.bufferedAmountLowThreshold&&await new Promise(ht=>{const Ut=()=>{Z.removeEventListener(cr,Ut),ht()};Z.addEventListener(cr,Ut)}),!i[G])break;z.sendData(q),H++,L==null||L(q[ke]/an,G,N)}}))}},r[w]||(r[w]=[s[w].send,s[w].setOnComplete,s[w].setOnProgress])},m=(w,T)=>{var W,at;const x=new Uint8Array(T),y=gn(x.subarray(oa,mn)).replaceAll("\0",""),[C]=x.subarray(mn,wn),[I]=x.subarray(wn,ke),[N]=x.subarray(ke,Le),L=x.subarray(Le),M=!!(I&1),F=!!(I&2),V=!!(I&4),D=!!(I&8);if(!s[y]){console.warn(`${Ue}: received message with unregistered type (${y})`);return}o[w]||(o[w]={}),(W=o[w])[y]||(W[y]={});const Y=(at=o[w][y])[C]||(at[C]={chunks:[]});if(F?Y.meta=Nn(gn(L)):Y.chunks.push(L),s[y].onProgress(N/an,w,Y.meta),!M)return;const tt=new Uint8Array(Y.chunks.reduce((G,z)=>G+z.byteLength,0));if(Y.chunks.reduce((G,z)=>(tt.set(z,G),G+z.byteLength),0),delete o[w][y][C],V)s[y].onComplete(tt,w,Y.meta);else{const G=gn(tt);s[y].onComplete(D?Nn(G):G,w)}},f=async()=>{await P(""),await new Promise(w=>setTimeout(w,99)),zs(i).forEach(([w,T])=>{T.destroy(),delete i[w]}),e()},[_,p]=g(re("ping")),[b,S]=g(re("pong")),[E,v]=g(re("signal")),[A,R]=g(re("stream")),[B,U]=g(re("track")),[P,k]=g(re("leave"));return n((w,T)=>{var x;i[T]||(i[T]=w,w.setHandlers({data:y=>m(T,y),stream:y=>{h.onPeerStream(y,T,l[T]),delete l[T]},track:(y,C)=>{h.onPeerTrack(y,C,T,c[T]),delete c[T]},signal:y=>E(y,T),close:()=>d(T),error:()=>d(T)}),h.onPeerJoin(T),(x=w.drainEarlyData)==null||x.call(w,y=>m(T,y)))}),p((w,T)=>b("",T)),S((w,T)=>{var x;(x=a[T])==null||x.call(a),delete a[T]}),v((w,T)=>{var x;return(x=i[T])==null?void 0:x.signal(w)}),R((w,T)=>l[T]=w),U((w,T)=>c[T]=w),k((w,T)=>d(T)),ns&&addEventListener("beforeunload",f),{makeAction:g,leave:f,ping:async w=>{if(!w)throw mt("ping() must be called with target peer ID");const T=Date.now();return _("",w),await new Promise(x=>a[w]=x),Date.now()-T},getPeers:()=>Ic(zs(i).map(([w,T])=>[w,T.connection])),addStream:(w,T,x)=>u(T,async(y,C)=>{x&&await A(x,y),C.addStream(w)}),removeStream:(w,T)=>u(T,(x,y)=>y.removeStream(w)),addTrack:(w,T,x,y)=>u(x,async(C,I)=>{y&&await B(y,C),I.addTrack(w,T)}),removeTrack:(w,T,x)=>u(x,(y,C)=>C.removeTrack(w,T)),replaceTrack:(w,T,x,y,C)=>u(y,async(I,N)=>{C&&await B(C,I),N.replaceTrack(w,T,x)}),onPeerJoin:w=>h.onPeerJoin=w,onPeerLeave:w=>h.onPeerLeave=w,onPeerStream:w=>h.onPeerStream=w,onPeerTrack:w=>h.onPeerTrack=w}},xu=20,Su=5333,hr=57333,Cu=({init:n,subscribe:t,announce:e})=>{const i={};let s=!1,r,o,a;return(l,c,h)=>{var C;const{appId:u}=l;if((C=i[u])!=null&&C[c])return i[u][c];const d={},g={},m=nn(Ue,u,c),f=sn(m),_=sn(nn(m,ae)),p=Oc(l.password||"",u,c),b=I=>async N=>({type:N.type,sdp:await I(p,N.sdp)}),S=b(Uc),E=b(Mc),v=()=>lr(!0,l.rtcConfig),A=(I,N,L)=>{var M;if(g[N]){g[N]!==I&&I.destroy();return}g[N]=I,y(I,N),(M=d[N])==null||M.forEach((F,V)=>{V!==L&&F.destroy()}),delete d[N]},R=(I,N)=>{g[N]===I&&delete g[N]},B=(I,N)=>{var M;if(g[I])return;const L=(M=d[I])==null?void 0:M[N];L&&(delete d[I][N],L.destroy())},U=I=>(o.push(...Fe(I,v)),le(o.splice(0,I).map(N=>N.offerPromise.then(E).then(L=>({peer:N,offer:L}))))),P=(I,N)=>h==null?void 0:h({error:`incorrect password (${l.password}) when decrypting ${N}`,appId:u,peerId:I,roomId:c}),k=I=>async(N,L,M)=>{var at,G,z;const[F,V]=await le([f,_]);if(N!==F&&N!==V)return;const{peerId:D,offer:Y,answer:tt,peer:W}=typeof L=="string"?Nn(L):L;if(!(D===ae||g[D])){if(D&&!Y&&!tt){if((at=d[D])!=null&&at[I])return;const[[{peer:Z,offer:H}],q]=await le([U(1),sn(nn(m,D))]);d[D]||(d[D]=[]),d[D][I]=Z,setTimeout(()=>B(D,I),w[I]*.9),Z.setHandlers({connect:()=>A(Z,D,I),close:()=>R(Z,D)}),M(q,Et({peerId:ae,offer:H}))}else if(Y){if(((G=d[D])==null?void 0:G[I])&&ae>D)return;const H=lr(!1,l.rtcConfig);H.setHandlers({connect:()=>A(H,D,I),close:()=>R(H,D)});let q;try{q=await S(Y)}catch{P(D,"offer");return}if(H.isDead)return;const[ht,Ut]=await le([sn(nn(m,D)),H.signal(q)]);M(ht,Et({peerId:ae,answer:await E(Ut)}))}else if(tt){let Z;try{Z=await S(tt)}catch{P(D,"answer");return}if(W)W.setHandlers({connect:()=>A(W,D,I),close:()=>R(W,D)}),W.signal(Z);else{const H=(z=d[D])==null?void 0:z[I];H&&!H.isDead&&H.signal(Z)}}}};if(!l)throw mt("requires a config map as the first argument");if(!u&&!l.firebaseApp)throw mt("config map is missing appId field");if(!c)throw mt("roomId argument required");if(!s){const I=n(l);o=Fe(xu,v),r=Array.isArray(I)?I:[I],s=!0,a=setInterval(()=>o=o.filter(N=>{const L=Date.now()-N.created<hr;return L||N.destroy(),L}),hr*1.03)}const w=r.map(()=>Su),T=[],x=r.map(async(I,N)=>t(await I,await f,await _,k(N),U));le([f,_]).then(([I,N])=>{const L=async(M,F)=>{const V=await e(M,I,N);typeof V=="number"&&(w[F]=V),T[F]=setTimeout(()=>L(M,F),w[F])};x.forEach(async(M,F)=>{await M,L(await r[F],F)})});let y=qt;return i[u]||(i[u]={}),i[u][c]=Eu(I=>y=I,I=>delete g[I],()=>{delete i[u][c],T.forEach(clearTimeout),x.forEach(async I=>(await I)()),clearInterval(a)})}},Au=5,aa=29333,la="x",ca="EVENT",ha=ns&&es.utils.randomPrivateKey(),Tu=ns&&vi(es.getPublicKey(ha)),ps={},$t={},ua=()=>Math.floor(Date.now()/1e3),ur=async(n,t)=>{const e={kind:aa,content:t,pubkey:Tu,created_at:ua(),tags:[[la,n]]},i=vi(new Uint8Array(await crypto.subtle.digest("SHA-256",Kt(Et([0,e.pubkey,e.created_at,e.kind,e.tags,e.content])))));return Et([ca,{...e,id:i,sig:vi(await es.sign(i,ha))}])},dr=(n,t)=>(ps[n]=t,Et(["REQ",n,{kinds:[aa],since:ua(),["#"+la]:[t]}])),fr=n=>(delete ps[n],Et(["CLOSE",n])),vu=Cu({init:n=>Pc(n,Iu,Au).map(t=>{const e=kc(t,i=>{var l;const[s,r,o,a]=Nn(i);if(s!==ca){const c=`${Ue}: relay failure from ${e.url} - `;s==="NOTICE"?console.warn(c+r):s==="OK"&&!o&&console.warn(c+a);return}(l=$t[r])==null||l.call($t,ps[r],o.content)});return e.ready}),subscribe:(n,t,e,i)=>{const s=Ti(64),r=Ti(64);return $t[s]=$t[r]=(o,a)=>i(o,a,async(l,c)=>n.send(await ur(l,c))),n.send(dr(s,t)),n.send(dr(r,e)),()=>{n.send(fr(s)),n.send(fr(r)),delete $t[s],delete $t[r]}},announce:async(n,t)=>n.send(await ur(t,Et({peerId:ae})))}),Iu=["relay.nostr.net","relay.snort.social","relay.piazza.today","relay.exit.pub","nostr.lu.ke","nostr.mom","relay.urbanzap.space","nostr.data.haus","nostr.sathoarder.com","relay.nostromo.social","relay.nostr.bg","nostr.stakey.net","nostr.vulpem.com","a.nos.lol","eu.purplerelay.com","nostr2.sanhauf.com","e.nos.lol"].map(n=>"wss://"+n);var Qe={},Ru=function(){return typeof Promise=="function"&&Promise.prototype&&Promise.prototype.then},da={},it={};let _s;const Nu=[0,26,44,70,100,134,172,196,242,292,346,404,466,532,581,655,733,815,901,991,1085,1156,1258,1364,1474,1588,1706,1828,1921,2051,2185,2323,2465,2611,2761,2876,3034,3196,3362,3532,3706];it.getSymbolSize=function(t){if(!t)throw new Error('"version" cannot be null or undefined');if(t<1||t>40)throw new Error('"version" should be in range from 1 to 40');return t*4+17};it.getSymbolTotalCodewords=function(t){return Nu[t]};it.getBCHDigit=function(n){let t=0;for(;n!==0;)t++,n>>>=1;return t};it.setToSJISFunction=function(t){if(typeof t!="function")throw new Error('"toSJISFunc" is not a valid function.');_s=t};it.isKanjiModeEnabled=function(){return typeof _s<"u"};it.toSJIS=function(t){return _s(t)};var Gn={};(function(n){n.L={bit:1},n.M={bit:0},n.Q={bit:3},n.H={bit:2};function t(e){if(typeof e!="string")throw new Error("Param is not a string");switch(e.toLowerCase()){case"l":case"low":return n.L;case"m":case"medium":return n.M;case"q":case"quartile":return n.Q;case"h":case"high":return n.H;default:throw new Error("Unknown EC Level: "+e)}}n.isValid=function(i){return i&&typeof i.bit<"u"&&i.bit>=0&&i.bit<4},n.from=function(i,s){if(n.isValid(i))return i;try{return t(i)}catch{return s}}})(Gn);function fa(){this.buffer=[],this.length=0}fa.prototype={get:function(n){const t=Math.floor(n/8);return(this.buffer[t]>>>7-n%8&1)===1},put:function(n,t){for(let e=0;e<t;e++)this.putBit((n>>>t-e-1&1)===1)},getLengthInBits:function(){return this.length},putBit:function(n){const t=Math.floor(this.length/8);this.buffer.length<=t&&this.buffer.push(0),n&&(this.buffer[t]|=128>>>this.length%8),this.length++}};var Bu=fa;function tn(n){if(!n||n<1)throw new Error("BitMatrix size must be defined and greater than 0");this.size=n,this.data=new Uint8Array(n*n),this.reservedBit=new Uint8Array(n*n)}tn.prototype.set=function(n,t,e,i){const s=n*this.size+t;this.data[s]=e,i&&(this.reservedBit[s]=!0)};tn.prototype.get=function(n,t){return this.data[n*this.size+t]};tn.prototype.xor=function(n,t,e){this.data[n*this.size+t]^=e};tn.prototype.isReserved=function(n,t){return this.reservedBit[n*this.size+t]};var Pu=tn,ga={};(function(n){const t=it.getSymbolSize;n.getRowColCoords=function(i){if(i===1)return[];const s=Math.floor(i/7)+2,r=t(i),o=r===145?26:Math.ceil((r-13)/(2*s-2))*2,a=[r-7];for(let l=1;l<s-1;l++)a[l]=a[l-1]-o;return a.push(6),a.reverse()},n.getPositions=function(i){const s=[],r=n.getRowColCoords(i),o=r.length;for(let a=0;a<o;a++)for(let l=0;l<o;l++)a===0&&l===0||a===0&&l===o-1||a===o-1&&l===0||s.push([r[a],r[l]]);return s}})(ga);var pa={};const ku=it.getSymbolSize,gr=7;pa.getPositions=function(t){const e=ku(t);return[[0,0],[e-gr,0],[0,e-gr]]};var _a={};(function(n){n.Patterns={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7};const t={N1:3,N2:3,N3:40,N4:10};n.isValid=function(s){return s!=null&&s!==""&&!isNaN(s)&&s>=0&&s<=7},n.from=function(s){return n.isValid(s)?parseInt(s,10):void 0},n.getPenaltyN1=function(s){const r=s.size;let o=0,a=0,l=0,c=null,h=null;for(let u=0;u<r;u++){a=l=0,c=h=null;for(let d=0;d<r;d++){let g=s.get(u,d);g===c?a++:(a>=5&&(o+=t.N1+(a-5)),c=g,a=1),g=s.get(d,u),g===h?l++:(l>=5&&(o+=t.N1+(l-5)),h=g,l=1)}a>=5&&(o+=t.N1+(a-5)),l>=5&&(o+=t.N1+(l-5))}return o},n.getPenaltyN2=function(s){const r=s.size;let o=0;for(let a=0;a<r-1;a++)for(let l=0;l<r-1;l++){const c=s.get(a,l)+s.get(a,l+1)+s.get(a+1,l)+s.get(a+1,l+1);(c===4||c===0)&&o++}return o*t.N2},n.getPenaltyN3=function(s){const r=s.size;let o=0,a=0,l=0;for(let c=0;c<r;c++){a=l=0;for(let h=0;h<r;h++)a=a<<1&2047|s.get(c,h),h>=10&&(a===1488||a===93)&&o++,l=l<<1&2047|s.get(h,c),h>=10&&(l===1488||l===93)&&o++}return o*t.N3},n.getPenaltyN4=function(s){let r=0;const o=s.data.length;for(let l=0;l<o;l++)r+=s.data[l];return Math.abs(Math.ceil(r*100/o/5)-10)*t.N4};function e(i,s,r){switch(i){case n.Patterns.PATTERN000:return(s+r)%2===0;case n.Patterns.PATTERN001:return s%2===0;case n.Patterns.PATTERN010:return r%3===0;case n.Patterns.PATTERN011:return(s+r)%3===0;case n.Patterns.PATTERN100:return(Math.floor(s/2)+Math.floor(r/3))%2===0;case n.Patterns.PATTERN101:return s*r%2+s*r%3===0;case n.Patterns.PATTERN110:return(s*r%2+s*r%3)%2===0;case n.Patterns.PATTERN111:return(s*r%3+(s+r)%2)%2===0;default:throw new Error("bad maskPattern:"+i)}}n.applyMask=function(s,r){const o=r.size;for(let a=0;a<o;a++)for(let l=0;l<o;l++)r.isReserved(l,a)||r.xor(l,a,e(s,l,a))},n.getBestMask=function(s,r){const o=Object.keys(n.Patterns).length;let a=0,l=1/0;for(let c=0;c<o;c++){r(c),n.applyMask(c,s);const h=n.getPenaltyN1(s)+n.getPenaltyN2(s)+n.getPenaltyN3(s)+n.getPenaltyN4(s);n.applyMask(c,s),h<l&&(l=h,a=c)}return a}})(_a);var Kn={};const vt=Gn,ln=[1,1,1,1,1,1,1,1,1,1,2,2,1,2,2,4,1,2,4,4,2,4,4,4,2,4,6,5,2,4,6,6,2,5,8,8,4,5,8,8,4,5,8,11,4,8,10,11,4,9,12,16,4,9,16,16,6,10,12,18,6,10,17,16,6,11,16,19,6,13,18,21,7,14,21,25,8,16,20,25,8,17,23,25,9,17,23,34,9,18,25,30,10,20,27,32,12,21,29,35,12,23,34,37,12,25,34,40,13,26,35,42,14,28,38,45,15,29,40,48,16,31,43,51,17,33,45,54,18,35,48,57,19,37,51,60,19,38,53,63,20,40,56,66,21,43,59,70,22,45,62,74,24,47,65,77,25,49,68,81],cn=[7,10,13,17,10,16,22,28,15,26,36,44,20,36,52,64,26,48,72,88,36,64,96,112,40,72,108,130,48,88,132,156,60,110,160,192,72,130,192,224,80,150,224,264,96,176,260,308,104,198,288,352,120,216,320,384,132,240,360,432,144,280,408,480,168,308,448,532,180,338,504,588,196,364,546,650,224,416,600,700,224,442,644,750,252,476,690,816,270,504,750,900,300,560,810,960,312,588,870,1050,336,644,952,1110,360,700,1020,1200,390,728,1050,1260,420,784,1140,1350,450,812,1200,1440,480,868,1290,1530,510,924,1350,1620,540,980,1440,1710,570,1036,1530,1800,570,1064,1590,1890,600,1120,1680,1980,630,1204,1770,2100,660,1260,1860,2220,720,1316,1950,2310,750,1372,2040,2430];Kn.getBlocksCount=function(t,e){switch(e){case vt.L:return ln[(t-1)*4+0];case vt.M:return ln[(t-1)*4+1];case vt.Q:return ln[(t-1)*4+2];case vt.H:return ln[(t-1)*4+3];default:return}};Kn.getTotalCodewordsCount=function(t,e){switch(e){case vt.L:return cn[(t-1)*4+0];case vt.M:return cn[(t-1)*4+1];case vt.Q:return cn[(t-1)*4+2];case vt.H:return cn[(t-1)*4+3];default:return}};var ma={},Vn={};const De=new Uint8Array(512),Bn=new Uint8Array(256);(function(){let t=1;for(let e=0;e<255;e++)De[e]=t,Bn[t]=e,t<<=1,t&256&&(t^=285);for(let e=255;e<512;e++)De[e]=De[e-255]})();Vn.log=function(t){if(t<1)throw new Error("log("+t+")");return Bn[t]};Vn.exp=function(t){return De[t]};Vn.mul=function(t,e){return t===0||e===0?0:De[Bn[t]+Bn[e]]};(function(n){const t=Vn;n.mul=function(i,s){const r=new Uint8Array(i.length+s.length-1);for(let o=0;o<i.length;o++)for(let a=0;a<s.length;a++)r[o+a]^=t.mul(i[o],s[a]);return r},n.mod=function(i,s){let r=new Uint8Array(i);for(;r.length-s.length>=0;){const o=r[0];for(let l=0;l<s.length;l++)r[l]^=t.mul(s[l],o);let a=0;for(;a<r.length&&r[a]===0;)a++;r=r.slice(a)}return r},n.generateECPolynomial=function(i){let s=new Uint8Array([1]);for(let r=0;r<i;r++)s=n.mul(s,new Uint8Array([1,t.exp(r)]));return s}})(ma);const wa=ma;function ms(n){this.genPoly=void 0,this.degree=n,this.degree&&this.initialize(this.degree)}ms.prototype.initialize=function(t){this.degree=t,this.genPoly=wa.generateECPolynomial(this.degree)};ms.prototype.encode=function(t){if(!this.genPoly)throw new Error("Encoder not initialized");const e=new Uint8Array(t.length+this.degree);e.set(t);const i=wa.mod(e,this.genPoly),s=this.degree-i.length;if(s>0){const r=new Uint8Array(this.degree);return r.set(i,s),r}return i};var Lu=ms,ya={},Mt={},ws={};ws.isValid=function(t){return!isNaN(t)&&t>=1&&t<=40};var ft={};const ba="[0-9]+",Du="[A-Z $%*+\\-./:]+";let We="(?:[u3000-u303F]|[u3040-u309F]|[u30A0-u30FF]|[uFF00-uFFEF]|[u4E00-u9FAF]|[u2605-u2606]|[u2190-u2195]|u203B|[u2010u2015u2018u2019u2025u2026u201Cu201Du2225u2260]|[u0391-u0451]|[u00A7u00A8u00B1u00B4u00D7u00F7])+";We=We.replace(/u/g,"\\u");const Ou="(?:(?![A-Z0-9 $%*+\\-./:]|"+We+`)(?:.|[\r
]))+`;ft.KANJI=new RegExp(We,"g");ft.BYTE_KANJI=new RegExp("[^A-Z0-9 $%*+\\-./:]+","g");ft.BYTE=new RegExp(Ou,"g");ft.NUMERIC=new RegExp(ba,"g");ft.ALPHANUMERIC=new RegExp(Du,"g");const Mu=new RegExp("^"+We+"$"),Uu=new RegExp("^"+ba+"$"),Fu=new RegExp("^[A-Z0-9 $%*+\\-./:]+$");ft.testKanji=function(t){return Mu.test(t)};ft.testNumeric=function(t){return Uu.test(t)};ft.testAlphanumeric=function(t){return Fu.test(t)};(function(n){const t=ws,e=ft;n.NUMERIC={id:"Numeric",bit:1,ccBits:[10,12,14]},n.ALPHANUMERIC={id:"Alphanumeric",bit:2,ccBits:[9,11,13]},n.BYTE={id:"Byte",bit:4,ccBits:[8,16,16]},n.KANJI={id:"Kanji",bit:8,ccBits:[8,10,12]},n.MIXED={bit:-1},n.getCharCountIndicator=function(r,o){if(!r.ccBits)throw new Error("Invalid mode: "+r);if(!t.isValid(o))throw new Error("Invalid version: "+o);return o>=1&&o<10?r.ccBits[0]:o<27?r.ccBits[1]:r.ccBits[2]},n.getBestModeForData=function(r){return e.testNumeric(r)?n.NUMERIC:e.testAlphanumeric(r)?n.ALPHANUMERIC:e.testKanji(r)?n.KANJI:n.BYTE},n.toString=function(r){if(r&&r.id)return r.id;throw new Error("Invalid mode")},n.isValid=function(r){return r&&r.bit&&r.ccBits};function i(s){if(typeof s!="string")throw new Error("Param is not a string");switch(s.toLowerCase()){case"numeric":return n.NUMERIC;case"alphanumeric":return n.ALPHANUMERIC;case"kanji":return n.KANJI;case"byte":return n.BYTE;default:throw new Error("Unknown mode: "+s)}}n.from=function(r,o){if(n.isValid(r))return r;try{return i(r)}catch{return o}}})(Mt);(function(n){const t=it,e=Kn,i=Gn,s=Mt,r=ws,o=7973,a=t.getBCHDigit(o);function l(d,g,m){for(let f=1;f<=40;f++)if(g<=n.getCapacity(f,m,d))return f}function c(d,g){return s.getCharCountIndicator(d,g)+4}function h(d,g){let m=0;return d.forEach(function(f){const _=c(f.mode,g);m+=_+f.getBitsLength()}),m}function u(d,g){for(let m=1;m<=40;m++)if(h(d,m)<=n.getCapacity(m,g,s.MIXED))return m}n.from=function(g,m){return r.isValid(g)?parseInt(g,10):m},n.getCapacity=function(g,m,f){if(!r.isValid(g))throw new Error("Invalid QR Code version");typeof f>"u"&&(f=s.BYTE);const _=t.getSymbolTotalCodewords(g),p=e.getTotalCodewordsCount(g,m),b=(_-p)*8;if(f===s.MIXED)return b;const S=b-c(f,g);switch(f){case s.NUMERIC:return Math.floor(S/10*3);case s.ALPHANUMERIC:return Math.floor(S/11*2);case s.KANJI:return Math.floor(S/13);case s.BYTE:default:return Math.floor(S/8)}},n.getBestVersionForData=function(g,m){let f;const _=i.from(m,i.M);if(Array.isArray(g)){if(g.length>1)return u(g,_);if(g.length===0)return 1;f=g[0]}else f=g;return l(f.mode,f.getLength(),_)},n.getEncodedBits=function(g){if(!r.isValid(g)||g<7)throw new Error("Invalid QR Code version");let m=g<<12;for(;t.getBCHDigit(m)-a>=0;)m^=o<<t.getBCHDigit(m)-a;return g<<12|m}})(ya);var Ea={};const Li=it,xa=1335,$u=21522,pr=Li.getBCHDigit(xa);Ea.getEncodedBits=function(t,e){const i=t.bit<<3|e;let s=i<<10;for(;Li.getBCHDigit(s)-pr>=0;)s^=xa<<Li.getBCHDigit(s)-pr;return(i<<10|s)^$u};var Sa={};const Hu=Mt;function Ce(n){this.mode=Hu.NUMERIC,this.data=n.toString()}Ce.getBitsLength=function(t){return 10*Math.floor(t/3)+(t%3?t%3*3+1:0)};Ce.prototype.getLength=function(){return this.data.length};Ce.prototype.getBitsLength=function(){return Ce.getBitsLength(this.data.length)};Ce.prototype.write=function(t){let e,i,s;for(e=0;e+3<=this.data.length;e+=3)i=this.data.substr(e,3),s=parseInt(i,10),t.put(s,10);const r=this.data.length-e;r>0&&(i=this.data.substr(e),s=parseInt(i,10),t.put(s,r*3+1))};var qu=Ce;const zu=Mt,hi=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"," ","$","%","*","+","-",".","/",":"];function Ae(n){this.mode=zu.ALPHANUMERIC,this.data=n}Ae.getBitsLength=function(t){return 11*Math.floor(t/2)+6*(t%2)};Ae.prototype.getLength=function(){return this.data.length};Ae.prototype.getBitsLength=function(){return Ae.getBitsLength(this.data.length)};Ae.prototype.write=function(t){let e;for(e=0;e+2<=this.data.length;e+=2){let i=hi.indexOf(this.data[e])*45;i+=hi.indexOf(this.data[e+1]),t.put(i,11)}this.data.length%2&&t.put(hi.indexOf(this.data[e]),6)};var Yu=Ae;const Wu=Mt;function Te(n){this.mode=Wu.BYTE,typeof n=="string"?this.data=new TextEncoder().encode(n):this.data=new Uint8Array(n)}Te.getBitsLength=function(t){return t*8};Te.prototype.getLength=function(){return this.data.length};Te.prototype.getBitsLength=function(){return Te.getBitsLength(this.data.length)};Te.prototype.write=function(n){for(let t=0,e=this.data.length;t<e;t++)n.put(this.data[t],8)};var ju=Te;const Gu=Mt,Ku=it;function ve(n){this.mode=Gu.KANJI,this.data=n}ve.getBitsLength=function(t){return t*13};ve.prototype.getLength=function(){return this.data.length};ve.prototype.getBitsLength=function(){return ve.getBitsLength(this.data.length)};ve.prototype.write=function(n){let t;for(t=0;t<this.data.length;t++){let e=Ku.toSJIS(this.data[t]);if(e>=33088&&e<=40956)e-=33088;else if(e>=57408&&e<=60351)e-=49472;else throw new Error("Invalid SJIS character: "+this.data[t]+`
Make sure your charset is UTF-8`);e=(e>>>8&255)*192+(e&255),n.put(e,13)}};var Vu=ve,Ca={exports:{}};(function(n){var t={single_source_shortest_paths:function(e,i,s){var r={},o={};o[i]=0;var a=t.PriorityQueue.make();a.push(i,0);for(var l,c,h,u,d,g,m,f,_;!a.empty();){l=a.pop(),c=l.value,u=l.cost,d=e[c]||{};for(h in d)d.hasOwnProperty(h)&&(g=d[h],m=u+g,f=o[h],_=typeof o[h]>"u",(_||f>m)&&(o[h]=m,a.push(h,m),r[h]=c))}if(typeof s<"u"&&typeof o[s]>"u"){var p=["Could not find a path from ",i," to ",s,"."].join("");throw new Error(p)}return r},extract_shortest_path_from_predecessor_list:function(e,i){for(var s=[],r=i;r;)s.push(r),e[r],r=e[r];return s.reverse(),s},find_path:function(e,i,s){var r=t.single_source_shortest_paths(e,i,s);return t.extract_shortest_path_from_predecessor_list(r,s)},PriorityQueue:{make:function(e){var i=t.PriorityQueue,s={},r;e=e||{};for(r in i)i.hasOwnProperty(r)&&(s[r]=i[r]);return s.queue=[],s.sorter=e.sorter||i.default_sorter,s},default_sorter:function(e,i){return e.cost-i.cost},push:function(e,i){var s={value:e,cost:i};this.queue.push(s),this.queue.sort(this.sorter)},pop:function(){return this.queue.shift()},empty:function(){return this.queue.length===0}}};n.exports=t})(Ca);var Zu=Ca.exports;(function(n){const t=Mt,e=qu,i=Yu,s=ju,r=Vu,o=ft,a=it,l=Zu;function c(p){return unescape(encodeURIComponent(p)).length}function h(p,b,S){const E=[];let v;for(;(v=p.exec(S))!==null;)E.push({data:v[0],index:v.index,mode:b,length:v[0].length});return E}function u(p){const b=h(o.NUMERIC,t.NUMERIC,p),S=h(o.ALPHANUMERIC,t.ALPHANUMERIC,p);let E,v;return a.isKanjiModeEnabled()?(E=h(o.BYTE,t.BYTE,p),v=h(o.KANJI,t.KANJI,p)):(E=h(o.BYTE_KANJI,t.BYTE,p),v=[]),b.concat(S,E,v).sort(function(R,B){return R.index-B.index}).map(function(R){return{data:R.data,mode:R.mode,length:R.length}})}function d(p,b){switch(b){case t.NUMERIC:return e.getBitsLength(p);case t.ALPHANUMERIC:return i.getBitsLength(p);case t.KANJI:return r.getBitsLength(p);case t.BYTE:return s.getBitsLength(p)}}function g(p){return p.reduce(function(b,S){const E=b.length-1>=0?b[b.length-1]:null;return E&&E.mode===S.mode?(b[b.length-1].data+=S.data,b):(b.push(S),b)},[])}function m(p){const b=[];for(let S=0;S<p.length;S++){const E=p[S];switch(E.mode){case t.NUMERIC:b.push([E,{data:E.data,mode:t.ALPHANUMERIC,length:E.length},{data:E.data,mode:t.BYTE,length:E.length}]);break;case t.ALPHANUMERIC:b.push([E,{data:E.data,mode:t.BYTE,length:E.length}]);break;case t.KANJI:b.push([E,{data:E.data,mode:t.BYTE,length:c(E.data)}]);break;case t.BYTE:b.push([{data:E.data,mode:t.BYTE,length:c(E.data)}])}}return b}function f(p,b){const S={},E={start:{}};let v=["start"];for(let A=0;A<p.length;A++){const R=p[A],B=[];for(let U=0;U<R.length;U++){const P=R[U],k=""+A+U;B.push(k),S[k]={node:P,lastCount:0},E[k]={};for(let w=0;w<v.length;w++){const T=v[w];S[T]&&S[T].node.mode===P.mode?(E[T][k]=d(S[T].lastCount+P.length,P.mode)-d(S[T].lastCount,P.mode),S[T].lastCount+=P.length):(S[T]&&(S[T].lastCount=P.length),E[T][k]=d(P.length,P.mode)+4+t.getCharCountIndicator(P.mode,b))}}v=B}for(let A=0;A<v.length;A++)E[v[A]].end=0;return{map:E,table:S}}function _(p,b){let S;const E=t.getBestModeForData(p);if(S=t.from(b,E),S!==t.BYTE&&S.bit<E.bit)throw new Error('"'+p+'" cannot be encoded with mode '+t.toString(S)+`.
 Suggested mode is: `+t.toString(E));switch(S===t.KANJI&&!a.isKanjiModeEnabled()&&(S=t.BYTE),S){case t.NUMERIC:return new e(p);case t.ALPHANUMERIC:return new i(p);case t.KANJI:return new r(p);case t.BYTE:return new s(p)}}n.fromArray=function(b){return b.reduce(function(S,E){return typeof E=="string"?S.push(_(E,null)):E.data&&S.push(_(E.data,E.mode)),S},[])},n.fromString=function(b,S){const E=u(b,a.isKanjiModeEnabled()),v=m(E),A=f(v,S),R=l.find_path(A.map,"start","end"),B=[];for(let U=1;U<R.length-1;U++)B.push(A.table[R[U]].node);return n.fromArray(g(B))},n.rawSplit=function(b){return n.fromArray(u(b,a.isKanjiModeEnabled()))}})(Sa);const Zn=it,ui=Gn,Ju=Bu,Xu=Pu,Qu=ga,td=pa,Di=_a,Oi=Kn,ed=Lu,Pn=ya,nd=Ea,id=Mt,di=Sa;function sd(n,t){const e=n.size,i=td.getPositions(t);for(let s=0;s<i.length;s++){const r=i[s][0],o=i[s][1];for(let a=-1;a<=7;a++)if(!(r+a<=-1||e<=r+a))for(let l=-1;l<=7;l++)o+l<=-1||e<=o+l||(a>=0&&a<=6&&(l===0||l===6)||l>=0&&l<=6&&(a===0||a===6)||a>=2&&a<=4&&l>=2&&l<=4?n.set(r+a,o+l,!0,!0):n.set(r+a,o+l,!1,!0))}}function rd(n){const t=n.size;for(let e=8;e<t-8;e++){const i=e%2===0;n.set(e,6,i,!0),n.set(6,e,i,!0)}}function od(n,t){const e=Qu.getPositions(t);for(let i=0;i<e.length;i++){const s=e[i][0],r=e[i][1];for(let o=-2;o<=2;o++)for(let a=-2;a<=2;a++)o===-2||o===2||a===-2||a===2||o===0&&a===0?n.set(s+o,r+a,!0,!0):n.set(s+o,r+a,!1,!0)}}function ad(n,t){const e=n.size,i=Pn.getEncodedBits(t);let s,r,o;for(let a=0;a<18;a++)s=Math.floor(a/3),r=a%3+e-8-3,o=(i>>a&1)===1,n.set(s,r,o,!0),n.set(r,s,o,!0)}function fi(n,t,e){const i=n.size,s=nd.getEncodedBits(t,e);let r,o;for(r=0;r<15;r++)o=(s>>r&1)===1,r<6?n.set(r,8,o,!0):r<8?n.set(r+1,8,o,!0):n.set(i-15+r,8,o,!0),r<8?n.set(8,i-r-1,o,!0):r<9?n.set(8,15-r-1+1,o,!0):n.set(8,15-r-1,o,!0);n.set(i-8,8,1,!0)}function ld(n,t){const e=n.size;let i=-1,s=e-1,r=7,o=0;for(let a=e-1;a>0;a-=2)for(a===6&&a--;;){for(let l=0;l<2;l++)if(!n.isReserved(s,a-l)){let c=!1;o<t.length&&(c=(t[o]>>>r&1)===1),n.set(s,a-l,c),r--,r===-1&&(o++,r=7)}if(s+=i,s<0||e<=s){s-=i,i=-i;break}}}function cd(n,t,e){const i=new Ju;e.forEach(function(l){i.put(l.mode.bit,4),i.put(l.getLength(),id.getCharCountIndicator(l.mode,n)),l.write(i)});const s=Zn.getSymbolTotalCodewords(n),r=Oi.getTotalCodewordsCount(n,t),o=(s-r)*8;for(i.getLengthInBits()+4<=o&&i.put(0,4);i.getLengthInBits()%8!==0;)i.putBit(0);const a=(o-i.getLengthInBits())/8;for(let l=0;l<a;l++)i.put(l%2?17:236,8);return hd(i,n,t)}function hd(n,t,e){const i=Zn.getSymbolTotalCodewords(t),s=Oi.getTotalCodewordsCount(t,e),r=i-s,o=Oi.getBlocksCount(t,e),a=i%o,l=o-a,c=Math.floor(i/o),h=Math.floor(r/o),u=h+1,d=c-h,g=new ed(d);let m=0;const f=new Array(o),_=new Array(o);let p=0;const b=new Uint8Array(n.buffer);for(let R=0;R<o;R++){const B=R<l?h:u;f[R]=b.slice(m,m+B),_[R]=g.encode(f[R]),m+=B,p=Math.max(p,B)}const S=new Uint8Array(i);let E=0,v,A;for(v=0;v<p;v++)for(A=0;A<o;A++)v<f[A].length&&(S[E++]=f[A][v]);for(v=0;v<d;v++)for(A=0;A<o;A++)S[E++]=_[A][v];return S}function ud(n,t,e,i){let s;if(Array.isArray(n))s=di.fromArray(n);else if(typeof n=="string"){let c=t;if(!c){const h=di.rawSplit(n);c=Pn.getBestVersionForData(h,e)}s=di.fromString(n,c||40)}else throw new Error("Invalid data");const r=Pn.getBestVersionForData(s,e);if(!r)throw new Error("The amount of data is too big to be stored in a QR Code");if(!t)t=r;else if(t<r)throw new Error(`
The chosen QR Code version cannot contain this amount of data.
Minimum version required to store current data is: `+r+`.
`);const o=cd(t,e,s),a=Zn.getSymbolSize(t),l=new Xu(a);return sd(l,t),rd(l),od(l,t),fi(l,e,0),t>=7&&ad(l,t),ld(l,o),isNaN(i)&&(i=Di.getBestMask(l,fi.bind(null,l,e))),Di.applyMask(i,l),fi(l,e,i),{modules:l,version:t,errorCorrectionLevel:e,maskPattern:i,segments:s}}da.create=function(t,e){if(typeof t>"u"||t==="")throw new Error("No input text");let i=ui.M,s,r;return typeof e<"u"&&(i=ui.from(e.errorCorrectionLevel,ui.M),s=Pn.from(e.version),r=Di.from(e.maskPattern),e.toSJISFunc&&Zn.setToSJISFunction(e.toSJISFunc)),ud(t,s,i,r)};var Aa={},ys={};(function(n){function t(e){if(typeof e=="number"&&(e=e.toString()),typeof e!="string")throw new Error("Color should be defined as hex string");let i=e.slice().replace("#","").split("");if(i.length<3||i.length===5||i.length>8)throw new Error("Invalid hex color: "+e);(i.length===3||i.length===4)&&(i=Array.prototype.concat.apply([],i.map(function(r){return[r,r]}))),i.length===6&&i.push("F","F");const s=parseInt(i.join(""),16);return{r:s>>24&255,g:s>>16&255,b:s>>8&255,a:s&255,hex:"#"+i.slice(0,6).join("")}}n.getOptions=function(i){i||(i={}),i.color||(i.color={});const s=typeof i.margin>"u"||i.margin===null||i.margin<0?4:i.margin,r=i.width&&i.width>=21?i.width:void 0,o=i.scale||4;return{width:r,scale:r?4:o,margin:s,color:{dark:t(i.color.dark||"#000000ff"),light:t(i.color.light||"#ffffffff")},type:i.type,rendererOpts:i.rendererOpts||{}}},n.getScale=function(i,s){return s.width&&s.width>=i+s.margin*2?s.width/(i+s.margin*2):s.scale},n.getImageWidth=function(i,s){const r=n.getScale(i,s);return Math.floor((i+s.margin*2)*r)},n.qrToImageData=function(i,s,r){const o=s.modules.size,a=s.modules.data,l=n.getScale(o,r),c=Math.floor((o+r.margin*2)*l),h=r.margin*l,u=[r.color.light,r.color.dark];for(let d=0;d<c;d++)for(let g=0;g<c;g++){let m=(d*c+g)*4,f=r.color.light;if(d>=h&&g>=h&&d<c-h&&g<c-h){const _=Math.floor((d-h)/l),p=Math.floor((g-h)/l);f=u[a[_*o+p]?1:0]}i[m++]=f.r,i[m++]=f.g,i[m++]=f.b,i[m]=f.a}}})(ys);(function(n){const t=ys;function e(s,r,o){s.clearRect(0,0,r.width,r.height),r.style||(r.style={}),r.height=o,r.width=o,r.style.height=o+"px",r.style.width=o+"px"}function i(){try{return document.createElement("canvas")}catch{throw new Error("You need to specify a canvas element")}}n.render=function(r,o,a){let l=a,c=o;typeof l>"u"&&(!o||!o.getContext)&&(l=o,o=void 0),o||(c=i()),l=t.getOptions(l);const h=t.getImageWidth(r.modules.size,l),u=c.getContext("2d"),d=u.createImageData(h,h);return t.qrToImageData(d.data,r,l),e(u,c,h),u.putImageData(d,0,0),c},n.renderToDataURL=function(r,o,a){let l=a;typeof l>"u"&&(!o||!o.getContext)&&(l=o,o=void 0),l||(l={});const c=n.render(r,o,l),h=l.type||"image/png",u=l.rendererOpts||{};return c.toDataURL(h,u.quality)}})(Aa);var Ta={};const dd=ys;function _r(n,t){const e=n.a/255,i=t+'="'+n.hex+'"';return e<1?i+" "+t+'-opacity="'+e.toFixed(2).slice(1)+'"':i}function gi(n,t,e){let i=n+t;return typeof e<"u"&&(i+=" "+e),i}function fd(n,t,e){let i="",s=0,r=!1,o=0;for(let a=0;a<n.length;a++){const l=Math.floor(a%t),c=Math.floor(a/t);!l&&!r&&(r=!0),n[a]?(o++,a>0&&l>0&&n[a-1]||(i+=r?gi("M",l+e,.5+c+e):gi("m",s,0),s=0,r=!1),l+1<t&&n[a+1]||(i+=gi("h",o),o=0)):s++}return i}Ta.render=function(t,e,i){const s=dd.getOptions(e),r=t.modules.size,o=t.modules.data,a=r+s.margin*2,l=s.color.light.a?"<path "+_r(s.color.light,"fill")+' d="M0 0h'+a+"v"+a+'H0z"/>':"",c="<path "+_r(s.color.dark,"stroke")+' d="'+fd(o,r,s.margin)+'"/>',h='viewBox="0 0 '+a+" "+a+'"',d='<svg xmlns="http://www.w3.org/2000/svg" '+(s.width?'width="'+s.width+'" height="'+s.width+'" ':"")+h+' shape-rendering="crispEdges">'+l+c+`</svg>
`;return typeof i=="function"&&i(null,d),d};const gd=Ru,Mi=da,va=Aa,pd=Ta;function bs(n,t,e,i,s){const r=[].slice.call(arguments,1),o=r.length,a=typeof r[o-1]=="function";if(!a&&!gd())throw new Error("Callback required as last argument");if(a){if(o<2)throw new Error("Too few arguments provided");o===2?(s=e,e=t,t=i=void 0):o===3&&(t.getContext&&typeof s>"u"?(s=i,i=void 0):(s=i,i=e,e=t,t=void 0))}else{if(o<1)throw new Error("Too few arguments provided");return o===1?(e=t,t=i=void 0):o===2&&!t.getContext&&(i=e,e=t,t=void 0),new Promise(function(l,c){try{const h=Mi.create(e,i);l(n(h,t,i))}catch(h){c(h)}})}try{const l=Mi.create(e,i);s(null,n(l,t,i))}catch(l){s(l)}}Qe.create=Mi.create;Qe.toCanvas=bs.bind(null,va.render);Qe.toDataURL=bs.bind(null,va.renderToDataURL);Qe.toString=bs.bind(null,function(n,t,e){return pd.render(n,e)});const _d="/gifshooter/assets/01.28-D_5FERI8.png",md="/gifshooter/assets/05.36-_eu3nG-w.png",wd="/gifshooter/assets/06.36-D3z7LYyo.png",yd="/gifshooter/assets/07.47-DsOIyi-K.png",bd="/gifshooter/assets/08.39-CNuNs_2G.png",Ed="/gifshooter/assets/09.41-CKuFrfe7.png",xd="/gifshooter/assets/10.39-CrAvx7-w.png",Sd="/gifshooter/assets/11.39-BW9zh7wN.png",Cd="/gifshooter/assets/12.20-CAw2TaEM.png",Ad="/gifshooter/assets/13.20-BPVeinxW.png",Td="/gifshooter/assets/14.20-DkzKJ_7Y.png",vd="/gifshooter/assets/15.72-BoZDKdHb.png",Id="/gifshooter/assets/16.12-DS5LuWek.png",Rd="/gifshooter/assets/17.36-DsyJH88H.png",Nd="/gifshooter/assets/18.27-CwnGWTS2.png",Bd="/gifshooter/assets/19.65-Pj4urRsn.png",Pd="/gifshooter/assets/20.28-BM0OmUHP.png",kd="/gifshooter/assets/21.113-BrCgOvVW.png",Ld="/gifshooter/assets/22.45-DaoYFX6r.png",Dd="/gifshooter/assets/23.11-DWDKVGwL.png",Od="/gifshooter/assets/24.125-zARE9kV6.png",Md="/gifshooter/assets/25.120-DfooVmdR.png",Ud="/gifshooter/assets/26.73-5rTYzTh5.png",Fd="/gifshooter/assets/27.121-DxQwWftk.png",$d="/gifshooter/assets/28.31-Dx2fKfsy.png",Hd="/gifshooter/assets/29.123-b5iwxTxq.png",qd="/gifshooter/assets/30.29-Dnv3f22k.png",zd="/gifshooter/assets/31.90-ZB3oXSRJ.png",Yd="/gifshooter/assets/32.147-KdGRWNAE.png",Wd="/gifshooter/assets/32.17-Bwo-nrFe.png",jd="/gifshooter/assets/logo-BQwxMYjs.gif";let{init:mr,Sprite:Gd,SpriteSheet:Kd,keyPressed:Vd,GameLoop:wr,initKeys:Zd,pointerPressed:Jd,onInput:pf,initPointer:Xd,getPointer:Qd}=Dl,ce=[];const Ia=new URLSearchParams(window.location.search);let Dt=Ia.get("room")||"notinitialized";console.log(Dt);let yn=Ia.get("present")=="true";var tf=document.getElementById("qr");Qe.toCanvas(tf,window.location.href.split("?")[0]+`?${Dt}`,function(n){n&&console.error(n),console.log("success!")});const ef=()=>(window.open(window.location.href.split("?")[0],"_self"),!1),nf=()=>(Dt=document.getElementById("room").value,yn=document.getElementById("present").checked,console.log(yn),window.open(window.location.href.split("?")[0]+`?room=${Dt}&present=${yn}`,"_self"),!1);let kn=0;const sf={appId:"gifshootah"},Ie=vu(sf,Dt);Ie.onPeerJoin(n=>{kn+=1,document.getElementById("online").textContent=`${kn} peers`});Ie.onPeerLeave(n=>{kn-=1,document.getElementById("online").textContent=`${kn} peers`});const[yr,rf]=Ie.makeAction("shoot");rf((n,t)=>{ce.push(n)});Dt&&Dt!="notinitialized"?(document.getElementById("setting").style.display="none",document.getElementById("home").style.display="block",document.getElementById("home").onclick=ef):document.getElementById("go").onclick=nf;const hn={};let un=0;const pi=[];document.getElementById("logo").src=jd;const At=[_d,md,wd,yd,bd,Ed,xd,Sd,Cd,Ad,Td,vd,Id,Rd,Nd,Bd,Pd,kd,Ld,Dd,Od,Md,Ud,Fd,$d,Hd,qd,zd,Yd,Wd];let pt=Object.keys(Ie.getPeers()).length%At.length;const of=n=>{var t=n.split("."),e=parseInt(t[t.length-2]);return new Promise(function(i,s){if(hn[n])return i(hn[n]);{let r=new Image;r.src=n,r.onload=function(){let o=Kd({image:r,frameWidth:r.width/e,frameHeight:r.height,animations:{walk:{frames:`0..${e-1}`,frameRate:15}}});return hn[n]=o,i(hn[n])}}})};let It={};const br=async(n,t)=>{if(It[n]&&It[n].url==t)return It[n].sprite;let e=await of(t),i=Gd({x:-1e3,y:-1e3,dx:0,dy:0,ddx:0,ddy:0,anchor:{x:.5,y:.5},animations:e.animations});return It[n]={url:t,sprite:i},i};if(yn){let{canvas:n,context:t}=mr("game");Xd(),Zd();let e=document.getElementById("qr");e.style.display="block",n.width=window.innerWidth,n.height=window.innerHeight;for(let r=0;r<120;r++){const o=new OffscreenCanvas(n.width,n.height);pi.push(o)}let i=0;wr({clearCanvas:!0,update:function(){if(ce.length){const r=ce[0];ce=ce.slice(1),i=At.length,br(r.peerId,At[r.spriteUrlIndex]).then(o=>{console.log("raw",r),o.x=r.x*-1*t.canvas.width+t.canvas.width/2,o.y=r.y*-1*t.canvas.height+t.canvas.height/2,console.log(o.x,o.y)})}if(Vd("enter")&&(pt=(pt+1)%At.length),Jd("left")){let r=Qd();const o={spriteUrlIndex:pt,peerId:Ie.selfId,x:r.x/t.canvas.width,y:r.ycontext.canvas.height};yr(o),ce.push(o)}for(let r of Object.keys(It))It[r].sprite.update()},render:function(){un++,un=un%pi.length;let r=pi[un];if(i>0){let o=r.getContext("2d");o.globalAlpha=.01,o.fillRect(0,0,r.width,r.height),o.globalAlpha=1,i-=1}t.drawImage(r,0,0);for(let o of Object.keys(It))It[o].sprite.render();r.getContext("2d").drawImage(n,0,0)}}).start()}else if(Dt!="notinitialized"){document.getElementById("phone").style.display="block";let n,t;document.getElementById("reset").onclick=()=>{n=null,t=null};let e,{canvasShoot:i,contextShoot:s}=mr("shootbutton"),r=document.getElementById("shootbutton"),o=document.getElementById("expand");r.width=o.clientWidth,r.height=o.clientHeight,console.log(i,s,"canvas"),document.getElementById("nextgif").onclick=()=>{pt=(pt+1)%At.length},document.getElementById("previousgif").onclick=()=>{pt=(pt+At.length-1)%At.length};let a=!1;r.ontouchstart=()=>{noSleep.enable(),a=!0},r.ontouchend=()=>{a=!1},window.addEventListener("deviceorientation",async c=>{n||(n=c.alpha,t=c.beta);var h=c.alpha-n,u=c.beta-t;if(h<-180&&(h=-180),h>180&&(h=180),u<-90&&(u=-90),u>90&&(u=90),h=h/180,u=u/90,a){const d={spriteUrlIndex:pt,peerId:Ie.selfId,x:h,alpha:c.alpha,y:u,beta:c.beta};console.log(d),yr(d)}}),wr({clearCanvas:!0,update:function(){br("preview",At[pt]).then(c=>{c.x=r.width/3+r.width/6,c.y=r.height/2,c.width=o.clientWidth/2,c.height=o.clientHeight/2,e=c}),e&&e.update()},render:function(){e&&e.render()}}).start()}
