var ko=Object.defineProperty;var Oo=(n,t,e)=>t in n?ko(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var Hi=(n,t,e)=>Oo(n,typeof t!="symbol"?t+"":t,e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function e(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(s){if(s.ep)return;s.ep=!0;const r=e(s);fetch(s.href,r)}})();/**
 * @preserve
 * Kontra.js v10.0.2
 */function Po(n){return n*Math.PI/180}function Do(n){return n*180/Math.PI}function Lo(n,t){return Math.atan2(t.y-n.y,t.x-n.x)}function Fs(n,t){let e=Math.sin(t),i=Math.cos(t);return{x:n.x*i-n.y*e,y:n.x*e+n.y*i}}function Bo(n,t,e){return{x:n.x+Math.cos(t)*e,y:n.y+Math.sin(t)*e}}function Mo(n,t,e){return n*(1-e)+t*e}function Uo(n,t,e){return(e-n)/(t-n)}function ce(n,t,e){return Math.min(Math.max(n,e),t)}function Fo(n,t){t==null?localStorage.removeItem(n):localStorage.setItem(n,JSON.stringify(t))}function $o(n){let t=localStorage.getItem(n);try{t=JSON.parse(t)}catch{}return t}function $s(n,t){let e=ue(n),i=ue(t);return n.radius&&e.width!=e.height||t.radius&&i.width!=i.height?!1:([e,i]=[e,i].map(s=>((s==e?n:t).radius&&(s.radius=s.width/2,s.x+=s.radius,s.y+=s.radius),s)),n.radius&&t.radius?Math.hypot(e.x-i.x,e.y-i.y)<e.radius+i.radius:n.radius||t.radius?qs(n.radius?e:i,n.radius?t:n):e.x<i.x+i.width&&e.x+e.width>i.x&&e.y<i.y+i.height&&e.y+e.height>i.y)}function ue(n){let{x:t=0,y:e=0,width:i,height:s,radius:r}=n.world||n;return n.mapwidth&&(i=n.mapwidth,s=n.mapheight),r&&(i=r.x*2,s=r.y*2),n.anchor&&(t-=i*n.anchor.x,e-=s*n.anchor.y),i<0&&(t+=i,i*=-1),s<0&&(e+=s,s*=-1),{x:t,y:e,width:i,height:s}}function Ho(n,t,e="y"){return[n,t]=[n,t].map(ue),n[e]-t[e]}let Yt=()=>{},Hs="position:absolute;width:1px;height:1px;overflow:hidden;clip:rect(0,0,0,0);",jn={preventScroll:!0};function Gn(n,t){let e=t.parentNode;n.setAttribute("data-kontra",""),e?([...e.querySelectorAll(":scope > [data-kontra]")].pop()||t).after(n):t.nodeName=="CANVAS"?document.body.append(n):t.append(n)}function de(n,t){let e=n.indexOf(t);if(e!=-1)return n.splice(e,1),!0}function qs(n,t){let{x:e,y:i,width:s,height:r}=ue(t);do e-=t.sx||0,i-=t.sy||0;while(t=t.parent);let o=n.x-Math.max(e,Math.min(n.x,e+s)),a=n.y-Math.max(i,Math.min(n.y,i+r));return o*o+a*a<n.radius*n.radius}let re={};function ut(n,t){re[n]=re[n]||[],re[n].push(t)}function Ws(n,t){re[n]=(re[n]||[]).filter(e=>e!=t)}function Rt(n,...t){(re[n]||[]).map(e=>e(...t))}let Lt,Xe,qi={get(n,t){return t=="_proxy"?!0:Yt}};function at(){return Lt}function rt(){return Xe}function qo(n,{contextless:t=!1}={}){if(Lt=document.getElementById(n)||n||document.querySelector("canvas"),t&&(Lt=Lt||new Proxy({},qi)),!Lt)throw Error("You must provide a canvas element for the game");return Xe=Lt.getContext("2d")||new Proxy({},qi),Xe.imageSmoothingEnabled=!1,Rt("init"),{canvas:Lt,context:Xe}}class yn{constructor({spriteSheet:t,frames:e,frameRate:i,loop:s=!0,name:r}){let{width:o,height:a,spacing:c=0,margin:l=0}=t.frame;Object.assign(this,{spriteSheet:t,frames:e,frameRate:i,loop:s,name:r,width:o,height:a,spacing:c,margin:l,isStopped:!1,_f:0,_a:0})}clone(){return new yn(this)}start(){this.isStopped=!1,this.loop||this.reset()}stop(){this.isStopped=!0}reset(){this._f=0,this._a=0}update(t=1/60){if(!this.isStopped){if(!this.loop&&this._f==this.frames.length-1){this.stop();return}for(this._a+=t;this._a*this.frameRate>=1;)this._f=++this._f%this.frames.length,this._a-=1/this.frameRate}}render({x:t,y:e,width:i=this.width,height:s=this.height,context:r=rt()}){let o=this.frames[this._f]/this.spriteSheet._f|0,a=this.frames[this._f]%this.spriteSheet._f|0;r.drawImage(this.spriteSheet.image,this.margin+a*this.width+(a*2+1)*this.spacing,this.margin+o*this.height+(o*2+1)*this.spacing,this.width,this.height,t,e,i,s)}}function Ys(){return new yn(...arguments)}let Wo=/(jpeg|jpg|gif|png|webp)$/,Yo=/(wav|mp3|ogg|aac)$/,js=/^\//,jo=/\/$/,Gs=new WeakMap,zs="",Ks="",Vs="";function wn(n,t){return new URL(n,t).href}function hi(n,t){return[n.replace(jo,""),n?t.replace(js,""):t].filter(e=>e).join("/")}function ci(n){return n.split(".").pop()}function ui(n){let t=n.replace("."+ci(n),"");return t.split("/").length==2?t.replace(js,""):t}function Go(n){return{wav:n.canPlayType('audio/wav; codecs="1"'),mp3:n.canPlayType("audio/mpeg;"),ogg:n.canPlayType('audio/ogg; codecs="vorbis"'),aac:n.canPlayType("audio/aac;")}}let Ut={},ne={},Ft={};function di(){window.__k||(window.__k={dm:Gs,u:wn,d:Ft,i:Ut})}function zo(n){zs=n}function Ko(n){Ks=n}function Vo(n){Vs=n}function Xs(n){return di(),new Promise((t,e)=>{let i,s,r;if(i=hi(zs,n),Ut[i])return t(Ut[i]);s=new Image,s.onload=function(){r=wn(i,window.location.href),Ut[ui(n)]=Ut[i]=Ut[r]=this,Rt("assetLoaded",this,n),t(this)},s.onerror=function(){e("Unable to load image "+i)},s.src=i})}function Zs(n){return new Promise((t,e)=>{let i=n,s,r,o,a;if(s=new Audio,r=Go(s),n=[].concat(n).reduce((c,l)=>c||(r[ci(l)]?l:null),0),!n)return e("cannot play any of the audio formats provided "+i);if(o=hi(Ks,n),ne[o])return t(ne[o]);s.addEventListener("canplay",function(){a=wn(o,window.location.href),ne[ui(n)]=ne[o]=ne[a]=this,Rt("assetLoaded",this,n),t(this)}),s.onerror=function(){e("Unable to load audio "+o)},s.src=o,s.load()})}function Js(n){di();let t,e;return t=hi(Vs,n),Ft[t]?Promise.resolve(Ft[t]):fetch(t).then(i=>{if(!i.ok)throw i;return i.clone().json().catch(()=>i.text())}).then(i=>(e=wn(t,window.location.href),typeof i=="object"&&Gs.set(i,e),Ft[ui(n)]=Ft[t]=Ft[e]=i,Rt("assetLoaded",i,n),i))}function Xo(...n){return di(),Promise.all(n.map(t=>{let e=ci([].concat(t)[0]);return e.match(Wo)?Xs(t):e.match(Yo)?Zs(t):Js(t)}))}class Ht{constructor(t=0,e=0,i={}){t.x!=null?(this.x=t.x,this.y=t.y):(this.x=t,this.y=e),i._c&&(this.clamp(i._a,i._b,i._d,i._e),this.x=t,this.y=e)}set(t){this.x=t.x,this.y=t.y}add(t){return new Ht(this.x+t.x,this.y+t.y,this)}subtract(t){return new Ht(this.x-t.x,this.y-t.y,this)}scale(t){return new Ht(this.x*t,this.y*t)}normalize(t=this.length()||1){return new Ht(this.x/t,this.y/t)}dot(t){return this.x*t.x+this.y*t.y}length(){return Math.hypot(this.x,this.y)}distance(t){return Math.hypot(this.x-t.x,this.y-t.y)}angle(t){return Math.acos(this.dot(t)/(this.length()*t.length()))}direction(){return Math.atan2(this.y,this.x)}clamp(t,e,i,s){this._c=!0,this._a=t,this._b=e,this._d=i,this._e=s}get x(){return this._x}get y(){return this._y}set x(t){this._x=this._c?ce(this._a,this._d,t):t}set y(t){this._y=this._c?ce(this._b,this._e,t):t}}function Ze(){return new Ht(...arguments)}class Zo{constructor(t){return this.init(t)}init(t={}){this.position=Ze(),this.velocity=Ze(),this.acceleration=Ze(),this.ttl=1/0,Object.assign(this,t)}update(t){this.advance(t)}advance(t){let e=this.acceleration;t&&(e=e.scale(t)),this.velocity=this.velocity.add(e);let i=this.velocity;t&&(i=i.scale(t)),this.position=this.position.add(i),this._pc(),this.ttl--}get dx(){return this.velocity.x}get dy(){return this.velocity.y}set dx(t){this.velocity.x=t}set dy(t){this.velocity.y=t}get ddx(){return this.acceleration.x}get ddy(){return this.acceleration.y}set ddx(t){this.acceleration.x=t}set ddy(t){this.acceleration.y=t}isAlive(){return this.ttl>0}_pc(){}}class we extends Zo{init({width:t=0,height:e=0,context:i=rt(),render:s=this.draw,update:r=this.advance,children:o=[],anchor:a={x:0,y:0},opacity:c=1,rotation:l=0,drotation:h=0,ddrotation:u=0,scaleX:d=1,scaleY:m=1,...x}={}){this._c=[],super.init({width:t,height:e,context:i,anchor:a,opacity:c,rotation:l,drotation:h,ddrotation:u,scaleX:d,scaleY:m,...x}),this._di=!0,this._uw(),this.addChild(o),this._rf=s,this._uf=r,ut("init",()=>{this.context??(this.context=rt())})}update(t){this._uf(t),this.children.map(e=>e.update&&e.update(t))}render(){let t=this.context;t.save(),(this.x||this.y)&&t.translate(this.x,this.y),this.rotation&&t.rotate(this.rotation),(this.scaleX!=1||this.scaleY!=1)&&t.scale(this.scaleX,this.scaleY);let e=this.width,i=this.height;this.radius&&(e=i=this.radius*2);let s=-e*this.anchor.x,r=-i*this.anchor.y;(s||r)&&t.translate(s,r),this.context.globalAlpha=this.opacity,this._rf(),(s||r)&&t.translate(-s,-r),this.children.map(a=>a.render&&a.render()),t.restore()}draw(){}_pc(){this._uw(),this.children.map(t=>t._pc())}get x(){return this.position.x}get y(){return this.position.y}set x(t){this.position.x=t,this._pc()}set y(t){this.position.y=t,this._pc()}get width(){return this._w}set width(t){this._w=t,this._pc()}get height(){return this._h}set height(t){this._h=t,this._pc()}_uw(){if(!this._di)return;let{_wx:t=0,_wy:e=0,_wo:i=1,_wrot:s=0,_wsx:r=1,_wsy:o=1}=this.parent||{};this._wx=this.x,this._wy=this.y,this._ww=this.width,this._wh=this.height,this.radius&&(this._wrx=this.radius,this._wry=this.radius),this._wo=i*this.opacity,this._wsx=r*this.scaleX,this._wsy=o*this.scaleY,this._wx=this._wx*r,this._wy=this._wy*o,this._ww=this.width*this._wsx,this._wh=this.height*this._wsy,this.radius&&(this._wrx=this.radius*this._wsx,this._wry=this.radius*this._wsy),this._wrot=s+this.rotation;let{x:a,y:c}=Fs({x:this._wx,y:this._wy},s);this._wx=a,this._wy=c,this._wx+=t,this._wy+=e}get world(){return{x:this._wx,y:this._wy,width:this._ww,height:this._wh,radius:this.radius?{x:this._wrx,y:this._wry}:void 0,opacity:this._wo,rotation:this._wrot,scaleX:this._wsx,scaleY:this._wsy}}set children(t){this.removeChild(this._c),this.addChild(t)}get children(){return this._c}addChild(...t){t.flat().map(e=>{this.children.push(e),e.parent=this,e._pc=e._pc||Yt,e._pc()})}removeChild(...t){t.flat().map(e=>{de(this.children,e)&&(e.parent=null,e._pc())})}get radius(){return this._r}set radius(t){this._r=t,this._pc()}get opacity(){return this._opa}set opacity(t){this._opa=ce(0,1,t),this._pc()}get rotation(){return this._rot}set rotation(t){this._rot=t,this._pc()}advance(t){super.advance(t),this.drotation+=this.ddrotation,this.rotation+=this.drotation}setScale(t,e=t){this.scaleX=t,this.scaleY=e}get scaleX(){return this._scx}set scaleX(t){this._scx=t,this._pc()}get scaleY(){return this._scy}set scaleY(t){this._scy=t,this._pc()}}function Jo(){return new we(...arguments)}let fi=class extends we{init({image:t,width:e=t?t.width:void 0,height:i=t?t.height:void 0,...s}={}){super.init({image:t,width:e,height:i,...s})}get animations(){return this._a}set animations(t){let e,i;this._a={};for(e in t)this._a[e]=t[e].clone(),i=i||this._a[e];this.currentAnimation=i,this.width=this.width||i.width,this.height=this.height||i.height}playAnimation(t){var e;(e=this.currentAnimation)==null||e.stop(),this.currentAnimation=this.animations[t],this.currentAnimation.start()}advance(t){var e;super.advance(t),(e=this.currentAnimation)==null||e.update(t)}draw(){if(this.image&&this.context.drawImage(this.image,0,0,this.image.width,this.image.height),this.currentAnimation&&this.currentAnimation.render({x:0,y:0,width:this.width,height:this.height,context:this.context}),this.color){if(this.context.fillStyle=this.color,this.radius){this.context.beginPath(),this.context.arc(this.radius,this.radius,this.radius,0,Math.PI*2),this.context.fill();return}this.context.fillRect(0,0,this.width,this.height)}}};function Qo(){return new fi(...arguments)}let ta=/(\d+)(\w+)/;function ea(n){if(!n)return{computed:0};let t=n.match(ta),e=+t[1],i=t[2];return{size:e,unit:i,computed:e}}class Qs extends we{init({text:t="",textAlign:e="",lineHeight:i=1,font:s=(o=>(o=rt())==null?void 0:o.font)(),...r}={}){t=""+t,super.init({text:t,textAlign:e,lineHeight:i,font:s,...r}),this.context&&this._p(),ut("init",()=>{this.font??(this.font=rt().font),this._p()})}get width(){return this._w}set width(t){this._d=!0,this._w=t,this._fw=t}get text(){return this._t}set text(t){this._d=!0,this._t=""+t}get font(){return this._f}set font(t){this._d=!0,this._f=t,this._fs=ea(t).computed}get lineHeight(){return this._lh}set lineHeight(t){this._d=!0,this._lh=t}render(){this._d&&this._p(),super.render()}_p(){this._s=[],this._d=!1;let t=this.context,e=[this.text];if(t.font=this.font,e=this.text.split(`
`),this._fw&&e.map(i=>{let s=i.split(" "),r=s.shift(),o=r;s.map(a=>{o+=" "+a,t.measureText(o).width>this._fw&&(this._s.push(r),o=a),r=o}),this._s.push(o)}),!this._s.length&&this.text.includes(`
`)){let i=0;e.map(s=>{this._s.push(s),i=Math.max(i,t.measureText(s).width)}),this._w=this._fw||i}this._s.length||(this._s.push(this.text),this._w=this._fw||t.measureText(this.text).width),this.height=this._fs+(this._s.length-1)*this._fs*this.lineHeight,this._uw()}draw(){let t=0,e=this.textAlign,i=this.context;e=this.textAlign||(i.canvas.dir=="rtl"?"right":"left"),t=e=="right"?this.width:e=="center"?this.width/2|0:0,this._s.map((s,r)=>{i.textBaseline="top",i.textAlign=e,i.fillStyle=this.color,i.font=this.font,this.strokeColor&&(i.strokeStyle=this.strokeColor,i.lineWidth=this.lineWidth??1,i.strokeText(s,t,this._fs*this.lineHeight*r)),i.fillText(s,t,this._fs*this.lineHeight*r)})}}function tr(){return new Qs(...arguments)}let It=new WeakMap,on={},bn={},er={0:"left",1:"middle",2:"right"};function na(n=at()){return It.get(n)}function nr(n){let t=n._lf.length?n._lf:n._cf;for(let e=t.length-1;e>=0;e--){let i=t[e];if(i.collidesWithPointer?i.collidesWithPointer(n):qs(n,i))return i}}function it(n,t){return parseFloat(n.getPropertyValue(t))||0}function ia(n){let{canvas:t,_s:e}=n,i=t.getBoundingClientRect(),s=e.transform!="none"?e.transform.replace("matrix(","").split(","):[1,1,1,1],r=parseFloat(s[0]),o=parseFloat(s[3]),a=(it(e,"border-left-width")+it(e,"border-right-width"))*r,c=(it(e,"border-top-width")+it(e,"border-bottom-width"))*o,l=(it(e,"padding-left")+it(e,"padding-right"))*r,h=(it(e,"padding-top")+it(e,"padding-bottom"))*o;return{scaleX:(i.width-a-l)/t.width,scaleY:(i.height-c-h)/t.height,offsetX:i.left+(it(e,"border-left-width")+it(e,"padding-left"))*r,offsetY:i.top+(it(e,"border-top-width")+it(e,"padding-top"))*o}}function Wi(n){let t=n.button!=null?er[n.button]:"left";bn[t]=!0,pi(n,"onDown")}function On(n){let t=n.button!=null?er[n.button]:"left";bn[t]=!1,pi(n,"onUp")}function Yi(n){pi(n,"onOver")}function sa(n){let t=It.get(n.target);t._oo=null,bn={}}function ji(n,t,e){let i=nr(n);i&&i[t]&&i[t](e),on[t]&&on[t](e,i),t=="onOver"&&(i!=n._oo&&n._oo&&n._oo.onOut&&n._oo.onOut(e),n._oo=i)}function pi(n,t){n.preventDefault();let e=n.target,i=It.get(e),{scaleX:s,scaleY:r,offsetX:o,offsetY:a}=ia(i);n.type.includes("touch")?(Array.from(n.touches).map(({clientX:l,clientY:h,identifier:u})=>{let d=i.touches[u];d||(d=i.touches[u]={start:{x:(l-o)/s,y:(h-a)/r}},i.touches.length++),d.changed=!1}),Array.from(n.changedTouches).map(({clientX:l,clientY:h,identifier:u})=>{let d=i.touches[u];d.changed=!0,d.x=i.x=(l-o)/s,d.y=i.y=(h-a)/r,ji(i,t,n),Rt("touchChanged",n,i.touches),t=="onUp"&&(delete i.touches[u],i.touches.length--,i.touches.length||Rt("touchEnd"))})):(i.x=(n.clientX-o)/s,i.y=(n.clientY-a)/r,ji(i,t,n))}function ir({radius:n=5,canvas:t=at()}={}){let e=It.get(t);if(!e){let i=window.getComputedStyle(t);e={x:0,y:0,radius:n,touches:{length:0},canvas:t,_cf:[],_lf:[],_o:[],_oo:null,_s:i},It.set(t,e)}return t.addEventListener("mousedown",Wi),t.addEventListener("touchstart",Wi),t.addEventListener("mouseup",On),t.addEventListener("touchend",On),t.addEventListener("touchcancel",On),t.addEventListener("blur",sa),t.addEventListener("mousemove",Yi),t.addEventListener("touchmove",Yi),e._t||(e._t=!0,ut("tick",()=>{e._lf.length=0,e._cf.map(i=>{e._lf.push(i)}),e._cf.length=0})),e}function sr(...n){n.flat().map(t=>{let e=t.context?t.context.canvas:at(),i=It.get(e);if(!i)throw new ReferenceError("Pointer events not initialized for the objects canvas");t.__r||(t.__r=t.render,t.render=function(){i._cf.push(this),this.__r()},i._o.push(t))})}function ra(...n){n.flat().map(t=>{let e=t.context?t.context.canvas:at(),i=It.get(e);if(!i)throw new ReferenceError("Pointer events not initialized for the objects canvas");t.render=t.__r,t.__r=0,de(i._o,t)})}function oa(n){let t=n.context?n.context.canvas:at(),e=It.get(t);if(!e)throw new ReferenceError("Pointer events not initialized for the objects canvas");return e._o.includes(n)&&nr(e)===n}function rr(n,t){let e=n[0].toUpperCase()+n.substr(1);on["on"+e]=t}function or(n){let t=n[0].toUpperCase()+n.substr(1);on["on"+t]=0}function aa(n){return!!bn[n]}class ar extends fi{init({padX:t=0,padY:e=0,text:i,disabled:s=!1,container:r,onDown:o,onUp:a,...c}={}){super.init({padX:t,padY:e,...c}),this.textNode=tr({...i,context:this.context}),this.width||(this.width=this.textNode.width,this.height=this.textNode.height),sr(this),this.addChild(this.textNode),this._od=o||Yt,this._ou=a||Yt;let l=this._dn=document.createElement("button");l.style=Hs,l.textContent=this.text,s&&this.disable(),l.addEventListener("focus",()=>this.focus()),l.addEventListener("blur",()=>this.blur()),l.addEventListener("keydown",h=>this._kd(h)),l.addEventListener("keyup",h=>this._ku(h)),Gn(l,r??this.context.canvas),this._uw(),this._p()}get text(){return this.textNode.text}set text(t){this._d=!0,this.textNode.text=t}get node(){return this._dn}destroy(){this._dn.remove()}_p(){this.text!=this._dn.textContent&&(this._dn.textContent=this.text),this.textNode._p();let t=this.textNode.width+this.padX*2,e=this.textNode.height+this.padY*2;this.width=Math.max(t,this.width),this.height=Math.max(e,this.height),this._uw()}render(){this._d&&this._p(),super.render()}enable(){this.disabled=this._dn.disabled=!1,this.onEnable()}disable(){this.disabled=this._dn.disabled=!0,this.onDisable()}focus(){this.disabled||(this.focused=!0,document.activeElement!=this._dn&&this._dn.focus(jn),this.onFocus())}blur(){this.focused=!1,document.activeElement==this._dn&&this._dn.blur(),this.onBlur()}onOver(){this.disabled||(this.hovered=!0)}onOut(){this.hovered=!1}onEnable(){}onDisable(){}onFocus(){}onBlur(){}onDown(){this.disabled||(this.pressed=!0,this._od())}onUp(){this.disabled||(this.pressed=!1,this._ou())}_kd(t){(t.code=="Enter"||t.code=="Space")&&this.onDown()}_ku(t){(t.code=="Enter"||t.code=="Space")&&this.onUp()}}function la(){return new ar(...arguments)}function ha(n){let t=n.canvas;n.clearRect(0,0,t.width,t.height)}function ca({fps:n=60,clearCanvas:t=!0,update:e=Yt,render:i,context:s=rt(),blur:r=!1}={}){if(!i)throw Error("You must provide a render() function");let o=0,a=1e3/n,c=1/n,l=t?ha:Yt,h,u,d,m,x,f=!0;r||(window.addEventListener("focus",()=>{f=!0}),window.addEventListener("blur",()=>{f=!1})),ut("init",()=>{x.context??(x.context=rt())});function p(){if(u=requestAnimationFrame(p),!!f&&(d=performance.now(),m=d-h,h=d,!(m>1e3))){for(o+=m;o>=a;)Rt("tick"),x.update(c),o-=a;l(x.context),x.render()}}return x={update:e,render:i,isStopped:!0,context:s,start(){this.isStopped&&(h=performance.now(),this.isStopped=!1,requestAnimationFrame(p))},stop(){this.isStopped=!0,cancelAnimationFrame(u)},_frame:p,set _last(w){h=w}},x}let gt=[],an={},ln={},xn={0:"south",1:"east",2:"west",3:"north",4:"leftshoulder",5:"rightshoulder",6:"lefttrigger",7:"righttrigger",8:"select",9:"start",10:"leftstick",11:"rightstick",12:"dpadup",13:"dpaddown",14:"dpadleft",15:"dpadright"};function ua(n){gt[n.gamepad.index]={pressedButtons:{},axes:{}}}function da(n){delete gt[n.gamepad.index]}function fa(){gt.map(n=>{n.pressedButtons={},n.axes={}})}function lr(){let n=navigator.getGamepads?navigator.getGamepads():navigator.webkitGetGamepads?navigator.webkitGetGamepads:[];for(let t=0;t<n.length;t++){let e=n[t];if(!e)continue;e.buttons.map((s,r)=>{let o=xn[r],{pressed:a}=s,{pressedButtons:c}=gt[e.index],l=c[o];!l&&a?[an[e.index],an].map(h=>{var u;(u=h==null?void 0:h[o])==null||u.call(h,e,s,o)}):l&&!a&&[ln[e.index],ln].map(h=>{var u;(u=h==null?void 0:h[o])==null||u.call(h,e,s,o)}),c[o]=a});let{axes:i}=gt[e.index];i.leftstickx=e.axes[0],i.leftsticky=e.axes[1],i.rightstickx=e.axes[2],i.rightsticky=e.axes[3]}}function hr(){window.addEventListener("gamepadconnected",ua),window.addEventListener("gamepaddisconnected",da),window.addEventListener("blur",fa),ut("tick",lr)}function cr(n,t,{gamepad:e,handler:i="gamepaddown"}={}){let s=i=="gamepaddown"?an:ln;[].concat(n).map(r=>{isNaN(e)?s[r]=t:(s[e]=s[e]||{},s[e][r]=t)})}function ur(n,{gamepad:t,handler:e="gamepaddown"}={}){let i=e=="gamepaddown"?an:ln;[].concat(n).map(s=>{isNaN(t)?delete i[s]:(i[t]=i[t]||{},delete i[t][s])})}function pa(n,{gamepad:t}={}){return isNaN(t)?gt.some(e=>e.pressedButtons[n]):gt[t]?!!gt[t].pressedButtons[n]:!1}function _a(n,t){var e;return((e=gt[t])==null?void 0:e.axes[n])||0}let hn={},qe,Gi=!1,cn={swipe:{touches:1,threshold:10,touchend({0:n}){let t=n.x-n.start.x,e=n.y-n.start.y,i=Math.abs(t),s=Math.abs(e);if(!(i<this.threshold&&s<this.threshold))return i>s?t<0?"left":"right":e<0?"up":"down"}},pinch:{touches:2,threshold:2,touchstart({0:n,1:t}){this.prevDist=Math.hypot(n.x-t.x,n.y-t.y)},touchmove({0:n,1:t}){let e=Math.hypot(n.x-t.x,n.y-t.y);if(Math.abs(e-this.prevDist)<this.threshold)return;let i=e>this.prevDist?"out":"in";return this.prevDist=e,i}}};function dr(){Gi||(Gi=!0,ut("touchChanged",(n,t)=>{Object.keys(cn).map(e=>{var r;let i=cn[e],s;(!qe||qe==e)&&t.length==i.touches&&[...Array(t.length).keys()].every(o=>t[o])&&(s=((r=i[n.type])==null?void 0:r.call(i,t))??"")&&hn[e+s]&&(qe=e,hn[e+s](n,t))})}),ut("touchEnd",()=>{qe=0}))}function fr(n,t){[].concat(n).map(e=>{hn[e]=t})}function pr(n){[].concat(n).map(t=>{hn[t]=0})}let ga={set(n,t,e){return t.startsWith("_")||(n._d=!0),Reflect.set(n,t,e)}},zi={start(n){return n?1:0},center(){return .5},end(n){return n?0:1}};class _r extends we{init({flow:t="column",align:e="start",justify:i="start",colGap:s=0,rowGap:r=0,numCols:o=1,dir:a="",breakpoints:c=[],...l}={}){return super.init({flow:t,align:e,justify:i,colGap:s,rowGap:r,numCols:o,dir:a,breakpoints:c,...l}),this._p(),new Proxy(this,ga)}addChild(t){this._d=!0,super.addChild(t)}removeChild(t){this._d=!0,super.removeChild(t)}render(){this._d&&this._p(),super.render()}destroy(){this.children.map(t=>t.destroy&&t.destroy())}_p(){this._d=!1,this.breakpoints.map(w=>{w.metric.call(this)&&this._b!==w&&(this._b=w,w.callback.call(this))});let t=this._g=[],e=this._cw=[],i=this._rh=[],s=this.children,r=this._nc=this.flow=="column"?1:this.flow=="row"?s.length:this.numCols,o=0,a=0;for(let w=0,v;v=s[w];w++){t[o]=t[o]||[],v._p&&v._p();let{width:N,height:T}=v.world||v;i[o]=Math.max(i[o]||0,T);let R=v.colSpan||1,C=R;do e[a]=Math.max(e[a]||0,N/C),t[o][a]=v;while(a++<=r&&--R);a>=r&&(a=0,o++)}for(;a>0&&a<r;)t[o][a++]=!1;let c=t.length,l=[].concat(this.colGap),h=[].concat(this.rowGap);this._w=e.reduce((w,v)=>w+=v,0);for(let w=0;w<r-1;w++)this._w+=l[w%l.length];this._h=i.reduce((w,v)=>w+=v,0);for(let w=0;w<c-1;w++)this._h+=h[w%h.length];this._uw();let d=this.context.canvas.dir=="rtl"&&!this.dir||this.dir=="rtl";this._rtl=d,d&&(this._g=t.map(w=>w.reverse()),this._cw=e.reverse(),l=l.reverse());let m=-this.anchor.y*this.height,x=[],f=[].concat(this.justify),p=[].concat(this.align);this._g.map((w,v)=>{let N=-this.anchor.x*this.width;w.map((T,R)=>{if(T&&!x.includes(T)){x.push(T);let C=zi[T.justifySelf||f[R%f.length]](this._rtl),I=zi[T.alignSelf||p[v%p.length]](),k=T.colSpan||1,Y=e[R];if(k>1&&R+k<=this._nc)for(let b=1;b<k;b++)Y+=e[R+b]+l[(R+b)%l.length];let D=Y*C,O=i[v]*I,_=0,E=0,{width:y,height:g}=T.world||T;if(T.anchor&&(_=T.anchor.x,E=T.anchor.y),C==0)D=D+y*_;else if(C==.5){let b=_<.5?-1:_==.5?0:1;D=D+b*y*C}else D=D-y*(1-_);if(I==0)O=O+g*E;else if(I==.5){let b=E<.5?-1:E==.5?0:1;O=O+b*g*I}else O=O-g*(1-E);T.x=N+D,T.y=m+O}N+=e[R]+l[R%l.length]}),m+=i[v]+h[v%h.length]})}}function ma(){return new _r(...arguments)}let _i={},gi={},En={},At={Enter:"enter",Escape:"esc",Space:"space",ArrowLeft:"arrowleft",ArrowUp:"arrowup",ArrowRight:"arrowright",ArrowDown:"arrowdown"};function gr(n=Yt,t){n._pd&&t.preventDefault(),n(t)}function ya(n){let t=At[n.code],e=_i[t];En[t]=!0,gr(e,n)}function wa(n){let t=At[n.code],e=gi[t];En[t]=!1,gr(e,n)}function ba(){En={}}function mr(){let n;for(n=0;n<26;n++)At["Key"+String.fromCharCode(n+65)]=String.fromCharCode(n+97);for(n=0;n<10;n++)At["Digit"+n]=At["Numpad"+n]=""+n;window.addEventListener("keydown",ya),window.addEventListener("keyup",wa),window.addEventListener("blur",ba)}function yr(n,t,{handler:e="keydown",preventDefault:i=!0}={}){let s=e=="keydown"?_i:gi;t._pd=i,[].concat(n).map(r=>s[r]=t)}function wr(n,{handler:t="keydown"}={}){let e=t=="keydown"?_i:gi;[].concat(n).map(i=>delete e[i])}function xa(n){return!![].concat(n).some(t=>En[t])}function un(n,t){return Object.values(t).includes(n)}function br(n){return Object.keys(cn).some(t=>n.startsWith(t))}function Ea(n={}){mr();let t=ir(n.pointer);return dr(),hr(),{pointer:t}}function Sa(n,t,{gamepad:e,key:i}={}){[].concat(n).map(s=>{if(un(s,xn))cr(s,t,e);else if(br(s))fr(s,t);else if(un(s,At))yr(s,t,i);else if(["down","up"].includes(s))rr(s,t);else throw new TypeError(`"${s}" is not a valid input name`)})}function va(n,{gamepad:t,key:e}={}){[].concat(n).map(i=>{un(i,xn)?ur(i,t):br(i)?pr(i):un(i,At)?wr(i,e):["down","up"].includes(i)&&or(i)})}function xr(n){let t=n.substr(n.search(/[A-Z]/));return t[0].toLowerCase()+t.substr(1)}function Aa(n,t){let e=n.prototype;e&&(e._inc||(e._inc={},e._bInc=function(s,r,...o){return this._inc[r].before.reduce((a,c)=>{let l=c(s,...a);return l||a},o)},e._aInc=function(s,r,o,...a){return this._inc[r].after.reduce((c,l)=>{let h=l(s,c,...a);return h||c},o)}),Object.getOwnPropertyNames(t).map(i=>{let s=xr(i);e[s]&&(e["_o"+s]||(e["_o"+s]=e[s],e[s]=function(...o){let a=this._bInc(this,s,...o),c=e["_o"+s].call(this,...a);return this._aInc(this,s,c,...o)}),e._inc[s]||(e._inc[s]={before:[],after:[]}),i.startsWith("before")?e._inc[s].before.push(t[i]):i.startsWith("after")&&e._inc[s].after.push(t[i]))}))}function Ca(n,t){let e=n.prototype;!e||!e._inc||Object.getOwnPropertyNames(t).map(i=>{let s=xr(i);i.startsWith("before")?de(e._inc[s].before,t[i]):i.startsWith("after")&&de(e._inc[s].after,t[i])})}function Ta(n,t){let e=n.prototype;e&&Object.getOwnPropertyNames(t).map(i=>{e[i]||(e[i]=t[i])})}class Er{constructor({create:t,maxSize:e=1024}={}){let i;if(!t||!(i=t())||!(i.update&&i.init&&i.isAlive&&i.render))throw Error("Must provide create() function which returns an object with init(), update(), render(), and isAlive() functions");this._c=t,this.objects=[t()],this.size=0,this.maxSize=e}get(t={}){if(this.size==this.objects.length){if(this.size==this.maxSize)return;for(let i=0;i<this.size&&this.objects.length<this.maxSize;i++)this.objects.push(this._c())}let e=this.objects[this.size];return this.size++,e.init(t),e}getAliveObjects(){return this.objects.slice(0,this.size)}clear(){this.size=this.objects.length=0,this.objects.push(this._c())}update(t){let e,i=!1;for(let s=this.size;s--;)e=this.objects[s],e.update(t),e.isAlive()||(i=!0,this.size--);i&&this.objects.sort((s,r)=>r.isAlive()-s.isAlive())}render(){for(let t=this.size;t--;)this.objects[t].render()}}function Ra(){return new Er(...arguments)}function Ki(n,t){let e=[],i=t.x+t.width/2,s=t.y+t.height/2,r=n.y<s,o=n.y+n.height>=s;return n.x<i&&(r&&e.push(0),o&&e.push(2)),n.x+n.width>=i&&(r&&e.push(1),o&&e.push(3)),e}class Sn{constructor({maxDepth:t=3,maxObjects:e=25,bounds:i}={}){this.maxDepth=t,this.maxObjects=e;let s=at();this.bounds=i||{x:0,y:0,width:s.width,height:s.height},this._b=!1,this._d=0,this._o=[],this._s=[],this._p=null}clear(){this._s.map(t=>{t.clear()}),this._b=!1,this._o.length=0}get(t){let e=new Set;for(;this._s.length&&this._b;)return Ki(t,this.bounds).map(i=>{this._s[i].get(t).map(s=>e.add(s))}),Array.from(e);return this._o.filter(i=>i!==t)}add(...t){t.flat().map(e=>{if(this._b){this._a(e);return}this._o.push(e),this._o.length>this.maxObjects&&this._d<this.maxDepth&&(this._sp(),this._o.map(i=>this._a(i)),this._o.length=0)})}_a(t){Ki(t,this.bounds).map(e=>{this._s[e].add(t)})}_sp(t,e,i){if(this._b=!0,!this._s.length)for(t=this.bounds.width/2|0,e=this.bounds.height/2|0,i=0;i<4;i++)this._s[i]=new Sn({bounds:{x:this.bounds.x+(i%2==1?t:0),y:this.bounds.y+(i>=2?e:0),width:t,height:e},maxDepth:this.maxDepth,maxObjects:this.maxObjects}),this._s[i]._d=this._d+1}}function Ia(){return new Sn(...arguments)}let pt;function Sr(){pt??(pt=Date.now()),pt|=0,pt=pt+2654435769|0;let n=pt^pt>>>16;return n=Math.imul(n,569420461),n=n^n>>>15,n=Math.imul(n,1935289751),((n=n^n>>>15)>>>0)/4294967296}function Na(n,t,e=Sr){return(e()*(t-n+1)|0)+n}function ka(){return pt}function Oa(n=Date.now()){if(pt=n,typeof n=="string"){for(var t=0,e=1779033703^n.length;t<n.length;t++)e=Math.imul(e^n.charCodeAt(t),3432918353),e=e<<13|e>>>19;e=Math.imul(e^e>>>16,2246822507),e=Math.imul(e^e>>>13,3266489909),pt=(e^=e>>>16)>>>0}}function zn(n){let t=[];return n._dn?t.push(n._dn):n.children&&n.children.map(e=>{t=t.concat(zn(e))}),t}class vr{constructor({id:t,name:e=t,objects:i=[],context:s=rt(),cullObjects:r=!0,cullFunction:o=$s,sortFunction:a,...c}){this._o=[],Object.assign(this,{id:t,name:e,context:s,cullObjects:r,cullFunction:o,sortFunction:a,...c});let l=this._dn=document.createElement("section");l.tabIndex=-1,l.style=Hs,l.id=t,l.setAttribute("aria-label",e);let h=this;class u extends we{set x(m){h.sx=m-this.centerX,super.x=m}get x(){return super.x}set y(m){h.sy=m-this.centerY,super.y=m}get y(){return super.y}}this.camera=new u({context:s,anchor:{x:.5,y:.5},render:this._rf.bind(this)}),this.add(i),this._i=()=>{this.context??(this.context=rt());let d=this.context.canvas,{width:m,height:x}=d,f=m/2,p=x/2;Object.assign(this.camera,{centerX:f,centerY:p,x:f,y:p,width:m,height:x}),l.isConnected||Gn(l,d)},this.context&&this._i(),ut("init",this._i)}set objects(t){this.remove(this._o),this.add(t)}get objects(){return this._o}get node(){return this._dn}add(...t){t.flat().map(e=>{this._o.push(e),e.parent=this,this._dn.append(...zn(e))})}remove(...t){t.flat().map(e=>{de(this._o,e),e.parent=null,zn(e).map(i=>{Gn(i,this.context.canvas)})})}show(){this.hidden=this._dn.hidden=!1;let t=this._o.find(e=>e.focus);t?t.focus(jn):this._dn.focus(jn),this.onShow()}hide(){this.hidden=this._dn.hidden=!0,this.onHide()}destroy(){Ws("init",this._i),this._dn.remove(),this._o.map(t=>t.destroy&&t.destroy())}lookAt(t){let{x:e,y:i}=t.world||t;this.camera.x=e,this.camera.y=i}update(t){this.hidden||this._o.map(e=>e.update&&e.update(t))}_rf(){let{_o:t,context:e,_sx:i,_sy:s,camera:r,sortFunction:o,cullObjects:a,cullFunction:c}=this;e.translate(i,s);let l=t;a&&(l=l.filter(h=>c(r,h))),o&&l.sort(o),l.map(h=>h.render&&h.render())}render(){if(!this.hidden){let{context:t,camera:e}=this,{x:i,y:s,centerX:r,centerY:o}=e;t.save(),this._sx=r-i,this._sy=o-s,t.translate(this._sx,this._sy),e.render(),t.restore()}}onShow(){}onHide(){}}function Pa(){return new vr(...arguments)}function Da(n){if(+n==n)return n;let t=[],e=n.split(".."),i=+e[0],s=+e[1],r=i;if(i<s)for(;r<=s;r++)t.push(r);else for(;r>=s;r--)t.push(r);return t}let Ar=class{constructor({image:t,frameWidth:e,frameHeight:i,spacing:s=0,margin:r=0,animations:o}={}){if(!t)throw Error("You must provide an Image for the SpriteSheet");this.animations={},this.image=t,this.frame={width:e,height:i,spacing:s,margin:r},this._f=(t.width-r)/e|0,this.createAnimations(o)}createAnimations(t){let e,i;for(i in t){let{frames:s,frameRate:r,loop:o}=t[i];if(e=[],s==null)throw Error("Animation "+i+" must provide a frames property");[].concat(s).map(a=>{e=e.concat(Da(a))}),this.animations[i]=Ys({spriteSheet:this,frames:e,frameRate:r,loop:o,name:i})}}};function La(){return new Ar(...arguments)}let Vi=2147483648,Xi=1073741824,Zi=536870912;function xe(n,t){return n/t|0}function Ee(n,t){return n/t|0}class Cr{constructor(t={}){let{width:e,height:i,tilewidth:s,tileheight:r,tilesets:o}=t,a=e*s,c=i*r,l=document.createElement("canvas");l.width=a,l.height=c,this._c=l,this._ctx=l.getContext("2d"),o.map(h=>{let{__k:u,location:d}=window,m=(u?u.dm.get(t):"")||d.href,{source:x}=h;if(x){if(!u)throw Error('You must use "load" or "loadData" to resolve tileset.source');let p=u.d[u.u(x,m)];if(!p)throw Error(`You must load the tileset source "${x}" before loading the tileset`);Object.keys(p).map(w=>{h[w]=p[w]})}let{image:f}=h;if(""+f===f){if(!u)throw Error('You must use "load" or "loadImage" to resolve tileset.image');let p=u.i[u.u(f,m)];if(!p)throw Error(`You must load the image "${f}" before loading the tileset`);h.image=p}}),Object.assign(this,{context:rt(),layerMap:{},layerCanvases:{},mapwidth:a,mapheight:c,_sx:0,_sy:0,_o:[],...t}),this.context&&this._p(),ut("init",()=>{this.context??(this.context=rt()),this._p()})}get sx(){return this._sx}get sy(){return this._sy}set sx(t){let e=Math.max(0,this.mapwidth-at().width);this._sx=ce(0,e,t)}set sy(t){let e=Math.max(0,this.mapheight-at().height);this._sy=ce(0,e,t)}set objects(t){this.remove(this._o),this.add(t)}get objects(){return this._o}add(...t){t.flat().map(e=>{this._o.push(e),e.parent=this})}remove(...t){t.flat().map(e=>{de(this._o,e),e.parent=null})}getPosition(t){let e=at().getBoundingClientRect(),i=t.x-e.x,s=t.y-e.y;return i+=this.sx,s+=this.sy,{x:i,y:s,row:xe(s,this.tileheight),col:Ee(i,this.tilewidth)}}setTileAtLayer(t,e,i){let{layerMap:s,tileheight:r,tilewidth:o,width:a}=this,{row:c,col:l,x:h,y:u}=e,d=c??xe(u,r),m=l??Ee(h,o);s[t]&&(this._d=!0,s[t]._d=!0,s[t].data[d*a+m]=i)}setLayer(t,e){let{layerMap:i}=this;i[t]&&(this._d=!0,i[t]._d=!0,i[t].data=e)}layerCollidesWith(t,e){let{tilewidth:i,tileheight:s,layerMap:r}=this,{x:o,y:a,width:c,height:l}=ue(e),h=xe(a,s),u=Ee(o,i),d=xe(a+l,s),m=Ee(o+c,i),x=r[t];for(let f=h;f<=d;f++)for(let p=u;p<=m;p++)if(x.data[p+f*this.width])return!0;return!1}tileAtLayer(t,e){let{layerMap:i,tileheight:s,tilewidth:r,width:o}=this,{row:a,col:c,x:l,y:h}=e,u=a??xe(h,s),d=c??Ee(l,r);return i[t]?i[t].data[u*o+d]:-1}render(t=this._c,e=!0){let{_d:i,context:s,sx:r=0,sy:o=0}=this;i&&this._p();let{width:a,height:c}=at(),l=Math.min(t.width,a),h=Math.min(t.height,c);s.drawImage(t,r,o,l,h,0,0,l,h),e&&(s.save(),(r||o)&&s.translate(-r,-o),this.objects.map(u=>u.render&&u.render()),s.restore())}renderLayer(t){let{layerCanvases:e,layerMap:i}=this,s=i[t],r=e[t],o=r==null?void 0:r.getContext("2d");if(!r){let{mapwidth:a,mapheight:c}=this;r=document.createElement("canvas"),o=r.getContext("2d"),r.width=a,r.height=c,e[t]=r,this._rl(s,o)}s._d&&(s._d=!1,o.clearRect(0,0,r.width,r.height),this._rl(s,o)),this.render(r,!1)}_p(){let{_ctx:t,layers:e=[],layerMap:i}=this;this._d=!1,e.map(s=>{let{name:r,data:o,visible:a}=s;s._d=!1,i[r]=s,o&&a!=!1&&this._rl(s,t)})}_rl(t,e){let{opacity:i,data:s=[]}=t,{tilesets:r,width:o,tilewidth:a,tileheight:c}=this;e.save(),e.globalAlpha=i,s.map((l,h)=>{if(!l)return;let u=0,d=0,m=l&Vi,x=l&Xi,f=0,p=0,w=0,v=0,N=0;u=m||x,l&=~(Vi|Xi),N=l&Zi,N&&(m&&x?w=1:m?f=1:x?p=1:v=1,d=f||p||w||v,l&=~Zi);let T;for(let b=r.length-1;b>=0&&(T=r[b],!(l/T.firstgid>=1));b--);let{image:R,spacing:C=0,margin:I=0,firstgid:k,columns:Y}=T,D=l-k,O=Y??R.width/(a+C)|0,_=h%o*a,E=(h/o|0)*c,y=I+D%O*(a+C),g=I+(D/O|0)*(c+C);d?(e.save(),e.translate(_+a/2,E+c/2),p||v?e.rotate(-Math.PI/2):(f||w)&&e.rotate(Math.PI/2),(w||v)&&e.scale(-1,1),_=-a/2,E=-c/2):u&&(e.save(),e.translate(_+(m?a:0),E+(x?c:0)),e.scale(m?-1:1,x?-1:1),_=u?0:_,E=u?0:E),e.drawImage(R,y,g,a,c,_,E,a,c),(u||d)&&e.restore()}),e.restore()}}function Ba(){return new Cr(...arguments)}let Ma={Animation:Ys,AnimationClass:yn,imageAssets:Ut,audioAssets:ne,dataAssets:Ft,setImagePath:zo,setAudioPath:Ko,setDataPath:Vo,loadImage:Xs,loadAudio:Zs,loadData:Js,load:Xo,Button:la,ButtonClass:ar,init:qo,getCanvas:at,getContext:rt,on:ut,off:Ws,emit:Rt,GameLoop:ca,GameObject:Jo,GameObjectClass:we,gamepadMap:xn,updateGamepad:lr,initGamepad:hr,onGamepad:cr,offGamepad:ur,gamepadPressed:pa,gamepadAxis:_a,gestureMap:cn,initGesture:dr,onGesture:fr,offGesture:pr,Grid:ma,GridClass:_r,degToRad:Po,radToDeg:Do,angleToTarget:Lo,rotatePoint:Fs,movePoint:Bo,lerp:Mo,inverseLerp:Uo,clamp:ce,setStoreItem:Fo,getStoreItem:$o,collides:$s,getWorldRect:ue,depthSort:Ho,initInput:Ea,onInput:Sa,offInput:va,keyMap:At,initKeys:mr,onKey:yr,offKey:wr,keyPressed:xa,registerPlugin:Aa,unregisterPlugin:Ca,extendObject:Ta,initPointer:ir,getPointer:na,track:sr,untrack:ra,pointerOver:oa,onPointer:rr,offPointer:or,pointerPressed:aa,Pool:Ra,PoolClass:Er,Quadtree:Ia,QuadtreeClass:Sn,rand:Sr,randInt:Na,getSeed:ka,seedRand:Oa,Scene:Pa,SceneClass:vr,Sprite:Qo,SpriteClass:fi,SpriteSheet:La,SpriteSheetClass:Ar,Text:tr,TextClass:Qs,TileEngine:Ba,TileEngineClass:Cr,Vector:Ze,VectorClass:Ht};function Ji(n){if(!Number.isSafeInteger(n)||n<0)throw new Error(`positive integer expected, not ${n}`)}function Ua(n){return n instanceof Uint8Array||n!=null&&typeof n=="object"&&n.constructor.name==="Uint8Array"}function vn(n,...t){if(!Ua(n))throw new Error("Uint8Array expected");if(t.length>0&&!t.includes(n.length))throw new Error(`Uint8Array expected of length ${t}, not of length=${n.length}`)}function Fa(n){if(typeof n!="function"||typeof n.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");Ji(n.outputLen),Ji(n.blockLen)}function dn(n,t=!0){if(n.destroyed)throw new Error("Hash instance has been destroyed");if(t&&n.finished)throw new Error("Hash#digest() has already been called")}function $a(n,t){vn(n);const e=t.outputLen;if(n.length<e)throw new Error(`digestInto() expects output buffer of length at least ${e}`)}const Pn=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Dn=n=>new DataView(n.buffer,n.byteOffset,n.byteLength),ct=(n,t)=>n<<32-t|n>>>t;new Uint8Array(new Uint32Array([287454020]).buffer)[0];function Ha(n){if(typeof n!="string")throw new Error(`utf8ToBytes expected string, got ${typeof n}`);return new Uint8Array(new TextEncoder().encode(n))}function mi(n){return typeof n=="string"&&(n=Ha(n)),vn(n),n}function qa(...n){let t=0;for(let i=0;i<n.length;i++){const s=n[i];vn(s),t+=s.length}const e=new Uint8Array(t);for(let i=0,s=0;i<n.length;i++){const r=n[i];e.set(r,s),s+=r.length}return e}class Tr{clone(){return this._cloneInto()}}function Wa(n){const t=i=>n().update(mi(i)).digest(),e=n();return t.outputLen=e.outputLen,t.blockLen=e.blockLen,t.create=()=>n(),t}function Rr(n=32){if(Pn&&typeof Pn.getRandomValues=="function")return Pn.getRandomValues(new Uint8Array(n));throw new Error("crypto.getRandomValues must be defined")}function Ya(n,t,e,i){if(typeof n.setBigUint64=="function")return n.setBigUint64(t,e,i);const s=BigInt(32),r=BigInt(4294967295),o=Number(e>>s&r),a=Number(e&r),c=i?4:0,l=i?0:4;n.setUint32(t+c,o,i),n.setUint32(t+l,a,i)}const ja=(n,t,e)=>n&t^~n&e,Ga=(n,t,e)=>n&t^n&e^t&e;class za extends Tr{constructor(t,e,i,s){super(),this.blockLen=t,this.outputLen=e,this.padOffset=i,this.isLE=s,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(t),this.view=Dn(this.buffer)}update(t){dn(this);const{view:e,buffer:i,blockLen:s}=this;t=mi(t);const r=t.length;for(let o=0;o<r;){const a=Math.min(s-this.pos,r-o);if(a===s){const c=Dn(t);for(;s<=r-o;o+=s)this.process(c,o);continue}i.set(t.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===s&&(this.process(e,0),this.pos=0)}return this.length+=t.length,this.roundClean(),this}digestInto(t){dn(this),$a(t,this),this.finished=!0;const{buffer:e,view:i,blockLen:s,isLE:r}=this;let{pos:o}=this;e[o++]=128,this.buffer.subarray(o).fill(0),this.padOffset>s-o&&(this.process(i,0),o=0);for(let u=o;u<s;u++)e[u]=0;Ya(i,s-8,BigInt(this.length*8),r),this.process(i,0);const a=Dn(t),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const l=c/4,h=this.get();if(l>h.length)throw new Error("_sha2: outputLen bigger than state");for(let u=0;u<l;u++)a.setUint32(4*u,h[u],r)}digest(){const{buffer:t,outputLen:e}=this;this.digestInto(t);const i=t.slice(0,e);return this.destroy(),i}_cloneInto(t){t||(t=new this.constructor),t.set(...this.get());const{blockLen:e,buffer:i,length:s,finished:r,destroyed:o,pos:a}=this;return t.length=s,t.pos=a,t.finished=r,t.destroyed=o,s%e&&t.buffer.set(i),t}}const Ka=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),xt=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Et=new Uint32Array(64);class Va extends za{constructor(){super(64,32,8,!1),this.A=xt[0]|0,this.B=xt[1]|0,this.C=xt[2]|0,this.D=xt[3]|0,this.E=xt[4]|0,this.F=xt[5]|0,this.G=xt[6]|0,this.H=xt[7]|0}get(){const{A:t,B:e,C:i,D:s,E:r,F:o,G:a,H:c}=this;return[t,e,i,s,r,o,a,c]}set(t,e,i,s,r,o,a,c){this.A=t|0,this.B=e|0,this.C=i|0,this.D=s|0,this.E=r|0,this.F=o|0,this.G=a|0,this.H=c|0}process(t,e){for(let u=0;u<16;u++,e+=4)Et[u]=t.getUint32(e,!1);for(let u=16;u<64;u++){const d=Et[u-15],m=Et[u-2],x=ct(d,7)^ct(d,18)^d>>>3,f=ct(m,17)^ct(m,19)^m>>>10;Et[u]=f+Et[u-7]+x+Et[u-16]|0}let{A:i,B:s,C:r,D:o,E:a,F:c,G:l,H:h}=this;for(let u=0;u<64;u++){const d=ct(a,6)^ct(a,11)^ct(a,25),m=h+d+ja(a,c,l)+Ka[u]+Et[u]|0,f=(ct(i,2)^ct(i,13)^ct(i,22))+Ga(i,s,r)|0;h=l,l=c,c=a,a=o+m|0,o=r,r=s,s=i,i=m+f|0}i=i+this.A|0,s=s+this.B|0,r=r+this.C|0,o=o+this.D|0,a=a+this.E|0,c=c+this.F|0,l=l+this.G|0,h=h+this.H|0,this.set(i,s,r,o,a,c,l,h)}roundClean(){Et.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}const Kn=Wa(()=>new Va);class Ir extends Tr{constructor(t,e){super(),this.finished=!1,this.destroyed=!1,Fa(t);const i=mi(e);if(this.iHash=t.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const s=this.blockLen,r=new Uint8Array(s);r.set(i.length>s?t.create().update(i).digest():i);for(let o=0;o<r.length;o++)r[o]^=54;this.iHash.update(r),this.oHash=t.create();for(let o=0;o<r.length;o++)r[o]^=106;this.oHash.update(r),r.fill(0)}update(t){return dn(this),this.iHash.update(t),this}digestInto(t){dn(this),vn(t,this.outputLen),this.finished=!0,this.iHash.digestInto(t),this.oHash.update(t),this.oHash.digestInto(t),this.destroy()}digest(){const t=new Uint8Array(this.oHash.outputLen);return this.digestInto(t),t}_cloneInto(t){t||(t=Object.create(Object.getPrototypeOf(this),{}));const{oHash:e,iHash:i,finished:s,destroyed:r,blockLen:o,outputLen:a}=this;return t=t,t.finished=s,t.destroyed=r,t.blockLen=o,t.outputLen=a,t.oHash=e._cloneInto(t.oHash),t.iHash=i._cloneInto(t.iHash),t}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const Nr=(n,t,e)=>new Ir(n,t).update(e).digest();Nr.create=(n,t)=>new Ir(n,t);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const yi=BigInt(0),An=BigInt(1),Xa=BigInt(2);function jt(n){return n instanceof Uint8Array||n!=null&&typeof n=="object"&&n.constructor.name==="Uint8Array"}function Le(n){if(!jt(n))throw new Error("Uint8Array expected")}function fe(n,t){if(typeof t!="boolean")throw new Error(`${n} must be valid boolean, got "${t}".`)}const Za=Array.from({length:256},(n,t)=>t.toString(16).padStart(2,"0"));function pe(n){Le(n);let t="";for(let e=0;e<n.length;e++)t+=Za[n[e]];return t}function kr(n){const t=n.toString(16);return t.length&1?`0${t}`:t}function wi(n){if(typeof n!="string")throw new Error("hex string expected, got "+typeof n);return BigInt(n===""?"0":`0x${n}`)}const dt={_0:48,_9:57,_A:65,_F:70,_a:97,_f:102};function Qi(n){if(n>=dt._0&&n<=dt._9)return n-dt._0;if(n>=dt._A&&n<=dt._F)return n-(dt._A-10);if(n>=dt._a&&n<=dt._f)return n-(dt._a-10)}function _e(n){if(typeof n!="string")throw new Error("hex string expected, got "+typeof n);const t=n.length,e=t/2;if(t%2)throw new Error("padded hex string expected, got unpadded hex of length "+t);const i=new Uint8Array(e);for(let s=0,r=0;s<e;s++,r+=2){const o=Qi(n.charCodeAt(r)),a=Qi(n.charCodeAt(r+1));if(o===void 0||a===void 0){const c=n[r]+n[r+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+r)}i[s]=o*16+a}return i}function mt(n){return wi(pe(n))}function bi(n){return Le(n),wi(pe(Uint8Array.from(n).reverse()))}function Nt(n,t){return _e(n.toString(16).padStart(t*2,"0"))}function xi(n,t){return Nt(n,t).reverse()}function Ja(n){return _e(kr(n))}function et(n,t,e){let i;if(typeof t=="string")try{i=_e(t)}catch(r){throw new Error(`${n} must be valid hex string, got "${t}". Cause: ${r}`)}else if(jt(t))i=Uint8Array.from(t);else throw new Error(`${n} must be hex string or Uint8Array`);const s=i.length;if(typeof e=="number"&&s!==e)throw new Error(`${n} expected ${e} bytes, got ${s}`);return i}function Gt(...n){let t=0;for(let i=0;i<n.length;i++){const s=n[i];Le(s),t+=s.length}const e=new Uint8Array(t);for(let i=0,s=0;i<n.length;i++){const r=n[i];e.set(r,s),s+=r.length}return e}function Qa(n,t){if(n.length!==t.length)return!1;let e=0;for(let i=0;i<n.length;i++)e|=n[i]^t[i];return e===0}function tl(n){if(typeof n!="string")throw new Error(`utf8ToBytes expected string, got ${typeof n}`);return new Uint8Array(new TextEncoder().encode(n))}const Ln=n=>typeof n=="bigint"&&yi<=n;function ge(n,t,e){return Ln(n)&&Ln(t)&&Ln(e)&&t<=n&&n<e}function Ct(n,t,e,i){if(!ge(t,e,i))throw new Error(`expected valid ${n}: ${e} <= n < ${i}, got ${typeof t} ${t}`)}function el(n){let t;for(t=0;n>yi;n>>=An,t+=1);return t}function nl(n,t){return n>>BigInt(t)&An}function il(n,t,e){return n|(e?An:yi)<<BigInt(t)}const Ei=n=>(Xa<<BigInt(n-1))-An,Bn=n=>new Uint8Array(n),ts=n=>Uint8Array.from(n);function Or(n,t,e){if(typeof n!="number"||n<2)throw new Error("hashLen must be a number");if(typeof t!="number"||t<2)throw new Error("qByteLen must be a number");if(typeof e!="function")throw new Error("hmacFn must be a function");let i=Bn(n),s=Bn(n),r=0;const o=()=>{i.fill(1),s.fill(0),r=0},a=(...u)=>e(s,i,...u),c=(u=Bn())=>{s=a(ts([0]),u),i=a(),u.length!==0&&(s=a(ts([1]),u),i=a())},l=()=>{if(r++>=1e3)throw new Error("drbg: tried 1000 values");let u=0;const d=[];for(;u<t;){i=a();const m=i.slice();d.push(m),u+=i.length}return Gt(...d)};return(u,d)=>{o(),c(u);let m;for(;!(m=d(l()));)c();return o(),m}}const sl={bigint:n=>typeof n=="bigint",function:n=>typeof n=="function",boolean:n=>typeof n=="boolean",string:n=>typeof n=="string",stringOrUint8Array:n=>typeof n=="string"||jt(n),isSafeInteger:n=>Number.isSafeInteger(n),array:n=>Array.isArray(n),field:(n,t)=>t.Fp.isValid(n),hash:n=>typeof n=="function"&&Number.isSafeInteger(n.outputLen)};function Be(n,t,e={}){const i=(s,r,o)=>{const a=sl[r];if(typeof a!="function")throw new Error(`Invalid validator "${r}", expected function`);const c=n[s];if(!(o&&c===void 0)&&!a(c,n))throw new Error(`Invalid param ${String(s)}=${c} (${typeof c}), expected ${r}`)};for(const[s,r]of Object.entries(t))i(s,r,!1);for(const[s,r]of Object.entries(e))i(s,r,!0);return n}const rl=()=>{throw new Error("not implemented")};function Vn(n){const t=new WeakMap;return(e,...i)=>{const s=t.get(e);if(s!==void 0)return s;const r=n(e,...i);return t.set(e,r),r}}const ol=Object.freeze(Object.defineProperty({__proto__:null,aInRange:Ct,abool:fe,abytes:Le,bitGet:nl,bitLen:el,bitMask:Ei,bitSet:il,bytesToHex:pe,bytesToNumberBE:mt,bytesToNumberLE:bi,concatBytes:Gt,createHmacDrbg:Or,ensureBytes:et,equalBytes:Qa,hexToBytes:_e,hexToNumber:wi,inRange:ge,isBytes:jt,memoized:Vn,notImplemented:rl,numberToBytesBE:Nt,numberToBytesLE:xi,numberToHexUnpadded:kr,numberToVarBytesBE:Ja,utf8ToBytes:tl,validateObject:Be},Symbol.toStringTag,{value:"Module"}));/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const J=BigInt(0),K=BigInt(1),$t=BigInt(2),al=BigInt(3),Xn=BigInt(4),es=BigInt(5),ns=BigInt(8);BigInt(9);BigInt(16);function Q(n,t){const e=n%t;return e>=J?e:t+e}function ll(n,t,e){if(e<=J||t<J)throw new Error("Expected power/modulo > 0");if(e===K)return J;let i=K;for(;t>J;)t&K&&(i=i*n%e),n=n*n%e,t>>=K;return i}function st(n,t,e){let i=n;for(;t-- >J;)i*=i,i%=e;return i}function Zn(n,t){if(n===J||t<=J)throw new Error(`invert: expected positive integers, got n=${n} mod=${t}`);let e=Q(n,t),i=t,s=J,r=K;for(;e!==J;){const a=i/e,c=i%e,l=s-r*a;i=e,e=c,s=r,r=l}if(i!==K)throw new Error("invert: does not exist");return Q(s,t)}function hl(n){const t=(n-K)/$t;let e,i,s;for(e=n-K,i=0;e%$t===J;e/=$t,i++);for(s=$t;s<n&&ll(s,t,n)!==n-K;s++);if(i===1){const o=(n+K)/Xn;return function(c,l){const h=c.pow(l,o);if(!c.eql(c.sqr(h),l))throw new Error("Cannot find square root");return h}}const r=(e+K)/$t;return function(a,c){if(a.pow(c,t)===a.neg(a.ONE))throw new Error("Cannot find square root");let l=i,h=a.pow(a.mul(a.ONE,s),e),u=a.pow(c,r),d=a.pow(c,e);for(;!a.eql(d,a.ONE);){if(a.eql(d,a.ZERO))return a.ZERO;let m=1;for(let f=a.sqr(d);m<l&&!a.eql(f,a.ONE);m++)f=a.sqr(f);const x=a.pow(h,K<<BigInt(l-m-1));h=a.sqr(x),u=a.mul(u,x),d=a.mul(d,h),l=m}return u}}function cl(n){if(n%Xn===al){const t=(n+K)/Xn;return function(i,s){const r=i.pow(s,t);if(!i.eql(i.sqr(r),s))throw new Error("Cannot find square root");return r}}if(n%ns===es){const t=(n-es)/ns;return function(i,s){const r=i.mul(s,$t),o=i.pow(r,t),a=i.mul(s,o),c=i.mul(i.mul(a,$t),o),l=i.mul(a,i.sub(c,i.ONE));if(!i.eql(i.sqr(l),s))throw new Error("Cannot find square root");return l}}return hl(n)}const ul=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function dl(n){const t={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},e=ul.reduce((i,s)=>(i[s]="function",i),t);return Be(n,e)}function fl(n,t,e){if(e<J)throw new Error("Expected power > 0");if(e===J)return n.ONE;if(e===K)return t;let i=n.ONE,s=t;for(;e>J;)e&K&&(i=n.mul(i,s)),s=n.sqr(s),e>>=K;return i}function pl(n,t){const e=new Array(t.length),i=t.reduce((r,o,a)=>n.is0(o)?r:(e[a]=r,n.mul(r,o)),n.ONE),s=n.inv(i);return t.reduceRight((r,o,a)=>n.is0(o)?r:(e[a]=n.mul(r,e[a]),n.mul(r,o)),s),e}function Pr(n,t){const e=t!==void 0?t:n.toString(2).length,i=Math.ceil(e/8);return{nBitLength:e,nByteLength:i}}function _l(n,t,e=!1,i={}){if(n<=J)throw new Error(`Expected Field ORDER > 0, got ${n}`);const{nBitLength:s,nByteLength:r}=Pr(n,t);if(r>2048)throw new Error("Field lengths over 2048 bytes are not supported");const o=cl(n),a=Object.freeze({ORDER:n,BITS:s,BYTES:r,MASK:Ei(s),ZERO:J,ONE:K,create:c=>Q(c,n),isValid:c=>{if(typeof c!="bigint")throw new Error(`Invalid field element: expected bigint, got ${typeof c}`);return J<=c&&c<n},is0:c=>c===J,isOdd:c=>(c&K)===K,neg:c=>Q(-c,n),eql:(c,l)=>c===l,sqr:c=>Q(c*c,n),add:(c,l)=>Q(c+l,n),sub:(c,l)=>Q(c-l,n),mul:(c,l)=>Q(c*l,n),pow:(c,l)=>fl(a,c,l),div:(c,l)=>Q(c*Zn(l,n),n),sqrN:c=>c*c,addN:(c,l)=>c+l,subN:(c,l)=>c-l,mulN:(c,l)=>c*l,inv:c=>Zn(c,n),sqrt:i.sqrt||(c=>o(a,c)),invertBatch:c=>pl(a,c),cmov:(c,l,h)=>h?l:c,toBytes:c=>e?xi(c,r):Nt(c,r),fromBytes:c=>{if(c.length!==r)throw new Error(`Fp.fromBytes: expected ${r}, got ${c.length}`);return e?bi(c):mt(c)}});return Object.freeze(a)}function Dr(n){if(typeof n!="bigint")throw new Error("field order must be bigint");const t=n.toString(2).length;return Math.ceil(t/8)}function Lr(n){const t=Dr(n);return t+Math.ceil(t/2)}function gl(n,t,e=!1){const i=n.length,s=Dr(t),r=Lr(t);if(i<16||i<r||i>1024)throw new Error(`expected ${r}-1024 bytes of input, got ${i}`);const o=e?mt(n):bi(n),a=Q(o,t-K)+K;return e?xi(a,s):Nt(a,s)}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const ml=BigInt(0),Mn=BigInt(1),Un=new WeakMap,is=new WeakMap;function yl(n,t){const e=(r,o)=>{const a=o.negate();return r?a:o},i=r=>{if(!Number.isSafeInteger(r)||r<=0||r>t)throw new Error(`Wrong window size=${r}, should be [1..${t}]`)},s=r=>{i(r);const o=Math.ceil(t/r)+1,a=2**(r-1);return{windows:o,windowSize:a}};return{constTimeNegate:e,unsafeLadder(r,o){let a=n.ZERO,c=r;for(;o>ml;)o&Mn&&(a=a.add(c)),c=c.double(),o>>=Mn;return a},precomputeWindow(r,o){const{windows:a,windowSize:c}=s(o),l=[];let h=r,u=h;for(let d=0;d<a;d++){u=h,l.push(u);for(let m=1;m<c;m++)u=u.add(h),l.push(u);h=u.double()}return l},wNAF(r,o,a){const{windows:c,windowSize:l}=s(r);let h=n.ZERO,u=n.BASE;const d=BigInt(2**r-1),m=2**r,x=BigInt(r);for(let f=0;f<c;f++){const p=f*l;let w=Number(a&d);a>>=x,w>l&&(w-=m,a+=Mn);const v=p,N=p+Math.abs(w)-1,T=f%2!==0,R=w<0;w===0?u=u.add(e(T,o[v])):h=h.add(e(R,o[N]))}return{p:h,f:u}},wNAFCached(r,o,a){const c=is.get(r)||1;let l=Un.get(r);return l||(l=this.precomputeWindow(r,c),c!==1&&Un.set(r,a(l))),this.wNAF(c,l,o)},setWindowSize(r,o){i(o),is.set(r,o),Un.delete(r)}}}function Br(n){return dl(n.Fp),Be(n,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...Pr(n.n,n.nBitLength),...n,p:n.Fp.ORDER})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function ss(n){n.lowS!==void 0&&fe("lowS",n.lowS),n.prehash!==void 0&&fe("prehash",n.prehash)}function wl(n){const t=Br(n);Be(t,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});const{endo:e,Fp:i,a:s}=t;if(e){if(!i.eql(s,i.ZERO))throw new Error("Endomorphism can only be defined for Koblitz curves that have a=0");if(typeof e!="object"||typeof e.beta!="bigint"||typeof e.splitScalar!="function")throw new Error("Expected endomorphism with beta: bigint and splitScalar: function")}return Object.freeze({...t})}const{bytesToNumberBE:bl,hexToBytes:xl}=ol,qt={Err:class extends Error{constructor(t=""){super(t)}},_parseInt(n){const{Err:t}=qt;if(n.length<2||n[0]!==2)throw new t("Invalid signature integer tag");const e=n[1],i=n.subarray(2,e+2);if(!e||i.length!==e)throw new t("Invalid signature integer: wrong length");if(i[0]&128)throw new t("Invalid signature integer: negative");if(i[0]===0&&!(i[1]&128))throw new t("Invalid signature integer: unnecessary leading zero");return{d:bl(i),l:n.subarray(e+2)}},toSig(n){const{Err:t}=qt,e=typeof n=="string"?xl(n):n;Le(e);let i=e.length;if(i<2||e[0]!=48)throw new t("Invalid signature tag");if(e[1]!==i-2)throw new t("Invalid signature: incorrect length");const{d:s,l:r}=qt._parseInt(e.subarray(2)),{d:o,l:a}=qt._parseInt(r);if(a.length)throw new t("Invalid signature: left bytes after parsing");return{r:s,s:o}},hexFromSig(n){const t=l=>Number.parseInt(l[0],16)&8?"00"+l:l,e=l=>{const h=l.toString(16);return h.length&1?`0${h}`:h},i=t(e(n.s)),s=t(e(n.r)),r=i.length/2,o=s.length/2,a=e(r),c=e(o);return`30${e(o+r+4)}02${c}${s}02${a}${i}`}},St=BigInt(0),Z=BigInt(1);BigInt(2);const rs=BigInt(3);BigInt(4);function El(n){const t=wl(n),{Fp:e}=t,i=t.toBytes||((x,f,p)=>{const w=f.toAffine();return Gt(Uint8Array.from([4]),e.toBytes(w.x),e.toBytes(w.y))}),s=t.fromBytes||(x=>{const f=x.subarray(1),p=e.fromBytes(f.subarray(0,e.BYTES)),w=e.fromBytes(f.subarray(e.BYTES,2*e.BYTES));return{x:p,y:w}});function r(x){const{a:f,b:p}=t,w=e.sqr(x),v=e.mul(w,x);return e.add(e.add(v,e.mul(x,f)),p)}if(!e.eql(e.sqr(t.Gy),r(t.Gx)))throw new Error("bad generator point: equation left != right");function o(x){return ge(x,Z,t.n)}function a(x){const{allowedPrivateKeyLengths:f,nByteLength:p,wrapPrivateKey:w,n:v}=t;if(f&&typeof x!="bigint"){if(jt(x)&&(x=pe(x)),typeof x!="string"||!f.includes(x.length))throw new Error("Invalid key");x=x.padStart(p*2,"0")}let N;try{N=typeof x=="bigint"?x:mt(et("private key",x,p))}catch{throw new Error(`private key must be ${p} bytes, hex or bigint, not ${typeof x}`)}return w&&(N=Q(N,v)),Ct("private key",N,Z,v),N}function c(x){if(!(x instanceof u))throw new Error("ProjectivePoint expected")}const l=Vn((x,f)=>{const{px:p,py:w,pz:v}=x;if(e.eql(v,e.ONE))return{x:p,y:w};const N=x.is0();f==null&&(f=N?e.ONE:e.inv(v));const T=e.mul(p,f),R=e.mul(w,f),C=e.mul(v,f);if(N)return{x:e.ZERO,y:e.ZERO};if(!e.eql(C,e.ONE))throw new Error("invZ was invalid");return{x:T,y:R}}),h=Vn(x=>{if(x.is0()){if(t.allowInfinityPoint&&!e.is0(x.py))return;throw new Error("bad point: ZERO")}const{x:f,y:p}=x.toAffine();if(!e.isValid(f)||!e.isValid(p))throw new Error("bad point: x or y not FE");const w=e.sqr(p),v=r(f);if(!e.eql(w,v))throw new Error("bad point: equation left != right");if(!x.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});class u{constructor(f,p,w){if(this.px=f,this.py=p,this.pz=w,f==null||!e.isValid(f))throw new Error("x required");if(p==null||!e.isValid(p))throw new Error("y required");if(w==null||!e.isValid(w))throw new Error("z required");Object.freeze(this)}static fromAffine(f){const{x:p,y:w}=f||{};if(!f||!e.isValid(p)||!e.isValid(w))throw new Error("invalid affine point");if(f instanceof u)throw new Error("projective point not allowed");const v=N=>e.eql(N,e.ZERO);return v(p)&&v(w)?u.ZERO:new u(p,w,e.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(f){const p=e.invertBatch(f.map(w=>w.pz));return f.map((w,v)=>w.toAffine(p[v])).map(u.fromAffine)}static fromHex(f){const p=u.fromAffine(s(et("pointHex",f)));return p.assertValidity(),p}static fromPrivateKey(f){return u.BASE.multiply(a(f))}_setWindowSize(f){m.setWindowSize(this,f)}assertValidity(){h(this)}hasEvenY(){const{y:f}=this.toAffine();if(e.isOdd)return!e.isOdd(f);throw new Error("Field doesn't support isOdd")}equals(f){c(f);const{px:p,py:w,pz:v}=this,{px:N,py:T,pz:R}=f,C=e.eql(e.mul(p,R),e.mul(N,v)),I=e.eql(e.mul(w,R),e.mul(T,v));return C&&I}negate(){return new u(this.px,e.neg(this.py),this.pz)}double(){const{a:f,b:p}=t,w=e.mul(p,rs),{px:v,py:N,pz:T}=this;let R=e.ZERO,C=e.ZERO,I=e.ZERO,k=e.mul(v,v),Y=e.mul(N,N),D=e.mul(T,T),O=e.mul(v,N);return O=e.add(O,O),I=e.mul(v,T),I=e.add(I,I),R=e.mul(f,I),C=e.mul(w,D),C=e.add(R,C),R=e.sub(Y,C),C=e.add(Y,C),C=e.mul(R,C),R=e.mul(O,R),I=e.mul(w,I),D=e.mul(f,D),O=e.sub(k,D),O=e.mul(f,O),O=e.add(O,I),I=e.add(k,k),k=e.add(I,k),k=e.add(k,D),k=e.mul(k,O),C=e.add(C,k),D=e.mul(N,T),D=e.add(D,D),k=e.mul(D,O),R=e.sub(R,k),I=e.mul(D,Y),I=e.add(I,I),I=e.add(I,I),new u(R,C,I)}add(f){c(f);const{px:p,py:w,pz:v}=this,{px:N,py:T,pz:R}=f;let C=e.ZERO,I=e.ZERO,k=e.ZERO;const Y=t.a,D=e.mul(t.b,rs);let O=e.mul(p,N),_=e.mul(w,T),E=e.mul(v,R),y=e.add(p,w),g=e.add(N,T);y=e.mul(y,g),g=e.add(O,_),y=e.sub(y,g),g=e.add(p,v);let b=e.add(N,R);return g=e.mul(g,b),b=e.add(O,E),g=e.sub(g,b),b=e.add(w,v),C=e.add(T,R),b=e.mul(b,C),C=e.add(_,E),b=e.sub(b,C),k=e.mul(Y,g),C=e.mul(D,E),k=e.add(C,k),C=e.sub(_,k),k=e.add(_,k),I=e.mul(C,k),_=e.add(O,O),_=e.add(_,O),E=e.mul(Y,E),g=e.mul(D,g),_=e.add(_,E),E=e.sub(O,E),E=e.mul(Y,E),g=e.add(g,E),O=e.mul(_,g),I=e.add(I,O),O=e.mul(b,g),C=e.mul(y,C),C=e.sub(C,O),O=e.mul(y,_),k=e.mul(b,k),k=e.add(k,O),new u(C,I,k)}subtract(f){return this.add(f.negate())}is0(){return this.equals(u.ZERO)}wNAF(f){return m.wNAFCached(this,f,u.normalizeZ)}multiplyUnsafe(f){Ct("scalar",f,St,t.n);const p=u.ZERO;if(f===St)return p;if(f===Z)return this;const{endo:w}=t;if(!w)return m.unsafeLadder(this,f);let{k1neg:v,k1:N,k2neg:T,k2:R}=w.splitScalar(f),C=p,I=p,k=this;for(;N>St||R>St;)N&Z&&(C=C.add(k)),R&Z&&(I=I.add(k)),k=k.double(),N>>=Z,R>>=Z;return v&&(C=C.negate()),T&&(I=I.negate()),I=new u(e.mul(I.px,w.beta),I.py,I.pz),C.add(I)}multiply(f){const{endo:p,n:w}=t;Ct("scalar",f,Z,w);let v,N;if(p){const{k1neg:T,k1:R,k2neg:C,k2:I}=p.splitScalar(f);let{p:k,f:Y}=this.wNAF(R),{p:D,f:O}=this.wNAF(I);k=m.constTimeNegate(T,k),D=m.constTimeNegate(C,D),D=new u(e.mul(D.px,p.beta),D.py,D.pz),v=k.add(D),N=Y.add(O)}else{const{p:T,f:R}=this.wNAF(f);v=T,N=R}return u.normalizeZ([v,N])[0]}multiplyAndAddUnsafe(f,p,w){const v=u.BASE,N=(R,C)=>C===St||C===Z||!R.equals(v)?R.multiplyUnsafe(C):R.multiply(C),T=N(this,p).add(N(f,w));return T.is0()?void 0:T}toAffine(f){return l(this,f)}isTorsionFree(){const{h:f,isTorsionFree:p}=t;if(f===Z)return!0;if(p)return p(u,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:f,clearCofactor:p}=t;return f===Z?this:p?p(u,this):this.multiplyUnsafe(t.h)}toRawBytes(f=!0){return fe("isCompressed",f),this.assertValidity(),i(u,this,f)}toHex(f=!0){return fe("isCompressed",f),pe(this.toRawBytes(f))}}u.BASE=new u(t.Gx,t.Gy,e.ONE),u.ZERO=new u(e.ZERO,e.ONE,e.ZERO);const d=t.nBitLength,m=yl(u,t.endo?Math.ceil(d/2):d);return{CURVE:t,ProjectivePoint:u,normPrivateKeyToScalar:a,weierstrassEquation:r,isWithinCurveOrder:o}}function Sl(n){const t=Br(n);return Be(t,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...t})}function vl(n){const t=Sl(n),{Fp:e,n:i}=t,s=e.BYTES+1,r=2*e.BYTES+1;function o(y){return Q(y,i)}function a(y){return Zn(y,i)}const{ProjectivePoint:c,normPrivateKeyToScalar:l,weierstrassEquation:h,isWithinCurveOrder:u}=El({...t,toBytes(y,g,b){const S=g.toAffine(),A=e.toBytes(S.x),P=Gt;return fe("isCompressed",b),b?P(Uint8Array.from([g.hasEvenY()?2:3]),A):P(Uint8Array.from([4]),A,e.toBytes(S.y))},fromBytes(y){const g=y.length,b=y[0],S=y.subarray(1);if(g===s&&(b===2||b===3)){const A=mt(S);if(!ge(A,Z,e.ORDER))throw new Error("Point is not on curve");const P=h(A);let M;try{M=e.sqrt(P)}catch(L){const W=L instanceof Error?": "+L.message:"";throw new Error("Point is not on curve"+W)}const U=(M&Z)===Z;return(b&1)===1!==U&&(M=e.neg(M)),{x:A,y:M}}else if(g===r&&b===4){const A=e.fromBytes(S.subarray(0,e.BYTES)),P=e.fromBytes(S.subarray(e.BYTES,2*e.BYTES));return{x:A,y:P}}else throw new Error(`Point of length ${g} was invalid. Expected ${s} compressed bytes or ${r} uncompressed bytes`)}}),d=y=>pe(Nt(y,t.nByteLength));function m(y){const g=i>>Z;return y>g}function x(y){return m(y)?o(-y):y}const f=(y,g,b)=>mt(y.slice(g,b));class p{constructor(g,b,S){this.r=g,this.s=b,this.recovery=S,this.assertValidity()}static fromCompact(g){const b=t.nByteLength;return g=et("compactSignature",g,b*2),new p(f(g,0,b),f(g,b,2*b))}static fromDER(g){const{r:b,s:S}=qt.toSig(et("DER",g));return new p(b,S)}assertValidity(){Ct("r",this.r,Z,i),Ct("s",this.s,Z,i)}addRecoveryBit(g){return new p(this.r,this.s,g)}recoverPublicKey(g){const{r:b,s:S,recovery:A}=this,P=C(et("msgHash",g));if(A==null||![0,1,2,3].includes(A))throw new Error("recovery id invalid");const M=A===2||A===3?b+t.n:b;if(M>=e.ORDER)throw new Error("recovery id 2 or 3 invalid");const U=A&1?"03":"02",V=c.fromHex(U+d(M)),L=a(M),W=o(-P*L),tt=o(S*L),j=c.BASE.multiplyAndAddUnsafe(V,W,tt);if(!j)throw new Error("point at infinify");return j.assertValidity(),j}hasHighS(){return m(this.s)}normalizeS(){return this.hasHighS()?new p(this.r,o(-this.s),this.recovery):this}toDERRawBytes(){return _e(this.toDERHex())}toDERHex(){return qt.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return _e(this.toCompactHex())}toCompactHex(){return d(this.r)+d(this.s)}}const w={isValidPrivateKey(y){try{return l(y),!0}catch{return!1}},normPrivateKeyToScalar:l,randomPrivateKey:()=>{const y=Lr(t.n);return gl(t.randomBytes(y),t.n)},precompute(y=8,g=c.BASE){return g._setWindowSize(y),g.multiply(BigInt(3)),g}};function v(y,g=!0){return c.fromPrivateKey(y).toRawBytes(g)}function N(y){const g=jt(y),b=typeof y=="string",S=(g||b)&&y.length;return g?S===s||S===r:b?S===2*s||S===2*r:y instanceof c}function T(y,g,b=!0){if(N(y))throw new Error("first arg must be private key");if(!N(g))throw new Error("second arg must be public key");return c.fromHex(g).multiply(l(y)).toRawBytes(b)}const R=t.bits2int||function(y){const g=mt(y),b=y.length*8-t.nBitLength;return b>0?g>>BigInt(b):g},C=t.bits2int_modN||function(y){return o(R(y))},I=Ei(t.nBitLength);function k(y){return Ct(`num < 2^${t.nBitLength}`,y,St,I),Nt(y,t.nByteLength)}function Y(y,g,b=D){if(["recovered","canonical"].some(z=>z in b))throw new Error("sign() legacy options not supported");const{hash:S,randomBytes:A}=t;let{lowS:P,prehash:M,extraEntropy:U}=b;P==null&&(P=!0),y=et("msgHash",y),ss(b),M&&(y=et("prehashed msgHash",S(y)));const V=C(y),L=l(g),W=[k(L),k(V)];if(U!=null&&U!==!1){const z=U===!0?A(e.BYTES):U;W.push(et("extraEntropy",z))}const tt=Gt(...W),j=V;function ot(z){const q=R(z);if(!u(q))return;const X=a(q),$=c.BASE.multiply(q).toAffine(),H=o($.x);if(H===St)return;const ht=o(X*o(j+H*L));if(ht===St)return;let Ot=($.x===H?0:2)|Number($.y&Z),kn=ht;return P&&m(ht)&&(kn=x(ht),Ot^=1),new p(H,kn,Ot)}return{seed:tt,k2sig:ot}}const D={lowS:t.lowS,prehash:!1},O={lowS:t.lowS,prehash:!1};function _(y,g,b=D){const{seed:S,k2sig:A}=Y(y,g,b),P=t;return Or(P.hash.outputLen,P.nByteLength,P.hmac)(S,A)}c.BASE._setWindowSize(8);function E(y,g,b,S=O){var $;const A=y;if(g=et("msgHash",g),b=et("publicKey",b),"strict"in S)throw new Error("options.strict was renamed to lowS");ss(S);const{lowS:P,prehash:M}=S;let U,V;try{if(typeof A=="string"||jt(A))try{U=p.fromDER(A)}catch(H){if(!(H instanceof qt.Err))throw H;U=p.fromCompact(A)}else if(typeof A=="object"&&typeof A.r=="bigint"&&typeof A.s=="bigint"){const{r:H,s:ht}=A;U=new p(H,ht)}else throw new Error("PARSE");V=c.fromHex(b)}catch(H){if(H.message==="PARSE")throw new Error("signature must be Signature instance, Uint8Array or hex string");return!1}if(P&&U.hasHighS())return!1;M&&(g=t.hash(g));const{r:L,s:W}=U,tt=C(g),j=a(W),ot=o(tt*j),z=o(L*j),q=($=c.BASE.multiplyAndAddUnsafe(V,ot,z))==null?void 0:$.toAffine();return q?o(q.x)===L:!1}return{CURVE:t,getPublicKey:v,getSharedSecret:T,sign:_,verify:E,ProjectivePoint:c,Signature:p,utils:w}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function Al(n){return{hash:n,hmac:(t,...e)=>Nr(n,t,qa(...e)),randomBytes:Rr}}function Cl(n,t){const e=i=>vl({...n,...Al(i)});return Object.freeze({...e(t),create:e})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Me=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),fn=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),Ae=BigInt(1),pn=BigInt(2),os=(n,t)=>(n+t/pn)/t;function Mr(n){const t=Me,e=BigInt(3),i=BigInt(6),s=BigInt(11),r=BigInt(22),o=BigInt(23),a=BigInt(44),c=BigInt(88),l=n*n*n%t,h=l*l*n%t,u=st(h,e,t)*h%t,d=st(u,e,t)*h%t,m=st(d,pn,t)*l%t,x=st(m,s,t)*m%t,f=st(x,r,t)*x%t,p=st(f,a,t)*f%t,w=st(p,c,t)*p%t,v=st(w,a,t)*f%t,N=st(v,e,t)*h%t,T=st(N,o,t)*x%t,R=st(T,i,t)*l%t,C=st(R,pn,t);if(!Jn.eql(Jn.sqr(C),n))throw new Error("Cannot find square root");return C}const Jn=_l(Me,void 0,void 0,{sqrt:Mr}),Si=Cl({a:BigInt(0),b:BigInt(7),Fp:Jn,n:fn,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:n=>{const t=fn,e=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),i=-Ae*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),s=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),r=e,o=BigInt("0x100000000000000000000000000000000"),a=os(r*n,t),c=os(-i*n,t);let l=Q(n-a*e-c*s,t),h=Q(-a*i-c*r,t);const u=l>o,d=h>o;if(u&&(l=t-l),d&&(h=t-h),l>o||h>o)throw new Error("splitScalar: Endomorphism failed, k="+n);return{k1neg:u,k1:l,k2neg:d,k2:h}}}},Kn),Ur=BigInt(0),as={};function _n(n,...t){let e=as[n];if(e===void 0){const i=Kn(Uint8Array.from(n,s=>s.charCodeAt(0)));e=Gt(i,i),as[n]=e}return Kn(Gt(e,...t))}const vi=n=>n.toRawBytes(!0).slice(1),Qn=n=>Nt(n,32),Fn=n=>Q(n,Me),Ce=n=>Q(n,fn),Ai=Si.ProjectivePoint,Tl=(n,t,e)=>Ai.BASE.multiplyAndAddUnsafe(n,t,e);function ti(n){let t=Si.utils.normPrivateKeyToScalar(n),e=Ai.fromPrivateKey(t);return{scalar:e.hasEvenY()?t:Ce(-t),bytes:vi(e)}}function Fr(n){Ct("x",n,Ae,Me);const t=Fn(n*n),e=Fn(t*n+BigInt(7));let i=Mr(e);i%pn!==Ur&&(i=Fn(-i));const s=new Ai(n,i,Ae);return s.assertValidity(),s}const oe=mt;function $r(...n){return Ce(oe(_n("BIP0340/challenge",...n)))}function Rl(n){return ti(n).bytes}function Il(n,t,e=Rr(32)){const i=et("message",n),{bytes:s,scalar:r}=ti(t),o=et("auxRand",e,32),a=Qn(r^oe(_n("BIP0340/aux",o))),c=_n("BIP0340/nonce",a,s,i),l=Ce(oe(c));if(l===Ur)throw new Error("sign failed: k is zero");const{bytes:h,scalar:u}=ti(l),d=$r(h,s,i),m=new Uint8Array(64);if(m.set(h,0),m.set(Qn(Ce(u+d*r)),32),!Hr(m,i,s))throw new Error("sign: Invalid signature produced");return m}function Hr(n,t,e){const i=et("signature",n,64),s=et("message",t),r=et("publicKey",e,32);try{const o=Fr(oe(r)),a=oe(i.subarray(0,32));if(!ge(a,Ae,Me))return!1;const c=oe(i.subarray(32,64));if(!ge(c,Ae,fn))return!1;const l=$r(Qn(a),vi(o),s),h=Tl(o,c,Ce(-l));return!(!h||!h.hasEvenY()||h.toAffine().x!==a)}catch{return!1}}const Ci={getPublicKey:Rl,sign:Il,verify:Hr,utils:{randomPrivateKey:Si.utils.randomPrivateKey,lift_x:Fr,pointToBytes:vi,numberToBytesBE:Nt,bytesToNumberBE:mt,taggedHash:_n,mod:Q}},Te="Trystero",Re=(n,t)=>Array(n).fill().map(t),ls="0123456789AaBbCcDdEeFfGgHhIiJjKkLlMmNnOoPpQqRrSsTtUuVvWwXxYyZz",ei=n=>Re(n,()=>ls[Math.floor(Math.random()*ls.length)]).join(""),ie=ei(20),se=Promise.all.bind(Promise),Ti=typeof window<"u",{entries:hs,fromEntries:Nl,keys:kl}=Object,Bt=()=>{},_t=n=>new Error(`${Te}: ${n}`),Ol=new TextEncoder,Pl=new TextDecoder,Wt=n=>Ol.encode(n),Je=n=>Pl.decode(n),ni=n=>n.reduce((t,e)=>t+e.toString(16).padStart(2,"0"),""),We=(...n)=>n.join("@"),Dl=(n,t,e)=>(n.relayUrls||t).slice(0,n.relayUrls?n.relayUrls.length:n.relayRedundancy||e),wt=JSON.stringify,gn=JSON.parse,cs=3333,te={},Ll=(n,t)=>{const e={},i=()=>{const s=new WebSocket(n);s.onclose=()=>{te[n]??(te[n]=cs),setTimeout(i,te[n]),te[n]*=2},s.onmessage=r=>t(r.data),e.socket=s,e.url=s.url,e.ready=new Promise(r=>s.onopen=()=>{r(e),te[n]=cs}),e.send=r=>{s.readyState===1&&s.send(r)}};return i(),e},Ri="AES-GCM",$n={},Bl=n=>btoa(String.fromCharCode.apply(null,new Uint8Array(n))),Ml=n=>{const t=atob(n);return new Uint8Array(t.length).map((e,i)=>t.charCodeAt(i)).buffer},Ye=async n=>{if($n[n])return $n[n];const t=Array.from(new Uint8Array(await crypto.subtle.digest("SHA-1",Wt(n)))).map(e=>e.toString(36)).join("");return $n[n]=t,t},Ul=async(n,t,e)=>crypto.subtle.importKey("raw",await crypto.subtle.digest({name:"SHA-256"},Wt(`${n}:${t}:${e}`)),{name:Ri},!1,["encrypt","decrypt"]),qr="$",Wr=",",Fl=async(n,t)=>{const e=crypto.getRandomValues(new Uint8Array(16));return e.join(Wr)+qr+Bl(await crypto.subtle.encrypt({name:Ri,iv:e},await n,Wt(t)))},$l=async(n,t)=>{const[e,i]=t.split(qr);return Je(await crypto.subtle.decrypt({name:Ri,iv:new Uint8Array(e.split(Wr))},await n,Ml(i)))};function Yr(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var ii={exports:{}},Hn,us;function Hl(){if(us)return Hn;us=1;var n=1e3,t=n*60,e=t*60,i=e*24,s=i*7,r=i*365.25;Hn=function(h,u){u=u||{};var d=typeof h;if(d==="string"&&h.length>0)return o(h);if(d==="number"&&isFinite(h))return u.long?c(h):a(h);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(h))};function o(h){if(h=String(h),!(h.length>100)){var u=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(h);if(u){var d=parseFloat(u[1]),m=(u[2]||"ms").toLowerCase();switch(m){case"years":case"year":case"yrs":case"yr":case"y":return d*r;case"weeks":case"week":case"w":return d*s;case"days":case"day":case"d":return d*i;case"hours":case"hour":case"hrs":case"hr":case"h":return d*e;case"minutes":case"minute":case"mins":case"min":case"m":return d*t;case"seconds":case"second":case"secs":case"sec":case"s":return d*n;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return d;default:return}}}}function a(h){var u=Math.abs(h);return u>=i?Math.round(h/i)+"d":u>=e?Math.round(h/e)+"h":u>=t?Math.round(h/t)+"m":u>=n?Math.round(h/n)+"s":h+"ms"}function c(h){var u=Math.abs(h);return u>=i?l(h,u,i,"day"):u>=e?l(h,u,e,"hour"):u>=t?l(h,u,t,"minute"):u>=n?l(h,u,n,"second"):h+" ms"}function l(h,u,d,m){var x=u>=d*1.5;return Math.round(h/d)+" "+m+(x?"s":"")}return Hn}function ql(n){e.debug=e,e.default=e,e.coerce=c,e.disable=r,e.enable=s,e.enabled=o,e.humanize=Hl(),e.destroy=l,Object.keys(n).forEach(h=>{e[h]=n[h]}),e.names=[],e.skips=[],e.formatters={};function t(h){let u=0;for(let d=0;d<h.length;d++)u=(u<<5)-u+h.charCodeAt(d),u|=0;return e.colors[Math.abs(u)%e.colors.length]}e.selectColor=t;function e(h){let u,d=null,m,x;function f(...p){if(!f.enabled)return;const w=f,v=Number(new Date),N=v-(u||v);w.diff=N,w.prev=u,w.curr=v,u=v,p[0]=e.coerce(p[0]),typeof p[0]!="string"&&p.unshift("%O");let T=0;p[0]=p[0].replace(/%([a-zA-Z%])/g,(C,I)=>{if(C==="%%")return"%";T++;const k=e.formatters[I];if(typeof k=="function"){const Y=p[T];C=k.call(w,Y),p.splice(T,1),T--}return C}),e.formatArgs.call(w,p),(w.log||e.log).apply(w,p)}return f.namespace=h,f.useColors=e.useColors(),f.color=e.selectColor(h),f.extend=i,f.destroy=e.destroy,Object.defineProperty(f,"enabled",{enumerable:!0,configurable:!1,get:()=>d!==null?d:(m!==e.namespaces&&(m=e.namespaces,x=e.enabled(h)),x),set:p=>{d=p}}),typeof e.init=="function"&&e.init(f),f}function i(h,u){const d=e(this.namespace+(typeof u>"u"?":":u)+h);return d.log=this.log,d}function s(h){e.save(h),e.namespaces=h,e.names=[],e.skips=[];let u;const d=(typeof h=="string"?h:"").split(/[\s,]+/),m=d.length;for(u=0;u<m;u++)d[u]&&(h=d[u].replace(/\*/g,".*?"),h[0]==="-"?e.skips.push(new RegExp("^"+h.slice(1)+"$")):e.names.push(new RegExp("^"+h+"$")))}function r(){const h=[...e.names.map(a),...e.skips.map(a).map(u=>"-"+u)].join(",");return e.enable(""),h}function o(h){if(h[h.length-1]==="*")return!0;let u,d;for(u=0,d=e.skips.length;u<d;u++)if(e.skips[u].test(h))return!1;for(u=0,d=e.names.length;u<d;u++)if(e.names[u].test(h))return!0;return!1}function a(h){return h.toString().substring(2,h.toString().length-2).replace(/\.\*\?$/,"*")}function c(h){return h instanceof Error?h.stack||h.message:h}function l(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return e.enable(e.load()),e}var Wl=ql;(function(n,t){var e={};t.formatArgs=s,t.save=r,t.load=o,t.useColors=i,t.storage=a(),t.destroy=(()=>{let l=!1;return()=>{l||(l=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function i(){if(typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))return!0;if(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let l;return typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&(l=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(l[1],10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function s(l){if(l[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+l[0]+(this.useColors?"%c ":" ")+"+"+n.exports.humanize(this.diff),!this.useColors)return;const h="color: "+this.color;l.splice(1,0,h,"color: inherit");let u=0,d=0;l[0].replace(/%[a-zA-Z%]/g,m=>{m!=="%%"&&(u++,m==="%c"&&(d=u))}),l.splice(d,0,h)}t.log=console.debug||console.log||(()=>{});function r(l){try{l?t.storage.setItem("debug",l):t.storage.removeItem("debug")}catch{}}function o(){let l;try{l=t.storage.getItem("debug")}catch{}return!l&&typeof process<"u"&&"env"in process&&(l=e.DEBUG),l}function a(){try{return localStorage}catch{}}n.exports=Wl(t);const{formatters:c}=n.exports;c.j=function(l){try{return JSON.stringify(l)}catch(h){return"[UnexpectedJSONParseError]: "+h.message}}})(ii,ii.exports);var Yl=ii.exports;const jl=Yr(Yl),yt=typeof window<"u"?window:self,si=yt.RTCPeerConnection||yt.mozRTCPeerConnection||yt.webkitRTCPeerConnection,Gl=yt.RTCSessionDescription||yt.mozRTCSessionDescription||yt.webkitRTCSessionDescription,zl=yt.RTCIceCandidate||yt.mozRTCIceCandidate||yt.webkitRTCIceCandidate;var Ii={exports:{}},ae=typeof Reflect=="object"?Reflect:null,ds=ae&&typeof ae.apply=="function"?ae.apply:function(t,e,i){return Function.prototype.apply.call(t,e,i)},Qe;ae&&typeof ae.ownKeys=="function"?Qe=ae.ownKeys:Object.getOwnPropertySymbols?Qe=function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:Qe=function(t){return Object.getOwnPropertyNames(t)};function Kl(n){console&&console.warn&&console.warn(n)}var jr=Number.isNaN||function(t){return t!==t};function F(){F.init.call(this)}Ii.exports=F;Ii.exports.once=Jl;F.EventEmitter=F;F.prototype._events=void 0;F.prototype._eventsCount=0;F.prototype._maxListeners=void 0;var fs=10;function Cn(n){if(typeof n!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof n)}Object.defineProperty(F,"defaultMaxListeners",{enumerable:!0,get:function(){return fs},set:function(n){if(typeof n!="number"||n<0||jr(n))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+n+".");fs=n}});F.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};F.prototype.setMaxListeners=function(t){if(typeof t!="number"||t<0||jr(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this};function Gr(n){return n._maxListeners===void 0?F.defaultMaxListeners:n._maxListeners}F.prototype.getMaxListeners=function(){return Gr(this)};F.prototype.emit=function(t){for(var e=[],i=1;i<arguments.length;i++)e.push(arguments[i]);var s=t==="error",r=this._events;if(r!==void 0)s=s&&r.error===void 0;else if(!s)return!1;if(s){var o;if(e.length>0&&(o=e[0]),o instanceof Error)throw o;var a=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw a.context=o,a}var c=r[t];if(c===void 0)return!1;if(typeof c=="function")ds(c,this,e);else for(var l=c.length,h=Zr(c,l),i=0;i<l;++i)ds(h[i],this,e);return!0};function zr(n,t,e,i){var s,r,o;if(Cn(e),r=n._events,r===void 0?(r=n._events=Object.create(null),n._eventsCount=0):(r.newListener!==void 0&&(n.emit("newListener",t,e.listener?e.listener:e),r=n._events),o=r[t]),o===void 0)o=r[t]=e,++n._eventsCount;else if(typeof o=="function"?o=r[t]=i?[e,o]:[o,e]:i?o.unshift(e):o.push(e),s=Gr(n),s>0&&o.length>s&&!o.warned){o.warned=!0;var a=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");a.name="MaxListenersExceededWarning",a.emitter=n,a.type=t,a.count=o.length,Kl(a)}return n}F.prototype.addListener=function(t,e){return zr(this,t,e,!1)};F.prototype.on=F.prototype.addListener;F.prototype.prependListener=function(t,e){return zr(this,t,e,!0)};function Vl(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function Kr(n,t,e){var i={fired:!1,wrapFn:void 0,target:n,type:t,listener:e},s=Vl.bind(i);return s.listener=e,i.wrapFn=s,s}F.prototype.once=function(t,e){return Cn(e),this.on(t,Kr(this,t,e)),this};F.prototype.prependOnceListener=function(t,e){return Cn(e),this.prependListener(t,Kr(this,t,e)),this};F.prototype.removeListener=function(t,e){var i,s,r,o,a;if(Cn(e),s=this._events,s===void 0)return this;if(i=s[t],i===void 0)return this;if(i===e||i.listener===e)--this._eventsCount===0?this._events=Object.create(null):(delete s[t],s.removeListener&&this.emit("removeListener",t,i.listener||e));else if(typeof i!="function"){for(r=-1,o=i.length-1;o>=0;o--)if(i[o]===e||i[o].listener===e){a=i[o].listener,r=o;break}if(r<0)return this;r===0?i.shift():Xl(i,r),i.length===1&&(s[t]=i[0]),s.removeListener!==void 0&&this.emit("removeListener",t,a||e)}return this};F.prototype.off=F.prototype.removeListener;F.prototype.removeAllListeners=function(t){var e,i,s;if(i=this._events,i===void 0)return this;if(i.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):i[t]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete i[t]),this;if(arguments.length===0){var r=Object.keys(i),o;for(s=0;s<r.length;++s)o=r[s],o!=="removeListener"&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(e=i[t],typeof e=="function")this.removeListener(t,e);else if(e!==void 0)for(s=e.length-1;s>=0;s--)this.removeListener(t,e[s]);return this};function Vr(n,t,e){var i=n._events;if(i===void 0)return[];var s=i[t];return s===void 0?[]:typeof s=="function"?e?[s.listener||s]:[s]:e?Zl(s):Zr(s,s.length)}F.prototype.listeners=function(t){return Vr(this,t,!0)};F.prototype.rawListeners=function(t){return Vr(this,t,!1)};F.listenerCount=function(n,t){return typeof n.listenerCount=="function"?n.listenerCount(t):Xr.call(n,t)};F.prototype.listenerCount=Xr;function Xr(n){var t=this._events;if(t!==void 0){var e=t[n];if(typeof e=="function")return 1;if(e!==void 0)return e.length}return 0}F.prototype.eventNames=function(){return this._eventsCount>0?Qe(this._events):[]};function Zr(n,t){for(var e=new Array(t),i=0;i<t;++i)e[i]=n[i];return e}function Xl(n,t){for(;t+1<n.length;t++)n[t]=n[t+1];n.pop()}function Zl(n){for(var t=new Array(n.length),e=0;e<t.length;++e)t[e]=n[e].listener||n[e];return t}function Jl(n,t){return new Promise(function(e,i){function s(o){n.removeListener(t,r),i(o)}function r(){typeof n.removeListener=="function"&&n.removeListener("error",s),e([].slice.call(arguments))}Jr(n,t,r,{once:!0}),t!=="error"&&Ql(n,s,{once:!0})})}function Ql(n,t,e){typeof n.on=="function"&&Jr(n,"error",t,e)}function Jr(n,t,e,i){if(typeof n.on=="function")i.once?n.once(t,e):n.on(t,e);else if(typeof n.addEventListener=="function")n.addEventListener(t,function s(r){i.once&&n.removeEventListener(t,s),e(r)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof n)}var th=Ii.exports,eh=typeof queueMicrotask=="function"?queueMicrotask:n=>Promise.resolve().then(n),nh=class{constructor(t){if(!(t>0)||t-1&t)throw new Error("Max size for a FixedFIFO should be a power of two");this.buffer=new Array(t),this.mask=t-1,this.top=0,this.btm=0,this.next=null}clear(){this.top=this.btm=0,this.next=null,this.buffer.fill(void 0)}push(t){return this.buffer[this.top]!==void 0?!1:(this.buffer[this.top]=t,this.top=this.top+1&this.mask,!0)}shift(){const t=this.buffer[this.btm];if(t!==void 0)return this.buffer[this.btm]=void 0,this.btm=this.btm+1&this.mask,t}peek(){return this.buffer[this.btm]}isEmpty(){return this.buffer[this.btm]===void 0}};const ps=nh;var ih=class{constructor(t){this.hwm=t||16,this.head=new ps(this.hwm),this.tail=this.head,this.length=0}clear(){this.head=this.tail,this.head.clear(),this.length=0}push(t){if(this.length++,!this.head.push(t)){const e=this.head;this.head=e.next=new ps(2*this.head.buffer.length),this.head.push(t)}}shift(){this.length!==0&&this.length--;const t=this.tail.shift();if(t===void 0&&this.tail.next){const e=this.tail.next;return this.tail.next=null,this.tail=e,this.tail.shift()}return t}peek(){const t=this.tail.peek();return t===void 0&&this.tail.next?this.tail.next.peek():t}isEmpty(){return this.length===0}},Qr=class{constructor(t){this.decoder=new TextDecoder(t==="utf16le"?"utf16-le":t)}decode(t){return this.decoder.decode(t,{stream:!0})}flush(){return this.decoder.decode(new Uint8Array(0))}};const sh=Qr,rh=Qr;var oh=class{constructor(t="utf8"){switch(this.encoding=ah(t),this.encoding){case"utf8":this.decoder=new rh;break;case"utf16le":case"base64":throw new Error("Unsupported encoding: "+this.encoding);default:this.decoder=new sh(this.encoding)}}push(t){return typeof t=="string"?t:this.decoder.decode(t)}write(t){return this.push(t)}end(t){let e="";return t&&(e=this.push(t)),e+=this.decoder.flush(),e}};function ah(n){switch(n=n.toLowerCase(),n){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return n;default:throw new Error("Unknown encoding: "+n)}}const{EventEmitter:lh}=th,Tn=new Error("Stream was destroyed"),qn=new Error("Premature close"),to=eh,eo=ih,hh=oh,G=(1<<29)-1,Jt=1,Ni=2,zt=4,Ie=8,no=G^Jt,ch=G^Ni,Ue=16,Ne=32,be=64,Tt=128,Fe=256,ki=512,Kt=1024,ri=2048,Oi=4096,Pi=8192,lt=16384,le=32768,Rn=65536,Vt=131072,io=Fe|ki,uh=Ue|Rn,dh=be|Ue,fh=Oi|Tt,Di=Fe|Vt,ph=G^Ue,_h=G^be,gh=G^(be|Rn),mh=G^Rn,yh=G^Fe,wh=G^(Tt|Pi),bh=G^Kt,_s=G^io,so=G^le,xh=G^Ne,ro=G^Vt,Eh=G^Di,kt=1<<18,me=2<<18,$e=4<<18,Xt=8<<18,He=16<<18,Qt=32<<18,oi=64<<18,he=128<<18,Li=256<<18,ye=512<<18,In=1024<<18,oo=G^(kt|Li),ao=G^$e,Sh=G^ye,vh=G^He,Ah=G^Xt,lo=G^he,Ch=G^me,ho=G^In,ke=Ue|kt,co=G^ke,Bi=lt|Qt,bt=zt|Ie|Ni,nt=bt|Jt,uo=bt|Bi,Th=ao&_h,Mi=he|le,Rh=Mi&co,fo=nt|Rh,Ih=nt|Kt|lt,gs=nt|lt|Tt,Nh=nt|Kt|Tt,kh=nt|Oi|Tt|Pi,Oh=nt|Ue|Kt|lt|Rn|Vt,Ph=bt|Kt|lt,Dh=Ne|nt|le|be,Lh=nt|ye|Qt,Bh=Xt|He,po=Xt|kt,Mh=Xt|He|nt|kt,ms=nt|kt|Xt|In,Uh=$e|kt,Fh=kt|Li,$h=nt|ye|po|Qt,Hh=He|bt|ye|Qt,qh=me|nt|he|$e,je=Symbol.asyncIterator||Symbol("asyncIterator");class _o{constructor(t,{highWaterMark:e=16384,map:i=null,mapWritable:s,byteLength:r,byteLengthWritable:o}={}){this.stream=t,this.queue=new eo,this.highWaterMark=e,this.buffered=0,this.error=null,this.pipeline=null,this.drains=null,this.byteLength=o||r||Eo,this.map=s||i,this.afterWrite=Kh.bind(this),this.afterUpdateNextTick=Zh.bind(this)}get ended(){return(this.stream._duplexState&Qt)!==0}push(t){return this.map!==null&&(t=this.map(t)),this.buffered+=this.byteLength(t),this.queue.push(t),this.buffered<this.highWaterMark?(this.stream._duplexState|=Xt,!0):(this.stream._duplexState|=Bh,!1)}shift(){const t=this.queue.shift();return this.buffered-=this.byteLength(t),this.buffered===0&&(this.stream._duplexState&=Ah),t}end(t){typeof t=="function"?this.stream.once("finish",t):t!=null&&this.push(t),this.stream._duplexState=(this.stream._duplexState|ye)&ao}autoBatch(t,e){const i=[],s=this.stream;for(i.push(t);(s._duplexState&ms)===po;)i.push(s._writableState.shift());if(s._duplexState&nt)return e(null);s._writev(i,e)}update(){const t=this.stream;t._duplexState|=me;do{for(;(t._duplexState&ms)===Xt;){const e=this.shift();t._duplexState|=Fh,t._write(e,this.afterWrite)}t._duplexState&Uh||this.updateNonPrimary()}while(this.continueUpdate()===!0);t._duplexState&=Ch}updateNonPrimary(){const t=this.stream;if((t._duplexState&$h)===ye){t._duplexState=(t._duplexState|kt)&Sh,t._final(zh.bind(this));return}if((t._duplexState&bt)===zt){t._duplexState&Mi||(t._duplexState|=ke,t._destroy(go.bind(this)));return}(t._duplexState&fo)===Jt&&(t._duplexState=(t._duplexState|ke)&no,t._open(mo.bind(this)))}continueUpdate(){return this.stream._duplexState&he?(this.stream._duplexState&=lo,!0):!1}updateCallback(){(this.stream._duplexState&qh)===$e?this.update():this.updateNextTick()}updateNextTick(){this.stream._duplexState&he||(this.stream._duplexState|=he,this.stream._duplexState&me||to(this.afterUpdateNextTick))}}class Wh{constructor(t,{highWaterMark:e=16384,map:i=null,mapReadable:s,byteLength:r,byteLengthReadable:o}={}){this.stream=t,this.queue=new eo,this.highWaterMark=e===0?1:e,this.buffered=0,this.readAhead=e>0,this.error=null,this.pipeline=null,this.byteLength=o||r||Eo,this.map=s||i,this.pipeTo=null,this.afterRead=Vh.bind(this),this.afterUpdateNextTick=Xh.bind(this)}get ended(){return(this.stream._duplexState&lt)!==0}pipe(t,e){if(this.pipeTo!==null)throw new Error("Can only pipe to one destination");if(typeof e!="function"&&(e=null),this.stream._duplexState|=ki,this.pipeTo=t,this.pipeline=new jh(this.stream,t,e),e&&this.stream.on("error",ys),Pe(t))t._writableState.pipeline=this.pipeline,e&&t.on("error",ys),t.on("finish",this.pipeline.finished.bind(this.pipeline));else{const i=this.pipeline.done.bind(this.pipeline,t),s=this.pipeline.done.bind(this.pipeline,t,null);t.on("error",i),t.on("close",s),t.on("finish",this.pipeline.finished.bind(this.pipeline))}t.on("drain",Gh.bind(this)),this.stream.emit("piping",t),t.emit("pipe",this.stream)}push(t){const e=this.stream;return t===null?(this.highWaterMark=0,e._duplexState=(e._duplexState|Kt)&gh,!1):this.map!==null&&(t=this.map(t),t===null)?this.buffered<this.highWaterMark:(this.buffered+=this.byteLength(t),this.queue.push(t),e._duplexState=(e._duplexState|Tt)&mh,this.buffered<this.highWaterMark)}shift(){const t=this.queue.shift();return this.buffered-=this.byteLength(t),this.buffered===0&&(this.stream._duplexState&=wh),t}unshift(t){const e=[this.map!==null?this.map(t):t];for(;this.buffered>0;)e.push(this.shift());for(let i=0;i<e.length-1;i++){const s=e[i];this.buffered+=this.byteLength(s),this.queue.push(s)}this.push(e[e.length-1])}read(){const t=this.stream;if((t._duplexState&gs)===Tt){const e=this.shift();return this.pipeTo!==null&&this.pipeTo.write(e)===!1&&(t._duplexState&=_s),t._duplexState&ri&&t.emit("data",e),e}return this.readAhead===!1&&(t._duplexState|=Vt,this.updateNextTick()),null}drain(){const t=this.stream;for(;(t._duplexState&gs)===Tt&&t._duplexState&io;){const e=this.shift();this.pipeTo!==null&&this.pipeTo.write(e)===!1&&(t._duplexState&=_s),t._duplexState&ri&&t.emit("data",e)}}update(){const t=this.stream;t._duplexState|=Ne;do{for(this.drain();this.buffered<this.highWaterMark&&(t._duplexState&Oh)===Vt;)t._duplexState|=uh,t._read(this.afterRead),this.drain();(t._duplexState&kh)===fh&&(t._duplexState|=Pi,t.emit("readable")),t._duplexState&dh||this.updateNonPrimary()}while(this.continueUpdate()===!0);t._duplexState&=xh}updateNonPrimary(){const t=this.stream;if((t._duplexState&Nh)===Kt&&(t._duplexState=(t._duplexState|lt)&bh,t.emit("end"),(t._duplexState&uo)===Bi&&(t._duplexState|=zt),this.pipeTo!==null&&this.pipeTo.end()),(t._duplexState&bt)===zt){t._duplexState&Mi||(t._duplexState|=ke,t._destroy(go.bind(this)));return}(t._duplexState&fo)===Jt&&(t._duplexState=(t._duplexState|ke)&no,t._open(mo.bind(this)))}continueUpdate(){return this.stream._duplexState&le?(this.stream._duplexState&=so,!0):!1}updateCallback(){(this.stream._duplexState&Dh)===be?this.update():this.updateNextTick()}updateNextTick(){this.stream._duplexState&le||(this.stream._duplexState|=le,this.stream._duplexState&Ne||to(this.afterUpdateNextTick))}}class Yh{constructor(t){this.data=null,this.afterTransform=Qh.bind(t),this.afterFinal=null}}class jh{constructor(t,e,i){this.from=t,this.to=e,this.afterPipe=i,this.error=null,this.pipeToFinished=!1}finished(){this.pipeToFinished=!0}done(t,e){if(e&&(this.error=e),t===this.to&&(this.to=null,this.from!==null)){(!(this.from._duplexState&lt)||!this.pipeToFinished)&&this.from.destroy(this.error||new Error("Writable stream closed prematurely"));return}if(t===this.from&&(this.from=null,this.to!==null)){t._duplexState&lt||this.to.destroy(this.error||new Error("Readable stream closed before ending"));return}this.afterPipe!==null&&this.afterPipe(this.error),this.to=this.from=this.afterPipe=null}}function Gh(){this.stream._duplexState|=ki,this.updateCallback()}function zh(n){const t=this.stream;n&&t.destroy(n),t._duplexState&bt||(t._duplexState|=Qt,t.emit("finish")),(t._duplexState&uo)===Bi&&(t._duplexState|=zt),t._duplexState&=oo,t._duplexState&me?this.updateNextTick():this.update()}function go(n){const t=this.stream;!n&&this.error!==Tn&&(n=this.error),n&&t.emit("error",n),t._duplexState|=Ie,t.emit("close");const e=t._readableState,i=t._writableState;if(e!==null&&e.pipeline!==null&&e.pipeline.done(t,n),i!==null){for(;i.drains!==null&&i.drains.length>0;)i.drains.shift().resolve(!1);i.pipeline!==null&&i.pipeline.done(t,n)}}function Kh(n){const t=this.stream;n&&t.destroy(n),t._duplexState&=oo,this.drains!==null&&Jh(this.drains),(t._duplexState&Mh)===He&&(t._duplexState&=vh,(t._duplexState&oi)===oi&&t.emit("drain")),this.updateCallback()}function Vh(n){n&&this.stream.destroy(n),this.stream._duplexState&=ph,this.readAhead===!1&&!(this.stream._duplexState&Fe)&&(this.stream._duplexState&=ro),this.updateCallback()}function Xh(){this.stream._duplexState&Ne||(this.stream._duplexState&=so,this.update())}function Zh(){this.stream._duplexState&me||(this.stream._duplexState&=lo,this.update())}function Jh(n){for(let t=0;t<n.length;t++)--n[t].writes===0&&(n.shift().resolve(!0),t--)}function mo(n){const t=this.stream;n&&t.destroy(n),t._duplexState&zt||(t._duplexState&Ih||(t._duplexState|=be),t._duplexState&Lh||(t._duplexState|=$e),t.emit("open")),t._duplexState&=co,t._writableState!==null&&t._writableState.updateCallback(),t._readableState!==null&&t._readableState.updateCallback()}function Qh(n,t){t!=null&&this.push(t),this._writableState.afterWrite(n)}function tc(n){this._readableState!==null&&(n==="data"&&(this._duplexState|=ri|Di,this._readableState.updateNextTick()),n==="readable"&&(this._duplexState|=Oi,this._readableState.updateNextTick())),this._writableState!==null&&n==="drain"&&(this._duplexState|=oi,this._writableState.updateNextTick())}class Ui extends lh{constructor(t){super(),this._duplexState=0,this._readableState=null,this._writableState=null,t&&(t.open&&(this._open=t.open),t.destroy&&(this._destroy=t.destroy),t.predestroy&&(this._predestroy=t.predestroy),t.signal&&t.signal.addEventListener("abort",lc.bind(this))),this.on("newListener",tc)}_open(t){t(null)}_destroy(t){t(null)}_predestroy(){}get readable(){return this._readableState!==null?!0:void 0}get writable(){return this._writableState!==null?!0:void 0}get destroyed(){return(this._duplexState&Ie)!==0}get destroying(){return(this._duplexState&bt)!==0}destroy(t){this._duplexState&bt||(t||(t=Tn),this._duplexState=(this._duplexState|zt)&Th,this._readableState!==null&&(this._readableState.highWaterMark=0,this._readableState.error=t),this._writableState!==null&&(this._writableState.highWaterMark=0,this._writableState.error=t),this._duplexState|=Ni,this._predestroy(),this._duplexState&=ch,this._readableState!==null&&this._readableState.updateNextTick(),this._writableState!==null&&this._writableState.updateNextTick())}}class Oe extends Ui{constructor(t){super(t),this._duplexState|=Jt|Qt|Vt,this._readableState=new Wh(this,t),t&&(this._readableState.readAhead===!1&&(this._duplexState&=ro),t.read&&(this._read=t.read),t.eagerOpen&&this._readableState.updateNextTick(),t.encoding&&this.setEncoding(t.encoding))}setEncoding(t){const e=new hh(t),i=this._readableState.map||sc;return this._readableState.map=s,this;function s(r){const o=e.push(r);return o===""?null:i(o)}}_read(t){t(null)}pipe(t,e){return this._readableState.updateNextTick(),this._readableState.pipe(t,e),t}read(){return this._readableState.updateNextTick(),this._readableState.read()}push(t){return this._readableState.updateNextTick(),this._readableState.push(t)}unshift(t){return this._readableState.updateNextTick(),this._readableState.unshift(t)}resume(){return this._duplexState|=Di,this._readableState.updateNextTick(),this}pause(){return this._duplexState&=this._readableState.readAhead===!1?Eh:yh,this}static _fromAsyncIterator(t,e){let i;const s=new Oe({...e,read(o){t.next().then(r).then(o.bind(null,null)).catch(o)},predestroy(){i=t.return()},destroy(o){if(!i)return o(null);i.then(o.bind(null,null)).catch(o)}});return s;function r(o){o.done?s.push(null):s.push(o.value)}}static from(t,e){if(oc(t))return t;if(t[je])return this._fromAsyncIterator(t[je](),e);Array.isArray(t)||(t=t===void 0?[]:[t]);let i=0;return new Oe({...e,read(s){this.push(i===t.length?null:t[i++]),s(null)}})}static isBackpressured(t){return(t._duplexState&Ph)!==0||t._readableState.buffered>=t._readableState.highWaterMark}static isPaused(t){return(t._duplexState&Fe)===0}[je](){const t=this;let e=null,i=null,s=null;return this.on("error",l=>{e=l}),this.on("readable",r),this.on("close",o),{[je](){return this},next(){return new Promise(function(l,h){i=l,s=h;const u=t.read();u!==null?a(u):t._duplexState&Ie&&a(null)})},return(){return c(null)},throw(l){return c(l)}};function r(){i!==null&&a(t.read())}function o(){i!==null&&a(null)}function a(l){s!==null&&(e?s(e):l===null&&!(t._duplexState&lt)?s(Tn):i({value:l,done:l===null}),s=i=null)}function c(l){return t.destroy(l),new Promise((h,u)=>{if(t._duplexState&Ie)return h({value:void 0,done:!0});t.once("close",function(){l?u(l):h({value:void 0,done:!0})})})}}}class yo extends Ui{constructor(t){super(t),this._duplexState|=Jt|lt,this._writableState=new _o(this,t),t&&(t.writev&&(this._writev=t.writev),t.write&&(this._write=t.write),t.final&&(this._final=t.final),t.eagerOpen&&this._writableState.updateNextTick())}cork(){this._duplexState|=In}uncork(){this._duplexState&=ho,this._writableState.updateNextTick()}_writev(t,e){e(null)}_write(t,e){this._writableState.autoBatch(t,e)}_final(t){t(null)}static isBackpressured(t){return(t._duplexState&Hh)!==0}static drained(t){if(t.destroyed)return Promise.resolve(!1);const e=t._writableState,s=(hc(t)?Math.min(1,e.queue.length):e.queue.length)+(t._duplexState&Li?1:0);return s===0?Promise.resolve(!0):(e.drains===null&&(e.drains=[]),new Promise(r=>{e.drains.push({writes:s,resolve:r})}))}write(t){return this._writableState.updateNextTick(),this._writableState.push(t)}end(t){return this._writableState.updateNextTick(),this._writableState.end(t),this}}class Fi extends Oe{constructor(t){super(t),this._duplexState=Jt|this._duplexState&Vt,this._writableState=new _o(this,t),t&&(t.writev&&(this._writev=t.writev),t.write&&(this._write=t.write),t.final&&(this._final=t.final))}cork(){this._duplexState|=In}uncork(){this._duplexState&=ho,this._writableState.updateNextTick()}_writev(t,e){e(null)}_write(t,e){this._writableState.autoBatch(t,e)}_final(t){t(null)}write(t){return this._writableState.updateNextTick(),this._writableState.push(t)}end(t){return this._writableState.updateNextTick(),this._writableState.end(t),this}}class wo extends Fi{constructor(t){super(t),this._transformState=new Yh(this),t&&(t.transform&&(this._transform=t.transform),t.flush&&(this._flush=t.flush))}_write(t,e){this._readableState.buffered>=this._readableState.highWaterMark?this._transformState.data=t:this._transform(t,this._transformState.afterTransform)}_read(t){if(this._transformState.data!==null){const e=this._transformState.data;this._transformState.data=null,t(null),this._transform(e,this._transformState.afterTransform)}else t(null)}destroy(t){super.destroy(t),this._transformState.data!==null&&(this._transformState.data=null,this._transformState.afterTransform())}_transform(t,e){e(null,t)}_flush(t){t(null)}_final(t){this._transformState.afterFinal=t,this._flush(nc.bind(this))}}class ec extends wo{}function nc(n,t){const e=this._transformState.afterFinal;if(n)return e(n);t!=null&&this.push(t),this.push(null),e(null)}function ic(...n){return new Promise((t,e)=>bo(...n,i=>{if(i)return e(i);t()}))}function bo(n,...t){const e=Array.isArray(n)?[...n,...t]:[n,...t],i=e.length&&typeof e[e.length-1]=="function"?e.pop():null;if(e.length<2)throw new Error("Pipeline requires at least 2 streams");let s=e[0],r=null,o=null;for(let l=1;l<e.length;l++)r=e[l],Pe(s)?s.pipe(r,c):(a(s,!0,l>1,c),s.pipe(r)),s=r;if(i){let l=!1;const h=Pe(r)||!!(r._writableState&&r._writableState.autoDestroy);r.on("error",u=>{o===null&&(o=u)}),r.on("finish",()=>{l=!0,h||i(o)}),h&&r.on("close",()=>i(o||(l?null:qn)))}return r;function a(l,h,u,d){l.on("error",d),l.on("close",m);function m(){if(l._readableState&&!l._readableState.ended||u&&l._writableState&&!l._writableState.ended)return d(qn)}}function c(l){if(!(!l||o)){o=l;for(const h of e)h.destroy(l)}}}function sc(n){return n}function xo(n){return!!n._readableState||!!n._writableState}function Pe(n){return typeof n._duplexState=="number"&&xo(n)}function rc(n,t={}){const e=n._readableState&&n._readableState.error||n._writableState&&n._writableState.error;return!t.all&&e===Tn?null:e}function oc(n){return Pe(n)&&n.readable}function ac(n){return typeof n=="object"&&n!==null&&typeof n.byteLength=="number"}function Eo(n){return ac(n)?n.byteLength:1024}function ys(){}function lc(){this.destroy(new Error("Stream aborted."))}function hc(n){return n._writev!==yo.prototype._writev&&n._writev!==Fi.prototype._writev}var cc={pipeline:bo,pipelinePromise:ic,isStream:xo,isStreamx:Pe,getStreamError:rc,Stream:Ui,Writable:yo,Readable:Oe,Duplex:Fi,Transform:wo,PassThrough:ec};function ws(n,t){for(const e in t)Object.defineProperty(n,e,{value:t[e],enumerable:!0,configurable:!0});return n}function uc(n,t,e){if(!n||typeof n=="string")throw new TypeError("Please pass an Error to err-code");e||(e={}),typeof t=="object"&&(e=t,t=""),t&&(e.code=t);try{return ws(n,e)}catch{e.message=n.message,e.stack=n.stack;const s=function(){};return s.prototype=Object.create(Object.getPrototypeOf(n)),ws(new s,e)}}var dc=uc;const B=Yr(dc);/* Common package for dealing with hex/string/uint8 conversions (and sha1 hashing)
*
* @author   Jimmy Wrting <jimmy@warting.se> (https://jimmy.warting.se/opensource)
* @license  MIT
*/const bs="0123456789abcdef",So=[];for(let n=0;n<256;n++)So[n]=bs[n>>4&15]+bs[n&15];const xs=n=>{const t=n.length;let e="",i=0;for(;i<t;)e+=So[n[i++]];return e};var Es="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",fc=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(var Ge=0;Ge<Es.length;Ge++)fc[Es.charCodeAt(Ge)]=Ge;new TextDecoder;const pc=new TextEncoder,_c=n=>pc.encode(n),Ss=typeof window<"u"?window:self,ai=Ss.crypto||Ss.msCrypto||{};ai.subtle||ai.webkitSubtle;const vs=n=>{const t=new Uint8Array(n);return ai.getRandomValues(t)};/*! simple-peer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */const gc=jl("simple-peer"),Wn=64*1024,mc=5*1e3,yc=5*1e3;function As(n){return n.replace(/a=ice-options:trickle\s\n/g,"")}function wc(n){console.warn(n)}let Nn=class li extends cc.Duplex{constructor(e){e=Object.assign({allowHalfOpen:!1},e);super(e);Hi(this,"_pc");if(this.__objectMode=!!e.objectMode,this._id=xs(vs(4)).slice(0,7),this._debug("new peer %o",e),this.channelName=e.initiator?e.channelName||xs(vs(20)):null,this.initiator=e.initiator||!1,this.channelConfig=e.channelConfig||li.channelConfig,this.channelNegotiated=this.channelConfig.negotiated,this.config=Object.assign({},li.config,e.config),this.offerOptions=e.offerOptions||{},this.answerOptions=e.answerOptions||{},this.sdpTransform=e.sdpTransform||(i=>i),this.trickle=e.trickle!==void 0?e.trickle:!0,this.allowHalfTrickle=e.allowHalfTrickle!==void 0?e.allowHalfTrickle:!1,this.iceCompleteTimeout=e.iceCompleteTimeout||mc,this._destroying=!1,this._connected=!1,this.remoteAddress=void 0,this.remoteFamily=void 0,this.remotePort=void 0,this.localAddress=void 0,this.localFamily=void 0,this.localPort=void 0,!si)throw B(typeof window>"u"?new Error("No WebRTC support: Specify `opts.wrtc` option in this environment"):new Error("No WebRTC support: Not a supported browser"),"ERR_WEBRTC_SUPPORT");this._pcReady=!1,this._channelReady=!1,this._iceComplete=!1,this._iceCompleteTimer=null,this._channel=null,this._pendingCandidates=[],this._isNegotiating=!1,this._firstNegotiation=!0,this._batchedNegotiation=!1,this._queuedNegotiation=!1,this._sendersAwaitingStable=[],this._closingInterval=null,this._remoteTracks=[],this._remoteStreams=[],this._chunk=null,this._cb=null,this._interval=null;try{this._pc=new si(this.config)}catch(i){this.__destroy(B(i,"ERR_PC_CONSTRUCTOR"));return}this._isReactNativeWebrtc=typeof this._pc._peerConnectionId=="number",this._pc.oniceconnectionstatechange=()=>{this._onIceStateChange()},this._pc.onicegatheringstatechange=()=>{this._onIceStateChange()},this._pc.onconnectionstatechange=()=>{this._onConnectionStateChange()},this._pc.onsignalingstatechange=()=>{this._onSignalingStateChange()},this._pc.onicecandidate=i=>{this._onIceCandidate(i)},typeof this._pc.peerIdentity=="object"&&this._pc.peerIdentity.catch(i=>{this.__destroy(B(i,"ERR_PC_PEER_IDENTITY"))}),this.initiator||this.channelNegotiated?this._setupData({channel:this._pc.createDataChannel(this.channelName,this.channelConfig)}):this._pc.ondatachannel=i=>{this._setupData(i)},this._debug("initial negotiation"),this._needsNegotiation(),this._onFinishBound=()=>{this._onFinish()},this.once("finish",this._onFinishBound)}get bufferSize(){return this._channel&&this._channel.bufferedAmount||0}get connected(){return this._connected&&this._channel.readyState==="open"}address(){return{port:this.localPort,family:this.localFamily,address:this.localAddress}}signal(e){if(!this._destroying){if(this.destroyed)throw B(new Error("cannot signal after peer is destroyed"),"ERR_DESTROYED");if(typeof e=="string")try{e=JSON.parse(e)}catch{e={}}this._debug("signal()"),e.renegotiate&&this.initiator&&(this._debug("got request to renegotiate"),this._needsNegotiation()),e.transceiverRequest&&this.initiator&&(this._debug("got request for transceiver"),this.addTransceiver(e.transceiverRequest.kind,e.transceiverRequest.init)),e.candidate&&(this._pc.remoteDescription&&this._pc.remoteDescription.type?this._addIceCandidate(e.candidate):this._pendingCandidates.push(e.candidate)),e.sdp&&this._pc.setRemoteDescription(new Gl(e)).then(()=>{this.destroyed||(this._pendingCandidates.forEach(i=>{this._addIceCandidate(i)}),this._pendingCandidates=[],this._pc.remoteDescription.type==="offer"&&this._createAnswer())}).catch(i=>{this.__destroy(B(i,"ERR_SET_REMOTE_DESCRIPTION"))}),!e.sdp&&!e.candidate&&!e.renegotiate&&!e.transceiverRequest&&this.__destroy(B(new Error("signal() called with invalid signal data"),"ERR_SIGNALING"))}}_addIceCandidate(e){const i=new zl(e);this._pc.addIceCandidate(i).catch(s=>{!i.address||i.address.endsWith(".local")?wc("Ignoring unsupported ICE candidate."):this.__destroy(B(s,"ERR_ADD_ICE_CANDIDATE"))})}send(e){if(!this._destroying){if(this.destroyed)throw B(new Error("cannot send after peer is destroyed"),"ERR_DESTROYED");this._channel.send(e)}}_needsNegotiation(){this._debug("_needsNegotiation"),!this._batchedNegotiation&&(this._batchedNegotiation=!0,queueMicrotask(()=>{this._batchedNegotiation=!1,this.initiator||!this._firstNegotiation?(this._debug("starting batched negotiation"),this.negotiate()):this._debug("non-initiator initial negotiation request discarded"),this._firstNegotiation=!1}))}negotiate(){if(!this._destroying){if(this.destroyed)throw B(new Error("cannot negotiate after peer is destroyed"),"ERR_DESTROYED");this.initiator?this._isNegotiating?(this._queuedNegotiation=!0,this._debug("already negotiating, queueing")):(this._debug("start negotiation"),setTimeout(()=>{this._createOffer()},0)):this._isNegotiating?(this._queuedNegotiation=!0,this._debug("already negotiating, queueing")):(this._debug("requesting negotiation from initiator"),this.emit("signal",{type:"renegotiate",renegotiate:!0})),this._isNegotiating=!0}}_final(e){this._readableState.ended||this.push(null),e(null)}__destroy(e){this.end(),this._destroy(()=>{},e)}_destroy(e,i){this.destroyed||this._destroying||(this._destroying=!0,this._debug("destroying (error: %s)",i&&(i.message||i)),setTimeout(()=>{if(this._connected=!1,this._pcReady=!1,this._channelReady=!1,this._remoteTracks=null,this._remoteStreams=null,this._senderMap=null,clearInterval(this._closingInterval),this._closingInterval=null,clearInterval(this._interval),this._interval=null,this._chunk=null,this._cb=null,this._onFinishBound&&this.removeListener("finish",this._onFinishBound),this._onFinishBound=null,this._channel){try{this._channel.close()}catch{}this._channel.onmessage=null,this._channel.onopen=null,this._channel.onclose=null,this._channel.onerror=null}if(this._pc){try{this._pc.close()}catch{}this._pc.oniceconnectionstatechange=null,this._pc.onicegatheringstatechange=null,this._pc.onsignalingstatechange=null,this._pc.onicecandidate=null,this._pc.ontrack=null,this._pc.ondatachannel=null}this._pc=null,this._channel=null,i&&this.emit("error",i),e()},0))}_setupData(e){if(!e.channel)return this.__destroy(B(new Error("Data channel event is missing `channel` property"),"ERR_DATA_CHANNEL"));this._channel=e.channel,this._channel.binaryType="arraybuffer",typeof this._channel.bufferedAmountLowThreshold=="number"&&(this._channel.bufferedAmountLowThreshold=Wn),this.channelName=this._channel.label,this._channel.onmessage=s=>{this._onChannelMessage(s)},this._channel.onbufferedamountlow=()=>{this._onChannelBufferedAmountLow()},this._channel.onopen=()=>{this._onChannelOpen()},this._channel.onclose=()=>{this._onChannelClose()},this._channel.onerror=s=>{const r=s.error instanceof Error?s.error:new Error(`Datachannel error: ${s.message} ${s.filename}:${s.lineno}:${s.colno}`);this.__destroy(B(r,"ERR_DATA_CHANNEL"))};let i=!1;this._closingInterval=setInterval(()=>{this._channel&&this._channel.readyState==="closing"?(i&&this._onChannelClose(),i=!0):i=!1},yc)}_write(e,i){if(this.destroyed)return i(B(new Error("cannot write after peer is destroyed"),"ERR_DATA_CHANNEL"));if(this._connected){try{this.send(e)}catch(s){return this.__destroy(B(s,"ERR_DATA_CHANNEL"))}this._channel.bufferedAmount>Wn?(this._debug("start backpressure: bufferedAmount %d",this._channel.bufferedAmount),this._cb=i):i(null)}else this._debug("write before connect"),this._chunk=e,this._cb=i}_onFinish(){if(this.destroyed)return;const e=()=>{setTimeout(()=>this.__destroy(),1e3)};this._connected?e():this.once("connect",e)}_startIceCompleteTimeout(){this.destroyed||this._iceCompleteTimer||(this._debug("started iceComplete timeout"),this._iceCompleteTimer=setTimeout(()=>{this._iceComplete||(this._iceComplete=!0,this._debug("iceComplete timeout completed"),this.emit("iceTimeout"),this.emit("_iceComplete"))},this.iceCompleteTimeout))}_createOffer(){this.destroyed||this._pc.createOffer(this.offerOptions).then(e=>{if(this.destroyed)return;!this.trickle&&!this.allowHalfTrickle&&(e.sdp=As(e.sdp)),e.sdp=this.sdpTransform(e.sdp);const i=()=>{if(this.destroyed)return;const o=this._pc.localDescription||e;this._debug("signal"),this.emit("signal",{type:o.type,sdp:o.sdp})},s=()=>{this._debug("createOffer success"),!this.destroyed&&(this.trickle||this._iceComplete?i():this.once("_iceComplete",i))},r=o=>{this.__destroy(B(o,"ERR_SET_LOCAL_DESCRIPTION"))};this._pc.setLocalDescription(e).then(s).catch(r)}).catch(e=>{this.__destroy(B(e,"ERR_CREATE_OFFER"))})}_createAnswer(){this.destroyed||this._pc.createAnswer(this.answerOptions).then(e=>{if(this.destroyed)return;!this.trickle&&!this.allowHalfTrickle&&(e.sdp=As(e.sdp)),e.sdp=this.sdpTransform(e.sdp);const i=()=>{var a;if(this.destroyed)return;const o=this._pc.localDescription||e;this._debug("signal"),this.emit("signal",{type:o.type,sdp:o.sdp}),this.initiator||(a=this._requestMissingTransceivers)==null||a.call(this)},s=()=>{this.destroyed||(this.trickle||this._iceComplete?i():this.once("_iceComplete",i))},r=o=>{this.__destroy(B(o,"ERR_SET_LOCAL_DESCRIPTION"))};this._pc.setLocalDescription(e).then(s).catch(r)}).catch(e=>{this.__destroy(B(e,"ERR_CREATE_ANSWER"))})}_onConnectionStateChange(){this.destroyed||this._destroying||this._pc.connectionState==="failed"&&this.__destroy(B(new Error("Connection failed."),"ERR_CONNECTION_FAILURE"))}_onIceStateChange(){if(this.destroyed)return;const e=this._pc.iceConnectionState,i=this._pc.iceGatheringState;this._debug("iceStateChange (connection: %s) (gathering: %s)",e,i),this.emit("iceStateChange",e,i),(e==="connected"||e==="completed")&&(this._pcReady=!0,this._maybeReady()),e==="failed"&&this.__destroy(B(new Error("Ice connection failed."),"ERR_ICE_CONNECTION_FAILURE")),e==="closed"&&this.__destroy(B(new Error("Ice connection closed."),"ERR_ICE_CONNECTION_CLOSED"))}getStats(e){const i=s=>(Object.prototype.toString.call(s.values)==="[object Array]"&&s.values.forEach(r=>{Object.assign(s,r)}),s);this._pc.getStats.length===0||this._isReactNativeWebrtc?this._pc.getStats().then(s=>{const r=[];s.forEach(o=>{r.push(i(o))}),e(null,r)},s=>e(s)):this._pc.getStats.length>0?this._pc.getStats(s=>{if(this.destroyed)return;const r=[];s.result().forEach(o=>{const a={};o.names().forEach(c=>{a[c]=o.stat(c)}),a.id=o.id,a.type=o.type,a.timestamp=o.timestamp,r.push(i(a))}),e(null,r)},s=>e(s)):e(null,[])}_maybeReady(){if(this._debug("maybeReady pc %s channel %s",this._pcReady,this._channelReady),this._connected||this._connecting||!this._pcReady||!this._channelReady)return;this._connecting=!0;const e=()=>{this.destroyed||this._destroying||this.getStats((i,s)=>{if(this.destroyed||this._destroying)return;i&&(s=[]);const r={},o={},a={};let c=!1;s.forEach(h=>{(h.type==="remotecandidate"||h.type==="remote-candidate")&&(r[h.id]=h),(h.type==="localcandidate"||h.type==="local-candidate")&&(o[h.id]=h),(h.type==="candidatepair"||h.type==="candidate-pair")&&(a[h.id]=h)});const l=h=>{c=!0;let u=o[h.localCandidateId];u&&(u.ip||u.address)?(this.localAddress=u.ip||u.address,this.localPort=Number(u.port)):u&&u.ipAddress?(this.localAddress=u.ipAddress,this.localPort=Number(u.portNumber)):typeof h.googLocalAddress=="string"&&(u=h.googLocalAddress.split(":"),this.localAddress=u[0],this.localPort=Number(u[1])),this.localAddress&&(this.localFamily=this.localAddress.includes(":")?"IPv6":"IPv4");let d=r[h.remoteCandidateId];d&&(d.ip||d.address)?(this.remoteAddress=d.ip||d.address,this.remotePort=Number(d.port)):d&&d.ipAddress?(this.remoteAddress=d.ipAddress,this.remotePort=Number(d.portNumber)):typeof h.googRemoteAddress=="string"&&(d=h.googRemoteAddress.split(":"),this.remoteAddress=d[0],this.remotePort=Number(d[1])),this.remoteAddress&&(this.remoteFamily=this.remoteAddress.includes(":")?"IPv6":"IPv4"),this._debug("connect local: %s:%s remote: %s:%s",this.localAddress,this.localPort,this.remoteAddress,this.remotePort)};if(s.forEach(h=>{h.type==="transport"&&h.selectedCandidatePairId&&l(a[h.selectedCandidatePairId]),(h.type==="googCandidatePair"&&h.googActiveConnection==="true"||(h.type==="candidatepair"||h.type==="candidate-pair")&&h.selected)&&l(h)}),!c&&(!Object.keys(a).length||Object.keys(o).length)){setTimeout(e,100);return}else this._connecting=!1,this._connected=!0;if(this._chunk){try{this.send(this._chunk)}catch(u){return this.__destroy(B(u,"ERR_DATA_CHANNEL"))}this._chunk=null,this._debug('sent chunk from "write before connect"');const h=this._cb;this._cb=null,h(null)}typeof this._channel.bufferedAmountLowThreshold!="number"&&(this._interval=setInterval(()=>this._onInterval(),150),this._interval.unref&&this._interval.unref()),this._debug("connect"),this.emit("connect")})};e()}_onInterval(){!this._cb||!this._channel||this._channel.bufferedAmount>Wn||this._onChannelBufferedAmountLow()}_onSignalingStateChange(){this.destroyed||(this._pc.signalingState==="stable"&&(this._isNegotiating=!1,this._debug("flushing sender queue",this._sendersAwaitingStable),this._sendersAwaitingStable.forEach(e=>{this._pc.removeTrack(e),this._queuedNegotiation=!0}),this._sendersAwaitingStable=[],this._queuedNegotiation?(this._debug("flushing negotiation queue"),this._queuedNegotiation=!1,this._needsNegotiation()):(this._debug("negotiated"),this.emit("negotiated"))),this._debug("signalingStateChange %s",this._pc.signalingState),this.emit("signalingStateChange",this._pc.signalingState))}_onIceCandidate(e){this.destroyed||(e.candidate&&this.trickle?this.emit("signal",{type:"candidate",candidate:{candidate:e.candidate.candidate,sdpMLineIndex:e.candidate.sdpMLineIndex,sdpMid:e.candidate.sdpMid}}):!e.candidate&&!this._iceComplete&&(this._iceComplete=!0,this.emit("_iceComplete")),e.candidate&&this._startIceCompleteTimeout())}_onChannelMessage(e){if(this.destroyed)return;let i=e.data;i instanceof ArrayBuffer?i=new Uint8Array(i):this.__objectMode===!1&&(i=_c(i)),this.push(i)}_onChannelBufferedAmountLow(){if(this.destroyed||!this._cb)return;this._debug("ending backpressure: bufferedAmount %d",this._channel.bufferedAmount);const e=this._cb;this._cb=null,e(null)}_onChannelOpen(){this._connected||this.destroyed||(this._debug("on channel open"),this._channelReady=!0,this._maybeReady())}_onChannelClose(){this.destroyed||(this._debug("on channel close"),this.__destroy())}_debug(){const e=[].slice.call(arguments);e[0]="["+this._id+"] "+e[0],gc.apply(null,e)}};Nn.WEBRTC_SUPPORT=!!si;Nn.config={iceServers:[{urls:["stun:stun.l.google.com:19302","stun:global.stun.twilio.com:3478"]}],sdpSemantics:"unified-plan"};Nn.channelConfig={};/*! simple-peer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */class bc extends Nn{constructor(t={}){super(t),this._pc&&(this.streams=t.streams||(t.stream?[t.stream]:[]),this._senderMap=new Map,this.streams&&this.streams.forEach(e=>{this.addStream(e)}),this._pc.ontrack=e=>{this._onTrack(e)})}addTransceiver(t,e){if(!this._destroying){if(this.destroyed)throw B(new Error("cannot addTransceiver after peer is destroyed"),"ERR_DESTROYED");if(this._debug("addTransceiver()"),this.initiator)try{this._pc.addTransceiver(t,e),this._needsNegotiation()}catch(i){this.__destroy(B(i,"ERR_ADD_TRANSCEIVER"))}else this.emit("signal",{type:"transceiverRequest",transceiverRequest:{kind:t,init:e}})}}addStream(t){if(!this._destroying){if(this.destroyed)throw B(new Error("cannot addStream after peer is destroyed"),"ERR_DESTROYED");this._debug("addStream()"),t.getTracks().forEach(e=>{this.addTrack(e,t)})}}addTrack(t,e){if(this._destroying)return;if(this.destroyed)throw B(new Error("cannot addTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("addTrack()");const i=this._senderMap.get(t)||new Map;let s=i.get(e);if(!s)s=this._pc.addTrack(t,e),i.set(e,s),this._senderMap.set(t,i),this._needsNegotiation();else throw s.removed?B(new Error("Track has been removed. You should enable/disable tracks that you want to re-add."),"ERR_SENDER_REMOVED"):B(new Error("Track has already been added to that stream."),"ERR_SENDER_ALREADY_ADDED")}replaceTrack(t,e,i){if(this._destroying)return;if(this.destroyed)throw B(new Error("cannot replaceTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("replaceTrack()");const s=this._senderMap.get(t),r=s?s.get(i):null;if(!r)throw B(new Error("Cannot replace track that was never added."),"ERR_TRACK_NOT_ADDED");e&&this._senderMap.set(e,s),r.replaceTrack!=null?r.replaceTrack(e):this.__destroy(B(new Error("replaceTrack is not supported in this browser"),"ERR_UNSUPPORTED_REPLACETRACK"))}removeTrack(t,e){if(this._destroying)return;if(this.destroyed)throw B(new Error("cannot removeTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("removeSender()");const i=this._senderMap.get(t),s=i?i.get(e):null;if(!s)throw B(new Error("Cannot remove track that was never added."),"ERR_TRACK_NOT_ADDED");try{s.removed=!0,this._pc.removeTrack(s)}catch(r){r.name==="NS_ERROR_UNEXPECTED"?this._sendersAwaitingStable.push(s):this.__destroy(B(r,"ERR_REMOVE_TRACK"))}this._needsNegotiation()}removeStream(t){if(!this._destroying){if(this.destroyed)throw B(new Error("cannot removeStream after peer is destroyed"),"ERR_DESTROYED");this._debug("removeSenders()"),t.getTracks().forEach(e=>{this.removeTrack(e,t)})}}_requestMissingTransceivers(){this._pc.getTransceivers&&this._pc.getTransceivers().forEach(t=>{!t.mid&&t.sender.track&&!t.requested&&(t.requested=!0,this.addTransceiver(t.sender.track.kind))})}_onTrack(t){this.destroyed||t.streams.forEach(e=>{this._debug("on track"),this.emit("track",t.track,e),this._remoteTracks.push({track:t.track,stream:e}),!this._remoteStreams.some(i=>i.id===e.id)&&(this._remoteStreams.push(e),queueMicrotask(()=>{this._debug("on stream"),this.emit("stream",e)}))})}}const Cs="data",Ts="signal",Rs=(n,t)=>{const e=new bc({iceServers:[{urls:xc}],...t,initiator:n,trickle:!1}),i=r=>s.push(r);let s=[];return e.on(Cs,i),{id:e._id,created:Date.now(),connection:e._pc,get channel(){return e._channel},get isDead(){return e.destroyed},signal:r=>new Promise(o=>{n||e.on(Ts,o),e.signal(r)}),sendData:r=>e.send(r),destroy:()=>e.destroy(),setHandlers:r=>Object.entries(r).forEach(([o,a])=>e.on(o,a)),offerPromise:n?new Promise(r=>e.on(Ts,r)):Promise.resolve(),addStream:r=>e.addStream(r),removeStream:r=>e.removeStream(r),addTrack:(r,o)=>e.addTrack(r,o),removeTrack:(r,o)=>e.removeTrack(r,o),replaceTrack:(r,o,a)=>e.replaceTrack(r,o,a),drainEarlyData:r=>{e.off(Cs,i),s.forEach(r),s=null}}},xc=[...Re(5,(n,t)=>`stun:stun${t||""}.l.google.com:19302`),"stun:global.stun.twilio.com:3478"],Ec=Object.getPrototypeOf(Uint8Array),tn=12,vo=0,en=vo+tn,nn=en+1,Se=nn+1,ve=Se+1,Pt=16*2**10-ve,ze=255,Is="bufferedamountlow",ee=n=>"@_"+n,Sc=(n,t,e)=>{const i={},s={},r={},o={},a={},c={},l={},h={onPeerJoin:Bt,onPeerLeave:Bt,onPeerStream:Bt,onPeerTrack:Bt},u=(_,E)=>(_?Array.isArray(_)?_:[_]:kl(i)).flatMap(y=>{const g=i[y];return g?E(y,g):(console.warn(`${Te}: no peer with id ${y} found`),[])}),d=_=>{i[_]&&(delete i[_],delete o[_],delete a[_],h.onPeerLeave(_),t(_))},m=_=>{if(s[_])return r[_];if(!_)throw _t("action type argument is required");const E=Wt(_);if(E.byteLength>tn)throw _t(`action type string "${_}" (${E.byteLength}b) exceeds byte limit (${tn}). Hint: choose a shorter name.`);const y=new Uint8Array(tn);y.set(E);let g=0;return s[_]={onComplete:Bt,onProgress:Bt,setOnComplete:b=>s[_]={...s[_],onComplete:b},setOnProgress:b=>s[_]={...s[_],onProgress:b},send:async(b,S,A,P)=>{if(A&&typeof A!="object")throw _t("action meta argument must be an object");const M=typeof b;if(M==="undefined")throw _t("action data cannot be undefined");const U=M!=="string",V=b instanceof Blob,L=V||b instanceof ArrayBuffer||b instanceof Ec;if(A&&!L)throw _t("action meta argument can only be used with binary data");const W=L?new Uint8Array(V?await b.arrayBuffer():b):Wt(U?wt(b):b),tt=A?Wt(wt(A)):null,j=Math.ceil(W.byteLength/Pt)+(A?1:0)||1,ot=Re(j,(z,q)=>{const X=q===j-1,$=A&&q===0,H=new Uint8Array(ve+($?tt.byteLength:X?W.byteLength-Pt*(j-(A?2:1)):Pt));return H.set(y),H.set([g],en),H.set([X|$<<1|L<<2|U<<3],nn),H.set([Math.round((q+1)/j*ze)],Se),H.set(A?$?tt:W.subarray((q-1)*Pt,q*Pt):W.subarray(q*Pt,(q+1)*Pt),ve),H});return g=g+1&ze,se(u(S,async(z,q)=>{const{channel:X}=q;let $=0;for(;$<j;){const H=ot[$];if(X.bufferedAmount>X.bufferedAmountLowThreshold&&await new Promise(ht=>{const Ot=()=>{X.removeEventListener(Is,Ot),ht()};X.addEventListener(Is,Ot)}),!i[z])break;q.sendData(H),$++,P==null||P(H[Se]/ze,z,A)}}))}},r[_]||(r[_]=[s[_].send,s[_].setOnComplete,s[_].setOnProgress])},x=(_,E)=>{var j,ot;const y=new Uint8Array(E),g=Je(y.subarray(vo,en)).replaceAll("\0",""),[b]=y.subarray(en,nn),[S]=y.subarray(nn,Se),[A]=y.subarray(Se,ve),P=y.subarray(ve),M=!!(S&1),U=!!(S&2),V=!!(S&4),L=!!(S&8);if(!s[g]){console.warn(`${Te}: received message with unregistered type (${g})`);return}o[_]||(o[_]={}),(j=o[_])[g]||(j[g]={});const W=(ot=o[_][g])[b]||(ot[b]={chunks:[]});if(U?W.meta=gn(Je(P)):W.chunks.push(P),s[g].onProgress(A/ze,_,W.meta),!M)return;const tt=new Uint8Array(W.chunks.reduce((z,q)=>z+q.byteLength,0));if(W.chunks.reduce((z,q)=>(tt.set(q,z),z+q.byteLength),0),delete o[_][g][b],V)s[g].onComplete(tt,_,W.meta);else{const z=Je(tt);s[g].onComplete(L?gn(z):z,_)}},f=async()=>{await D(""),await new Promise(_=>setTimeout(_,99)),hs(i).forEach(([_,E])=>{E.destroy(),delete i[_]}),e()},[p,w]=m(ee("ping")),[v,N]=m(ee("pong")),[T,R]=m(ee("signal")),[C,I]=m(ee("stream")),[k,Y]=m(ee("track")),[D,O]=m(ee("leave"));return n((_,E)=>{var y;i[E]||(i[E]=_,_.setHandlers({data:g=>x(E,g),stream:g=>{h.onPeerStream(g,E,c[E]),delete c[E]},track:(g,b)=>{h.onPeerTrack(g,b,E,l[E]),delete l[E]},signal:g=>T(g,E),close:()=>d(E),error:()=>d(E)}),h.onPeerJoin(E),(y=_.drainEarlyData)==null||y.call(_,g=>x(E,g)))}),w((_,E)=>v("",E)),N((_,E)=>{var y;(y=a[E])==null||y.call(a),delete a[E]}),R((_,E)=>{var y;return(y=i[E])==null?void 0:y.signal(_)}),I((_,E)=>c[E]=_),Y((_,E)=>l[E]=_),O((_,E)=>d(E)),Ti&&addEventListener("beforeunload",f),{makeAction:m,leave:f,ping:async _=>{if(!_)throw _t("ping() must be called with target peer ID");const E=Date.now();return p("",_),await new Promise(y=>a[_]=y),Date.now()-E},getPeers:()=>Nl(hs(i).map(([_,E])=>[_,E.connection])),addStream:(_,E,y)=>u(E,async(g,b)=>{y&&await C(y,g),b.addStream(_)}),removeStream:(_,E)=>u(E,(y,g)=>g.removeStream(_)),addTrack:(_,E,y,g)=>u(y,async(b,S)=>{g&&await k(g,b),S.addTrack(_,E)}),removeTrack:(_,E,y)=>u(y,(g,b)=>b.removeTrack(_,E)),replaceTrack:(_,E,y,g,b)=>u(g,async(S,A)=>{b&&await k(b,S),A.replaceTrack(_,E,y)}),onPeerJoin:_=>h.onPeerJoin=_,onPeerLeave:_=>h.onPeerLeave=_,onPeerStream:_=>h.onPeerStream=_,onPeerTrack:_=>h.onPeerTrack=_}},vc=20,Ac=5333,Ns=57333,Cc=({init:n,subscribe:t,announce:e})=>{const i={};let s=!1,r,o,a;return(c,l,h)=>{var b;const{appId:u}=c;if((b=i[u])!=null&&b[l])return i[u][l];const d={},m={},x=We(Te,u,l),f=Ye(x),p=Ye(We(x,ie)),w=Ul(c.password||"",u,l),v=S=>async A=>({type:A.type,sdp:await S(w,A.sdp)}),N=v($l),T=v(Fl),R=()=>Rs(!0,c.rtcConfig),C=(S,A,P)=>{var M;if(m[A]){m[A]!==S&&S.destroy();return}m[A]=S,g(S,A),(M=d[A])==null||M.forEach((U,V)=>{V!==P&&U.destroy()}),delete d[A]},I=(S,A)=>{m[A]===S&&delete m[A]},k=(S,A)=>{var M;if(m[S])return;const P=(M=d[S])==null?void 0:M[A];P&&(delete d[S][A],P.destroy())},Y=S=>(o.push(...Re(S,R)),se(o.splice(0,S).map(A=>A.offerPromise.then(T).then(P=>({peer:A,offer:P}))))),D=(S,A)=>h==null?void 0:h({error:`incorrect password (${c.password}) when decrypting ${A}`,appId:u,peerId:S,roomId:l}),O=S=>async(A,P,M)=>{var ot,z,q;const[U,V]=await se([f,p]);if(A!==U&&A!==V)return;const{peerId:L,offer:W,answer:tt,peer:j}=typeof P=="string"?gn(P):P;if(!(L===ie||m[L])){if(L&&!W&&!tt){if((ot=d[L])!=null&&ot[S])return;const[[{peer:X,offer:$}],H]=await se([Y(1),Ye(We(x,L))]);d[L]||(d[L]=[]),d[L][S]=X,setTimeout(()=>k(L,S),_[S]*.9),X.setHandlers({connect:()=>C(X,L,S),close:()=>I(X,L)}),M(H,wt({peerId:ie,offer:$}))}else if(W){if(((z=d[L])==null?void 0:z[S])&&ie>L)return;const $=Rs(!1,c.rtcConfig);$.setHandlers({connect:()=>C($,L,S),close:()=>I($,L)});let H;try{H=await N(W)}catch{D(L,"offer");return}if($.isDead)return;const[ht,Ot]=await se([Ye(We(x,L)),$.signal(H)]);M(ht,wt({peerId:ie,answer:await T(Ot)}))}else if(tt){let X;try{X=await N(tt)}catch{D(L,"answer");return}if(j)j.setHandlers({connect:()=>C(j,L,S),close:()=>I(j,L)}),j.signal(X);else{const $=(q=d[L])==null?void 0:q[S];$&&!$.isDead&&$.signal(X)}}}};if(!c)throw _t("requires a config map as the first argument");if(!u&&!c.firebaseApp)throw _t("config map is missing appId field");if(!l)throw _t("roomId argument required");if(!s){const S=n(c);o=Re(vc,R),r=Array.isArray(S)?S:[S],s=!0,a=setInterval(()=>o=o.filter(A=>{const P=Date.now()-A.created<Ns;return P||A.destroy(),P}),Ns*1.03)}const _=r.map(()=>Ac),E=[],y=r.map(async(S,A)=>t(await S,await f,await p,O(A),Y));se([f,p]).then(([S,A])=>{const P=async(M,U)=>{const V=await e(M,S,A);typeof V=="number"&&(_[U]=V),E[U]=setTimeout(()=>P(M,U),_[U])};y.forEach(async(M,U)=>{await M,P(await r[U],U)})});let g=Bt;return i[u]||(i[u]={}),i[u][l]=Sc(S=>g=S,S=>delete m[S],()=>{delete i[u][l],E.forEach(clearTimeout),y.forEach(async S=>(await S)()),clearInterval(a)})}},Tc=5,Ao=29333,Co="x",To="EVENT",Ro=Ti&&Ci.utils.randomPrivateKey(),Rc=Ti&&ni(Ci.getPublicKey(Ro)),$i={},Dt={},Io=()=>Math.floor(Date.now()/1e3),ks=async(n,t)=>{const e={kind:Ao,content:t,pubkey:Rc,created_at:Io(),tags:[[Co,n]]},i=ni(new Uint8Array(await crypto.subtle.digest("SHA-256",Wt(wt([0,e.pubkey,e.created_at,e.kind,e.tags,e.content])))));return wt([To,{...e,id:i,sig:ni(await Ci.sign(i,Ro))}])},Os=(n,t)=>($i[n]=t,wt(["REQ",n,{kinds:[Ao],since:Io(),["#"+Co]:[t]}])),Ps=n=>(delete $i[n],wt(["CLOSE",n])),Ic=Cc({init:n=>Dl(n,Nc,Tc).map(t=>{const e=Ll(t,i=>{var c;const[s,r,o,a]=gn(i);if(s!==To){const l=`${Te}: relay failure from ${e.url} - `;s==="NOTICE"?console.warn(l+r):s==="OK"&&!o&&console.warn(l+a);return}(c=Dt[r])==null||c.call(Dt,$i[r],o.content)});return e.ready}),subscribe:(n,t,e,i)=>{const s=ei(64),r=ei(64);return Dt[s]=Dt[r]=(o,a)=>i(o,a,async(c,l)=>n.send(await ks(c,l))),n.send(Os(s,t)),n.send(Os(r,e)),()=>{n.send(Ps(s)),n.send(Ps(r)),delete Dt[s],delete Dt[r]}},announce:async(n,t)=>n.send(await ks(t,wt({peerId:ie})))}),Nc=["relay.nostr.net","relay.snort.social","relay.piazza.today","relay.exit.pub","nostr.lu.ke","nostr.mom","relay.urbanzap.space","nostr.data.haus","nostr.sathoarder.com","relay.nostromo.social","relay.nostr.bg","nostr.stakey.net","nostr.vulpem.com","a.nos.lol","eu.purplerelay.com","nostr2.sanhauf.com","e.nos.lol"].map(n=>"wss://"+n),kc="/gifshooter/assets/01.28-D_5FERI8.png",Oc="/gifshooter/assets/02.20-BoBji87-.png",Pc="/gifshooter/assets/03.14-DvrilD0J.png",Dc="/gifshooter/assets/04.62-ClpOCGaf.png";let{init:Ds,Sprite:Lc,SpriteSheet:Bc,keyPressed:Mc,GameLoop:Ls,initKeys:Uc,pointerPressed:Fc,onInput:eu,initPointer:$c,getPointer:Hc}=Ma,sn=[];const No=new URLSearchParams(window.location.search);let Zt=No.get("room")||"notinitialized";console.log(Zt);let rn=No.get("present")=="true";const qc=()=>(window.open(window.location.href.split("?")[0],"_self"),!1),Wc=()=>(Zt=document.getElementById("room").value,rn=document.getElementById("present").checked,console.log(rn),window.open(window.location.href.split("?")[0]+`?room=${Zt}&present=${rn}`,"_self"),!1);let mn=0;const Yc={appId:"gifshootah"},De=Ic(Yc,Zt);De.onPeerJoin(n=>{mn+=1,document.getElementById("online").textContent=`${mn} peers`});De.onPeerLeave(n=>{mn-=1,document.getElementById("online").textContent=`${mn} peers`});const[Bs,jc]=De.makeAction("shoot");jc((n,t)=>{sn.push(n)});Zt&&Zt!="notinitialized"?(document.getElementById("setting").style.display="none",document.getElementById("home").style.display="block",document.getElementById("home").onclick=qc):document.getElementById("go").onclick=Wc;const Ke={};let Ve=0;const Yn=[],Mt=[kc,Oc,Pc,Dc];let ft=Math.floor(Math.random()*Mt.length);const Gc=n=>{var t=n.split("."),e=parseInt(t[t.length-2]);return new Promise(function(i,s){if(Ke[n])return i(Ke[n]);{let r=new Image;r.src=n,r.onload=function(){let o=Bc({image:r,frameWidth:r.width/e,frameHeight:r.height,animations:{walk:{frames:`0..${e-1}`,frameRate:15}}});return Ke[n]=o,i(Ke[n])}}})};let vt={};const Ms=async(n,t)=>{if(vt[n]&&vt[n].url==t)return vt[n].sprite;let e=await Gc(t),i=Lc({x:-1e3,y:-1e3,dx:0,dy:0,ddx:0,ddy:0,anchor:{x:.5,y:.5},animations:e.animations});return vt[n]={url:t,sprite:i},i};if(rn){var Us=new Date/10;let{canvas:n,context:t}=Ds("game");$c(),Uc(),t.canvas.width=window.innerWidth,t.canvas.height=window.innerHeight;for(let i=0;i<120;i++){const s=new OffscreenCanvas(n.width,n.height);Yn.push(s)}Ls({clearCanvas:!0,update:function(){const i=new Date/10;if(sn.length&&i+100>Us){Us=i+100;const s=sn.pop();Ms(s.peerId,Mt[s.spriteUrlIndex]).then(r=>{r.x=s.x*t.canvas.width,r.y=s.y*t.canvas.height})}if(Mc("enter")&&(ft=(ft+1)%Mt.length),Fc("left")){let s=Hc();const r={spriteUrlIndex:ft,peerId:De.selfId,x:s.x/t.canvas.width,y:s.ycontext.canvas.height};Bs(r),sn.push(r)}for(let s of Object.keys(vt))vt[s].sprite.update()},render:function(){Ve++,Ve=Ve%Yn.length;let i=Yn[Ve];t.drawImage(i,0,0);for(let s of Object.keys(vt))vt[s].sprite.render();i.getContext("2d").drawImage(n,0,0)}}).start()}else if(Zt!="notinitialized"){document.getElementById("phone").style.display="block";let n,t,{canvasShoot:e,contextShoot:i}=Ds("shootbutton"),s=document.getElementById("shootbutton"),r=document.getElementById("expand");s.width=r.clientWidth,s.height=r.clientHeight,console.log(e,i,"canvas"),document.getElementById("nextgif").onclick=()=>{ft=(ft+1)%Mt.length},document.getElementById("previousgif").onclick=()=>{ft=(ft+Mt.length-1)%Mt.length};let o=!1;s.ontouchstart=()=>{o=!0},s.ontouchend=()=>{o=!1},window.addEventListener("deviceorientation",async c=>{n||(n=c.alpha);var l=c.beta,h=c.alpha-n,u=1-Math.sin(h/180*Math.PI),d=1-Math.sin(l/180*Math.PI);if(o){const m={spriteUrlIndex:ft,peerId:De.selfId,x:u,y:d};console.log(m),Bs(m)}}),Ls({clearCanvas:!0,update:function(){Ms("preview",Mt[ft]).then(c=>{c.x=s.width/3+s.width/6,c.y=s.height/2,c.width=r.clientWidth/2,c.height=r.clientHeight/2,t=c}),t&&t.update()},render:function(){t&&t.render()}}).start()}
