var kA=Object.defineProperty;var NA=(n,t,e)=>t in n?kA(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var Ss=(n,t,e)=>NA(n,typeof t!="symbol"?t+"":t,e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function e(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(s){if(s.ep)return;s.ep=!0;const r=e(s);fetch(s.href,r)}})();/**
 * @preserve
 * Kontra.js v10.0.2
 */function DA(n){return n*Math.PI/180}function MA(n){return n*180/Math.PI}function OA(n,t){return Math.atan2(t.y-n.y,t.x-n.x)}function Sr(n,t){let e=Math.sin(t),i=Math.cos(t);return{x:n.x*i-n.y*e,y:n.x*e+n.y*i}}function PA(n,t,e){return{x:n.x+Math.cos(t)*e,y:n.y+Math.sin(t)*e}}function LA(n,t,e){return n*(1-e)+t*e}function FA(n,t,e){return(e-n)/(t-n)}function ge(n,t,e){return Math.min(Math.max(n,e),t)}function UA(n,t){t==null?localStorage.removeItem(n):localStorage.setItem(n,JSON.stringify(t))}function QA(n){let t=localStorage.getItem(n);try{t=JSON.parse(t)}catch{}return t}function xr(n,t){let e=pe(n),i=pe(t);return n.radius&&e.width!=e.height||t.radius&&i.width!=i.height?!1:([e,i]=[e,i].map(s=>((s==e?n:t).radius&&(s.radius=s.width/2,s.x+=s.radius,s.y+=s.radius),s)),n.radius&&t.radius?Math.hypot(e.x-i.x,e.y-i.y)<e.radius+i.radius:n.radius||t.radius?Br(n.radius?e:i,n.radius?t:n):e.x<i.x+i.width&&e.x+e.width>i.x&&e.y<i.y+i.height&&e.y+e.height>i.y)}function pe(n){let{x:t=0,y:e=0,width:i,height:s,radius:r}=n.world||n;return n.mapwidth&&(i=n.mapwidth,s=n.mapheight),r&&(i=r.x*2,s=r.y*2),n.anchor&&(t-=i*n.anchor.x,e-=s*n.anchor.y),i<0&&(t+=i,i*=-1),s<0&&(e+=s,s*=-1),{x:t,y:e,width:i,height:s}}function YA(n,t,e="y"){return[n,t]=[n,t].map(pe),n[e]-t[e]}let Xt=()=>{},Ir="position:absolute;width:1px;height:1px;overflow:hidden;clip:rect(0,0,0,0);",wi={preventScroll:!0};function _i(n,t){let e=t.parentNode;n.setAttribute("data-kontra",""),e?([...e.querySelectorAll(":scope > [data-kontra]")].pop()||t).after(n):t.nodeName=="CANVAS"?document.body.append(n):t.append(n)}function me(n,t){let e=n.indexOf(t);if(e!=-1)return n.splice(e,1),!0}function Br(n,t){let{x:e,y:i,width:s,height:r}=pe(t);do e-=t.sx||0,i-=t.sy||0;while(t=t.parent);let o=n.x-Math.max(e,Math.min(n.x,e+s)),A=n.y-Math.max(i,Math.min(n.y,i+r));return o*o+A*A<n.radius*n.radius}let ce={};function ut(n,t){ce[n]=ce[n]||[],ce[n].push(t)}function Tr(n,t){ce[n]=(ce[n]||[]).filter(e=>e!=t)}function Nt(n,...t){(ce[n]||[]).map(e=>e(...t))}let Yt,un,xs={get(n,t){return t=="_proxy"?!0:Xt}};function at(){return Yt}function ot(){return un}function VA(n,{contextless:t=!1}={}){if(Yt=document.getElementById(n)||n||document.querySelector("canvas"),t&&(Yt=Yt||new Proxy({},xs)),!Yt)throw Error("You must provide a canvas element for the game");return un=Yt.getContext("2d")||new Proxy({},xs),un.imageSmoothingEnabled=!1,Nt("init"),{canvas:Yt,context:un}}class Mn{constructor({spriteSheet:t,frames:e,frameRate:i,loop:s=!0,name:r}){let{width:o,height:A,spacing:a=0,margin:l=0}=t.frame;Object.assign(this,{spriteSheet:t,frames:e,frameRate:i,loop:s,name:r,width:o,height:A,spacing:a,margin:l,isStopped:!1,_f:0,_a:0})}clone(){return new Mn(this)}start(){this.isStopped=!1,this.loop||this.reset()}stop(){this.isStopped=!0}reset(){this._f=0,this._a=0}update(t=1/60){if(!this.isStopped){if(!this.loop&&this._f==this.frames.length-1){this.stop();return}for(this._a+=t;this._a*this.frameRate>=1;)this._f=++this._f%this.frames.length,this._a-=1/this.frameRate}}render({x:t,y:e,width:i=this.width,height:s=this.height,context:r=ot()}){let o=this.frames[this._f]/this.spriteSheet._f|0,A=this.frames[this._f]%this.spriteSheet._f|0;r.drawImage(this.spriteSheet.image,this.margin+A*this.width+(A*2+1)*this.spacing,this.margin+o*this.height+(o*2+1)*this.spacing,this.width,this.height,t,e,i,s)}}function Rr(){return new Mn(...arguments)}let GA=/(jpeg|jpg|gif|png|webp)$/,qA=/(wav|mp3|ogg|aac)$/,vr=/^\//,ZA=/\/$/,kr=new WeakMap,Nr="",Dr="",Mr="";function On(n,t){return new URL(n,t).href}function Qi(n,t){return[n.replace(ZA,""),n?t.replace(vr,""):t].filter(e=>e).join("/")}function Yi(n){return n.split(".").pop()}function Vi(n){let t=n.replace("."+Yi(n),"");return t.split("/").length==2?t.replace(vr,""):t}function WA(n){return{wav:n.canPlayType('audio/wav; codecs="1"'),mp3:n.canPlayType("audio/mpeg;"),ogg:n.canPlayType('audio/ogg; codecs="vorbis"'),aac:n.canPlayType("audio/aac;")}}let Gt={},oe={},qt={};function Gi(){window.__k||(window.__k={dm:kr,u:On,d:qt,i:Gt})}function HA(n){Nr=n}function JA(n){Dr=n}function XA(n){Mr=n}function Or(n){return Gi(),new Promise((t,e)=>{let i,s,r;if(i=Qi(Nr,n),Gt[i])return t(Gt[i]);s=new Image,s.onload=function(){r=On(i,window.location.href),Gt[Vi(n)]=Gt[i]=Gt[r]=this,Nt("assetLoaded",this,n),t(this)},s.onerror=function(){e("Unable to load image "+i)},s.src=i})}function Pr(n){return new Promise((t,e)=>{let i=n,s,r,o,A;if(s=new Audio,r=WA(s),n=[].concat(n).reduce((a,l)=>a||(r[Yi(l)]?l:null),0),!n)return e("cannot play any of the audio formats provided "+i);if(o=Qi(Dr,n),oe[o])return t(oe[o]);s.addEventListener("canplay",function(){A=On(o,window.location.href),oe[Vi(n)]=oe[o]=oe[A]=this,Nt("assetLoaded",this,n),t(this)}),s.onerror=function(){e("Unable to load audio "+o)},s.src=o,s.load()})}function Lr(n){Gi();let t,e;return t=Qi(Mr,n),qt[t]?Promise.resolve(qt[t]):fetch(t).then(i=>{if(!i.ok)throw i;return i.clone().json().catch(()=>i.text())}).then(i=>(e=On(t,window.location.href),typeof i=="object"&&kr.set(i,e),qt[Vi(n)]=qt[t]=qt[e]=i,Nt("assetLoaded",i,n),i))}function zA(...n){return Gi(),Promise.all(n.map(t=>{let e=Yi([].concat(t)[0]);return e.match(GA)?Or(t):e.match(qA)?Pr(t):Lr(t)}))}class Wt{constructor(t=0,e=0,i={}){t.x!=null?(this.x=t.x,this.y=t.y):(this.x=t,this.y=e),i._c&&(this.clamp(i._a,i._b,i._d,i._e),this.x=t,this.y=e)}set(t){this.x=t.x,this.y=t.y}add(t){return new Wt(this.x+t.x,this.y+t.y,this)}subtract(t){return new Wt(this.x-t.x,this.y-t.y,this)}scale(t){return new Wt(this.x*t,this.y*t)}normalize(t=this.length()||1){return new Wt(this.x/t,this.y/t)}dot(t){return this.x*t.x+this.y*t.y}length(){return Math.hypot(this.x,this.y)}distance(t){return Math.hypot(this.x-t.x,this.y-t.y)}angle(t){return Math.acos(this.dot(t)/(this.length()*t.length()))}direction(){return Math.atan2(this.y,this.x)}clamp(t,e,i,s){this._c=!0,this._a=t,this._b=e,this._d=i,this._e=s}get x(){return this._x}get y(){return this._y}set x(t){this._x=this._c?ge(this._a,this._d,t):t}set y(t){this._y=this._c?ge(this._b,this._e,t):t}}function dn(){return new Wt(...arguments)}class jA{constructor(t){return this.init(t)}init(t={}){this.position=dn(),this.velocity=dn(),this.acceleration=dn(),this.ttl=1/0,Object.assign(this,t)}update(t){this.advance(t)}advance(t){let e=this.acceleration;t&&(e=e.scale(t)),this.velocity=this.velocity.add(e);let i=this.velocity;t&&(i=i.scale(t)),this.position=this.position.add(i),this._pc(),this.ttl--}get dx(){return this.velocity.x}get dy(){return this.velocity.y}set dx(t){this.velocity.x=t}set dy(t){this.velocity.y=t}get ddx(){return this.acceleration.x}get ddy(){return this.acceleration.y}set ddx(t){this.acceleration.x=t}set ddy(t){this.acceleration.y=t}isAlive(){return this.ttl>0}_pc(){}}class Re extends jA{init({width:t=0,height:e=0,context:i=ot(),render:s=this.draw,update:r=this.advance,children:o=[],anchor:A={x:0,y:0},opacity:a=1,rotation:l=0,drotation:c=0,ddrotation:h=0,scaleX:u=1,scaleY:f=1,...m}={}){this._c=[],super.init({width:t,height:e,context:i,anchor:A,opacity:a,rotation:l,drotation:c,ddrotation:h,scaleX:u,scaleY:f,...m}),this._di=!0,this._uw(),this.addChild(o),this._rf=s,this._uf=r,ut("init",()=>{this.context??(this.context=ot())})}update(t){this._uf(t),this.children.map(e=>e.update&&e.update(t))}render(){let t=this.context;t.save(),(this.x||this.y)&&t.translate(this.x,this.y),this.rotation&&t.rotate(this.rotation),(this.scaleX!=1||this.scaleY!=1)&&t.scale(this.scaleX,this.scaleY);let e=this.width,i=this.height;this.radius&&(e=i=this.radius*2);let s=-e*this.anchor.x,r=-i*this.anchor.y;(s||r)&&t.translate(s,r),this.context.globalAlpha=this.opacity,this._rf(),(s||r)&&t.translate(-s,-r),this.children.map(A=>A.render&&A.render()),t.restore()}draw(){}_pc(){this._uw(),this.children.map(t=>t._pc())}get x(){return this.position.x}get y(){return this.position.y}set x(t){this.position.x=t,this._pc()}set y(t){this.position.y=t,this._pc()}get width(){return this._w}set width(t){this._w=t,this._pc()}get height(){return this._h}set height(t){this._h=t,this._pc()}_uw(){if(!this._di)return;let{_wx:t=0,_wy:e=0,_wo:i=1,_wrot:s=0,_wsx:r=1,_wsy:o=1}=this.parent||{};this._wx=this.x,this._wy=this.y,this._ww=this.width,this._wh=this.height,this.radius&&(this._wrx=this.radius,this._wry=this.radius),this._wo=i*this.opacity,this._wsx=r*this.scaleX,this._wsy=o*this.scaleY,this._wx=this._wx*r,this._wy=this._wy*o,this._ww=this.width*this._wsx,this._wh=this.height*this._wsy,this.radius&&(this._wrx=this.radius*this._wsx,this._wry=this.radius*this._wsy),this._wrot=s+this.rotation;let{x:A,y:a}=Sr({x:this._wx,y:this._wy},s);this._wx=A,this._wy=a,this._wx+=t,this._wy+=e}get world(){return{x:this._wx,y:this._wy,width:this._ww,height:this._wh,radius:this.radius?{x:this._wrx,y:this._wry}:void 0,opacity:this._wo,rotation:this._wrot,scaleX:this._wsx,scaleY:this._wsy}}set children(t){this.removeChild(this._c),this.addChild(t)}get children(){return this._c}addChild(...t){t.flat().map(e=>{this.children.push(e),e.parent=this,e._pc=e._pc||Xt,e._pc()})}removeChild(...t){t.flat().map(e=>{me(this.children,e)&&(e.parent=null,e._pc())})}get radius(){return this._r}set radius(t){this._r=t,this._pc()}get opacity(){return this._opa}set opacity(t){this._opa=ge(0,1,t),this._pc()}get rotation(){return this._rot}set rotation(t){this._rot=t,this._pc()}advance(t){super.advance(t),this.drotation+=this.ddrotation,this.rotation+=this.drotation}setScale(t,e=t){this.scaleX=t,this.scaleY=e}get scaleX(){return this._scx}set scaleX(t){this._scx=t,this._pc()}get scaleY(){return this._scy}set scaleY(t){this._scy=t,this._pc()}}function KA(){return new Re(...arguments)}let qi=class extends Re{init({image:t,width:e=t?t.width:void 0,height:i=t?t.height:void 0,...s}={}){super.init({image:t,width:e,height:i,...s})}get animations(){return this._a}set animations(t){let e,i;this._a={};for(e in t)this._a[e]=t[e].clone(),i=i||this._a[e];this.currentAnimation=i,this.width=this.width||i.width,this.height=this.height||i.height}playAnimation(t){var e;(e=this.currentAnimation)==null||e.stop(),this.currentAnimation=this.animations[t],this.currentAnimation.start()}advance(t){var e;super.advance(t),(e=this.currentAnimation)==null||e.update(t)}draw(){if(this.image&&this.context.drawImage(this.image,0,0,this.image.width,this.image.height),this.currentAnimation&&this.currentAnimation.render({x:0,y:0,width:this.width,height:this.height,context:this.context}),this.color){if(this.context.fillStyle=this.color,this.radius){this.context.beginPath(),this.context.arc(this.radius,this.radius,this.radius,0,Math.PI*2),this.context.fill();return}this.context.fillRect(0,0,this.width,this.height)}}};function $A(){return new qi(...arguments)}let ta=/(\d+)(\w+)/;function ea(n){if(!n)return{computed:0};let t=n.match(ta),e=+t[1],i=t[2];return{size:e,unit:i,computed:e}}class Fr extends Re{init({text:t="",textAlign:e="",lineHeight:i=1,font:s=(o=>(o=ot())==null?void 0:o.font)(),...r}={}){t=""+t,super.init({text:t,textAlign:e,lineHeight:i,font:s,...r}),this.context&&this._p(),ut("init",()=>{this.font??(this.font=ot().font),this._p()})}get width(){return this._w}set width(t){this._d=!0,this._w=t,this._fw=t}get text(){return this._t}set text(t){this._d=!0,this._t=""+t}get font(){return this._f}set font(t){this._d=!0,this._f=t,this._fs=ea(t).computed}get lineHeight(){return this._lh}set lineHeight(t){this._d=!0,this._lh=t}render(){this._d&&this._p(),super.render()}_p(){this._s=[],this._d=!1;let t=this.context,e=[this.text];if(t.font=this.font,e=this.text.split(`
`),this._fw&&e.map(i=>{let s=i.split(" "),r=s.shift(),o=r;s.map(A=>{o+=" "+A,t.measureText(o).width>this._fw&&(this._s.push(r),o=A),r=o}),this._s.push(o)}),!this._s.length&&this.text.includes(`
`)){let i=0;e.map(s=>{this._s.push(s),i=Math.max(i,t.measureText(s).width)}),this._w=this._fw||i}this._s.length||(this._s.push(this.text),this._w=this._fw||t.measureText(this.text).width),this.height=this._fs+(this._s.length-1)*this._fs*this.lineHeight,this._uw()}draw(){let t=0,e=this.textAlign,i=this.context;e=this.textAlign||(i.canvas.dir=="rtl"?"right":"left"),t=e=="right"?this.width:e=="center"?this.width/2|0:0,this._s.map((s,r)=>{i.textBaseline="top",i.textAlign=e,i.fillStyle=this.color,i.font=this.font,this.strokeColor&&(i.strokeStyle=this.strokeColor,i.lineWidth=this.lineWidth??1,i.strokeText(s,t,this._fs*this.lineHeight*r)),i.fillText(s,t,this._fs*this.lineHeight*r)})}}function Ur(){return new Fr(...arguments)}let Dt=new WeakMap,yn={},Pn={},Qr={0:"left",1:"middle",2:"right"};function na(n=at()){return Dt.get(n)}function Yr(n){let t=n._lf.length?n._lf:n._cf;for(let e=t.length-1;e>=0;e--){let i=t[e];if(i.collidesWithPointer?i.collidesWithPointer(n):Br(n,i))return i}}function st(n,t){return parseFloat(n.getPropertyValue(t))||0}function ia(n){let{canvas:t,_s:e}=n,i=t.getBoundingClientRect(),s=e.transform!="none"?e.transform.replace("matrix(","").split(","):[1,1,1,1],r=parseFloat(s[0]),o=parseFloat(s[3]),A=(st(e,"border-left-width")+st(e,"border-right-width"))*r,a=(st(e,"border-top-width")+st(e,"border-bottom-width"))*o,l=(st(e,"padding-left")+st(e,"padding-right"))*r,c=(st(e,"padding-top")+st(e,"padding-bottom"))*o;return{scaleX:(i.width-A-l)/t.width,scaleY:(i.height-a-c)/t.height,offsetX:i.left+(st(e,"border-left-width")+st(e,"padding-left"))*r,offsetY:i.top+(st(e,"border-top-width")+st(e,"padding-top"))*o}}function Is(n){let t=n.button!=null?Qr[n.button]:"left";Pn[t]=!0,Zi(n,"onDown")}function Kn(n){let t=n.button!=null?Qr[n.button]:"left";Pn[t]=!1,Zi(n,"onUp")}function Bs(n){Zi(n,"onOver")}function sa(n){let t=Dt.get(n.target);t._oo=null,Pn={}}function Ts(n,t,e){let i=Yr(n);i&&i[t]&&i[t](e),yn[t]&&yn[t](e,i),t=="onOver"&&(i!=n._oo&&n._oo&&n._oo.onOut&&n._oo.onOut(e),n._oo=i)}function Zi(n,t){n.preventDefault();let e=n.target,i=Dt.get(e),{scaleX:s,scaleY:r,offsetX:o,offsetY:A}=ia(i);n.type.includes("touch")?(Array.from(n.touches).map(({clientX:l,clientY:c,identifier:h})=>{let u=i.touches[h];u||(u=i.touches[h]={start:{x:(l-o)/s,y:(c-A)/r}},i.touches.length++),u.changed=!1}),Array.from(n.changedTouches).map(({clientX:l,clientY:c,identifier:h})=>{let u=i.touches[h];u.changed=!0,u.x=i.x=(l-o)/s,u.y=i.y=(c-A)/r,Ts(i,t,n),Nt("touchChanged",n,i.touches),t=="onUp"&&(delete i.touches[h],i.touches.length--,i.touches.length||Nt("touchEnd"))})):(i.x=(n.clientX-o)/s,i.y=(n.clientY-A)/r,Ts(i,t,n))}function Vr({radius:n=5,canvas:t=at()}={}){let e=Dt.get(t);if(!e){let i=window.getComputedStyle(t);e={x:0,y:0,radius:n,touches:{length:0},canvas:t,_cf:[],_lf:[],_o:[],_oo:null,_s:i},Dt.set(t,e)}return t.addEventListener("mousedown",Is),t.addEventListener("touchstart",Is),t.addEventListener("mouseup",Kn),t.addEventListener("touchend",Kn),t.addEventListener("touchcancel",Kn),t.addEventListener("blur",sa),t.addEventListener("mousemove",Bs),t.addEventListener("touchmove",Bs),e._t||(e._t=!0,ut("tick",()=>{e._lf.length=0,e._cf.map(i=>{e._lf.push(i)}),e._cf.length=0})),e}function Gr(...n){n.flat().map(t=>{let e=t.context?t.context.canvas:at(),i=Dt.get(e);if(!i)throw new ReferenceError("Pointer events not initialized for the objects canvas");t.__r||(t.__r=t.render,t.render=function(){i._cf.push(this),this.__r()},i._o.push(t))})}function ra(...n){n.flat().map(t=>{let e=t.context?t.context.canvas:at(),i=Dt.get(e);if(!i)throw new ReferenceError("Pointer events not initialized for the objects canvas");t.render=t.__r,t.__r=0,me(i._o,t)})}function oa(n){let t=n.context?n.context.canvas:at(),e=Dt.get(t);if(!e)throw new ReferenceError("Pointer events not initialized for the objects canvas");return e._o.includes(n)&&Yr(e)===n}function qr(n,t){let e=n[0].toUpperCase()+n.substr(1);yn["on"+e]=t}function Zr(n){let t=n[0].toUpperCase()+n.substr(1);yn["on"+t]=0}function Aa(n){return!!Pn[n]}class Wr extends qi{init({padX:t=0,padY:e=0,text:i,disabled:s=!1,container:r,onDown:o,onUp:A,...a}={}){super.init({padX:t,padY:e,...a}),this.textNode=Ur({...i,context:this.context}),this.width||(this.width=this.textNode.width,this.height=this.textNode.height),Gr(this),this.addChild(this.textNode),this._od=o||Xt,this._ou=A||Xt;let l=this._dn=document.createElement("button");l.style=Ir,l.textContent=this.text,s&&this.disable(),l.addEventListener("focus",()=>this.focus()),l.addEventListener("blur",()=>this.blur()),l.addEventListener("keydown",c=>this._kd(c)),l.addEventListener("keyup",c=>this._ku(c)),_i(l,r??this.context.canvas),this._uw(),this._p()}get text(){return this.textNode.text}set text(t){this._d=!0,this.textNode.text=t}get node(){return this._dn}destroy(){this._dn.remove()}_p(){this.text!=this._dn.textContent&&(this._dn.textContent=this.text),this.textNode._p();let t=this.textNode.width+this.padX*2,e=this.textNode.height+this.padY*2;this.width=Math.max(t,this.width),this.height=Math.max(e,this.height),this._uw()}render(){this._d&&this._p(),super.render()}enable(){this.disabled=this._dn.disabled=!1,this.onEnable()}disable(){this.disabled=this._dn.disabled=!0,this.onDisable()}focus(){this.disabled||(this.focused=!0,document.activeElement!=this._dn&&this._dn.focus(wi),this.onFocus())}blur(){this.focused=!1,document.activeElement==this._dn&&this._dn.blur(),this.onBlur()}onOver(){this.disabled||(this.hovered=!0)}onOut(){this.hovered=!1}onEnable(){}onDisable(){}onFocus(){}onBlur(){}onDown(){this.disabled||(this.pressed=!0,this._od())}onUp(){this.disabled||(this.pressed=!1,this._ou())}_kd(t){(t.code=="Enter"||t.code=="Space")&&this.onDown()}_ku(t){(t.code=="Enter"||t.code=="Space")&&this.onUp()}}function aa(){return new Wr(...arguments)}function la(n){let t=n.canvas;n.clearRect(0,0,t.width,t.height)}function ca({fps:n=60,clearCanvas:t=!0,update:e=Xt,render:i,context:s=ot(),blur:r=!1}={}){if(!i)throw Error("You must provide a render() function");let o=0,A=1e3/n,a=1/n,l=t?la:Xt,c,h,u,f,m,d=!0;r||(window.addEventListener("focus",()=>{d=!0}),window.addEventListener("blur",()=>{d=!1})),ut("init",()=>{m.context??(m.context=ot())});function p(){if(h=requestAnimationFrame(p),!!d&&(u=performance.now(),f=u-c,c=u,!(f>1e3))){for(o+=f;o>=A;)Nt("tick"),m.update(a),o-=A;l(m.context),m.render()}}return m={update:e,render:i,isStopped:!0,context:s,start(){this.isStopped&&(c=performance.now(),this.isStopped=!1,requestAnimationFrame(p))},stop(){this.isStopped=!0,cancelAnimationFrame(h)},_frame:p,set _last(g){c=g}},m}let wt=[],En={},bn={},Ln={0:"south",1:"east",2:"west",3:"north",4:"leftshoulder",5:"rightshoulder",6:"lefttrigger",7:"righttrigger",8:"select",9:"start",10:"leftstick",11:"rightstick",12:"dpadup",13:"dpaddown",14:"dpadleft",15:"dpadright"};function ha(n){wt[n.gamepad.index]={pressedButtons:{},axes:{}}}function ua(n){delete wt[n.gamepad.index]}function da(){wt.map(n=>{n.pressedButtons={},n.axes={}})}function Hr(){let n=navigator.getGamepads?navigator.getGamepads():navigator.webkitGetGamepads?navigator.webkitGetGamepads:[];for(let t=0;t<n.length;t++){let e=n[t];if(!e)continue;e.buttons.map((s,r)=>{let o=Ln[r],{pressed:A}=s,{pressedButtons:a}=wt[e.index],l=a[o];!l&&A?[En[e.index],En].map(c=>{var h;(h=c==null?void 0:c[o])==null||h.call(c,e,s,o)}):l&&!A&&[bn[e.index],bn].map(c=>{var h;(h=c==null?void 0:c[o])==null||h.call(c,e,s,o)}),a[o]=A});let{axes:i}=wt[e.index];i.leftstickx=e.axes[0],i.leftsticky=e.axes[1],i.rightstickx=e.axes[2],i.rightsticky=e.axes[3]}}function Jr(){window.addEventListener("gamepadconnected",ha),window.addEventListener("gamepaddisconnected",ua),window.addEventListener("blur",da),ut("tick",Hr)}function Xr(n,t,{gamepad:e,handler:i="gamepaddown"}={}){let s=i=="gamepaddown"?En:bn;[].concat(n).map(r=>{isNaN(e)?s[r]=t:(s[e]=s[e]||{},s[e][r]=t)})}function zr(n,{gamepad:t,handler:e="gamepaddown"}={}){let i=e=="gamepaddown"?En:bn;[].concat(n).map(s=>{isNaN(t)?delete i[s]:(i[t]=i[t]||{},delete i[t][s])})}function fa(n,{gamepad:t}={}){return isNaN(t)?wt.some(e=>e.pressedButtons[n]):wt[t]?!!wt[t].pressedButtons[n]:!1}function ga(n,t){var e;return((e=wt[t])==null?void 0:e.axes[n])||0}let Cn={},en,Rs=!1,Sn={swipe:{touches:1,threshold:10,touchend({0:n}){let t=n.x-n.start.x,e=n.y-n.start.y,i=Math.abs(t),s=Math.abs(e);if(!(i<this.threshold&&s<this.threshold))return i>s?t<0?"left":"right":e<0?"up":"down"}},pinch:{touches:2,threshold:2,touchstart({0:n,1:t}){this.prevDist=Math.hypot(n.x-t.x,n.y-t.y)},touchmove({0:n,1:t}){let e=Math.hypot(n.x-t.x,n.y-t.y);if(Math.abs(e-this.prevDist)<this.threshold)return;let i=e>this.prevDist?"out":"in";return this.prevDist=e,i}}};function jr(){Rs||(Rs=!0,ut("touchChanged",(n,t)=>{Object.keys(Sn).map(e=>{var r;let i=Sn[e],s;(!en||en==e)&&t.length==i.touches&&[...Array(t.length).keys()].every(o=>t[o])&&(s=((r=i[n.type])==null?void 0:r.call(i,t))??"")&&Cn[e+s]&&(en=e,Cn[e+s](n,t))})}),ut("touchEnd",()=>{en=0}))}function Kr(n,t){[].concat(n).map(e=>{Cn[e]=t})}function $r(n){[].concat(n).map(t=>{Cn[t]=0})}let pa={set(n,t,e){return t.startsWith("_")||(n._d=!0),Reflect.set(n,t,e)}},vs={start(n){return n?1:0},center(){return .5},end(n){return n?0:1}};class to extends Re{init({flow:t="column",align:e="start",justify:i="start",colGap:s=0,rowGap:r=0,numCols:o=1,dir:A="",breakpoints:a=[],...l}={}){return super.init({flow:t,align:e,justify:i,colGap:s,rowGap:r,numCols:o,dir:A,breakpoints:a,...l}),this._p(),new Proxy(this,pa)}addChild(t){this._d=!0,super.addChild(t)}removeChild(t){this._d=!0,super.removeChild(t)}render(){this._d&&this._p(),super.render()}destroy(){this.children.map(t=>t.destroy&&t.destroy())}_p(){this._d=!1,this.breakpoints.map(g=>{g.metric.call(this)&&this._b!==g&&(this._b=g,g.callback.call(this))});let t=this._g=[],e=this._cw=[],i=this._rh=[],s=this.children,r=this._nc=this.flow=="column"?1:this.flow=="row"?s.length:this.numCols,o=0,A=0;for(let g=0,y;y=s[g];g++){t[o]=t[o]||[],y._p&&y._p();let{width:C,height:E}=y.world||y;i[o]=Math.max(i[o]||0,E);let B=y.colSpan||1,x=B;do e[A]=Math.max(e[A]||0,C/x),t[o][A]=y;while(A++<=r&&--B);A>=r&&(A=0,o++)}for(;A>0&&A<r;)t[o][A++]=!1;let a=t.length,l=[].concat(this.colGap),c=[].concat(this.rowGap);this._w=e.reduce((g,y)=>g+=y,0);for(let g=0;g<r-1;g++)this._w+=l[g%l.length];this._h=i.reduce((g,y)=>g+=y,0);for(let g=0;g<a-1;g++)this._h+=c[g%c.length];this._uw();let u=this.context.canvas.dir=="rtl"&&!this.dir||this.dir=="rtl";this._rtl=u,u&&(this._g=t.map(g=>g.reverse()),this._cw=e.reverse(),l=l.reverse());let f=-this.anchor.y*this.height,m=[],d=[].concat(this.justify),p=[].concat(this.align);this._g.map((g,y)=>{let C=-this.anchor.x*this.width;g.map((E,B)=>{if(E&&!m.includes(E)){m.push(E);let x=vs[E.justifySelf||d[B%d.length]](this._rtl),R=vs[E.alignSelf||p[y%p.length]](),k=E.colSpan||1,F=e[B];if(k>1&&B+k<=this._nc)for(let S=1;S<k;S++)F+=e[B+S]+l[(B+S)%l.length];let N=F*x,D=i[y]*R,w=0,I=0,{width:b,height:_}=E.world||E;if(E.anchor&&(w=E.anchor.x,I=E.anchor.y),x==0)N=N+b*w;else if(x==.5){let S=w<.5?-1:w==.5?0:1;N=N+S*b*x}else N=N-b*(1-w);if(R==0)D=D+_*I;else if(R==.5){let S=I<.5?-1:I==.5?0:1;D=D+S*_*R}else D=D-_*(1-I);E.x=C+N,E.y=f+D}C+=e[B]+l[B%l.length]}),f+=i[y]+c[y%c.length]})}}function ma(){return new to(...arguments)}let Wi={},Hi={},Fn={},Rt={Enter:"enter",Escape:"esc",Space:"space",ArrowLeft:"arrowleft",ArrowUp:"arrowup",ArrowRight:"arrowright",ArrowDown:"arrowdown"};function eo(n=Xt,t){n._pd&&t.preventDefault(),n(t)}function wa(n){let t=Rt[n.code],e=Wi[t];Fn[t]=!0,eo(e,n)}function _a(n){let t=Rt[n.code],e=Hi[t];Fn[t]=!1,eo(e,n)}function ya(){Fn={}}function no(){let n;for(n=0;n<26;n++)Rt["Key"+String.fromCharCode(n+65)]=String.fromCharCode(n+97);for(n=0;n<10;n++)Rt["Digit"+n]=Rt["Numpad"+n]=""+n;window.addEventListener("keydown",wa),window.addEventListener("keyup",_a),window.addEventListener("blur",ya)}function io(n,t,{handler:e="keydown",preventDefault:i=!0}={}){let s=e=="keydown"?Wi:Hi;t._pd=i,[].concat(n).map(r=>s[r]=t)}function so(n,{handler:t="keydown"}={}){let e=t=="keydown"?Wi:Hi;[].concat(n).map(i=>delete e[i])}function Ea(n){return!![].concat(n).some(t=>Fn[t])}function xn(n,t){return Object.values(t).includes(n)}function ro(n){return Object.keys(Sn).some(t=>n.startsWith(t))}function ba(n={}){no();let t=Vr(n.pointer);return jr(),Jr(),{pointer:t}}function Ca(n,t,{gamepad:e,key:i}={}){[].concat(n).map(s=>{if(xn(s,Ln))Xr(s,t,e);else if(ro(s))Kr(s,t);else if(xn(s,Rt))io(s,t,i);else if(["down","up"].includes(s))qr(s,t);else throw new TypeError(`"${s}" is not a valid input name`)})}function Sa(n,{gamepad:t,key:e}={}){[].concat(n).map(i=>{xn(i,Ln)?zr(i,t):ro(i)?$r(i):xn(i,Rt)?so(i,e):["down","up"].includes(i)&&Zr(i)})}function oo(n){let t=n.substr(n.search(/[A-Z]/));return t[0].toLowerCase()+t.substr(1)}function xa(n,t){let e=n.prototype;e&&(e._inc||(e._inc={},e._bInc=function(s,r,...o){return this._inc[r].before.reduce((A,a)=>{let l=a(s,...A);return l||A},o)},e._aInc=function(s,r,o,...A){return this._inc[r].after.reduce((a,l)=>{let c=l(s,a,...A);return c||a},o)}),Object.getOwnPropertyNames(t).map(i=>{let s=oo(i);e[s]&&(e["_o"+s]||(e["_o"+s]=e[s],e[s]=function(...o){let A=this._bInc(this,s,...o),a=e["_o"+s].call(this,...A);return this._aInc(this,s,a,...o)}),e._inc[s]||(e._inc[s]={before:[],after:[]}),i.startsWith("before")?e._inc[s].before.push(t[i]):i.startsWith("after")&&e._inc[s].after.push(t[i]))}))}function Ia(n,t){let e=n.prototype;!e||!e._inc||Object.getOwnPropertyNames(t).map(i=>{let s=oo(i);i.startsWith("before")?me(e._inc[s].before,t[i]):i.startsWith("after")&&me(e._inc[s].after,t[i])})}function Ba(n,t){let e=n.prototype;e&&Object.getOwnPropertyNames(t).map(i=>{e[i]||(e[i]=t[i])})}class Ao{constructor({create:t,maxSize:e=1024}={}){let i;if(!t||!(i=t())||!(i.update&&i.init&&i.isAlive&&i.render))throw Error("Must provide create() function which returns an object with init(), update(), render(), and isAlive() functions");this._c=t,this.objects=[t()],this.size=0,this.maxSize=e}get(t={}){if(this.size==this.objects.length){if(this.size==this.maxSize)return;for(let i=0;i<this.size&&this.objects.length<this.maxSize;i++)this.objects.push(this._c())}let e=this.objects[this.size];return this.size++,e.init(t),e}getAliveObjects(){return this.objects.slice(0,this.size)}clear(){this.size=this.objects.length=0,this.objects.push(this._c())}update(t){let e,i=!1;for(let s=this.size;s--;)e=this.objects[s],e.update(t),e.isAlive()||(i=!0,this.size--);i&&this.objects.sort((s,r)=>r.isAlive()-s.isAlive())}render(){for(let t=this.size;t--;)this.objects[t].render()}}function Ta(){return new Ao(...arguments)}function ks(n,t){let e=[],i=t.x+t.width/2,s=t.y+t.height/2,r=n.y<s,o=n.y+n.height>=s;return n.x<i&&(r&&e.push(0),o&&e.push(2)),n.x+n.width>=i&&(r&&e.push(1),o&&e.push(3)),e}class Un{constructor({maxDepth:t=3,maxObjects:e=25,bounds:i}={}){this.maxDepth=t,this.maxObjects=e;let s=at();this.bounds=i||{x:0,y:0,width:s.width,height:s.height},this._b=!1,this._d=0,this._o=[],this._s=[],this._p=null}clear(){this._s.map(t=>{t.clear()}),this._b=!1,this._o.length=0}get(t){let e=new Set;for(;this._s.length&&this._b;)return ks(t,this.bounds).map(i=>{this._s[i].get(t).map(s=>e.add(s))}),Array.from(e);return this._o.filter(i=>i!==t)}add(...t){t.flat().map(e=>{if(this._b){this._a(e);return}this._o.push(e),this._o.length>this.maxObjects&&this._d<this.maxDepth&&(this._sp(),this._o.map(i=>this._a(i)),this._o.length=0)})}_a(t){ks(t,this.bounds).map(e=>{this._s[e].add(t)})}_sp(t,e,i){if(this._b=!0,!this._s.length)for(t=this.bounds.width/2|0,e=this.bounds.height/2|0,i=0;i<4;i++)this._s[i]=new Un({bounds:{x:this.bounds.x+(i%2==1?t:0),y:this.bounds.y+(i>=2?e:0),width:t,height:e},maxDepth:this.maxDepth,maxObjects:this.maxObjects}),this._s[i]._d=this._d+1}}function Ra(){return new Un(...arguments)}let pt;function ao(){pt??(pt=Date.now()),pt|=0,pt=pt+2654435769|0;let n=pt^pt>>>16;return n=Math.imul(n,569420461),n=n^n>>>15,n=Math.imul(n,1935289751),((n=n^n>>>15)>>>0)/4294967296}function va(n,t,e=ao){return(e()*(t-n+1)|0)+n}function ka(){return pt}function Na(n=Date.now()){if(pt=n,typeof n=="string"){for(var t=0,e=1779033703^n.length;t<n.length;t++)e=Math.imul(e^n.charCodeAt(t),3432918353),e=e<<13|e>>>19;e=Math.imul(e^e>>>16,2246822507),e=Math.imul(e^e>>>13,3266489909),pt=(e^=e>>>16)>>>0}}function yi(n){let t=[];return n._dn?t.push(n._dn):n.children&&n.children.map(e=>{t=t.concat(yi(e))}),t}class lo{constructor({id:t,name:e=t,objects:i=[],context:s=ot(),cullObjects:r=!0,cullFunction:o=xr,sortFunction:A,...a}){this._o=[],Object.assign(this,{id:t,name:e,context:s,cullObjects:r,cullFunction:o,sortFunction:A,...a});let l=this._dn=document.createElement("section");l.tabIndex=-1,l.style=Ir,l.id=t,l.setAttribute("aria-label",e);let c=this;class h extends Re{set x(f){c.sx=f-this.centerX,super.x=f}get x(){return super.x}set y(f){c.sy=f-this.centerY,super.y=f}get y(){return super.y}}this.camera=new h({context:s,anchor:{x:.5,y:.5},render:this._rf.bind(this)}),this.add(i),this._i=()=>{this.context??(this.context=ot());let u=this.context.canvas,{width:f,height:m}=u,d=f/2,p=m/2;Object.assign(this.camera,{centerX:d,centerY:p,x:d,y:p,width:f,height:m}),l.isConnected||_i(l,u)},this.context&&this._i(),ut("init",this._i)}set objects(t){this.remove(this._o),this.add(t)}get objects(){return this._o}get node(){return this._dn}add(...t){t.flat().map(e=>{this._o.push(e),e.parent=this,this._dn.append(...yi(e))})}remove(...t){t.flat().map(e=>{me(this._o,e),e.parent=null,yi(e).map(i=>{_i(i,this.context.canvas)})})}show(){this.hidden=this._dn.hidden=!1;let t=this._o.find(e=>e.focus);t?t.focus(wi):this._dn.focus(wi),this.onShow()}hide(){this.hidden=this._dn.hidden=!0,this.onHide()}destroy(){Tr("init",this._i),this._dn.remove(),this._o.map(t=>t.destroy&&t.destroy())}lookAt(t){let{x:e,y:i}=t.world||t;this.camera.x=e,this.camera.y=i}update(t){this.hidden||this._o.map(e=>e.update&&e.update(t))}_rf(){let{_o:t,context:e,_sx:i,_sy:s,camera:r,sortFunction:o,cullObjects:A,cullFunction:a}=this;e.translate(i,s);let l=t;A&&(l=l.filter(c=>a(r,c))),o&&l.sort(o),l.map(c=>c.render&&c.render())}render(){if(!this.hidden){let{context:t,camera:e}=this,{x:i,y:s,centerX:r,centerY:o}=e;t.save(),this._sx=r-i,this._sy=o-s,t.translate(this._sx,this._sy),e.render(),t.restore()}}onShow(){}onHide(){}}function Da(){return new lo(...arguments)}function Ma(n){if(+n==n)return n;let t=[],e=n.split(".."),i=+e[0],s=+e[1],r=i;if(i<s)for(;r<=s;r++)t.push(r);else for(;r>=s;r--)t.push(r);return t}let co=class{constructor({image:t,frameWidth:e,frameHeight:i,spacing:s=0,margin:r=0,animations:o}={}){if(!t)throw Error("You must provide an Image for the SpriteSheet");this.animations={},this.image=t,this.frame={width:e,height:i,spacing:s,margin:r},this._f=(t.width-r)/e|0,this.createAnimations(o)}createAnimations(t){let e,i;for(i in t){let{frames:s,frameRate:r,loop:o}=t[i];if(e=[],s==null)throw Error("Animation "+i+" must provide a frames property");[].concat(s).map(A=>{e=e.concat(Ma(A))}),this.animations[i]=Rr({spriteSheet:this,frames:e,frameRate:r,loop:o,name:i})}}};function Oa(){return new co(...arguments)}let Ns=2147483648,Ds=1073741824,Ms=536870912;function ke(n,t){return n/t|0}function Ne(n,t){return n/t|0}class ho{constructor(t={}){let{width:e,height:i,tilewidth:s,tileheight:r,tilesets:o}=t,A=e*s,a=i*r,l=document.createElement("canvas");l.width=A,l.height=a,this._c=l,this._ctx=l.getContext("2d"),o.map(c=>{let{__k:h,location:u}=window,f=(h?h.dm.get(t):"")||u.href,{source:m}=c;if(m){if(!h)throw Error('You must use "load" or "loadData" to resolve tileset.source');let p=h.d[h.u(m,f)];if(!p)throw Error(`You must load the tileset source "${m}" before loading the tileset`);Object.keys(p).map(g=>{c[g]=p[g]})}let{image:d}=c;if(""+d===d){if(!h)throw Error('You must use "load" or "loadImage" to resolve tileset.image');let p=h.i[h.u(d,f)];if(!p)throw Error(`You must load the image "${d}" before loading the tileset`);c.image=p}}),Object.assign(this,{context:ot(),layerMap:{},layerCanvases:{},mapwidth:A,mapheight:a,_sx:0,_sy:0,_o:[],...t}),this.context&&this._p(),ut("init",()=>{this.context??(this.context=ot()),this._p()})}get sx(){return this._sx}get sy(){return this._sy}set sx(t){let e=Math.max(0,this.mapwidth-at().width);this._sx=ge(0,e,t)}set sy(t){let e=Math.max(0,this.mapheight-at().height);this._sy=ge(0,e,t)}set objects(t){this.remove(this._o),this.add(t)}get objects(){return this._o}add(...t){t.flat().map(e=>{this._o.push(e),e.parent=this})}remove(...t){t.flat().map(e=>{me(this._o,e),e.parent=null})}getPosition(t){let e=at().getBoundingClientRect(),i=t.x-e.x,s=t.y-e.y;return i+=this.sx,s+=this.sy,{x:i,y:s,row:ke(s,this.tileheight),col:Ne(i,this.tilewidth)}}setTileAtLayer(t,e,i){let{layerMap:s,tileheight:r,tilewidth:o,width:A}=this,{row:a,col:l,x:c,y:h}=e,u=a??ke(h,r),f=l??Ne(c,o);s[t]&&(this._d=!0,s[t]._d=!0,s[t].data[u*A+f]=i)}setLayer(t,e){let{layerMap:i}=this;i[t]&&(this._d=!0,i[t]._d=!0,i[t].data=e)}layerCollidesWith(t,e){let{tilewidth:i,tileheight:s,layerMap:r}=this,{x:o,y:A,width:a,height:l}=pe(e),c=ke(A,s),h=Ne(o,i),u=ke(A+l,s),f=Ne(o+a,i),m=r[t];for(let d=c;d<=u;d++)for(let p=h;p<=f;p++)if(m.data[p+d*this.width])return!0;return!1}tileAtLayer(t,e){let{layerMap:i,tileheight:s,tilewidth:r,width:o}=this,{row:A,col:a,x:l,y:c}=e,h=A??ke(c,s),u=a??Ne(l,r);return i[t]?i[t].data[h*o+u]:-1}render(t=this._c,e=!0){let{_d:i,context:s,sx:r=0,sy:o=0}=this;i&&this._p();let{width:A,height:a}=at(),l=Math.min(t.width,A),c=Math.min(t.height,a);s.drawImage(t,r,o,l,c,0,0,l,c),e&&(s.save(),(r||o)&&s.translate(-r,-o),this.objects.map(h=>h.render&&h.render()),s.restore())}renderLayer(t){let{layerCanvases:e,layerMap:i}=this,s=i[t],r=e[t],o=r==null?void 0:r.getContext("2d");if(!r){let{mapwidth:A,mapheight:a}=this;r=document.createElement("canvas"),o=r.getContext("2d"),r.width=A,r.height=a,e[t]=r,this._rl(s,o)}s._d&&(s._d=!1,o.clearRect(0,0,r.width,r.height),this._rl(s,o)),this.render(r,!1)}_p(){let{_ctx:t,layers:e=[],layerMap:i}=this;this._d=!1,e.map(s=>{let{name:r,data:o,visible:A}=s;s._d=!1,i[r]=s,o&&A!=!1&&this._rl(s,t)})}_rl(t,e){let{opacity:i,data:s=[]}=t,{tilesets:r,width:o,tilewidth:A,tileheight:a}=this;e.save(),e.globalAlpha=i,s.map((l,c)=>{if(!l)return;let h=0,u=0,f=l&Ns,m=l&Ds,d=0,p=0,g=0,y=0,C=0;h=f||m,l&=~(Ns|Ds),C=l&Ms,C&&(f&&m?g=1:f?d=1:m?p=1:y=1,u=d||p||g||y,l&=~Ms);let E;for(let S=r.length-1;S>=0&&(E=r[S],!(l/E.firstgid>=1));S--);let{image:B,spacing:x=0,margin:R=0,firstgid:k,columns:F}=E,N=l-k,D=F??B.width/(A+x)|0,w=c%o*A,I=(c/o|0)*a,b=R+N%D*(A+x),_=R+(N/D|0)*(a+x);u?(e.save(),e.translate(w+A/2,I+a/2),p||y?e.rotate(-Math.PI/2):(d||g)&&e.rotate(Math.PI/2),(g||y)&&e.scale(-1,1),w=-A/2,I=-a/2):h&&(e.save(),e.translate(w+(f?A:0),I+(m?a:0)),e.scale(f?-1:1,m?-1:1),w=h?0:w,I=h?0:I),e.drawImage(B,b,_,A,a,w,I,A,a),(h||u)&&e.restore()}),e.restore()}}function Pa(){return new ho(...arguments)}let La={Animation:Rr,AnimationClass:Mn,imageAssets:Gt,audioAssets:oe,dataAssets:qt,setImagePath:HA,setAudioPath:JA,setDataPath:XA,loadImage:Or,loadAudio:Pr,loadData:Lr,load:zA,Button:aa,ButtonClass:Wr,init:VA,getCanvas:at,getContext:ot,on:ut,off:Tr,emit:Nt,GameLoop:ca,GameObject:KA,GameObjectClass:Re,gamepadMap:Ln,updateGamepad:Hr,initGamepad:Jr,onGamepad:Xr,offGamepad:zr,gamepadPressed:fa,gamepadAxis:ga,gestureMap:Sn,initGesture:jr,onGesture:Kr,offGesture:$r,Grid:ma,GridClass:to,degToRad:DA,radToDeg:MA,angleToTarget:OA,rotatePoint:Sr,movePoint:PA,lerp:LA,inverseLerp:FA,clamp:ge,setStoreItem:UA,getStoreItem:QA,collides:xr,getWorldRect:pe,depthSort:YA,initInput:ba,onInput:Ca,offInput:Sa,keyMap:Rt,initKeys:no,onKey:io,offKey:so,keyPressed:Ea,registerPlugin:xa,unregisterPlugin:Ia,extendObject:Ba,initPointer:Vr,getPointer:na,track:Gr,untrack:ra,pointerOver:oa,onPointer:qr,offPointer:Zr,pointerPressed:Aa,Pool:Ta,PoolClass:Ao,Quadtree:Ra,QuadtreeClass:Un,rand:ao,randInt:va,getSeed:ka,seedRand:Na,Scene:Da,SceneClass:lo,Sprite:$A,SpriteClass:qi,SpriteSheet:Oa,SpriteSheetClass:co,Text:Ur,TextClass:Fr,TileEngine:Pa,TileEngineClass:ho,Vector:dn,VectorClass:Wt};function Os(n){if(!Number.isSafeInteger(n)||n<0)throw new Error(`positive integer expected, not ${n}`)}function Fa(n){return n instanceof Uint8Array||n!=null&&typeof n=="object"&&n.constructor.name==="Uint8Array"}function Qn(n,...t){if(!Fa(n))throw new Error("Uint8Array expected");if(t.length>0&&!t.includes(n.length))throw new Error(`Uint8Array expected of length ${t}, not of length=${n.length}`)}function Ua(n){if(typeof n!="function"||typeof n.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");Os(n.outputLen),Os(n.blockLen)}function In(n,t=!0){if(n.destroyed)throw new Error("Hash instance has been destroyed");if(t&&n.finished)throw new Error("Hash#digest() has already been called")}function Qa(n,t){Qn(n);const e=t.outputLen;if(n.length<e)throw new Error(`digestInto() expects output buffer of length at least ${e}`)}const $n=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */const ti=n=>new DataView(n.buffer,n.byteOffset,n.byteLength),ht=(n,t)=>n<<32-t|n>>>t;new Uint8Array(new Uint32Array([287454020]).buffer)[0];function Ya(n){if(typeof n!="string")throw new Error(`utf8ToBytes expected string, got ${typeof n}`);return new Uint8Array(new TextEncoder().encode(n))}function Ji(n){return typeof n=="string"&&(n=Ya(n)),Qn(n),n}function Va(...n){let t=0;for(let i=0;i<n.length;i++){const s=n[i];Qn(s),t+=s.length}const e=new Uint8Array(t);for(let i=0,s=0;i<n.length;i++){const r=n[i];e.set(r,s),s+=r.length}return e}class uo{clone(){return this._cloneInto()}}function Ga(n){const t=i=>n().update(Ji(i)).digest(),e=n();return t.outputLen=e.outputLen,t.blockLen=e.blockLen,t.create=()=>n(),t}function fo(n=32){if($n&&typeof $n.getRandomValues=="function")return $n.getRandomValues(new Uint8Array(n));throw new Error("crypto.getRandomValues must be defined")}function qa(n,t,e,i){if(typeof n.setBigUint64=="function")return n.setBigUint64(t,e,i);const s=BigInt(32),r=BigInt(4294967295),o=Number(e>>s&r),A=Number(e&r),a=i?4:0,l=i?0:4;n.setUint32(t+a,o,i),n.setUint32(t+l,A,i)}const Za=(n,t,e)=>n&t^~n&e,Wa=(n,t,e)=>n&t^n&e^t&e;class Ha extends uo{constructor(t,e,i,s){super(),this.blockLen=t,this.outputLen=e,this.padOffset=i,this.isLE=s,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(t),this.view=ti(this.buffer)}update(t){In(this);const{view:e,buffer:i,blockLen:s}=this;t=Ji(t);const r=t.length;for(let o=0;o<r;){const A=Math.min(s-this.pos,r-o);if(A===s){const a=ti(t);for(;s<=r-o;o+=s)this.process(a,o);continue}i.set(t.subarray(o,o+A),this.pos),this.pos+=A,o+=A,this.pos===s&&(this.process(e,0),this.pos=0)}return this.length+=t.length,this.roundClean(),this}digestInto(t){In(this),Qa(t,this),this.finished=!0;const{buffer:e,view:i,blockLen:s,isLE:r}=this;let{pos:o}=this;e[o++]=128,this.buffer.subarray(o).fill(0),this.padOffset>s-o&&(this.process(i,0),o=0);for(let h=o;h<s;h++)e[h]=0;qa(i,s-8,BigInt(this.length*8),r),this.process(i,0);const A=ti(t),a=this.outputLen;if(a%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const l=a/4,c=this.get();if(l>c.length)throw new Error("_sha2: outputLen bigger than state");for(let h=0;h<l;h++)A.setUint32(4*h,c[h],r)}digest(){const{buffer:t,outputLen:e}=this;this.digestInto(t);const i=t.slice(0,e);return this.destroy(),i}_cloneInto(t){t||(t=new this.constructor),t.set(...this.get());const{blockLen:e,buffer:i,length:s,finished:r,destroyed:o,pos:A}=this;return t.length=s,t.pos=A,t.finished=r,t.destroyed=o,s%e&&t.buffer.set(i),t}}const Ja=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Ct=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),St=new Uint32Array(64);class Xa extends Ha{constructor(){super(64,32,8,!1),this.A=Ct[0]|0,this.B=Ct[1]|0,this.C=Ct[2]|0,this.D=Ct[3]|0,this.E=Ct[4]|0,this.F=Ct[5]|0,this.G=Ct[6]|0,this.H=Ct[7]|0}get(){const{A:t,B:e,C:i,D:s,E:r,F:o,G:A,H:a}=this;return[t,e,i,s,r,o,A,a]}set(t,e,i,s,r,o,A,a){this.A=t|0,this.B=e|0,this.C=i|0,this.D=s|0,this.E=r|0,this.F=o|0,this.G=A|0,this.H=a|0}process(t,e){for(let h=0;h<16;h++,e+=4)St[h]=t.getUint32(e,!1);for(let h=16;h<64;h++){const u=St[h-15],f=St[h-2],m=ht(u,7)^ht(u,18)^u>>>3,d=ht(f,17)^ht(f,19)^f>>>10;St[h]=d+St[h-7]+m+St[h-16]|0}let{A:i,B:s,C:r,D:o,E:A,F:a,G:l,H:c}=this;for(let h=0;h<64;h++){const u=ht(A,6)^ht(A,11)^ht(A,25),f=c+u+Za(A,a,l)+Ja[h]+St[h]|0,d=(ht(i,2)^ht(i,13)^ht(i,22))+Wa(i,s,r)|0;c=l,l=a,a=A,A=o+f|0,o=r,r=s,s=i,i=f+d|0}i=i+this.A|0,s=s+this.B|0,r=r+this.C|0,o=o+this.D|0,A=A+this.E|0,a=a+this.F|0,l=l+this.G|0,c=c+this.H|0,this.set(i,s,r,o,A,a,l,c)}roundClean(){St.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}const Ei=Ga(()=>new Xa);class go extends uo{constructor(t,e){super(),this.finished=!1,this.destroyed=!1,Ua(t);const i=Ji(e);if(this.iHash=t.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const s=this.blockLen,r=new Uint8Array(s);r.set(i.length>s?t.create().update(i).digest():i);for(let o=0;o<r.length;o++)r[o]^=54;this.iHash.update(r),this.oHash=t.create();for(let o=0;o<r.length;o++)r[o]^=106;this.oHash.update(r),r.fill(0)}update(t){return In(this),this.iHash.update(t),this}digestInto(t){In(this),Qn(t,this.outputLen),this.finished=!0,this.iHash.digestInto(t),this.oHash.update(t),this.oHash.digestInto(t),this.destroy()}digest(){const t=new Uint8Array(this.oHash.outputLen);return this.digestInto(t),t}_cloneInto(t){t||(t=Object.create(Object.getPrototypeOf(this),{}));const{oHash:e,iHash:i,finished:s,destroyed:r,blockLen:o,outputLen:A}=this;return t=t,t.finished=s,t.destroyed=r,t.blockLen=o,t.outputLen=A,t.oHash=e._cloneInto(t.oHash),t.iHash=i._cloneInto(t.iHash),t}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const po=(n,t,e)=>new go(n,t).update(e).digest();po.create=(n,t)=>new go(n,t);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Xi=BigInt(0),Yn=BigInt(1),za=BigInt(2);function zt(n){return n instanceof Uint8Array||n!=null&&typeof n=="object"&&n.constructor.name==="Uint8Array"}function We(n){if(!zt(n))throw new Error("Uint8Array expected")}function we(n,t){if(typeof t!="boolean")throw new Error(`${n} must be valid boolean, got "${t}".`)}const ja=Array.from({length:256},(n,t)=>t.toString(16).padStart(2,"0"));function _e(n){We(n);let t="";for(let e=0;e<n.length;e++)t+=ja[n[e]];return t}function mo(n){const t=n.toString(16);return t.length&1?`0${t}`:t}function zi(n){if(typeof n!="string")throw new Error("hex string expected, got "+typeof n);return BigInt(n===""?"0":`0x${n}`)}const ft={_0:48,_9:57,_A:65,_F:70,_a:97,_f:102};function Ps(n){if(n>=ft._0&&n<=ft._9)return n-ft._0;if(n>=ft._A&&n<=ft._F)return n-(ft._A-10);if(n>=ft._a&&n<=ft._f)return n-(ft._a-10)}function ye(n){if(typeof n!="string")throw new Error("hex string expected, got "+typeof n);const t=n.length,e=t/2;if(t%2)throw new Error("padded hex string expected, got unpadded hex of length "+t);const i=new Uint8Array(e);for(let s=0,r=0;s<e;s++,r+=2){const o=Ps(n.charCodeAt(r)),A=Ps(n.charCodeAt(r+1));if(o===void 0||A===void 0){const a=n[r]+n[r+1];throw new Error('hex string expected, got non-hex character "'+a+'" at index '+r)}i[s]=o*16+A}return i}function _t(n){return zi(_e(n))}function ji(n){return We(n),zi(_e(Uint8Array.from(n).reverse()))}function Mt(n,t){return ye(n.toString(16).padStart(t*2,"0"))}function Ki(n,t){return Mt(n,t).reverse()}function Ka(n){return ye(mo(n))}function et(n,t,e){let i;if(typeof t=="string")try{i=ye(t)}catch(r){throw new Error(`${n} must be valid hex string, got "${t}". Cause: ${r}`)}else if(zt(t))i=Uint8Array.from(t);else throw new Error(`${n} must be hex string or Uint8Array`);const s=i.length;if(typeof e=="number"&&s!==e)throw new Error(`${n} expected ${e} bytes, got ${s}`);return i}function jt(...n){let t=0;for(let i=0;i<n.length;i++){const s=n[i];We(s),t+=s.length}const e=new Uint8Array(t);for(let i=0,s=0;i<n.length;i++){const r=n[i];e.set(r,s),s+=r.length}return e}function $a(n,t){if(n.length!==t.length)return!1;let e=0;for(let i=0;i<n.length;i++)e|=n[i]^t[i];return e===0}function tl(n){if(typeof n!="string")throw new Error(`utf8ToBytes expected string, got ${typeof n}`);return new Uint8Array(new TextEncoder().encode(n))}const ei=n=>typeof n=="bigint"&&Xi<=n;function Ee(n,t,e){return ei(n)&&ei(t)&&ei(e)&&t<=n&&n<e}function vt(n,t,e,i){if(!Ee(t,e,i))throw new Error(`expected valid ${n}: ${e} <= n < ${i}, got ${typeof t} ${t}`)}function el(n){let t;for(t=0;n>Xi;n>>=Yn,t+=1);return t}function nl(n,t){return n>>BigInt(t)&Yn}function il(n,t,e){return n|(e?Yn:Xi)<<BigInt(t)}const $i=n=>(za<<BigInt(n-1))-Yn,ni=n=>new Uint8Array(n),Ls=n=>Uint8Array.from(n);function wo(n,t,e){if(typeof n!="number"||n<2)throw new Error("hashLen must be a number");if(typeof t!="number"||t<2)throw new Error("qByteLen must be a number");if(typeof e!="function")throw new Error("hmacFn must be a function");let i=ni(n),s=ni(n),r=0;const o=()=>{i.fill(1),s.fill(0),r=0},A=(...h)=>e(s,i,...h),a=(h=ni())=>{s=A(Ls([0]),h),i=A(),h.length!==0&&(s=A(Ls([1]),h),i=A())},l=()=>{if(r++>=1e3)throw new Error("drbg: tried 1000 values");let h=0;const u=[];for(;h<t;){i=A();const f=i.slice();u.push(f),h+=i.length}return jt(...u)};return(h,u)=>{o(),a(h);let f;for(;!(f=u(l()));)a();return o(),f}}const sl={bigint:n=>typeof n=="bigint",function:n=>typeof n=="function",boolean:n=>typeof n=="boolean",string:n=>typeof n=="string",stringOrUint8Array:n=>typeof n=="string"||zt(n),isSafeInteger:n=>Number.isSafeInteger(n),array:n=>Array.isArray(n),field:(n,t)=>t.Fp.isValid(n),hash:n=>typeof n=="function"&&Number.isSafeInteger(n.outputLen)};function He(n,t,e={}){const i=(s,r,o)=>{const A=sl[r];if(typeof A!="function")throw new Error(`Invalid validator "${r}", expected function`);const a=n[s];if(!(o&&a===void 0)&&!A(a,n))throw new Error(`Invalid param ${String(s)}=${a} (${typeof a}), expected ${r}`)};for(const[s,r]of Object.entries(t))i(s,r,!1);for(const[s,r]of Object.entries(e))i(s,r,!0);return n}const rl=()=>{throw new Error("not implemented")};function bi(n){const t=new WeakMap;return(e,...i)=>{const s=t.get(e);if(s!==void 0)return s;const r=n(e,...i);return t.set(e,r),r}}const ol=Object.freeze(Object.defineProperty({__proto__:null,aInRange:vt,abool:we,abytes:We,bitGet:nl,bitLen:el,bitMask:$i,bitSet:il,bytesToHex:_e,bytesToNumberBE:_t,bytesToNumberLE:ji,concatBytes:jt,createHmacDrbg:wo,ensureBytes:et,equalBytes:$a,hexToBytes:ye,hexToNumber:zi,inRange:Ee,isBytes:zt,memoized:bi,notImplemented:rl,numberToBytesBE:Mt,numberToBytesLE:Ki,numberToHexUnpadded:mo,numberToVarBytesBE:Ka,utf8ToBytes:tl,validateObject:He},Symbol.toStringTag,{value:"Module"}));/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const K=BigInt(0),J=BigInt(1),Zt=BigInt(2),Al=BigInt(3),Ci=BigInt(4),Fs=BigInt(5),Us=BigInt(8);BigInt(9);BigInt(16);function $(n,t){const e=n%t;return e>=K?e:t+e}function al(n,t,e){if(e<=K||t<K)throw new Error("Expected power/modulo > 0");if(e===J)return K;let i=J;for(;t>K;)t&J&&(i=i*n%e),n=n*n%e,t>>=J;return i}function rt(n,t,e){let i=n;for(;t-- >K;)i*=i,i%=e;return i}function Si(n,t){if(n===K||t<=K)throw new Error(`invert: expected positive integers, got n=${n} mod=${t}`);let e=$(n,t),i=t,s=K,r=J;for(;e!==K;){const A=i/e,a=i%e,l=s-r*A;i=e,e=a,s=r,r=l}if(i!==J)throw new Error("invert: does not exist");return $(s,t)}function ll(n){const t=(n-J)/Zt;let e,i,s;for(e=n-J,i=0;e%Zt===K;e/=Zt,i++);for(s=Zt;s<n&&al(s,t,n)!==n-J;s++);if(i===1){const o=(n+J)/Ci;return function(a,l){const c=a.pow(l,o);if(!a.eql(a.sqr(c),l))throw new Error("Cannot find square root");return c}}const r=(e+J)/Zt;return function(A,a){if(A.pow(a,t)===A.neg(A.ONE))throw new Error("Cannot find square root");let l=i,c=A.pow(A.mul(A.ONE,s),e),h=A.pow(a,r),u=A.pow(a,e);for(;!A.eql(u,A.ONE);){if(A.eql(u,A.ZERO))return A.ZERO;let f=1;for(let d=A.sqr(u);f<l&&!A.eql(d,A.ONE);f++)d=A.sqr(d);const m=A.pow(c,J<<BigInt(l-f-1));c=A.sqr(m),h=A.mul(h,m),u=A.mul(u,c),l=f}return h}}function cl(n){if(n%Ci===Al){const t=(n+J)/Ci;return function(i,s){const r=i.pow(s,t);if(!i.eql(i.sqr(r),s))throw new Error("Cannot find square root");return r}}if(n%Us===Fs){const t=(n-Fs)/Us;return function(i,s){const r=i.mul(s,Zt),o=i.pow(r,t),A=i.mul(s,o),a=i.mul(i.mul(A,Zt),o),l=i.mul(A,i.sub(a,i.ONE));if(!i.eql(i.sqr(l),s))throw new Error("Cannot find square root");return l}}return ll(n)}const hl=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function ul(n){const t={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},e=hl.reduce((i,s)=>(i[s]="function",i),t);return He(n,e)}function dl(n,t,e){if(e<K)throw new Error("Expected power > 0");if(e===K)return n.ONE;if(e===J)return t;let i=n.ONE,s=t;for(;e>K;)e&J&&(i=n.mul(i,s)),s=n.sqr(s),e>>=J;return i}function fl(n,t){const e=new Array(t.length),i=t.reduce((r,o,A)=>n.is0(o)?r:(e[A]=r,n.mul(r,o)),n.ONE),s=n.inv(i);return t.reduceRight((r,o,A)=>n.is0(o)?r:(e[A]=n.mul(r,e[A]),n.mul(r,o)),s),e}function _o(n,t){const e=t!==void 0?t:n.toString(2).length,i=Math.ceil(e/8);return{nBitLength:e,nByteLength:i}}function gl(n,t,e=!1,i={}){if(n<=K)throw new Error(`Expected Field ORDER > 0, got ${n}`);const{nBitLength:s,nByteLength:r}=_o(n,t);if(r>2048)throw new Error("Field lengths over 2048 bytes are not supported");const o=cl(n),A=Object.freeze({ORDER:n,BITS:s,BYTES:r,MASK:$i(s),ZERO:K,ONE:J,create:a=>$(a,n),isValid:a=>{if(typeof a!="bigint")throw new Error(`Invalid field element: expected bigint, got ${typeof a}`);return K<=a&&a<n},is0:a=>a===K,isOdd:a=>(a&J)===J,neg:a=>$(-a,n),eql:(a,l)=>a===l,sqr:a=>$(a*a,n),add:(a,l)=>$(a+l,n),sub:(a,l)=>$(a-l,n),mul:(a,l)=>$(a*l,n),pow:(a,l)=>dl(A,a,l),div:(a,l)=>$(a*Si(l,n),n),sqrN:a=>a*a,addN:(a,l)=>a+l,subN:(a,l)=>a-l,mulN:(a,l)=>a*l,inv:a=>Si(a,n),sqrt:i.sqrt||(a=>o(A,a)),invertBatch:a=>fl(A,a),cmov:(a,l,c)=>c?l:a,toBytes:a=>e?Ki(a,r):Mt(a,r),fromBytes:a=>{if(a.length!==r)throw new Error(`Fp.fromBytes: expected ${r}, got ${a.length}`);return e?ji(a):_t(a)}});return Object.freeze(A)}function yo(n){if(typeof n!="bigint")throw new Error("field order must be bigint");const t=n.toString(2).length;return Math.ceil(t/8)}function Eo(n){const t=yo(n);return t+Math.ceil(t/2)}function pl(n,t,e=!1){const i=n.length,s=yo(t),r=Eo(t);if(i<16||i<r||i>1024)throw new Error(`expected ${r}-1024 bytes of input, got ${i}`);const o=e?_t(n):ji(n),A=$(o,t-J)+J;return e?Ki(A,s):Mt(A,s)}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const ml=BigInt(0),ii=BigInt(1),si=new WeakMap,Qs=new WeakMap;function wl(n,t){const e=(r,o)=>{const A=o.negate();return r?A:o},i=r=>{if(!Number.isSafeInteger(r)||r<=0||r>t)throw new Error(`Wrong window size=${r}, should be [1..${t}]`)},s=r=>{i(r);const o=Math.ceil(t/r)+1,A=2**(r-1);return{windows:o,windowSize:A}};return{constTimeNegate:e,unsafeLadder(r,o){let A=n.ZERO,a=r;for(;o>ml;)o&ii&&(A=A.add(a)),a=a.double(),o>>=ii;return A},precomputeWindow(r,o){const{windows:A,windowSize:a}=s(o),l=[];let c=r,h=c;for(let u=0;u<A;u++){h=c,l.push(h);for(let f=1;f<a;f++)h=h.add(c),l.push(h);c=h.double()}return l},wNAF(r,o,A){const{windows:a,windowSize:l}=s(r);let c=n.ZERO,h=n.BASE;const u=BigInt(2**r-1),f=2**r,m=BigInt(r);for(let d=0;d<a;d++){const p=d*l;let g=Number(A&u);A>>=m,g>l&&(g-=f,A+=ii);const y=p,C=p+Math.abs(g)-1,E=d%2!==0,B=g<0;g===0?h=h.add(e(E,o[y])):c=c.add(e(B,o[C]))}return{p:c,f:h}},wNAFCached(r,o,A){const a=Qs.get(r)||1;let l=si.get(r);return l||(l=this.precomputeWindow(r,a),a!==1&&si.set(r,A(l))),this.wNAF(a,l,o)},setWindowSize(r,o){i(o),Qs.set(r,o),si.delete(r)}}}function bo(n){return ul(n.Fp),He(n,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({..._o(n.n,n.nBitLength),...n,p:n.Fp.ORDER})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function Ys(n){n.lowS!==void 0&&we("lowS",n.lowS),n.prehash!==void 0&&we("prehash",n.prehash)}function _l(n){const t=bo(n);He(t,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});const{endo:e,Fp:i,a:s}=t;if(e){if(!i.eql(s,i.ZERO))throw new Error("Endomorphism can only be defined for Koblitz curves that have a=0");if(typeof e!="object"||typeof e.beta!="bigint"||typeof e.splitScalar!="function")throw new Error("Expected endomorphism with beta: bigint and splitScalar: function")}return Object.freeze({...t})}const{bytesToNumberBE:yl,hexToBytes:El}=ol,Ht={Err:class extends Error{constructor(t=""){super(t)}},_parseInt(n){const{Err:t}=Ht;if(n.length<2||n[0]!==2)throw new t("Invalid signature integer tag");const e=n[1],i=n.subarray(2,e+2);if(!e||i.length!==e)throw new t("Invalid signature integer: wrong length");if(i[0]&128)throw new t("Invalid signature integer: negative");if(i[0]===0&&!(i[1]&128))throw new t("Invalid signature integer: unnecessary leading zero");return{d:yl(i),l:n.subarray(e+2)}},toSig(n){const{Err:t}=Ht,e=typeof n=="string"?El(n):n;We(e);let i=e.length;if(i<2||e[0]!=48)throw new t("Invalid signature tag");if(e[1]!==i-2)throw new t("Invalid signature: incorrect length");const{d:s,l:r}=Ht._parseInt(e.subarray(2)),{d:o,l:A}=Ht._parseInt(r);if(A.length)throw new t("Invalid signature: left bytes after parsing");return{r:s,s:o}},hexFromSig(n){const t=l=>Number.parseInt(l[0],16)&8?"00"+l:l,e=l=>{const c=l.toString(16);return c.length&1?`0${c}`:c},i=t(e(n.s)),s=t(e(n.r)),r=i.length/2,o=s.length/2,A=e(r),a=e(o);return`30${e(o+r+4)}02${a}${s}02${A}${i}`}},It=BigInt(0),j=BigInt(1);BigInt(2);const Vs=BigInt(3);BigInt(4);function bl(n){const t=_l(n),{Fp:e}=t,i=t.toBytes||((m,d,p)=>{const g=d.toAffine();return jt(Uint8Array.from([4]),e.toBytes(g.x),e.toBytes(g.y))}),s=t.fromBytes||(m=>{const d=m.subarray(1),p=e.fromBytes(d.subarray(0,e.BYTES)),g=e.fromBytes(d.subarray(e.BYTES,2*e.BYTES));return{x:p,y:g}});function r(m){const{a:d,b:p}=t,g=e.sqr(m),y=e.mul(g,m);return e.add(e.add(y,e.mul(m,d)),p)}if(!e.eql(e.sqr(t.Gy),r(t.Gx)))throw new Error("bad generator point: equation left != right");function o(m){return Ee(m,j,t.n)}function A(m){const{allowedPrivateKeyLengths:d,nByteLength:p,wrapPrivateKey:g,n:y}=t;if(d&&typeof m!="bigint"){if(zt(m)&&(m=_e(m)),typeof m!="string"||!d.includes(m.length))throw new Error("Invalid key");m=m.padStart(p*2,"0")}let C;try{C=typeof m=="bigint"?m:_t(et("private key",m,p))}catch{throw new Error(`private key must be ${p} bytes, hex or bigint, not ${typeof m}`)}return g&&(C=$(C,y)),vt("private key",C,j,y),C}function a(m){if(!(m instanceof h))throw new Error("ProjectivePoint expected")}const l=bi((m,d)=>{const{px:p,py:g,pz:y}=m;if(e.eql(y,e.ONE))return{x:p,y:g};const C=m.is0();d==null&&(d=C?e.ONE:e.inv(y));const E=e.mul(p,d),B=e.mul(g,d),x=e.mul(y,d);if(C)return{x:e.ZERO,y:e.ZERO};if(!e.eql(x,e.ONE))throw new Error("invZ was invalid");return{x:E,y:B}}),c=bi(m=>{if(m.is0()){if(t.allowInfinityPoint&&!e.is0(m.py))return;throw new Error("bad point: ZERO")}const{x:d,y:p}=m.toAffine();if(!e.isValid(d)||!e.isValid(p))throw new Error("bad point: x or y not FE");const g=e.sqr(p),y=r(d);if(!e.eql(g,y))throw new Error("bad point: equation left != right");if(!m.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});class h{constructor(d,p,g){if(this.px=d,this.py=p,this.pz=g,d==null||!e.isValid(d))throw new Error("x required");if(p==null||!e.isValid(p))throw new Error("y required");if(g==null||!e.isValid(g))throw new Error("z required");Object.freeze(this)}static fromAffine(d){const{x:p,y:g}=d||{};if(!d||!e.isValid(p)||!e.isValid(g))throw new Error("invalid affine point");if(d instanceof h)throw new Error("projective point not allowed");const y=C=>e.eql(C,e.ZERO);return y(p)&&y(g)?h.ZERO:new h(p,g,e.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(d){const p=e.invertBatch(d.map(g=>g.pz));return d.map((g,y)=>g.toAffine(p[y])).map(h.fromAffine)}static fromHex(d){const p=h.fromAffine(s(et("pointHex",d)));return p.assertValidity(),p}static fromPrivateKey(d){return h.BASE.multiply(A(d))}_setWindowSize(d){f.setWindowSize(this,d)}assertValidity(){c(this)}hasEvenY(){const{y:d}=this.toAffine();if(e.isOdd)return!e.isOdd(d);throw new Error("Field doesn't support isOdd")}equals(d){a(d);const{px:p,py:g,pz:y}=this,{px:C,py:E,pz:B}=d,x=e.eql(e.mul(p,B),e.mul(C,y)),R=e.eql(e.mul(g,B),e.mul(E,y));return x&&R}negate(){return new h(this.px,e.neg(this.py),this.pz)}double(){const{a:d,b:p}=t,g=e.mul(p,Vs),{px:y,py:C,pz:E}=this;let B=e.ZERO,x=e.ZERO,R=e.ZERO,k=e.mul(y,y),F=e.mul(C,C),N=e.mul(E,E),D=e.mul(y,C);return D=e.add(D,D),R=e.mul(y,E),R=e.add(R,R),B=e.mul(d,R),x=e.mul(g,N),x=e.add(B,x),B=e.sub(F,x),x=e.add(F,x),x=e.mul(B,x),B=e.mul(D,B),R=e.mul(g,R),N=e.mul(d,N),D=e.sub(k,N),D=e.mul(d,D),D=e.add(D,R),R=e.add(k,k),k=e.add(R,k),k=e.add(k,N),k=e.mul(k,D),x=e.add(x,k),N=e.mul(C,E),N=e.add(N,N),k=e.mul(N,D),B=e.sub(B,k),R=e.mul(N,F),R=e.add(R,R),R=e.add(R,R),new h(B,x,R)}add(d){a(d);const{px:p,py:g,pz:y}=this,{px:C,py:E,pz:B}=d;let x=e.ZERO,R=e.ZERO,k=e.ZERO;const F=t.a,N=e.mul(t.b,Vs);let D=e.mul(p,C),w=e.mul(g,E),I=e.mul(y,B),b=e.add(p,g),_=e.add(C,E);b=e.mul(b,_),_=e.add(D,w),b=e.sub(b,_),_=e.add(p,y);let S=e.add(C,B);return _=e.mul(_,S),S=e.add(D,I),_=e.sub(_,S),S=e.add(g,y),x=e.add(E,B),S=e.mul(S,x),x=e.add(w,I),S=e.sub(S,x),k=e.mul(F,_),x=e.mul(N,I),k=e.add(x,k),x=e.sub(w,k),k=e.add(w,k),R=e.mul(x,k),w=e.add(D,D),w=e.add(w,D),I=e.mul(F,I),_=e.mul(N,_),w=e.add(w,I),I=e.sub(D,I),I=e.mul(F,I),_=e.add(_,I),D=e.mul(w,_),R=e.add(R,D),D=e.mul(S,_),x=e.mul(b,x),x=e.sub(x,D),D=e.mul(b,w),k=e.mul(S,k),k=e.add(k,D),new h(x,R,k)}subtract(d){return this.add(d.negate())}is0(){return this.equals(h.ZERO)}wNAF(d){return f.wNAFCached(this,d,h.normalizeZ)}multiplyUnsafe(d){vt("scalar",d,It,t.n);const p=h.ZERO;if(d===It)return p;if(d===j)return this;const{endo:g}=t;if(!g)return f.unsafeLadder(this,d);let{k1neg:y,k1:C,k2neg:E,k2:B}=g.splitScalar(d),x=p,R=p,k=this;for(;C>It||B>It;)C&j&&(x=x.add(k)),B&j&&(R=R.add(k)),k=k.double(),C>>=j,B>>=j;return y&&(x=x.negate()),E&&(R=R.negate()),R=new h(e.mul(R.px,g.beta),R.py,R.pz),x.add(R)}multiply(d){const{endo:p,n:g}=t;vt("scalar",d,j,g);let y,C;if(p){const{k1neg:E,k1:B,k2neg:x,k2:R}=p.splitScalar(d);let{p:k,f:F}=this.wNAF(B),{p:N,f:D}=this.wNAF(R);k=f.constTimeNegate(E,k),N=f.constTimeNegate(x,N),N=new h(e.mul(N.px,p.beta),N.py,N.pz),y=k.add(N),C=F.add(D)}else{const{p:E,f:B}=this.wNAF(d);y=E,C=B}return h.normalizeZ([y,C])[0]}multiplyAndAddUnsafe(d,p,g){const y=h.BASE,C=(B,x)=>x===It||x===j||!B.equals(y)?B.multiplyUnsafe(x):B.multiply(x),E=C(this,p).add(C(d,g));return E.is0()?void 0:E}toAffine(d){return l(this,d)}isTorsionFree(){const{h:d,isTorsionFree:p}=t;if(d===j)return!0;if(p)return p(h,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:d,clearCofactor:p}=t;return d===j?this:p?p(h,this):this.multiplyUnsafe(t.h)}toRawBytes(d=!0){return we("isCompressed",d),this.assertValidity(),i(h,this,d)}toHex(d=!0){return we("isCompressed",d),_e(this.toRawBytes(d))}}h.BASE=new h(t.Gx,t.Gy,e.ONE),h.ZERO=new h(e.ZERO,e.ONE,e.ZERO);const u=t.nBitLength,f=wl(h,t.endo?Math.ceil(u/2):u);return{CURVE:t,ProjectivePoint:h,normPrivateKeyToScalar:A,weierstrassEquation:r,isWithinCurveOrder:o}}function Cl(n){const t=bo(n);return He(t,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...t})}function Sl(n){const t=Cl(n),{Fp:e,n:i}=t,s=e.BYTES+1,r=2*e.BYTES+1;function o(b){return $(b,i)}function A(b){return Si(b,i)}const{ProjectivePoint:a,normPrivateKeyToScalar:l,weierstrassEquation:c,isWithinCurveOrder:h}=bl({...t,toBytes(b,_,S){const T=_.toAffine(),v=e.toBytes(T.x),M=jt;return we("isCompressed",S),S?M(Uint8Array.from([_.hasEvenY()?2:3]),v):M(Uint8Array.from([4]),v,e.toBytes(T.y))},fromBytes(b){const _=b.length,S=b[0],T=b.subarray(1);if(_===s&&(S===2||S===3)){const v=_t(T);if(!Ee(v,j,e.ORDER))throw new Error("Point is not on curve");const M=c(v);let L;try{L=e.sqrt(M)}catch(O){const q=O instanceof Error?": "+O.message:"";throw new Error("Point is not on curve"+q)}const U=(L&j)===j;return(S&1)===1!==U&&(L=e.neg(L)),{x:v,y:L}}else if(_===r&&S===4){const v=e.fromBytes(T.subarray(0,e.BYTES)),M=e.fromBytes(T.subarray(e.BYTES,2*e.BYTES));return{x:v,y:M}}else throw new Error(`Point of length ${_} was invalid. Expected ${s} compressed bytes or ${r} uncompressed bytes`)}}),u=b=>_e(Mt(b,t.nByteLength));function f(b){const _=i>>j;return b>_}function m(b){return f(b)?o(-b):b}const d=(b,_,S)=>_t(b.slice(_,S));class p{constructor(_,S,T){this.r=_,this.s=S,this.recovery=T,this.assertValidity()}static fromCompact(_){const S=t.nByteLength;return _=et("compactSignature",_,S*2),new p(d(_,0,S),d(_,S,2*S))}static fromDER(_){const{r:S,s:T}=Ht.toSig(et("DER",_));return new p(S,T)}assertValidity(){vt("r",this.r,j,i),vt("s",this.s,j,i)}addRecoveryBit(_){return new p(this.r,this.s,_)}recoverPublicKey(_){const{r:S,s:T,recovery:v}=this,M=x(et("msgHash",_));if(v==null||![0,1,2,3].includes(v))throw new Error("recovery id invalid");const L=v===2||v===3?S+t.n:S;if(L>=e.ORDER)throw new Error("recovery id 2 or 3 invalid");const U=v&1?"03":"02",X=a.fromHex(U+u(L)),O=A(L),q=o(-M*O),tt=o(T*O),Z=a.BASE.multiplyAndAddUnsafe(X,q,tt);if(!Z)throw new Error("point at infinify");return Z.assertValidity(),Z}hasHighS(){return f(this.s)}normalizeS(){return this.hasHighS()?new p(this.r,o(-this.s),this.recovery):this}toDERRawBytes(){return ye(this.toDERHex())}toDERHex(){return Ht.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return ye(this.toCompactHex())}toCompactHex(){return u(this.r)+u(this.s)}}const g={isValidPrivateKey(b){try{return l(b),!0}catch{return!1}},normPrivateKeyToScalar:l,randomPrivateKey:()=>{const b=Eo(t.n);return pl(t.randomBytes(b),t.n)},precompute(b=8,_=a.BASE){return _._setWindowSize(b),_.multiply(BigInt(3)),_}};function y(b,_=!0){return a.fromPrivateKey(b).toRawBytes(_)}function C(b){const _=zt(b),S=typeof b=="string",T=(_||S)&&b.length;return _?T===s||T===r:S?T===2*s||T===2*r:b instanceof a}function E(b,_,S=!0){if(C(b))throw new Error("first arg must be private key");if(!C(_))throw new Error("second arg must be public key");return a.fromHex(_).multiply(l(b)).toRawBytes(S)}const B=t.bits2int||function(b){const _=_t(b),S=b.length*8-t.nBitLength;return S>0?_>>BigInt(S):_},x=t.bits2int_modN||function(b){return o(B(b))},R=$i(t.nBitLength);function k(b){return vt(`num < 2^${t.nBitLength}`,b,It,R),Mt(b,t.nByteLength)}function F(b,_,S=N){if(["recovered","canonical"].some(H=>H in S))throw new Error("sign() legacy options not supported");const{hash:T,randomBytes:v}=t;let{lowS:M,prehash:L,extraEntropy:U}=S;M==null&&(M=!0),b=et("msgHash",b),Ys(S),L&&(b=et("prehashed msgHash",T(b)));const X=x(b),O=l(_),q=[k(O),k(X)];if(U!=null&&U!==!1){const H=U===!0?v(e.BYTES):U;q.push(et("extraEntropy",H))}const tt=jt(...q),Z=X;function At(H){const G=B(H);if(!h(G))return;const z=A(G),Y=a.BASE.multiply(G).toAffine(),V=o(Y.x);if(V===It)return;const ct=o(z*o(Z+V*O));if(ct===It)return;let Ft=(Y.x===V?0:2)|Number(Y.y&j),jn=ct;return M&&f(ct)&&(jn=m(ct),Ft^=1),new p(V,jn,Ft)}return{seed:tt,k2sig:At}}const N={lowS:t.lowS,prehash:!1},D={lowS:t.lowS,prehash:!1};function w(b,_,S=N){const{seed:T,k2sig:v}=F(b,_,S),M=t;return wo(M.hash.outputLen,M.nByteLength,M.hmac)(T,v)}a.BASE._setWindowSize(8);function I(b,_,S,T=D){var Y;const v=b;if(_=et("msgHash",_),S=et("publicKey",S),"strict"in T)throw new Error("options.strict was renamed to lowS");Ys(T);const{lowS:M,prehash:L}=T;let U,X;try{if(typeof v=="string"||zt(v))try{U=p.fromDER(v)}catch(V){if(!(V instanceof Ht.Err))throw V;U=p.fromCompact(v)}else if(typeof v=="object"&&typeof v.r=="bigint"&&typeof v.s=="bigint"){const{r:V,s:ct}=v;U=new p(V,ct)}else throw new Error("PARSE");X=a.fromHex(S)}catch(V){if(V.message==="PARSE")throw new Error("signature must be Signature instance, Uint8Array or hex string");return!1}if(M&&U.hasHighS())return!1;L&&(_=t.hash(_));const{r:O,s:q}=U,tt=x(_),Z=A(q),At=o(tt*Z),H=o(O*Z),G=(Y=a.BASE.multiplyAndAddUnsafe(X,At,H))==null?void 0:Y.toAffine();return G?o(G.x)===O:!1}return{CURVE:t,getPublicKey:y,getSharedSecret:E,sign:w,verify:I,ProjectivePoint:a,Signature:p,utils:g}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function xl(n){return{hash:n,hmac:(t,...e)=>po(n,t,Va(...e)),randomBytes:fo}}function Il(n,t){const e=i=>Sl({...n,...xl(i)});return Object.freeze({...e(t),create:e})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Je=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),Bn=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),Pe=BigInt(1),Tn=BigInt(2),Gs=(n,t)=>(n+t/Tn)/t;function Co(n){const t=Je,e=BigInt(3),i=BigInt(6),s=BigInt(11),r=BigInt(22),o=BigInt(23),A=BigInt(44),a=BigInt(88),l=n*n*n%t,c=l*l*n%t,h=rt(c,e,t)*c%t,u=rt(h,e,t)*c%t,f=rt(u,Tn,t)*l%t,m=rt(f,s,t)*f%t,d=rt(m,r,t)*m%t,p=rt(d,A,t)*d%t,g=rt(p,a,t)*p%t,y=rt(g,A,t)*d%t,C=rt(y,e,t)*c%t,E=rt(C,o,t)*m%t,B=rt(E,i,t)*l%t,x=rt(B,Tn,t);if(!xi.eql(xi.sqr(x),n))throw new Error("Cannot find square root");return x}const xi=gl(Je,void 0,void 0,{sqrt:Co}),ts=Il({a:BigInt(0),b:BigInt(7),Fp:xi,n:Bn,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:n=>{const t=Bn,e=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),i=-Pe*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),s=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),r=e,o=BigInt("0x100000000000000000000000000000000"),A=Gs(r*n,t),a=Gs(-i*n,t);let l=$(n-A*e-a*s,t),c=$(-A*i-a*r,t);const h=l>o,u=c>o;if(h&&(l=t-l),u&&(c=t-c),l>o||c>o)throw new Error("splitScalar: Endomorphism failed, k="+n);return{k1neg:h,k1:l,k2neg:u,k2:c}}}},Ei),So=BigInt(0),qs={};function Rn(n,...t){let e=qs[n];if(e===void 0){const i=Ei(Uint8Array.from(n,s=>s.charCodeAt(0)));e=jt(i,i),qs[n]=e}return Ei(jt(e,...t))}const es=n=>n.toRawBytes(!0).slice(1),Ii=n=>Mt(n,32),ri=n=>$(n,Je),Le=n=>$(n,Bn),ns=ts.ProjectivePoint,Bl=(n,t,e)=>ns.BASE.multiplyAndAddUnsafe(n,t,e);function Bi(n){let t=ts.utils.normPrivateKeyToScalar(n),e=ns.fromPrivateKey(t);return{scalar:e.hasEvenY()?t:Le(-t),bytes:es(e)}}function xo(n){vt("x",n,Pe,Je);const t=ri(n*n),e=ri(t*n+BigInt(7));let i=Co(e);i%Tn!==So&&(i=ri(-i));const s=new ns(n,i,Pe);return s.assertValidity(),s}const he=_t;function Io(...n){return Le(he(Rn("BIP0340/challenge",...n)))}function Tl(n){return Bi(n).bytes}function Rl(n,t,e=fo(32)){const i=et("message",n),{bytes:s,scalar:r}=Bi(t),o=et("auxRand",e,32),A=Ii(r^he(Rn("BIP0340/aux",o))),a=Rn("BIP0340/nonce",A,s,i),l=Le(he(a));if(l===So)throw new Error("sign failed: k is zero");const{bytes:c,scalar:h}=Bi(l),u=Io(c,s,i),f=new Uint8Array(64);if(f.set(c,0),f.set(Ii(Le(h+u*r)),32),!Bo(f,i,s))throw new Error("sign: Invalid signature produced");return f}function Bo(n,t,e){const i=et("signature",n,64),s=et("message",t),r=et("publicKey",e,32);try{const o=xo(he(r)),A=he(i.subarray(0,32));if(!Ee(A,Pe,Je))return!1;const a=he(i.subarray(32,64));if(!Ee(a,Pe,Bn))return!1;const l=Io(Ii(A),es(o),s),c=Bl(o,a,Le(-l));return!(!c||!c.hasEvenY()||c.toAffine().x!==A)}catch{return!1}}const is={getPublicKey:Tl,sign:Rl,verify:Bo,utils:{randomPrivateKey:ts.utils.randomPrivateKey,lift_x:xo,pointToBytes:es,numberToBytesBE:Mt,bytesToNumberBE:_t,taggedHash:Rn,mod:$}},Fe="Trystero",Ue=(n,t)=>Array(n).fill().map(t),Zs="0123456789AaBbCcDdEeFfGgHhIiJjKkLlMmNnOoPpQqRrSsTtUuVvWwXxYyZz",Ti=n=>Ue(n,()=>Zs[Math.floor(Math.random()*Zs.length)]).join(""),Ae=Ti(20),ae=Promise.all.bind(Promise),ss=typeof window<"u",{entries:Ws,fromEntries:vl,keys:kl}=Object,Vt=()=>{},mt=n=>new Error(`${Fe}: ${n}`),Nl=new TextEncoder,Dl=new TextDecoder,Jt=n=>Nl.encode(n),fn=n=>Dl.decode(n),Ri=n=>n.reduce((t,e)=>t+e.toString(16).padStart(2,"0"),""),nn=(...n)=>n.join("@"),Ml=(n,t,e)=>(n.relayUrls||t).slice(0,n.relayUrls?n.relayUrls.length:n.relayRedundancy||e),Et=JSON.stringify,vn=JSON.parse,Hs=3333,se={},Ol=(n,t)=>{const e={},i=()=>{const s=new WebSocket(n);s.onclose=()=>{se[n]??(se[n]=Hs),setTimeout(i,se[n]),se[n]*=2},s.onmessage=r=>t(r.data),e.socket=s,e.url=s.url,e.ready=new Promise(r=>s.onopen=()=>{r(e),se[n]=Hs}),e.send=r=>{s.readyState===1&&s.send(r)}};return i(),e},rs="AES-GCM",oi={},Pl=n=>btoa(String.fromCharCode.apply(null,new Uint8Array(n))),Ll=n=>{const t=atob(n);return new Uint8Array(t.length).map((e,i)=>t.charCodeAt(i)).buffer},sn=async n=>{if(oi[n])return oi[n];const t=Array.from(new Uint8Array(await crypto.subtle.digest("SHA-1",Jt(n)))).map(e=>e.toString(36)).join("");return oi[n]=t,t},Fl=async(n,t,e)=>crypto.subtle.importKey("raw",await crypto.subtle.digest({name:"SHA-256"},Jt(`${n}:${t}:${e}`)),{name:rs},!1,["encrypt","decrypt"]),To="$",Ro=",",Ul=async(n,t)=>{const e=crypto.getRandomValues(new Uint8Array(16));return e.join(Ro)+To+Pl(await crypto.subtle.encrypt({name:rs,iv:e},await n,Jt(t)))},Ql=async(n,t)=>{const[e,i]=t.split(To);return fn(await crypto.subtle.decrypt({name:rs,iv:new Uint8Array(e.split(Ro))},await n,Ll(i)))};function os(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var vi={exports:{}},Ai,Js;function Yl(){if(Js)return Ai;Js=1;var n=1e3,t=n*60,e=t*60,i=e*24,s=i*7,r=i*365.25;Ai=function(c,h){h=h||{};var u=typeof c;if(u==="string"&&c.length>0)return o(c);if(u==="number"&&isFinite(c))return h.long?a(c):A(c);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(c))};function o(c){if(c=String(c),!(c.length>100)){var h=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(c);if(h){var u=parseFloat(h[1]),f=(h[2]||"ms").toLowerCase();switch(f){case"years":case"year":case"yrs":case"yr":case"y":return u*r;case"weeks":case"week":case"w":return u*s;case"days":case"day":case"d":return u*i;case"hours":case"hour":case"hrs":case"hr":case"h":return u*e;case"minutes":case"minute":case"mins":case"min":case"m":return u*t;case"seconds":case"second":case"secs":case"sec":case"s":return u*n;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return u;default:return}}}}function A(c){var h=Math.abs(c);return h>=i?Math.round(c/i)+"d":h>=e?Math.round(c/e)+"h":h>=t?Math.round(c/t)+"m":h>=n?Math.round(c/n)+"s":c+"ms"}function a(c){var h=Math.abs(c);return h>=i?l(c,h,i,"day"):h>=e?l(c,h,e,"hour"):h>=t?l(c,h,t,"minute"):h>=n?l(c,h,n,"second"):c+" ms"}function l(c,h,u,f){var m=h>=u*1.5;return Math.round(c/u)+" "+f+(m?"s":"")}return Ai}function Vl(n){e.debug=e,e.default=e,e.coerce=a,e.disable=r,e.enable=s,e.enabled=o,e.humanize=Yl(),e.destroy=l,Object.keys(n).forEach(c=>{e[c]=n[c]}),e.names=[],e.skips=[],e.formatters={};function t(c){let h=0;for(let u=0;u<c.length;u++)h=(h<<5)-h+c.charCodeAt(u),h|=0;return e.colors[Math.abs(h)%e.colors.length]}e.selectColor=t;function e(c){let h,u=null,f,m;function d(...p){if(!d.enabled)return;const g=d,y=Number(new Date),C=y-(h||y);g.diff=C,g.prev=h,g.curr=y,h=y,p[0]=e.coerce(p[0]),typeof p[0]!="string"&&p.unshift("%O");let E=0;p[0]=p[0].replace(/%([a-zA-Z%])/g,(x,R)=>{if(x==="%%")return"%";E++;const k=e.formatters[R];if(typeof k=="function"){const F=p[E];x=k.call(g,F),p.splice(E,1),E--}return x}),e.formatArgs.call(g,p),(g.log||e.log).apply(g,p)}return d.namespace=c,d.useColors=e.useColors(),d.color=e.selectColor(c),d.extend=i,d.destroy=e.destroy,Object.defineProperty(d,"enabled",{enumerable:!0,configurable:!1,get:()=>u!==null?u:(f!==e.namespaces&&(f=e.namespaces,m=e.enabled(c)),m),set:p=>{u=p}}),typeof e.init=="function"&&e.init(d),d}function i(c,h){const u=e(this.namespace+(typeof h>"u"?":":h)+c);return u.log=this.log,u}function s(c){e.save(c),e.namespaces=c,e.names=[],e.skips=[];let h;const u=(typeof c=="string"?c:"").split(/[\s,]+/),f=u.length;for(h=0;h<f;h++)u[h]&&(c=u[h].replace(/\*/g,".*?"),c[0]==="-"?e.skips.push(new RegExp("^"+c.slice(1)+"$")):e.names.push(new RegExp("^"+c+"$")))}function r(){const c=[...e.names.map(A),...e.skips.map(A).map(h=>"-"+h)].join(",");return e.enable(""),c}function o(c){if(c[c.length-1]==="*")return!0;let h,u;for(h=0,u=e.skips.length;h<u;h++)if(e.skips[h].test(c))return!1;for(h=0,u=e.names.length;h<u;h++)if(e.names[h].test(c))return!0;return!1}function A(c){return c.toString().substring(2,c.toString().length-2).replace(/\.\*\?$/,"*")}function a(c){return c instanceof Error?c.stack||c.message:c}function l(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return e.enable(e.load()),e}var Gl=Vl;(function(n,t){var e={};t.formatArgs=s,t.save=r,t.load=o,t.useColors=i,t.storage=A(),t.destroy=(()=>{let l=!1;return()=>{l||(l=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function i(){if(typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))return!0;if(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let l;return typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&(l=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(l[1],10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function s(l){if(l[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+l[0]+(this.useColors?"%c ":" ")+"+"+n.exports.humanize(this.diff),!this.useColors)return;const c="color: "+this.color;l.splice(1,0,c,"color: inherit");let h=0,u=0;l[0].replace(/%[a-zA-Z%]/g,f=>{f!=="%%"&&(h++,f==="%c"&&(u=h))}),l.splice(u,0,c)}t.log=console.debug||console.log||(()=>{});function r(l){try{l?t.storage.setItem("debug",l):t.storage.removeItem("debug")}catch{}}function o(){let l;try{l=t.storage.getItem("debug")}catch{}return!l&&typeof process<"u"&&"env"in process&&(l=e.DEBUG),l}function A(){try{return localStorage}catch{}}n.exports=Gl(t);const{formatters:a}=n.exports;a.j=function(l){try{return JSON.stringify(l)}catch(c){return"[UnexpectedJSONParseError]: "+c.message}}})(vi,vi.exports);var ql=vi.exports;const Zl=os(ql),yt=typeof window<"u"?window:self,ki=yt.RTCPeerConnection||yt.mozRTCPeerConnection||yt.webkitRTCPeerConnection,Wl=yt.RTCSessionDescription||yt.mozRTCSessionDescription||yt.webkitRTCSessionDescription,Hl=yt.RTCIceCandidate||yt.mozRTCIceCandidate||yt.webkitRTCIceCandidate;var As={exports:{}},ue=typeof Reflect=="object"?Reflect:null,Xs=ue&&typeof ue.apply=="function"?ue.apply:function(t,e,i){return Function.prototype.apply.call(t,e,i)},gn;ue&&typeof ue.ownKeys=="function"?gn=ue.ownKeys:Object.getOwnPropertySymbols?gn=function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:gn=function(t){return Object.getOwnPropertyNames(t)};function Jl(n){console&&console.warn&&console.warn(n)}var vo=Number.isNaN||function(t){return t!==t};function Q(){Q.init.call(this)}As.exports=Q;As.exports.once=Kl;Q.EventEmitter=Q;Q.prototype._events=void 0;Q.prototype._eventsCount=0;Q.prototype._maxListeners=void 0;var zs=10;function Vn(n){if(typeof n!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof n)}Object.defineProperty(Q,"defaultMaxListeners",{enumerable:!0,get:function(){return zs},set:function(n){if(typeof n!="number"||n<0||vo(n))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+n+".");zs=n}});Q.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};Q.prototype.setMaxListeners=function(t){if(typeof t!="number"||t<0||vo(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this};function ko(n){return n._maxListeners===void 0?Q.defaultMaxListeners:n._maxListeners}Q.prototype.getMaxListeners=function(){return ko(this)};Q.prototype.emit=function(t){for(var e=[],i=1;i<arguments.length;i++)e.push(arguments[i]);var s=t==="error",r=this._events;if(r!==void 0)s=s&&r.error===void 0;else if(!s)return!1;if(s){var o;if(e.length>0&&(o=e[0]),o instanceof Error)throw o;var A=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw A.context=o,A}var a=r[t];if(a===void 0)return!1;if(typeof a=="function")Xs(a,this,e);else for(var l=a.length,c=Po(a,l),i=0;i<l;++i)Xs(c[i],this,e);return!0};function No(n,t,e,i){var s,r,o;if(Vn(e),r=n._events,r===void 0?(r=n._events=Object.create(null),n._eventsCount=0):(r.newListener!==void 0&&(n.emit("newListener",t,e.listener?e.listener:e),r=n._events),o=r[t]),o===void 0)o=r[t]=e,++n._eventsCount;else if(typeof o=="function"?o=r[t]=i?[e,o]:[o,e]:i?o.unshift(e):o.push(e),s=ko(n),s>0&&o.length>s&&!o.warned){o.warned=!0;var A=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");A.name="MaxListenersExceededWarning",A.emitter=n,A.type=t,A.count=o.length,Jl(A)}return n}Q.prototype.addListener=function(t,e){return No(this,t,e,!1)};Q.prototype.on=Q.prototype.addListener;Q.prototype.prependListener=function(t,e){return No(this,t,e,!0)};function Xl(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function Do(n,t,e){var i={fired:!1,wrapFn:void 0,target:n,type:t,listener:e},s=Xl.bind(i);return s.listener=e,i.wrapFn=s,s}Q.prototype.once=function(t,e){return Vn(e),this.on(t,Do(this,t,e)),this};Q.prototype.prependOnceListener=function(t,e){return Vn(e),this.prependListener(t,Do(this,t,e)),this};Q.prototype.removeListener=function(t,e){var i,s,r,o,A;if(Vn(e),s=this._events,s===void 0)return this;if(i=s[t],i===void 0)return this;if(i===e||i.listener===e)--this._eventsCount===0?this._events=Object.create(null):(delete s[t],s.removeListener&&this.emit("removeListener",t,i.listener||e));else if(typeof i!="function"){for(r=-1,o=i.length-1;o>=0;o--)if(i[o]===e||i[o].listener===e){A=i[o].listener,r=o;break}if(r<0)return this;r===0?i.shift():zl(i,r),i.length===1&&(s[t]=i[0]),s.removeListener!==void 0&&this.emit("removeListener",t,A||e)}return this};Q.prototype.off=Q.prototype.removeListener;Q.prototype.removeAllListeners=function(t){var e,i,s;if(i=this._events,i===void 0)return this;if(i.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):i[t]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete i[t]),this;if(arguments.length===0){var r=Object.keys(i),o;for(s=0;s<r.length;++s)o=r[s],o!=="removeListener"&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(e=i[t],typeof e=="function")this.removeListener(t,e);else if(e!==void 0)for(s=e.length-1;s>=0;s--)this.removeListener(t,e[s]);return this};function Mo(n,t,e){var i=n._events;if(i===void 0)return[];var s=i[t];return s===void 0?[]:typeof s=="function"?e?[s.listener||s]:[s]:e?jl(s):Po(s,s.length)}Q.prototype.listeners=function(t){return Mo(this,t,!0)};Q.prototype.rawListeners=function(t){return Mo(this,t,!1)};Q.listenerCount=function(n,t){return typeof n.listenerCount=="function"?n.listenerCount(t):Oo.call(n,t)};Q.prototype.listenerCount=Oo;function Oo(n){var t=this._events;if(t!==void 0){var e=t[n];if(typeof e=="function")return 1;if(e!==void 0)return e.length}return 0}Q.prototype.eventNames=function(){return this._eventsCount>0?gn(this._events):[]};function Po(n,t){for(var e=new Array(t),i=0;i<t;++i)e[i]=n[i];return e}function zl(n,t){for(;t+1<n.length;t++)n[t]=n[t+1];n.pop()}function jl(n){for(var t=new Array(n.length),e=0;e<t.length;++e)t[e]=n[e].listener||n[e];return t}function Kl(n,t){return new Promise(function(e,i){function s(o){n.removeListener(t,r),i(o)}function r(){typeof n.removeListener=="function"&&n.removeListener("error",s),e([].slice.call(arguments))}Lo(n,t,r,{once:!0}),t!=="error"&&$l(n,s,{once:!0})})}function $l(n,t,e){typeof n.on=="function"&&Lo(n,"error",t,e)}function Lo(n,t,e,i){if(typeof n.on=="function")i.once?n.once(t,e):n.on(t,e);else if(typeof n.addEventListener=="function")n.addEventListener(t,function s(r){i.once&&n.removeEventListener(t,s),e(r)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof n)}var tc=As.exports,ec=typeof queueMicrotask=="function"?queueMicrotask:n=>Promise.resolve().then(n),nc=class{constructor(t){if(!(t>0)||t-1&t)throw new Error("Max size for a FixedFIFO should be a power of two");this.buffer=new Array(t),this.mask=t-1,this.top=0,this.btm=0,this.next=null}clear(){this.top=this.btm=0,this.next=null,this.buffer.fill(void 0)}push(t){return this.buffer[this.top]!==void 0?!1:(this.buffer[this.top]=t,this.top=this.top+1&this.mask,!0)}shift(){const t=this.buffer[this.btm];if(t!==void 0)return this.buffer[this.btm]=void 0,this.btm=this.btm+1&this.mask,t}peek(){return this.buffer[this.btm]}isEmpty(){return this.buffer[this.btm]===void 0}};const js=nc;var ic=class{constructor(t){this.hwm=t||16,this.head=new js(this.hwm),this.tail=this.head,this.length=0}clear(){this.head=this.tail,this.head.clear(),this.length=0}push(t){if(this.length++,!this.head.push(t)){const e=this.head;this.head=e.next=new js(2*this.head.buffer.length),this.head.push(t)}}shift(){this.length!==0&&this.length--;const t=this.tail.shift();if(t===void 0&&this.tail.next){const e=this.tail.next;return this.tail.next=null,this.tail=e,this.tail.shift()}return t}peek(){const t=this.tail.peek();return t===void 0&&this.tail.next?this.tail.next.peek():t}isEmpty(){return this.length===0}},Fo=class{constructor(t){this.decoder=new TextDecoder(t==="utf16le"?"utf16-le":t)}decode(t){return this.decoder.decode(t,{stream:!0})}flush(){return this.decoder.decode(new Uint8Array(0))}};const sc=Fo,rc=Fo;var oc=class{constructor(t="utf8"){switch(this.encoding=Ac(t),this.encoding){case"utf8":this.decoder=new rc;break;case"utf16le":case"base64":throw new Error("Unsupported encoding: "+this.encoding);default:this.decoder=new sc(this.encoding)}}push(t){return typeof t=="string"?t:this.decoder.decode(t)}write(t){return this.push(t)}end(t){let e="";return t&&(e=this.push(t)),e+=this.decoder.flush(),e}};function Ac(n){switch(n=n.toLowerCase(),n){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return n;default:throw new Error("Unknown encoding: "+n)}}const{EventEmitter:ac}=tc,Gn=new Error("Stream was destroyed"),ai=new Error("Premature close"),Uo=ec,Qo=ic,lc=oc,W=(1<<29)-1,ne=1,as=2,Kt=4,Qe=8,Yo=W^ne,cc=W^as,Xe=16,Ye=32,ve=64,kt=128,ze=256,ls=512,$t=1024,Ni=2048,cs=4096,hs=8192,lt=16384,de=32768,qn=65536,te=131072,Vo=ze|ls,hc=Xe|qn,uc=ve|Xe,dc=cs|kt,us=ze|te,fc=W^Xe,gc=W^ve,pc=W^(ve|qn),mc=W^qn,wc=W^ze,_c=W^(kt|hs),yc=W^$t,Ks=W^Vo,Go=W^de,Ec=W^Ye,qo=W^te,bc=W^us,Pt=1<<18,be=2<<18,je=4<<18,ee=8<<18,Ke=16<<18,ie=32<<18,Di=64<<18,fe=128<<18,ds=256<<18,Ce=512<<18,Zn=1024<<18,Zo=W^(Pt|ds),Wo=W^je,Cc=W^Ce,Sc=W^Ke,xc=W^ee,Ho=W^fe,Ic=W^be,Jo=W^Zn,Ve=Xe|Pt,Xo=W^Ve,fs=lt|ie,bt=Kt|Qe|as,nt=bt|ne,zo=bt|fs,Bc=Wo&gc,gs=fe|de,Tc=gs&Xo,jo=nt|Tc,Rc=nt|$t|lt,$s=nt|lt|kt,vc=nt|$t|kt,kc=nt|cs|kt|hs,Nc=nt|Xe|$t|lt|qn|te,Dc=bt|$t|lt,Mc=Ye|nt|de|ve,Oc=nt|Ce|ie,Pc=ee|Ke,Ko=ee|Pt,Lc=ee|Ke|nt|Pt,tr=nt|Pt|ee|Zn,Fc=je|Pt,Uc=Pt|ds,Qc=nt|Ce|Ko|ie,Yc=Ke|bt|Ce|ie,Vc=be|nt|fe|je,rn=Symbol.asyncIterator||Symbol("asyncIterator");class $o{constructor(t,{highWaterMark:e=16384,map:i=null,mapWritable:s,byteLength:r,byteLengthWritable:o}={}){this.stream=t,this.queue=new Qo,this.highWaterMark=e,this.buffered=0,this.error=null,this.pipeline=null,this.drains=null,this.byteLength=o||r||oA,this.map=s||i,this.afterWrite=Jc.bind(this),this.afterUpdateNextTick=jc.bind(this)}get ended(){return(this.stream._duplexState&ie)!==0}push(t){return this.map!==null&&(t=this.map(t)),this.buffered+=this.byteLength(t),this.queue.push(t),this.buffered<this.highWaterMark?(this.stream._duplexState|=ee,!0):(this.stream._duplexState|=Pc,!1)}shift(){const t=this.queue.shift();return this.buffered-=this.byteLength(t),this.buffered===0&&(this.stream._duplexState&=xc),t}end(t){typeof t=="function"?this.stream.once("finish",t):t!=null&&this.push(t),this.stream._duplexState=(this.stream._duplexState|Ce)&Wo}autoBatch(t,e){const i=[],s=this.stream;for(i.push(t);(s._duplexState&tr)===Ko;)i.push(s._writableState.shift());if(s._duplexState&nt)return e(null);s._writev(i,e)}update(){const t=this.stream;t._duplexState|=be;do{for(;(t._duplexState&tr)===ee;){const e=this.shift();t._duplexState|=Uc,t._write(e,this.afterWrite)}t._duplexState&Fc||this.updateNonPrimary()}while(this.continueUpdate()===!0);t._duplexState&=Ic}updateNonPrimary(){const t=this.stream;if((t._duplexState&Qc)===Ce){t._duplexState=(t._duplexState|Pt)&Cc,t._final(Hc.bind(this));return}if((t._duplexState&bt)===Kt){t._duplexState&gs||(t._duplexState|=Ve,t._destroy(tA.bind(this)));return}(t._duplexState&jo)===ne&&(t._duplexState=(t._duplexState|Ve)&Yo,t._open(eA.bind(this)))}continueUpdate(){return this.stream._duplexState&fe?(this.stream._duplexState&=Ho,!0):!1}updateCallback(){(this.stream._duplexState&Vc)===je?this.update():this.updateNextTick()}updateNextTick(){this.stream._duplexState&fe||(this.stream._duplexState|=fe,this.stream._duplexState&be||Uo(this.afterUpdateNextTick))}}class Gc{constructor(t,{highWaterMark:e=16384,map:i=null,mapReadable:s,byteLength:r,byteLengthReadable:o}={}){this.stream=t,this.queue=new Qo,this.highWaterMark=e===0?1:e,this.buffered=0,this.readAhead=e>0,this.error=null,this.pipeline=null,this.byteLength=o||r||oA,this.map=s||i,this.pipeTo=null,this.afterRead=Xc.bind(this),this.afterUpdateNextTick=zc.bind(this)}get ended(){return(this.stream._duplexState&lt)!==0}pipe(t,e){if(this.pipeTo!==null)throw new Error("Can only pipe to one destination");if(typeof e!="function"&&(e=null),this.stream._duplexState|=ls,this.pipeTo=t,this.pipeline=new Zc(this.stream,t,e),e&&this.stream.on("error",er),qe(t))t._writableState.pipeline=this.pipeline,e&&t.on("error",er),t.on("finish",this.pipeline.finished.bind(this.pipeline));else{const i=this.pipeline.done.bind(this.pipeline,t),s=this.pipeline.done.bind(this.pipeline,t,null);t.on("error",i),t.on("close",s),t.on("finish",this.pipeline.finished.bind(this.pipeline))}t.on("drain",Wc.bind(this)),this.stream.emit("piping",t),t.emit("pipe",this.stream)}push(t){const e=this.stream;return t===null?(this.highWaterMark=0,e._duplexState=(e._duplexState|$t)&pc,!1):this.map!==null&&(t=this.map(t),t===null)?this.buffered<this.highWaterMark:(this.buffered+=this.byteLength(t),this.queue.push(t),e._duplexState=(e._duplexState|kt)&mc,this.buffered<this.highWaterMark)}shift(){const t=this.queue.shift();return this.buffered-=this.byteLength(t),this.buffered===0&&(this.stream._duplexState&=_c),t}unshift(t){const e=[this.map!==null?this.map(t):t];for(;this.buffered>0;)e.push(this.shift());for(let i=0;i<e.length-1;i++){const s=e[i];this.buffered+=this.byteLength(s),this.queue.push(s)}this.push(e[e.length-1])}read(){const t=this.stream;if((t._duplexState&$s)===kt){const e=this.shift();return this.pipeTo!==null&&this.pipeTo.write(e)===!1&&(t._duplexState&=Ks),t._duplexState&Ni&&t.emit("data",e),e}return this.readAhead===!1&&(t._duplexState|=te,this.updateNextTick()),null}drain(){const t=this.stream;for(;(t._duplexState&$s)===kt&&t._duplexState&Vo;){const e=this.shift();this.pipeTo!==null&&this.pipeTo.write(e)===!1&&(t._duplexState&=Ks),t._duplexState&Ni&&t.emit("data",e)}}update(){const t=this.stream;t._duplexState|=Ye;do{for(this.drain();this.buffered<this.highWaterMark&&(t._duplexState&Nc)===te;)t._duplexState|=hc,t._read(this.afterRead),this.drain();(t._duplexState&kc)===dc&&(t._duplexState|=hs,t.emit("readable")),t._duplexState&uc||this.updateNonPrimary()}while(this.continueUpdate()===!0);t._duplexState&=Ec}updateNonPrimary(){const t=this.stream;if((t._duplexState&vc)===$t&&(t._duplexState=(t._duplexState|lt)&yc,t.emit("end"),(t._duplexState&zo)===fs&&(t._duplexState|=Kt),this.pipeTo!==null&&this.pipeTo.end()),(t._duplexState&bt)===Kt){t._duplexState&gs||(t._duplexState|=Ve,t._destroy(tA.bind(this)));return}(t._duplexState&jo)===ne&&(t._duplexState=(t._duplexState|Ve)&Yo,t._open(eA.bind(this)))}continueUpdate(){return this.stream._duplexState&de?(this.stream._duplexState&=Go,!0):!1}updateCallback(){(this.stream._duplexState&Mc)===ve?this.update():this.updateNextTick()}updateNextTick(){this.stream._duplexState&de||(this.stream._duplexState|=de,this.stream._duplexState&Ye||Uo(this.afterUpdateNextTick))}}class qc{constructor(t){this.data=null,this.afterTransform=$c.bind(t),this.afterFinal=null}}class Zc{constructor(t,e,i){this.from=t,this.to=e,this.afterPipe=i,this.error=null,this.pipeToFinished=!1}finished(){this.pipeToFinished=!0}done(t,e){if(e&&(this.error=e),t===this.to&&(this.to=null,this.from!==null)){(!(this.from._duplexState&lt)||!this.pipeToFinished)&&this.from.destroy(this.error||new Error("Writable stream closed prematurely"));return}if(t===this.from&&(this.from=null,this.to!==null)){t._duplexState&lt||this.to.destroy(this.error||new Error("Readable stream closed before ending"));return}this.afterPipe!==null&&this.afterPipe(this.error),this.to=this.from=this.afterPipe=null}}function Wc(){this.stream._duplexState|=ls,this.updateCallback()}function Hc(n){const t=this.stream;n&&t.destroy(n),t._duplexState&bt||(t._duplexState|=ie,t.emit("finish")),(t._duplexState&zo)===fs&&(t._duplexState|=Kt),t._duplexState&=Zo,t._duplexState&be?this.updateNextTick():this.update()}function tA(n){const t=this.stream;!n&&this.error!==Gn&&(n=this.error),n&&t.emit("error",n),t._duplexState|=Qe,t.emit("close");const e=t._readableState,i=t._writableState;if(e!==null&&e.pipeline!==null&&e.pipeline.done(t,n),i!==null){for(;i.drains!==null&&i.drains.length>0;)i.drains.shift().resolve(!1);i.pipeline!==null&&i.pipeline.done(t,n)}}function Jc(n){const t=this.stream;n&&t.destroy(n),t._duplexState&=Zo,this.drains!==null&&Kc(this.drains),(t._duplexState&Lc)===Ke&&(t._duplexState&=Sc,(t._duplexState&Di)===Di&&t.emit("drain")),this.updateCallback()}function Xc(n){n&&this.stream.destroy(n),this.stream._duplexState&=fc,this.readAhead===!1&&!(this.stream._duplexState&ze)&&(this.stream._duplexState&=qo),this.updateCallback()}function zc(){this.stream._duplexState&Ye||(this.stream._duplexState&=Go,this.update())}function jc(){this.stream._duplexState&be||(this.stream._duplexState&=Ho,this.update())}function Kc(n){for(let t=0;t<n.length;t++)--n[t].writes===0&&(n.shift().resolve(!0),t--)}function eA(n){const t=this.stream;n&&t.destroy(n),t._duplexState&Kt||(t._duplexState&Rc||(t._duplexState|=ve),t._duplexState&Oc||(t._duplexState|=je),t.emit("open")),t._duplexState&=Xo,t._writableState!==null&&t._writableState.updateCallback(),t._readableState!==null&&t._readableState.updateCallback()}function $c(n,t){t!=null&&this.push(t),this._writableState.afterWrite(n)}function th(n){this._readableState!==null&&(n==="data"&&(this._duplexState|=Ni|us,this._readableState.updateNextTick()),n==="readable"&&(this._duplexState|=cs,this._readableState.updateNextTick())),this._writableState!==null&&n==="drain"&&(this._duplexState|=Di,this._writableState.updateNextTick())}class ps extends ac{constructor(t){super(),this._duplexState=0,this._readableState=null,this._writableState=null,t&&(t.open&&(this._open=t.open),t.destroy&&(this._destroy=t.destroy),t.predestroy&&(this._predestroy=t.predestroy),t.signal&&t.signal.addEventListener("abort",ah.bind(this))),this.on("newListener",th)}_open(t){t(null)}_destroy(t){t(null)}_predestroy(){}get readable(){return this._readableState!==null?!0:void 0}get writable(){return this._writableState!==null?!0:void 0}get destroyed(){return(this._duplexState&Qe)!==0}get destroying(){return(this._duplexState&bt)!==0}destroy(t){this._duplexState&bt||(t||(t=Gn),this._duplexState=(this._duplexState|Kt)&Bc,this._readableState!==null&&(this._readableState.highWaterMark=0,this._readableState.error=t),this._writableState!==null&&(this._writableState.highWaterMark=0,this._writableState.error=t),this._duplexState|=as,this._predestroy(),this._duplexState&=cc,this._readableState!==null&&this._readableState.updateNextTick(),this._writableState!==null&&this._writableState.updateNextTick())}}class Ge extends ps{constructor(t){super(t),this._duplexState|=ne|ie|te,this._readableState=new Gc(this,t),t&&(this._readableState.readAhead===!1&&(this._duplexState&=qo),t.read&&(this._read=t.read),t.eagerOpen&&this._readableState.updateNextTick(),t.encoding&&this.setEncoding(t.encoding))}setEncoding(t){const e=new lc(t),i=this._readableState.map||sh;return this._readableState.map=s,this;function s(r){const o=e.push(r);return o===""?null:i(o)}}_read(t){t(null)}pipe(t,e){return this._readableState.updateNextTick(),this._readableState.pipe(t,e),t}read(){return this._readableState.updateNextTick(),this._readableState.read()}push(t){return this._readableState.updateNextTick(),this._readableState.push(t)}unshift(t){return this._readableState.updateNextTick(),this._readableState.unshift(t)}resume(){return this._duplexState|=us,this._readableState.updateNextTick(),this}pause(){return this._duplexState&=this._readableState.readAhead===!1?bc:wc,this}static _fromAsyncIterator(t,e){let i;const s=new Ge({...e,read(o){t.next().then(r).then(o.bind(null,null)).catch(o)},predestroy(){i=t.return()},destroy(o){if(!i)return o(null);i.then(o.bind(null,null)).catch(o)}});return s;function r(o){o.done?s.push(null):s.push(o.value)}}static from(t,e){if(oh(t))return t;if(t[rn])return this._fromAsyncIterator(t[rn](),e);Array.isArray(t)||(t=t===void 0?[]:[t]);let i=0;return new Ge({...e,read(s){this.push(i===t.length?null:t[i++]),s(null)}})}static isBackpressured(t){return(t._duplexState&Dc)!==0||t._readableState.buffered>=t._readableState.highWaterMark}static isPaused(t){return(t._duplexState&ze)===0}[rn](){const t=this;let e=null,i=null,s=null;return this.on("error",l=>{e=l}),this.on("readable",r),this.on("close",o),{[rn](){return this},next(){return new Promise(function(l,c){i=l,s=c;const h=t.read();h!==null?A(h):t._duplexState&Qe&&A(null)})},return(){return a(null)},throw(l){return a(l)}};function r(){i!==null&&A(t.read())}function o(){i!==null&&A(null)}function A(l){s!==null&&(e?s(e):l===null&&!(t._duplexState&lt)?s(Gn):i({value:l,done:l===null}),s=i=null)}function a(l){return t.destroy(l),new Promise((c,h)=>{if(t._duplexState&Qe)return c({value:void 0,done:!0});t.once("close",function(){l?h(l):c({value:void 0,done:!0})})})}}}class nA extends ps{constructor(t){super(t),this._duplexState|=ne|lt,this._writableState=new $o(this,t),t&&(t.writev&&(this._writev=t.writev),t.write&&(this._write=t.write),t.final&&(this._final=t.final),t.eagerOpen&&this._writableState.updateNextTick())}cork(){this._duplexState|=Zn}uncork(){this._duplexState&=Jo,this._writableState.updateNextTick()}_writev(t,e){e(null)}_write(t,e){this._writableState.autoBatch(t,e)}_final(t){t(null)}static isBackpressured(t){return(t._duplexState&Yc)!==0}static drained(t){if(t.destroyed)return Promise.resolve(!1);const e=t._writableState,s=(lh(t)?Math.min(1,e.queue.length):e.queue.length)+(t._duplexState&ds?1:0);return s===0?Promise.resolve(!0):(e.drains===null&&(e.drains=[]),new Promise(r=>{e.drains.push({writes:s,resolve:r})}))}write(t){return this._writableState.updateNextTick(),this._writableState.push(t)}end(t){return this._writableState.updateNextTick(),this._writableState.end(t),this}}class ms extends Ge{constructor(t){super(t),this._duplexState=ne|this._duplexState&te,this._writableState=new $o(this,t),t&&(t.writev&&(this._writev=t.writev),t.write&&(this._write=t.write),t.final&&(this._final=t.final))}cork(){this._duplexState|=Zn}uncork(){this._duplexState&=Jo,this._writableState.updateNextTick()}_writev(t,e){e(null)}_write(t,e){this._writableState.autoBatch(t,e)}_final(t){t(null)}write(t){return this._writableState.updateNextTick(),this._writableState.push(t)}end(t){return this._writableState.updateNextTick(),this._writableState.end(t),this}}class iA extends ms{constructor(t){super(t),this._transformState=new qc(this),t&&(t.transform&&(this._transform=t.transform),t.flush&&(this._flush=t.flush))}_write(t,e){this._readableState.buffered>=this._readableState.highWaterMark?this._transformState.data=t:this._transform(t,this._transformState.afterTransform)}_read(t){if(this._transformState.data!==null){const e=this._transformState.data;this._transformState.data=null,t(null),this._transform(e,this._transformState.afterTransform)}else t(null)}destroy(t){super.destroy(t),this._transformState.data!==null&&(this._transformState.data=null,this._transformState.afterTransform())}_transform(t,e){e(null,t)}_flush(t){t(null)}_final(t){this._transformState.afterFinal=t,this._flush(nh.bind(this))}}class eh extends iA{}function nh(n,t){const e=this._transformState.afterFinal;if(n)return e(n);t!=null&&this.push(t),this.push(null),e(null)}function ih(...n){return new Promise((t,e)=>sA(...n,i=>{if(i)return e(i);t()}))}function sA(n,...t){const e=Array.isArray(n)?[...n,...t]:[n,...t],i=e.length&&typeof e[e.length-1]=="function"?e.pop():null;if(e.length<2)throw new Error("Pipeline requires at least 2 streams");let s=e[0],r=null,o=null;for(let l=1;l<e.length;l++)r=e[l],qe(s)?s.pipe(r,a):(A(s,!0,l>1,a),s.pipe(r)),s=r;if(i){let l=!1;const c=qe(r)||!!(r._writableState&&r._writableState.autoDestroy);r.on("error",h=>{o===null&&(o=h)}),r.on("finish",()=>{l=!0,c||i(o)}),c&&r.on("close",()=>i(o||(l?null:ai)))}return r;function A(l,c,h,u){l.on("error",u),l.on("close",f);function f(){if(l._readableState&&!l._readableState.ended||h&&l._writableState&&!l._writableState.ended)return u(ai)}}function a(l){if(!(!l||o)){o=l;for(const c of e)c.destroy(l)}}}function sh(n){return n}function rA(n){return!!n._readableState||!!n._writableState}function qe(n){return typeof n._duplexState=="number"&&rA(n)}function rh(n,t={}){const e=n._readableState&&n._readableState.error||n._writableState&&n._writableState.error;return!t.all&&e===Gn?null:e}function oh(n){return qe(n)&&n.readable}function Ah(n){return typeof n=="object"&&n!==null&&typeof n.byteLength=="number"}function oA(n){return Ah(n)?n.byteLength:1024}function er(){}function ah(){this.destroy(new Error("Stream aborted."))}function lh(n){return n._writev!==nA.prototype._writev&&n._writev!==ms.prototype._writev}var ch={pipeline:sA,pipelinePromise:ih,isStream:rA,isStreamx:qe,getStreamError:rh,Stream:ps,Writable:nA,Readable:Ge,Duplex:ms,Transform:iA,PassThrough:eh};function nr(n,t){for(const e in t)Object.defineProperty(n,e,{value:t[e],enumerable:!0,configurable:!0});return n}function hh(n,t,e){if(!n||typeof n=="string")throw new TypeError("Please pass an Error to err-code");e||(e={}),typeof t=="object"&&(e=t,t=""),t&&(e.code=t);try{return nr(n,e)}catch{e.message=n.message,e.stack=n.stack;const s=function(){};return s.prototype=Object.create(Object.getPrototypeOf(n)),nr(new s,e)}}var uh=hh;const P=os(uh);/* Common package for dealing with hex/string/uint8 conversions (and sha1 hashing)
*
* @author   Jimmy Wrting <jimmy@warting.se> (https://jimmy.warting.se/opensource)
* @license  MIT
*/const ir="0123456789abcdef",AA=[];for(let n=0;n<256;n++)AA[n]=ir[n>>4&15]+ir[n&15];const sr=n=>{const t=n.length;let e="",i=0;for(;i<t;)e+=AA[n[i++]];return e};var rr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",dh=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(var on=0;on<rr.length;on++)dh[rr.charCodeAt(on)]=on;new TextDecoder;const fh=new TextEncoder,gh=n=>fh.encode(n),or=typeof window<"u"?window:self,Mi=or.crypto||or.msCrypto||{};Mi.subtle||Mi.webkitSubtle;const Ar=n=>{const t=new Uint8Array(n);return Mi.getRandomValues(t)};/*! simple-peer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */const ph=Zl("simple-peer"),li=64*1024,mh=5*1e3,wh=5*1e3;function ar(n){return n.replace(/a=ice-options:trickle\s\n/g,"")}function _h(n){console.warn(n)}let Wn=class Oi extends ch.Duplex{constructor(e){e=Object.assign({allowHalfOpen:!1},e);super(e);Ss(this,"_pc");if(this.__objectMode=!!e.objectMode,this._id=sr(Ar(4)).slice(0,7),this._debug("new peer %o",e),this.channelName=e.initiator?e.channelName||sr(Ar(20)):null,this.initiator=e.initiator||!1,this.channelConfig=e.channelConfig||Oi.channelConfig,this.channelNegotiated=this.channelConfig.negotiated,this.config=Object.assign({},Oi.config,e.config),this.offerOptions=e.offerOptions||{},this.answerOptions=e.answerOptions||{},this.sdpTransform=e.sdpTransform||(i=>i),this.trickle=e.trickle!==void 0?e.trickle:!0,this.allowHalfTrickle=e.allowHalfTrickle!==void 0?e.allowHalfTrickle:!1,this.iceCompleteTimeout=e.iceCompleteTimeout||mh,this._destroying=!1,this._connected=!1,this.remoteAddress=void 0,this.remoteFamily=void 0,this.remotePort=void 0,this.localAddress=void 0,this.localFamily=void 0,this.localPort=void 0,!ki)throw P(typeof window>"u"?new Error("No WebRTC support: Specify `opts.wrtc` option in this environment"):new Error("No WebRTC support: Not a supported browser"),"ERR_WEBRTC_SUPPORT");this._pcReady=!1,this._channelReady=!1,this._iceComplete=!1,this._iceCompleteTimer=null,this._channel=null,this._pendingCandidates=[],this._isNegotiating=!1,this._firstNegotiation=!0,this._batchedNegotiation=!1,this._queuedNegotiation=!1,this._sendersAwaitingStable=[],this._closingInterval=null,this._remoteTracks=[],this._remoteStreams=[],this._chunk=null,this._cb=null,this._interval=null;try{this._pc=new ki(this.config)}catch(i){this.__destroy(P(i,"ERR_PC_CONSTRUCTOR"));return}this._isReactNativeWebrtc=typeof this._pc._peerConnectionId=="number",this._pc.oniceconnectionstatechange=()=>{this._onIceStateChange()},this._pc.onicegatheringstatechange=()=>{this._onIceStateChange()},this._pc.onconnectionstatechange=()=>{this._onConnectionStateChange()},this._pc.onsignalingstatechange=()=>{this._onSignalingStateChange()},this._pc.onicecandidate=i=>{this._onIceCandidate(i)},typeof this._pc.peerIdentity=="object"&&this._pc.peerIdentity.catch(i=>{this.__destroy(P(i,"ERR_PC_PEER_IDENTITY"))}),this.initiator||this.channelNegotiated?this._setupData({channel:this._pc.createDataChannel(this.channelName,this.channelConfig)}):this._pc.ondatachannel=i=>{this._setupData(i)},this._debug("initial negotiation"),this._needsNegotiation(),this._onFinishBound=()=>{this._onFinish()},this.once("finish",this._onFinishBound)}get bufferSize(){return this._channel&&this._channel.bufferedAmount||0}get connected(){return this._connected&&this._channel.readyState==="open"}address(){return{port:this.localPort,family:this.localFamily,address:this.localAddress}}signal(e){if(!this._destroying){if(this.destroyed)throw P(new Error("cannot signal after peer is destroyed"),"ERR_DESTROYED");if(typeof e=="string")try{e=JSON.parse(e)}catch{e={}}this._debug("signal()"),e.renegotiate&&this.initiator&&(this._debug("got request to renegotiate"),this._needsNegotiation()),e.transceiverRequest&&this.initiator&&(this._debug("got request for transceiver"),this.addTransceiver(e.transceiverRequest.kind,e.transceiverRequest.init)),e.candidate&&(this._pc.remoteDescription&&this._pc.remoteDescription.type?this._addIceCandidate(e.candidate):this._pendingCandidates.push(e.candidate)),e.sdp&&this._pc.setRemoteDescription(new Wl(e)).then(()=>{this.destroyed||(this._pendingCandidates.forEach(i=>{this._addIceCandidate(i)}),this._pendingCandidates=[],this._pc.remoteDescription.type==="offer"&&this._createAnswer())}).catch(i=>{this.__destroy(P(i,"ERR_SET_REMOTE_DESCRIPTION"))}),!e.sdp&&!e.candidate&&!e.renegotiate&&!e.transceiverRequest&&this.__destroy(P(new Error("signal() called with invalid signal data"),"ERR_SIGNALING"))}}_addIceCandidate(e){const i=new Hl(e);this._pc.addIceCandidate(i).catch(s=>{!i.address||i.address.endsWith(".local")?_h("Ignoring unsupported ICE candidate."):this.__destroy(P(s,"ERR_ADD_ICE_CANDIDATE"))})}send(e){if(!this._destroying){if(this.destroyed)throw P(new Error("cannot send after peer is destroyed"),"ERR_DESTROYED");this._channel.send(e)}}_needsNegotiation(){this._debug("_needsNegotiation"),!this._batchedNegotiation&&(this._batchedNegotiation=!0,queueMicrotask(()=>{this._batchedNegotiation=!1,this.initiator||!this._firstNegotiation?(this._debug("starting batched negotiation"),this.negotiate()):this._debug("non-initiator initial negotiation request discarded"),this._firstNegotiation=!1}))}negotiate(){if(!this._destroying){if(this.destroyed)throw P(new Error("cannot negotiate after peer is destroyed"),"ERR_DESTROYED");this.initiator?this._isNegotiating?(this._queuedNegotiation=!0,this._debug("already negotiating, queueing")):(this._debug("start negotiation"),setTimeout(()=>{this._createOffer()},0)):this._isNegotiating?(this._queuedNegotiation=!0,this._debug("already negotiating, queueing")):(this._debug("requesting negotiation from initiator"),this.emit("signal",{type:"renegotiate",renegotiate:!0})),this._isNegotiating=!0}}_final(e){this._readableState.ended||this.push(null),e(null)}__destroy(e){this.end(),this._destroy(()=>{},e)}_destroy(e,i){this.destroyed||this._destroying||(this._destroying=!0,this._debug("destroying (error: %s)",i&&(i.message||i)),setTimeout(()=>{if(this._connected=!1,this._pcReady=!1,this._channelReady=!1,this._remoteTracks=null,this._remoteStreams=null,this._senderMap=null,clearInterval(this._closingInterval),this._closingInterval=null,clearInterval(this._interval),this._interval=null,this._chunk=null,this._cb=null,this._onFinishBound&&this.removeListener("finish",this._onFinishBound),this._onFinishBound=null,this._channel){try{this._channel.close()}catch{}this._channel.onmessage=null,this._channel.onopen=null,this._channel.onclose=null,this._channel.onerror=null}if(this._pc){try{this._pc.close()}catch{}this._pc.oniceconnectionstatechange=null,this._pc.onicegatheringstatechange=null,this._pc.onsignalingstatechange=null,this._pc.onicecandidate=null,this._pc.ontrack=null,this._pc.ondatachannel=null}this._pc=null,this._channel=null,i&&this.emit("error",i),e()},0))}_setupData(e){if(!e.channel)return this.__destroy(P(new Error("Data channel event is missing `channel` property"),"ERR_DATA_CHANNEL"));this._channel=e.channel,this._channel.binaryType="arraybuffer",typeof this._channel.bufferedAmountLowThreshold=="number"&&(this._channel.bufferedAmountLowThreshold=li),this.channelName=this._channel.label,this._channel.onmessage=s=>{this._onChannelMessage(s)},this._channel.onbufferedamountlow=()=>{this._onChannelBufferedAmountLow()},this._channel.onopen=()=>{this._onChannelOpen()},this._channel.onclose=()=>{this._onChannelClose()},this._channel.onerror=s=>{const r=s.error instanceof Error?s.error:new Error(`Datachannel error: ${s.message} ${s.filename}:${s.lineno}:${s.colno}`);this.__destroy(P(r,"ERR_DATA_CHANNEL"))};let i=!1;this._closingInterval=setInterval(()=>{this._channel&&this._channel.readyState==="closing"?(i&&this._onChannelClose(),i=!0):i=!1},wh)}_write(e,i){if(this.destroyed)return i(P(new Error("cannot write after peer is destroyed"),"ERR_DATA_CHANNEL"));if(this._connected){try{this.send(e)}catch(s){return this.__destroy(P(s,"ERR_DATA_CHANNEL"))}this._channel.bufferedAmount>li?(this._debug("start backpressure: bufferedAmount %d",this._channel.bufferedAmount),this._cb=i):i(null)}else this._debug("write before connect"),this._chunk=e,this._cb=i}_onFinish(){if(this.destroyed)return;const e=()=>{setTimeout(()=>this.__destroy(),1e3)};this._connected?e():this.once("connect",e)}_startIceCompleteTimeout(){this.destroyed||this._iceCompleteTimer||(this._debug("started iceComplete timeout"),this._iceCompleteTimer=setTimeout(()=>{this._iceComplete||(this._iceComplete=!0,this._debug("iceComplete timeout completed"),this.emit("iceTimeout"),this.emit("_iceComplete"))},this.iceCompleteTimeout))}_createOffer(){this.destroyed||this._pc.createOffer(this.offerOptions).then(e=>{if(this.destroyed)return;!this.trickle&&!this.allowHalfTrickle&&(e.sdp=ar(e.sdp)),e.sdp=this.sdpTransform(e.sdp);const i=()=>{if(this.destroyed)return;const o=this._pc.localDescription||e;this._debug("signal"),this.emit("signal",{type:o.type,sdp:o.sdp})},s=()=>{this._debug("createOffer success"),!this.destroyed&&(this.trickle||this._iceComplete?i():this.once("_iceComplete",i))},r=o=>{this.__destroy(P(o,"ERR_SET_LOCAL_DESCRIPTION"))};this._pc.setLocalDescription(e).then(s).catch(r)}).catch(e=>{this.__destroy(P(e,"ERR_CREATE_OFFER"))})}_createAnswer(){this.destroyed||this._pc.createAnswer(this.answerOptions).then(e=>{if(this.destroyed)return;!this.trickle&&!this.allowHalfTrickle&&(e.sdp=ar(e.sdp)),e.sdp=this.sdpTransform(e.sdp);const i=()=>{var A;if(this.destroyed)return;const o=this._pc.localDescription||e;this._debug("signal"),this.emit("signal",{type:o.type,sdp:o.sdp}),this.initiator||(A=this._requestMissingTransceivers)==null||A.call(this)},s=()=>{this.destroyed||(this.trickle||this._iceComplete?i():this.once("_iceComplete",i))},r=o=>{this.__destroy(P(o,"ERR_SET_LOCAL_DESCRIPTION"))};this._pc.setLocalDescription(e).then(s).catch(r)}).catch(e=>{this.__destroy(P(e,"ERR_CREATE_ANSWER"))})}_onConnectionStateChange(){this.destroyed||this._destroying||this._pc.connectionState==="failed"&&this.__destroy(P(new Error("Connection failed."),"ERR_CONNECTION_FAILURE"))}_onIceStateChange(){if(this.destroyed)return;const e=this._pc.iceConnectionState,i=this._pc.iceGatheringState;this._debug("iceStateChange (connection: %s) (gathering: %s)",e,i),this.emit("iceStateChange",e,i),(e==="connected"||e==="completed")&&(this._pcReady=!0,this._maybeReady()),e==="failed"&&this.__destroy(P(new Error("Ice connection failed."),"ERR_ICE_CONNECTION_FAILURE")),e==="closed"&&this.__destroy(P(new Error("Ice connection closed."),"ERR_ICE_CONNECTION_CLOSED"))}getStats(e){const i=s=>(Object.prototype.toString.call(s.values)==="[object Array]"&&s.values.forEach(r=>{Object.assign(s,r)}),s);this._pc.getStats.length===0||this._isReactNativeWebrtc?this._pc.getStats().then(s=>{const r=[];s.forEach(o=>{r.push(i(o))}),e(null,r)},s=>e(s)):this._pc.getStats.length>0?this._pc.getStats(s=>{if(this.destroyed)return;const r=[];s.result().forEach(o=>{const A={};o.names().forEach(a=>{A[a]=o.stat(a)}),A.id=o.id,A.type=o.type,A.timestamp=o.timestamp,r.push(i(A))}),e(null,r)},s=>e(s)):e(null,[])}_maybeReady(){if(this._debug("maybeReady pc %s channel %s",this._pcReady,this._channelReady),this._connected||this._connecting||!this._pcReady||!this._channelReady)return;this._connecting=!0;const e=()=>{this.destroyed||this._destroying||this.getStats((i,s)=>{if(this.destroyed||this._destroying)return;i&&(s=[]);const r={},o={},A={};let a=!1;s.forEach(c=>{(c.type==="remotecandidate"||c.type==="remote-candidate")&&(r[c.id]=c),(c.type==="localcandidate"||c.type==="local-candidate")&&(o[c.id]=c),(c.type==="candidatepair"||c.type==="candidate-pair")&&(A[c.id]=c)});const l=c=>{a=!0;let h=o[c.localCandidateId];h&&(h.ip||h.address)?(this.localAddress=h.ip||h.address,this.localPort=Number(h.port)):h&&h.ipAddress?(this.localAddress=h.ipAddress,this.localPort=Number(h.portNumber)):typeof c.googLocalAddress=="string"&&(h=c.googLocalAddress.split(":"),this.localAddress=h[0],this.localPort=Number(h[1])),this.localAddress&&(this.localFamily=this.localAddress.includes(":")?"IPv6":"IPv4");let u=r[c.remoteCandidateId];u&&(u.ip||u.address)?(this.remoteAddress=u.ip||u.address,this.remotePort=Number(u.port)):u&&u.ipAddress?(this.remoteAddress=u.ipAddress,this.remotePort=Number(u.portNumber)):typeof c.googRemoteAddress=="string"&&(u=c.googRemoteAddress.split(":"),this.remoteAddress=u[0],this.remotePort=Number(u[1])),this.remoteAddress&&(this.remoteFamily=this.remoteAddress.includes(":")?"IPv6":"IPv4"),this._debug("connect local: %s:%s remote: %s:%s",this.localAddress,this.localPort,this.remoteAddress,this.remotePort)};if(s.forEach(c=>{c.type==="transport"&&c.selectedCandidatePairId&&l(A[c.selectedCandidatePairId]),(c.type==="googCandidatePair"&&c.googActiveConnection==="true"||(c.type==="candidatepair"||c.type==="candidate-pair")&&c.selected)&&l(c)}),!a&&(!Object.keys(A).length||Object.keys(o).length)){setTimeout(e,100);return}else this._connecting=!1,this._connected=!0;if(this._chunk){try{this.send(this._chunk)}catch(h){return this.__destroy(P(h,"ERR_DATA_CHANNEL"))}this._chunk=null,this._debug('sent chunk from "write before connect"');const c=this._cb;this._cb=null,c(null)}typeof this._channel.bufferedAmountLowThreshold!="number"&&(this._interval=setInterval(()=>this._onInterval(),150),this._interval.unref&&this._interval.unref()),this._debug("connect"),this.emit("connect")})};e()}_onInterval(){!this._cb||!this._channel||this._channel.bufferedAmount>li||this._onChannelBufferedAmountLow()}_onSignalingStateChange(){this.destroyed||(this._pc.signalingState==="stable"&&(this._isNegotiating=!1,this._debug("flushing sender queue",this._sendersAwaitingStable),this._sendersAwaitingStable.forEach(e=>{this._pc.removeTrack(e),this._queuedNegotiation=!0}),this._sendersAwaitingStable=[],this._queuedNegotiation?(this._debug("flushing negotiation queue"),this._queuedNegotiation=!1,this._needsNegotiation()):(this._debug("negotiated"),this.emit("negotiated"))),this._debug("signalingStateChange %s",this._pc.signalingState),this.emit("signalingStateChange",this._pc.signalingState))}_onIceCandidate(e){this.destroyed||(e.candidate&&this.trickle?this.emit("signal",{type:"candidate",candidate:{candidate:e.candidate.candidate,sdpMLineIndex:e.candidate.sdpMLineIndex,sdpMid:e.candidate.sdpMid}}):!e.candidate&&!this._iceComplete&&(this._iceComplete=!0,this.emit("_iceComplete")),e.candidate&&this._startIceCompleteTimeout())}_onChannelMessage(e){if(this.destroyed)return;let i=e.data;i instanceof ArrayBuffer?i=new Uint8Array(i):this.__objectMode===!1&&(i=gh(i)),this.push(i)}_onChannelBufferedAmountLow(){if(this.destroyed||!this._cb)return;this._debug("ending backpressure: bufferedAmount %d",this._channel.bufferedAmount);const e=this._cb;this._cb=null,e(null)}_onChannelOpen(){this._connected||this.destroyed||(this._debug("on channel open"),this._channelReady=!0,this._maybeReady())}_onChannelClose(){this.destroyed||(this._debug("on channel close"),this.__destroy())}_debug(){const e=[].slice.call(arguments);e[0]="["+this._id+"] "+e[0],ph.apply(null,e)}};Wn.WEBRTC_SUPPORT=!!ki;Wn.config={iceServers:[{urls:["stun:stun.l.google.com:19302","stun:global.stun.twilio.com:3478"]}],sdpSemantics:"unified-plan"};Wn.channelConfig={};/*! simple-peer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */class yh extends Wn{constructor(t={}){super(t),this._pc&&(this.streams=t.streams||(t.stream?[t.stream]:[]),this._senderMap=new Map,this.streams&&this.streams.forEach(e=>{this.addStream(e)}),this._pc.ontrack=e=>{this._onTrack(e)})}addTransceiver(t,e){if(!this._destroying){if(this.destroyed)throw P(new Error("cannot addTransceiver after peer is destroyed"),"ERR_DESTROYED");if(this._debug("addTransceiver()"),this.initiator)try{this._pc.addTransceiver(t,e),this._needsNegotiation()}catch(i){this.__destroy(P(i,"ERR_ADD_TRANSCEIVER"))}else this.emit("signal",{type:"transceiverRequest",transceiverRequest:{kind:t,init:e}})}}addStream(t){if(!this._destroying){if(this.destroyed)throw P(new Error("cannot addStream after peer is destroyed"),"ERR_DESTROYED");this._debug("addStream()"),t.getTracks().forEach(e=>{this.addTrack(e,t)})}}addTrack(t,e){if(this._destroying)return;if(this.destroyed)throw P(new Error("cannot addTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("addTrack()");const i=this._senderMap.get(t)||new Map;let s=i.get(e);if(!s)s=this._pc.addTrack(t,e),i.set(e,s),this._senderMap.set(t,i),this._needsNegotiation();else throw s.removed?P(new Error("Track has been removed. You should enable/disable tracks that you want to re-add."),"ERR_SENDER_REMOVED"):P(new Error("Track has already been added to that stream."),"ERR_SENDER_ALREADY_ADDED")}replaceTrack(t,e,i){if(this._destroying)return;if(this.destroyed)throw P(new Error("cannot replaceTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("replaceTrack()");const s=this._senderMap.get(t),r=s?s.get(i):null;if(!r)throw P(new Error("Cannot replace track that was never added."),"ERR_TRACK_NOT_ADDED");e&&this._senderMap.set(e,s),r.replaceTrack!=null?r.replaceTrack(e):this.__destroy(P(new Error("replaceTrack is not supported in this browser"),"ERR_UNSUPPORTED_REPLACETRACK"))}removeTrack(t,e){if(this._destroying)return;if(this.destroyed)throw P(new Error("cannot removeTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("removeSender()");const i=this._senderMap.get(t),s=i?i.get(e):null;if(!s)throw P(new Error("Cannot remove track that was never added."),"ERR_TRACK_NOT_ADDED");try{s.removed=!0,this._pc.removeTrack(s)}catch(r){r.name==="NS_ERROR_UNEXPECTED"?this._sendersAwaitingStable.push(s):this.__destroy(P(r,"ERR_REMOVE_TRACK"))}this._needsNegotiation()}removeStream(t){if(!this._destroying){if(this.destroyed)throw P(new Error("cannot removeStream after peer is destroyed"),"ERR_DESTROYED");this._debug("removeSenders()"),t.getTracks().forEach(e=>{this.removeTrack(e,t)})}}_requestMissingTransceivers(){this._pc.getTransceivers&&this._pc.getTransceivers().forEach(t=>{!t.mid&&t.sender.track&&!t.requested&&(t.requested=!0,this.addTransceiver(t.sender.track.kind))})}_onTrack(t){this.destroyed||t.streams.forEach(e=>{this._debug("on track"),this.emit("track",t.track,e),this._remoteTracks.push({track:t.track,stream:e}),!this._remoteStreams.some(i=>i.id===e.id)&&(this._remoteStreams.push(e),queueMicrotask(()=>{this._debug("on stream"),this.emit("stream",e)}))})}}const lr="data",cr="signal",hr=(n,t)=>{const e=new yh({iceServers:[{urls:Eh}],...t,initiator:n,trickle:!1}),i=r=>s.push(r);let s=[];return e.on(lr,i),{id:e._id,created:Date.now(),connection:e._pc,get channel(){return e._channel},get isDead(){return e.destroyed},signal:r=>new Promise(o=>{n||e.on(cr,o),e.signal(r)}),sendData:r=>e.send(r),destroy:()=>e.destroy(),setHandlers:r=>Object.entries(r).forEach(([o,A])=>e.on(o,A)),offerPromise:n?new Promise(r=>e.on(cr,r)):Promise.resolve(),addStream:r=>e.addStream(r),removeStream:r=>e.removeStream(r),addTrack:(r,o)=>e.addTrack(r,o),removeTrack:(r,o)=>e.removeTrack(r,o),replaceTrack:(r,o,A)=>e.replaceTrack(r,o,A),drainEarlyData:r=>{e.off(lr,i),s.forEach(r),s=null}}},Eh=[...Ue(5,(n,t)=>`stun:stun${t||""}.l.google.com:19302`),"stun:global.stun.twilio.com:3478"],bh=Object.getPrototypeOf(Uint8Array),pn=12,aA=0,mn=aA+pn,wn=mn+1,De=wn+1,Me=De+1,Ut=16*2**10-Me,An=255,ur="bufferedamountlow",re=n=>"@_"+n,Ch=(n,t,e)=>{const i={},s={},r={},o={},A={},a={},l={},c={onPeerJoin:Vt,onPeerLeave:Vt,onPeerStream:Vt,onPeerTrack:Vt},h=(w,I)=>(w?Array.isArray(w)?w:[w]:kl(i)).flatMap(b=>{const _=i[b];return _?I(b,_):(console.warn(`${Fe}: no peer with id ${b} found`),[])}),u=w=>{i[w]&&(delete i[w],delete o[w],delete A[w],c.onPeerLeave(w),t(w))},f=w=>{if(s[w])return r[w];if(!w)throw mt("action type argument is required");const I=Jt(w);if(I.byteLength>pn)throw mt(`action type string "${w}" (${I.byteLength}b) exceeds byte limit (${pn}). Hint: choose a shorter name.`);const b=new Uint8Array(pn);b.set(I);let _=0;return s[w]={onComplete:Vt,onProgress:Vt,setOnComplete:S=>s[w]={...s[w],onComplete:S},setOnProgress:S=>s[w]={...s[w],onProgress:S},send:async(S,T,v,M)=>{if(v&&typeof v!="object")throw mt("action meta argument must be an object");const L=typeof S;if(L==="undefined")throw mt("action data cannot be undefined");const U=L!=="string",X=S instanceof Blob,O=X||S instanceof ArrayBuffer||S instanceof bh;if(v&&!O)throw mt("action meta argument can only be used with binary data");const q=O?new Uint8Array(X?await S.arrayBuffer():S):Jt(U?Et(S):S),tt=v?Jt(Et(v)):null,Z=Math.ceil(q.byteLength/Ut)+(v?1:0)||1,At=Ue(Z,(H,G)=>{const z=G===Z-1,Y=v&&G===0,V=new Uint8Array(Me+(Y?tt.byteLength:z?q.byteLength-Ut*(Z-(v?2:1)):Ut));return V.set(b),V.set([_],mn),V.set([z|Y<<1|O<<2|U<<3],wn),V.set([Math.round((G+1)/Z*An)],De),V.set(v?Y?tt:q.subarray((G-1)*Ut,G*Ut):q.subarray(G*Ut,(G+1)*Ut),Me),V});return _=_+1&An,ae(h(T,async(H,G)=>{const{channel:z}=G;let Y=0;for(;Y<Z;){const V=At[Y];if(z.bufferedAmount>z.bufferedAmountLowThreshold&&await new Promise(ct=>{const Ft=()=>{z.removeEventListener(ur,Ft),ct()};z.addEventListener(ur,Ft)}),!i[H])break;G.sendData(V),Y++,M==null||M(V[De]/An,H,v)}}))}},r[w]||(r[w]=[s[w].send,s[w].setOnComplete,s[w].setOnProgress])},m=(w,I)=>{var Z,At;const b=new Uint8Array(I),_=fn(b.subarray(aA,mn)).replaceAll("\0",""),[S]=b.subarray(mn,wn),[T]=b.subarray(wn,De),[v]=b.subarray(De,Me),M=b.subarray(Me),L=!!(T&1),U=!!(T&2),X=!!(T&4),O=!!(T&8);if(!s[_]){console.warn(`${Fe}: received message with unregistered type (${_})`);return}o[w]||(o[w]={}),(Z=o[w])[_]||(Z[_]={});const q=(At=o[w][_])[S]||(At[S]={chunks:[]});if(U?q.meta=vn(fn(M)):q.chunks.push(M),s[_].onProgress(v/An,w,q.meta),!L)return;const tt=new Uint8Array(q.chunks.reduce((H,G)=>H+G.byteLength,0));if(q.chunks.reduce((H,G)=>(tt.set(G,H),H+G.byteLength),0),delete o[w][_][S],X)s[_].onComplete(tt,w,q.meta);else{const H=fn(tt);s[_].onComplete(O?vn(H):H,w)}},d=async()=>{await N(""),await new Promise(w=>setTimeout(w,99)),Ws(i).forEach(([w,I])=>{I.destroy(),delete i[w]}),e()},[p,g]=f(re("ping")),[y,C]=f(re("pong")),[E,B]=f(re("signal")),[x,R]=f(re("stream")),[k,F]=f(re("track")),[N,D]=f(re("leave"));return n((w,I)=>{var b;i[I]||(i[I]=w,w.setHandlers({data:_=>m(I,_),stream:_=>{c.onPeerStream(_,I,a[I]),delete a[I]},track:(_,S)=>{c.onPeerTrack(_,S,I,l[I]),delete l[I]},signal:_=>E(_,I),close:()=>u(I),error:()=>u(I)}),c.onPeerJoin(I),(b=w.drainEarlyData)==null||b.call(w,_=>m(I,_)))}),g((w,I)=>y("",I)),C((w,I)=>{var b;(b=A[I])==null||b.call(A),delete A[I]}),B((w,I)=>{var b;return(b=i[I])==null?void 0:b.signal(w)}),R((w,I)=>a[I]=w),F((w,I)=>l[I]=w),D((w,I)=>u(I)),ss&&addEventListener("beforeunload",d),{makeAction:f,leave:d,ping:async w=>{if(!w)throw mt("ping() must be called with target peer ID");const I=Date.now();return p("",w),await new Promise(b=>A[w]=b),Date.now()-I},getPeers:()=>vl(Ws(i).map(([w,I])=>[w,I.connection])),addStream:(w,I,b)=>h(I,async(_,S)=>{b&&await x(b,_),S.addStream(w)}),removeStream:(w,I)=>h(I,(b,_)=>_.removeStream(w)),addTrack:(w,I,b,_)=>h(b,async(S,T)=>{_&&await k(_,S),T.addTrack(w,I)}),removeTrack:(w,I,b)=>h(b,(_,S)=>S.removeTrack(w,I)),replaceTrack:(w,I,b,_,S)=>h(_,async(T,v)=>{S&&await k(S,T),v.replaceTrack(w,I,b)}),onPeerJoin:w=>c.onPeerJoin=w,onPeerLeave:w=>c.onPeerLeave=w,onPeerStream:w=>c.onPeerStream=w,onPeerTrack:w=>c.onPeerTrack=w}},Sh=20,xh=5333,dr=57333,Ih=({init:n,subscribe:t,announce:e})=>{const i={};let s=!1,r,o,A;return(a,l,c)=>{var S;const{appId:h}=a;if((S=i[h])!=null&&S[l])return i[h][l];const u={},f={},m=nn(Fe,h,l),d=sn(m),p=sn(nn(m,Ae)),g=Fl(a.password||"",h,l),y=T=>async v=>({type:v.type,sdp:await T(g,v.sdp)}),C=y(Ql),E=y(Ul),B=()=>hr(!0,a.rtcConfig),x=(T,v,M)=>{var L;if(f[v]){f[v]!==T&&T.destroy();return}f[v]=T,_(T,v),(L=u[v])==null||L.forEach((U,X)=>{X!==M&&U.destroy()}),delete u[v]},R=(T,v)=>{f[v]===T&&delete f[v]},k=(T,v)=>{var L;if(f[T])return;const M=(L=u[T])==null?void 0:L[v];M&&(delete u[T][v],M.destroy())},F=T=>(o.push(...Ue(T,B)),ae(o.splice(0,T).map(v=>v.offerPromise.then(E).then(M=>({peer:v,offer:M}))))),N=(T,v)=>c==null?void 0:c({error:`incorrect password (${a.password}) when decrypting ${v}`,appId:h,peerId:T,roomId:l}),D=T=>async(v,M,L)=>{var At,H,G;const[U,X]=await ae([d,p]);if(v!==U&&v!==X)return;const{peerId:O,offer:q,answer:tt,peer:Z}=typeof M=="string"?vn(M):M;if(!(O===Ae||f[O])){if(O&&!q&&!tt){if((At=u[O])!=null&&At[T])return;const[[{peer:z,offer:Y}],V]=await ae([F(1),sn(nn(m,O))]);u[O]||(u[O]=[]),u[O][T]=z,setTimeout(()=>k(O,T),w[T]*.9),z.setHandlers({connect:()=>x(z,O,T),close:()=>R(z,O)}),L(V,Et({peerId:Ae,offer:Y}))}else if(q){if(((H=u[O])==null?void 0:H[T])&&Ae>O)return;const Y=hr(!1,a.rtcConfig);Y.setHandlers({connect:()=>x(Y,O,T),close:()=>R(Y,O)});let V;try{V=await C(q)}catch{N(O,"offer");return}if(Y.isDead)return;const[ct,Ft]=await ae([sn(nn(m,O)),Y.signal(V)]);L(ct,Et({peerId:Ae,answer:await E(Ft)}))}else if(tt){let z;try{z=await C(tt)}catch{N(O,"answer");return}if(Z)Z.setHandlers({connect:()=>x(Z,O,T),close:()=>R(Z,O)}),Z.signal(z);else{const Y=(G=u[O])==null?void 0:G[T];Y&&!Y.isDead&&Y.signal(z)}}}};if(!a)throw mt("requires a config map as the first argument");if(!h&&!a.firebaseApp)throw mt("config map is missing appId field");if(!l)throw mt("roomId argument required");if(!s){const T=n(a);o=Ue(Sh,B),r=Array.isArray(T)?T:[T],s=!0,A=setInterval(()=>o=o.filter(v=>{const M=Date.now()-v.created<dr;return M||v.destroy(),M}),dr*1.03)}const w=r.map(()=>xh),I=[],b=r.map(async(T,v)=>t(await T,await d,await p,D(v),F));ae([d,p]).then(([T,v])=>{const M=async(L,U)=>{const X=await e(L,T,v);typeof X=="number"&&(w[U]=X),I[U]=setTimeout(()=>M(L,U),w[U])};b.forEach(async(L,U)=>{await L,M(await r[U],U)})});let _=Vt;return i[h]||(i[h]={}),i[h][l]=Ch(T=>_=T,T=>delete f[T],()=>{delete i[h][l],I.forEach(clearTimeout),b.forEach(async T=>(await T)()),clearInterval(A)})}},Bh=5,lA=29333,cA="x",hA="EVENT",uA=ss&&is.utils.randomPrivateKey(),Th=ss&&Ri(is.getPublicKey(uA)),ws={},Qt={},dA=()=>Math.floor(Date.now()/1e3),fr=async(n,t)=>{const e={kind:lA,content:t,pubkey:Th,created_at:dA(),tags:[[cA,n]]},i=Ri(new Uint8Array(await crypto.subtle.digest("SHA-256",Jt(Et([0,e.pubkey,e.created_at,e.kind,e.tags,e.content])))));return Et([hA,{...e,id:i,sig:Ri(await is.sign(i,uA))}])},gr=(n,t)=>(ws[n]=t,Et(["REQ",n,{kinds:[lA],since:dA(),["#"+cA]:[t]}])),pr=n=>(delete ws[n],Et(["CLOSE",n])),Rh=Ih({init:n=>Ml(n,vh,Bh).map(t=>{const e=Ol(t,i=>{var a;const[s,r,o,A]=vn(i);if(s!==hA){const l=`${Fe}: relay failure from ${e.url} - `;s==="NOTICE"?console.warn(l+r):s==="OK"&&!o&&console.warn(l+A);return}(a=Qt[r])==null||a.call(Qt,ws[r],o.content)});return e.ready}),subscribe:(n,t,e,i)=>{const s=Ti(64),r=Ti(64);return Qt[s]=Qt[r]=(o,A)=>i(o,A,async(a,l)=>n.send(await fr(a,l))),n.send(gr(s,t)),n.send(gr(r,e)),()=>{n.send(pr(s)),n.send(pr(r)),delete Qt[s],delete Qt[r]}},announce:async(n,t)=>n.send(await fr(t,Et({peerId:Ae})))}),vh=["relay.nostr.net","relay.snort.social","relay.piazza.today","relay.exit.pub","nostr.lu.ke","nostr.mom","relay.urbanzap.space","nostr.data.haus","nostr.sathoarder.com","relay.nostromo.social","relay.nostr.bg","nostr.stakey.net","nostr.vulpem.com","a.nos.lol","eu.purplerelay.com","nostr2.sanhauf.com","e.nos.lol"].map(n=>"wss://"+n);var $e={},kh=function(){return typeof Promise=="function"&&Promise.prototype&&Promise.prototype.then},fA={},it={};let _s;const Nh=[0,26,44,70,100,134,172,196,242,292,346,404,466,532,581,655,733,815,901,991,1085,1156,1258,1364,1474,1588,1706,1828,1921,2051,2185,2323,2465,2611,2761,2876,3034,3196,3362,3532,3706];it.getSymbolSize=function(t){if(!t)throw new Error('"version" cannot be null or undefined');if(t<1||t>40)throw new Error('"version" should be in range from 1 to 40');return t*4+17};it.getSymbolTotalCodewords=function(t){return Nh[t]};it.getBCHDigit=function(n){let t=0;for(;n!==0;)t++,n>>>=1;return t};it.setToSJISFunction=function(t){if(typeof t!="function")throw new Error('"toSJISFunc" is not a valid function.');_s=t};it.isKanjiModeEnabled=function(){return typeof _s<"u"};it.toSJIS=function(t){return _s(t)};var Hn={};(function(n){n.L={bit:1},n.M={bit:0},n.Q={bit:3},n.H={bit:2};function t(e){if(typeof e!="string")throw new Error("Param is not a string");switch(e.toLowerCase()){case"l":case"low":return n.L;case"m":case"medium":return n.M;case"q":case"quartile":return n.Q;case"h":case"high":return n.H;default:throw new Error("Unknown EC Level: "+e)}}n.isValid=function(i){return i&&typeof i.bit<"u"&&i.bit>=0&&i.bit<4},n.from=function(i,s){if(n.isValid(i))return i;try{return t(i)}catch{return s}}})(Hn);function gA(){this.buffer=[],this.length=0}gA.prototype={get:function(n){const t=Math.floor(n/8);return(this.buffer[t]>>>7-n%8&1)===1},put:function(n,t){for(let e=0;e<t;e++)this.putBit((n>>>t-e-1&1)===1)},getLengthInBits:function(){return this.length},putBit:function(n){const t=Math.floor(this.length/8);this.buffer.length<=t&&this.buffer.push(0),n&&(this.buffer[t]|=128>>>this.length%8),this.length++}};var Dh=gA;function tn(n){if(!n||n<1)throw new Error("BitMatrix size must be defined and greater than 0");this.size=n,this.data=new Uint8Array(n*n),this.reservedBit=new Uint8Array(n*n)}tn.prototype.set=function(n,t,e,i){const s=n*this.size+t;this.data[s]=e,i&&(this.reservedBit[s]=!0)};tn.prototype.get=function(n,t){return this.data[n*this.size+t]};tn.prototype.xor=function(n,t,e){this.data[n*this.size+t]^=e};tn.prototype.isReserved=function(n,t){return this.reservedBit[n*this.size+t]};var Mh=tn,pA={};(function(n){const t=it.getSymbolSize;n.getRowColCoords=function(i){if(i===1)return[];const s=Math.floor(i/7)+2,r=t(i),o=r===145?26:Math.ceil((r-13)/(2*s-2))*2,A=[r-7];for(let a=1;a<s-1;a++)A[a]=A[a-1]-o;return A.push(6),A.reverse()},n.getPositions=function(i){const s=[],r=n.getRowColCoords(i),o=r.length;for(let A=0;A<o;A++)for(let a=0;a<o;a++)A===0&&a===0||A===0&&a===o-1||A===o-1&&a===0||s.push([r[A],r[a]]);return s}})(pA);var mA={};const Oh=it.getSymbolSize,mr=7;mA.getPositions=function(t){const e=Oh(t);return[[0,0],[e-mr,0],[0,e-mr]]};var wA={};(function(n){n.Patterns={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7};const t={N1:3,N2:3,N3:40,N4:10};n.isValid=function(s){return s!=null&&s!==""&&!isNaN(s)&&s>=0&&s<=7},n.from=function(s){return n.isValid(s)?parseInt(s,10):void 0},n.getPenaltyN1=function(s){const r=s.size;let o=0,A=0,a=0,l=null,c=null;for(let h=0;h<r;h++){A=a=0,l=c=null;for(let u=0;u<r;u++){let f=s.get(h,u);f===l?A++:(A>=5&&(o+=t.N1+(A-5)),l=f,A=1),f=s.get(u,h),f===c?a++:(a>=5&&(o+=t.N1+(a-5)),c=f,a=1)}A>=5&&(o+=t.N1+(A-5)),a>=5&&(o+=t.N1+(a-5))}return o},n.getPenaltyN2=function(s){const r=s.size;let o=0;for(let A=0;A<r-1;A++)for(let a=0;a<r-1;a++){const l=s.get(A,a)+s.get(A,a+1)+s.get(A+1,a)+s.get(A+1,a+1);(l===4||l===0)&&o++}return o*t.N2},n.getPenaltyN3=function(s){const r=s.size;let o=0,A=0,a=0;for(let l=0;l<r;l++){A=a=0;for(let c=0;c<r;c++)A=A<<1&2047|s.get(l,c),c>=10&&(A===1488||A===93)&&o++,a=a<<1&2047|s.get(c,l),c>=10&&(a===1488||a===93)&&o++}return o*t.N3},n.getPenaltyN4=function(s){let r=0;const o=s.data.length;for(let a=0;a<o;a++)r+=s.data[a];return Math.abs(Math.ceil(r*100/o/5)-10)*t.N4};function e(i,s,r){switch(i){case n.Patterns.PATTERN000:return(s+r)%2===0;case n.Patterns.PATTERN001:return s%2===0;case n.Patterns.PATTERN010:return r%3===0;case n.Patterns.PATTERN011:return(s+r)%3===0;case n.Patterns.PATTERN100:return(Math.floor(s/2)+Math.floor(r/3))%2===0;case n.Patterns.PATTERN101:return s*r%2+s*r%3===0;case n.Patterns.PATTERN110:return(s*r%2+s*r%3)%2===0;case n.Patterns.PATTERN111:return(s*r%3+(s+r)%2)%2===0;default:throw new Error("bad maskPattern:"+i)}}n.applyMask=function(s,r){const o=r.size;for(let A=0;A<o;A++)for(let a=0;a<o;a++)r.isReserved(a,A)||r.xor(a,A,e(s,a,A))},n.getBestMask=function(s,r){const o=Object.keys(n.Patterns).length;let A=0,a=1/0;for(let l=0;l<o;l++){r(l),n.applyMask(l,s);const c=n.getPenaltyN1(s)+n.getPenaltyN2(s)+n.getPenaltyN3(s)+n.getPenaltyN4(s);n.applyMask(l,s),c<a&&(a=c,A=l)}return A}})(wA);var Jn={};const Bt=Hn,an=[1,1,1,1,1,1,1,1,1,1,2,2,1,2,2,4,1,2,4,4,2,4,4,4,2,4,6,5,2,4,6,6,2,5,8,8,4,5,8,8,4,5,8,11,4,8,10,11,4,9,12,16,4,9,16,16,6,10,12,18,6,10,17,16,6,11,16,19,6,13,18,21,7,14,21,25,8,16,20,25,8,17,23,25,9,17,23,34,9,18,25,30,10,20,27,32,12,21,29,35,12,23,34,37,12,25,34,40,13,26,35,42,14,28,38,45,15,29,40,48,16,31,43,51,17,33,45,54,18,35,48,57,19,37,51,60,19,38,53,63,20,40,56,66,21,43,59,70,22,45,62,74,24,47,65,77,25,49,68,81],ln=[7,10,13,17,10,16,22,28,15,26,36,44,20,36,52,64,26,48,72,88,36,64,96,112,40,72,108,130,48,88,132,156,60,110,160,192,72,130,192,224,80,150,224,264,96,176,260,308,104,198,288,352,120,216,320,384,132,240,360,432,144,280,408,480,168,308,448,532,180,338,504,588,196,364,546,650,224,416,600,700,224,442,644,750,252,476,690,816,270,504,750,900,300,560,810,960,312,588,870,1050,336,644,952,1110,360,700,1020,1200,390,728,1050,1260,420,784,1140,1350,450,812,1200,1440,480,868,1290,1530,510,924,1350,1620,540,980,1440,1710,570,1036,1530,1800,570,1064,1590,1890,600,1120,1680,1980,630,1204,1770,2100,660,1260,1860,2220,720,1316,1950,2310,750,1372,2040,2430];Jn.getBlocksCount=function(t,e){switch(e){case Bt.L:return an[(t-1)*4+0];case Bt.M:return an[(t-1)*4+1];case Bt.Q:return an[(t-1)*4+2];case Bt.H:return an[(t-1)*4+3];default:return}};Jn.getTotalCodewordsCount=function(t,e){switch(e){case Bt.L:return ln[(t-1)*4+0];case Bt.M:return ln[(t-1)*4+1];case Bt.Q:return ln[(t-1)*4+2];case Bt.H:return ln[(t-1)*4+3];default:return}};var _A={},Xn={};const Oe=new Uint8Array(512),kn=new Uint8Array(256);(function(){let t=1;for(let e=0;e<255;e++)Oe[e]=t,kn[t]=e,t<<=1,t&256&&(t^=285);for(let e=255;e<512;e++)Oe[e]=Oe[e-255]})();Xn.log=function(t){if(t<1)throw new Error("log("+t+")");return kn[t]};Xn.exp=function(t){return Oe[t]};Xn.mul=function(t,e){return t===0||e===0?0:Oe[kn[t]+kn[e]]};(function(n){const t=Xn;n.mul=function(i,s){const r=new Uint8Array(i.length+s.length-1);for(let o=0;o<i.length;o++)for(let A=0;A<s.length;A++)r[o+A]^=t.mul(i[o],s[A]);return r},n.mod=function(i,s){let r=new Uint8Array(i);for(;r.length-s.length>=0;){const o=r[0];for(let a=0;a<s.length;a++)r[a]^=t.mul(s[a],o);let A=0;for(;A<r.length&&r[A]===0;)A++;r=r.slice(A)}return r},n.generateECPolynomial=function(i){let s=new Uint8Array([1]);for(let r=0;r<i;r++)s=n.mul(s,new Uint8Array([1,t.exp(r)]));return s}})(_A);const yA=_A;function ys(n){this.genPoly=void 0,this.degree=n,this.degree&&this.initialize(this.degree)}ys.prototype.initialize=function(t){this.degree=t,this.genPoly=yA.generateECPolynomial(this.degree)};ys.prototype.encode=function(t){if(!this.genPoly)throw new Error("Encoder not initialized");const e=new Uint8Array(t.length+this.degree);e.set(t);const i=yA.mod(e,this.genPoly),s=this.degree-i.length;if(s>0){const r=new Uint8Array(this.degree);return r.set(i,s),r}return i};var Ph=ys,EA={},Lt={},Es={};Es.isValid=function(t){return!isNaN(t)&&t>=1&&t<=40};var dt={};const bA="[0-9]+",Lh="[A-Z $%*+\\-./:]+";let Ze="(?:[u3000-u303F]|[u3040-u309F]|[u30A0-u30FF]|[uFF00-uFFEF]|[u4E00-u9FAF]|[u2605-u2606]|[u2190-u2195]|u203B|[u2010u2015u2018u2019u2025u2026u201Cu201Du2225u2260]|[u0391-u0451]|[u00A7u00A8u00B1u00B4u00D7u00F7])+";Ze=Ze.replace(/u/g,"\\u");const Fh="(?:(?![A-Z0-9 $%*+\\-./:]|"+Ze+`)(?:.|[\r
]))+`;dt.KANJI=new RegExp(Ze,"g");dt.BYTE_KANJI=new RegExp("[^A-Z0-9 $%*+\\-./:]+","g");dt.BYTE=new RegExp(Fh,"g");dt.NUMERIC=new RegExp(bA,"g");dt.ALPHANUMERIC=new RegExp(Lh,"g");const Uh=new RegExp("^"+Ze+"$"),Qh=new RegExp("^"+bA+"$"),Yh=new RegExp("^[A-Z0-9 $%*+\\-./:]+$");dt.testKanji=function(t){return Uh.test(t)};dt.testNumeric=function(t){return Qh.test(t)};dt.testAlphanumeric=function(t){return Yh.test(t)};(function(n){const t=Es,e=dt;n.NUMERIC={id:"Numeric",bit:1,ccBits:[10,12,14]},n.ALPHANUMERIC={id:"Alphanumeric",bit:2,ccBits:[9,11,13]},n.BYTE={id:"Byte",bit:4,ccBits:[8,16,16]},n.KANJI={id:"Kanji",bit:8,ccBits:[8,10,12]},n.MIXED={bit:-1},n.getCharCountIndicator=function(r,o){if(!r.ccBits)throw new Error("Invalid mode: "+r);if(!t.isValid(o))throw new Error("Invalid version: "+o);return o>=1&&o<10?r.ccBits[0]:o<27?r.ccBits[1]:r.ccBits[2]},n.getBestModeForData=function(r){return e.testNumeric(r)?n.NUMERIC:e.testAlphanumeric(r)?n.ALPHANUMERIC:e.testKanji(r)?n.KANJI:n.BYTE},n.toString=function(r){if(r&&r.id)return r.id;throw new Error("Invalid mode")},n.isValid=function(r){return r&&r.bit&&r.ccBits};function i(s){if(typeof s!="string")throw new Error("Param is not a string");switch(s.toLowerCase()){case"numeric":return n.NUMERIC;case"alphanumeric":return n.ALPHANUMERIC;case"kanji":return n.KANJI;case"byte":return n.BYTE;default:throw new Error("Unknown mode: "+s)}}n.from=function(r,o){if(n.isValid(r))return r;try{return i(r)}catch{return o}}})(Lt);(function(n){const t=it,e=Jn,i=Hn,s=Lt,r=Es,o=7973,A=t.getBCHDigit(o);function a(u,f,m){for(let d=1;d<=40;d++)if(f<=n.getCapacity(d,m,u))return d}function l(u,f){return s.getCharCountIndicator(u,f)+4}function c(u,f){let m=0;return u.forEach(function(d){const p=l(d.mode,f);m+=p+d.getBitsLength()}),m}function h(u,f){for(let m=1;m<=40;m++)if(c(u,m)<=n.getCapacity(m,f,s.MIXED))return m}n.from=function(f,m){return r.isValid(f)?parseInt(f,10):m},n.getCapacity=function(f,m,d){if(!r.isValid(f))throw new Error("Invalid QR Code version");typeof d>"u"&&(d=s.BYTE);const p=t.getSymbolTotalCodewords(f),g=e.getTotalCodewordsCount(f,m),y=(p-g)*8;if(d===s.MIXED)return y;const C=y-l(d,f);switch(d){case s.NUMERIC:return Math.floor(C/10*3);case s.ALPHANUMERIC:return Math.floor(C/11*2);case s.KANJI:return Math.floor(C/13);case s.BYTE:default:return Math.floor(C/8)}},n.getBestVersionForData=function(f,m){let d;const p=i.from(m,i.M);if(Array.isArray(f)){if(f.length>1)return h(f,p);if(f.length===0)return 1;d=f[0]}else d=f;return a(d.mode,d.getLength(),p)},n.getEncodedBits=function(f){if(!r.isValid(f)||f<7)throw new Error("Invalid QR Code version");let m=f<<12;for(;t.getBCHDigit(m)-A>=0;)m^=o<<t.getBCHDigit(m)-A;return f<<12|m}})(EA);var CA={};const Pi=it,SA=1335,Vh=21522,wr=Pi.getBCHDigit(SA);CA.getEncodedBits=function(t,e){const i=t.bit<<3|e;let s=i<<10;for(;Pi.getBCHDigit(s)-wr>=0;)s^=SA<<Pi.getBCHDigit(s)-wr;return(i<<10|s)^Vh};var xA={};const Gh=Lt;function Se(n){this.mode=Gh.NUMERIC,this.data=n.toString()}Se.getBitsLength=function(t){return 10*Math.floor(t/3)+(t%3?t%3*3+1:0)};Se.prototype.getLength=function(){return this.data.length};Se.prototype.getBitsLength=function(){return Se.getBitsLength(this.data.length)};Se.prototype.write=function(t){let e,i,s;for(e=0;e+3<=this.data.length;e+=3)i=this.data.substr(e,3),s=parseInt(i,10),t.put(s,10);const r=this.data.length-e;r>0&&(i=this.data.substr(e),s=parseInt(i,10),t.put(s,r*3+1))};var qh=Se;const Zh=Lt,ci=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"," ","$","%","*","+","-",".","/",":"];function xe(n){this.mode=Zh.ALPHANUMERIC,this.data=n}xe.getBitsLength=function(t){return 11*Math.floor(t/2)+6*(t%2)};xe.prototype.getLength=function(){return this.data.length};xe.prototype.getBitsLength=function(){return xe.getBitsLength(this.data.length)};xe.prototype.write=function(t){let e;for(e=0;e+2<=this.data.length;e+=2){let i=ci.indexOf(this.data[e])*45;i+=ci.indexOf(this.data[e+1]),t.put(i,11)}this.data.length%2&&t.put(ci.indexOf(this.data[e]),6)};var Wh=xe;const Hh=Lt;function Ie(n){this.mode=Hh.BYTE,typeof n=="string"?this.data=new TextEncoder().encode(n):this.data=new Uint8Array(n)}Ie.getBitsLength=function(t){return t*8};Ie.prototype.getLength=function(){return this.data.length};Ie.prototype.getBitsLength=function(){return Ie.getBitsLength(this.data.length)};Ie.prototype.write=function(n){for(let t=0,e=this.data.length;t<e;t++)n.put(this.data[t],8)};var Jh=Ie;const Xh=Lt,zh=it;function Be(n){this.mode=Xh.KANJI,this.data=n}Be.getBitsLength=function(t){return t*13};Be.prototype.getLength=function(){return this.data.length};Be.prototype.getBitsLength=function(){return Be.getBitsLength(this.data.length)};Be.prototype.write=function(n){let t;for(t=0;t<this.data.length;t++){let e=zh.toSJIS(this.data[t]);if(e>=33088&&e<=40956)e-=33088;else if(e>=57408&&e<=60351)e-=49472;else throw new Error("Invalid SJIS character: "+this.data[t]+`
Make sure your charset is UTF-8`);e=(e>>>8&255)*192+(e&255),n.put(e,13)}};var jh=Be,IA={exports:{}};(function(n){var t={single_source_shortest_paths:function(e,i,s){var r={},o={};o[i]=0;var A=t.PriorityQueue.make();A.push(i,0);for(var a,l,c,h,u,f,m,d,p;!A.empty();){a=A.pop(),l=a.value,h=a.cost,u=e[l]||{};for(c in u)u.hasOwnProperty(c)&&(f=u[c],m=h+f,d=o[c],p=typeof o[c]>"u",(p||d>m)&&(o[c]=m,A.push(c,m),r[c]=l))}if(typeof s<"u"&&typeof o[s]>"u"){var g=["Could not find a path from ",i," to ",s,"."].join("");throw new Error(g)}return r},extract_shortest_path_from_predecessor_list:function(e,i){for(var s=[],r=i;r;)s.push(r),e[r],r=e[r];return s.reverse(),s},find_path:function(e,i,s){var r=t.single_source_shortest_paths(e,i,s);return t.extract_shortest_path_from_predecessor_list(r,s)},PriorityQueue:{make:function(e){var i=t.PriorityQueue,s={},r;e=e||{};for(r in i)i.hasOwnProperty(r)&&(s[r]=i[r]);return s.queue=[],s.sorter=e.sorter||i.default_sorter,s},default_sorter:function(e,i){return e.cost-i.cost},push:function(e,i){var s={value:e,cost:i};this.queue.push(s),this.queue.sort(this.sorter)},pop:function(){return this.queue.shift()},empty:function(){return this.queue.length===0}}};n.exports=t})(IA);var Kh=IA.exports;(function(n){const t=Lt,e=qh,i=Wh,s=Jh,r=jh,o=dt,A=it,a=Kh;function l(g){return unescape(encodeURIComponent(g)).length}function c(g,y,C){const E=[];let B;for(;(B=g.exec(C))!==null;)E.push({data:B[0],index:B.index,mode:y,length:B[0].length});return E}function h(g){const y=c(o.NUMERIC,t.NUMERIC,g),C=c(o.ALPHANUMERIC,t.ALPHANUMERIC,g);let E,B;return A.isKanjiModeEnabled()?(E=c(o.BYTE,t.BYTE,g),B=c(o.KANJI,t.KANJI,g)):(E=c(o.BYTE_KANJI,t.BYTE,g),B=[]),y.concat(C,E,B).sort(function(R,k){return R.index-k.index}).map(function(R){return{data:R.data,mode:R.mode,length:R.length}})}function u(g,y){switch(y){case t.NUMERIC:return e.getBitsLength(g);case t.ALPHANUMERIC:return i.getBitsLength(g);case t.KANJI:return r.getBitsLength(g);case t.BYTE:return s.getBitsLength(g)}}function f(g){return g.reduce(function(y,C){const E=y.length-1>=0?y[y.length-1]:null;return E&&E.mode===C.mode?(y[y.length-1].data+=C.data,y):(y.push(C),y)},[])}function m(g){const y=[];for(let C=0;C<g.length;C++){const E=g[C];switch(E.mode){case t.NUMERIC:y.push([E,{data:E.data,mode:t.ALPHANUMERIC,length:E.length},{data:E.data,mode:t.BYTE,length:E.length}]);break;case t.ALPHANUMERIC:y.push([E,{data:E.data,mode:t.BYTE,length:E.length}]);break;case t.KANJI:y.push([E,{data:E.data,mode:t.BYTE,length:l(E.data)}]);break;case t.BYTE:y.push([{data:E.data,mode:t.BYTE,length:l(E.data)}])}}return y}function d(g,y){const C={},E={start:{}};let B=["start"];for(let x=0;x<g.length;x++){const R=g[x],k=[];for(let F=0;F<R.length;F++){const N=R[F],D=""+x+F;k.push(D),C[D]={node:N,lastCount:0},E[D]={};for(let w=0;w<B.length;w++){const I=B[w];C[I]&&C[I].node.mode===N.mode?(E[I][D]=u(C[I].lastCount+N.length,N.mode)-u(C[I].lastCount,N.mode),C[I].lastCount+=N.length):(C[I]&&(C[I].lastCount=N.length),E[I][D]=u(N.length,N.mode)+4+t.getCharCountIndicator(N.mode,y))}}B=k}for(let x=0;x<B.length;x++)E[B[x]].end=0;return{map:E,table:C}}function p(g,y){let C;const E=t.getBestModeForData(g);if(C=t.from(y,E),C!==t.BYTE&&C.bit<E.bit)throw new Error('"'+g+'" cannot be encoded with mode '+t.toString(C)+`.
 Suggested mode is: `+t.toString(E));switch(C===t.KANJI&&!A.isKanjiModeEnabled()&&(C=t.BYTE),C){case t.NUMERIC:return new e(g);case t.ALPHANUMERIC:return new i(g);case t.KANJI:return new r(g);case t.BYTE:return new s(g)}}n.fromArray=function(y){return y.reduce(function(C,E){return typeof E=="string"?C.push(p(E,null)):E.data&&C.push(p(E.data,E.mode)),C},[])},n.fromString=function(y,C){const E=h(y,A.isKanjiModeEnabled()),B=m(E),x=d(B,C),R=a.find_path(x.map,"start","end"),k=[];for(let F=1;F<R.length-1;F++)k.push(x.table[R[F]].node);return n.fromArray(f(k))},n.rawSplit=function(y){return n.fromArray(h(y,A.isKanjiModeEnabled()))}})(xA);const zn=it,hi=Hn,$h=Dh,tu=Mh,eu=pA,nu=mA,Li=wA,Fi=Jn,iu=Ph,Nn=EA,su=CA,ru=Lt,ui=xA;function ou(n,t){const e=n.size,i=nu.getPositions(t);for(let s=0;s<i.length;s++){const r=i[s][0],o=i[s][1];for(let A=-1;A<=7;A++)if(!(r+A<=-1||e<=r+A))for(let a=-1;a<=7;a++)o+a<=-1||e<=o+a||(A>=0&&A<=6&&(a===0||a===6)||a>=0&&a<=6&&(A===0||A===6)||A>=2&&A<=4&&a>=2&&a<=4?n.set(r+A,o+a,!0,!0):n.set(r+A,o+a,!1,!0))}}function Au(n){const t=n.size;for(let e=8;e<t-8;e++){const i=e%2===0;n.set(e,6,i,!0),n.set(6,e,i,!0)}}function au(n,t){const e=eu.getPositions(t);for(let i=0;i<e.length;i++){const s=e[i][0],r=e[i][1];for(let o=-2;o<=2;o++)for(let A=-2;A<=2;A++)o===-2||o===2||A===-2||A===2||o===0&&A===0?n.set(s+o,r+A,!0,!0):n.set(s+o,r+A,!1,!0)}}function lu(n,t){const e=n.size,i=Nn.getEncodedBits(t);let s,r,o;for(let A=0;A<18;A++)s=Math.floor(A/3),r=A%3+e-8-3,o=(i>>A&1)===1,n.set(s,r,o,!0),n.set(r,s,o,!0)}function di(n,t,e){const i=n.size,s=su.getEncodedBits(t,e);let r,o;for(r=0;r<15;r++)o=(s>>r&1)===1,r<6?n.set(r,8,o,!0):r<8?n.set(r+1,8,o,!0):n.set(i-15+r,8,o,!0),r<8?n.set(8,i-r-1,o,!0):r<9?n.set(8,15-r-1+1,o,!0):n.set(8,15-r-1,o,!0);n.set(i-8,8,1,!0)}function cu(n,t){const e=n.size;let i=-1,s=e-1,r=7,o=0;for(let A=e-1;A>0;A-=2)for(A===6&&A--;;){for(let a=0;a<2;a++)if(!n.isReserved(s,A-a)){let l=!1;o<t.length&&(l=(t[o]>>>r&1)===1),n.set(s,A-a,l),r--,r===-1&&(o++,r=7)}if(s+=i,s<0||e<=s){s-=i,i=-i;break}}}function hu(n,t,e){const i=new $h;e.forEach(function(a){i.put(a.mode.bit,4),i.put(a.getLength(),ru.getCharCountIndicator(a.mode,n)),a.write(i)});const s=zn.getSymbolTotalCodewords(n),r=Fi.getTotalCodewordsCount(n,t),o=(s-r)*8;for(i.getLengthInBits()+4<=o&&i.put(0,4);i.getLengthInBits()%8!==0;)i.putBit(0);const A=(o-i.getLengthInBits())/8;for(let a=0;a<A;a++)i.put(a%2?17:236,8);return uu(i,n,t)}function uu(n,t,e){const i=zn.getSymbolTotalCodewords(t),s=Fi.getTotalCodewordsCount(t,e),r=i-s,o=Fi.getBlocksCount(t,e),A=i%o,a=o-A,l=Math.floor(i/o),c=Math.floor(r/o),h=c+1,u=l-c,f=new iu(u);let m=0;const d=new Array(o),p=new Array(o);let g=0;const y=new Uint8Array(n.buffer);for(let R=0;R<o;R++){const k=R<a?c:h;d[R]=y.slice(m,m+k),p[R]=f.encode(d[R]),m+=k,g=Math.max(g,k)}const C=new Uint8Array(i);let E=0,B,x;for(B=0;B<g;B++)for(x=0;x<o;x++)B<d[x].length&&(C[E++]=d[x][B]);for(B=0;B<u;B++)for(x=0;x<o;x++)C[E++]=p[x][B];return C}function du(n,t,e,i){let s;if(Array.isArray(n))s=ui.fromArray(n);else if(typeof n=="string"){let l=t;if(!l){const c=ui.rawSplit(n);l=Nn.getBestVersionForData(c,e)}s=ui.fromString(n,l||40)}else throw new Error("Invalid data");const r=Nn.getBestVersionForData(s,e);if(!r)throw new Error("The amount of data is too big to be stored in a QR Code");if(!t)t=r;else if(t<r)throw new Error(`
The chosen QR Code version cannot contain this amount of data.
Minimum version required to store current data is: `+r+`.
`);const o=hu(t,e,s),A=zn.getSymbolSize(t),a=new tu(A);return ou(a,t),Au(a),au(a,t),di(a,e,0),t>=7&&lu(a,t),cu(a,o),isNaN(i)&&(i=Li.getBestMask(a,di.bind(null,a,e))),Li.applyMask(i,a),di(a,e,i),{modules:a,version:t,errorCorrectionLevel:e,maskPattern:i,segments:s}}fA.create=function(t,e){if(typeof t>"u"||t==="")throw new Error("No input text");let i=hi.M,s,r;return typeof e<"u"&&(i=hi.from(e.errorCorrectionLevel,hi.M),s=Nn.from(e.version),r=Li.from(e.maskPattern),e.toSJISFunc&&zn.setToSJISFunction(e.toSJISFunc)),du(t,s,i,r)};var BA={},bs={};(function(n){function t(e){if(typeof e=="number"&&(e=e.toString()),typeof e!="string")throw new Error("Color should be defined as hex string");let i=e.slice().replace("#","").split("");if(i.length<3||i.length===5||i.length>8)throw new Error("Invalid hex color: "+e);(i.length===3||i.length===4)&&(i=Array.prototype.concat.apply([],i.map(function(r){return[r,r]}))),i.length===6&&i.push("F","F");const s=parseInt(i.join(""),16);return{r:s>>24&255,g:s>>16&255,b:s>>8&255,a:s&255,hex:"#"+i.slice(0,6).join("")}}n.getOptions=function(i){i||(i={}),i.color||(i.color={});const s=typeof i.margin>"u"||i.margin===null||i.margin<0?4:i.margin,r=i.width&&i.width>=21?i.width:void 0,o=i.scale||4;return{width:r,scale:r?4:o,margin:s,color:{dark:t(i.color.dark||"#000000ff"),light:t(i.color.light||"#ffffffff")},type:i.type,rendererOpts:i.rendererOpts||{}}},n.getScale=function(i,s){return s.width&&s.width>=i+s.margin*2?s.width/(i+s.margin*2):s.scale},n.getImageWidth=function(i,s){const r=n.getScale(i,s);return Math.floor((i+s.margin*2)*r)},n.qrToImageData=function(i,s,r){const o=s.modules.size,A=s.modules.data,a=n.getScale(o,r),l=Math.floor((o+r.margin*2)*a),c=r.margin*a,h=[r.color.light,r.color.dark];for(let u=0;u<l;u++)for(let f=0;f<l;f++){let m=(u*l+f)*4,d=r.color.light;if(u>=c&&f>=c&&u<l-c&&f<l-c){const p=Math.floor((u-c)/a),g=Math.floor((f-c)/a);d=h[A[p*o+g]?1:0]}i[m++]=d.r,i[m++]=d.g,i[m++]=d.b,i[m]=d.a}}})(bs);(function(n){const t=bs;function e(s,r,o){s.clearRect(0,0,r.width,r.height),r.style||(r.style={}),r.height=o,r.width=o,r.style.height=o+"px",r.style.width=o+"px"}function i(){try{return document.createElement("canvas")}catch{throw new Error("You need to specify a canvas element")}}n.render=function(r,o,A){let a=A,l=o;typeof a>"u"&&(!o||!o.getContext)&&(a=o,o=void 0),o||(l=i()),a=t.getOptions(a);const c=t.getImageWidth(r.modules.size,a),h=l.getContext("2d"),u=h.createImageData(c,c);return t.qrToImageData(u.data,r,a),e(h,l,c),h.putImageData(u,0,0),l},n.renderToDataURL=function(r,o,A){let a=A;typeof a>"u"&&(!o||!o.getContext)&&(a=o,o=void 0),a||(a={});const l=n.render(r,o,a),c=a.type||"image/png",h=a.rendererOpts||{};return l.toDataURL(c,h.quality)}})(BA);var TA={};const fu=bs;function _r(n,t){const e=n.a/255,i=t+'="'+n.hex+'"';return e<1?i+" "+t+'-opacity="'+e.toFixed(2).slice(1)+'"':i}function fi(n,t,e){let i=n+t;return typeof e<"u"&&(i+=" "+e),i}function gu(n,t,e){let i="",s=0,r=!1,o=0;for(let A=0;A<n.length;A++){const a=Math.floor(A%t),l=Math.floor(A/t);!a&&!r&&(r=!0),n[A]?(o++,A>0&&a>0&&n[A-1]||(i+=r?fi("M",a+e,.5+l+e):fi("m",s,0),s=0,r=!1),a+1<t&&n[A+1]||(i+=fi("h",o),o=0)):s++}return i}TA.render=function(t,e,i){const s=fu.getOptions(e),r=t.modules.size,o=t.modules.data,A=r+s.margin*2,a=s.color.light.a?"<path "+_r(s.color.light,"fill")+' d="M0 0h'+A+"v"+A+'H0z"/>':"",l="<path "+_r(s.color.dark,"stroke")+' d="'+gu(o,r,s.margin)+'"/>',c='viewBox="0 0 '+A+" "+A+'"',u='<svg xmlns="http://www.w3.org/2000/svg" '+(s.width?'width="'+s.width+'" height="'+s.width+'" ':"")+c+' shape-rendering="crispEdges">'+a+l+`</svg>
`;return typeof i=="function"&&i(null,u),u};const pu=kh,Ui=fA,RA=BA,mu=TA;function Cs(n,t,e,i,s){const r=[].slice.call(arguments,1),o=r.length,A=typeof r[o-1]=="function";if(!A&&!pu())throw new Error("Callback required as last argument");if(A){if(o<2)throw new Error("Too few arguments provided");o===2?(s=e,e=t,t=i=void 0):o===3&&(t.getContext&&typeof s>"u"?(s=i,i=void 0):(s=i,i=e,e=t,t=void 0))}else{if(o<1)throw new Error("Too few arguments provided");return o===1?(e=t,t=i=void 0):o===2&&!t.getContext&&(i=e,e=t,t=void 0),new Promise(function(a,l){try{const c=Ui.create(e,i);a(n(c,t,i))}catch(c){l(c)}})}try{const a=Ui.create(e,i);s(null,n(a,t,i))}catch(a){s(a)}}$e.create=Ui.create;$e.toCanvas=Cs.bind(null,RA.render);$e.toDataURL=Cs.bind(null,RA.renderToDataURL);$e.toString=Cs.bind(null,function(n,t,e){return mu.render(n,e)});var wu={webm:"data:video/webm;base64,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",mp4:"data:video/mp4;base64,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"};const{webm:_u,mp4:yu}=wu,gi=()=>typeof navigator<"u"&&parseFloat((""+(/CPU.*OS ([0-9_]{3,4})[0-9_]{0,1}|(CPU like).*AppleWebKit.*Mobile/i.exec(navigator.userAgent)||[0,""])[1]).replace("undefined","3_2").replace("_",".").replace("_",""))<10&&!window.MSStream,pi=()=>"wakeLock"in navigator;class Eu{constructor(){if(this.enabled=!1,pi()){this._wakeLock=null;const t=()=>{this._wakeLock!==null&&document.visibilityState==="visible"&&this.enable()};document.addEventListener("visibilitychange",t),document.addEventListener("fullscreenchange",t)}else gi()?this.noSleepTimer=null:(this.noSleepVideo=document.createElement("video"),this.noSleepVideo.setAttribute("title","No Sleep"),this.noSleepVideo.setAttribute("playsinline",""),this._addSourceToVideo(this.noSleepVideo,"webm",_u),this._addSourceToVideo(this.noSleepVideo,"mp4",yu),this.noSleepVideo.addEventListener("loadedmetadata",()=>{this.noSleepVideo.duration<=1?this.noSleepVideo.setAttribute("loop",""):this.noSleepVideo.addEventListener("timeupdate",()=>{this.noSleepVideo.currentTime>.5&&(this.noSleepVideo.currentTime=Math.random())})}))}_addSourceToVideo(t,e,i){var s=document.createElement("source");s.src=i,s.type=`video/${e}`,t.appendChild(s)}get isEnabled(){return this.enabled}enable(){return pi()?navigator.wakeLock.request("screen").then(t=>{this._wakeLock=t,this.enabled=!0,console.log("Wake Lock active."),this._wakeLock.addEventListener("release",()=>{console.log("Wake Lock released.")})}).catch(t=>{throw this.enabled=!1,console.error(`${t.name}, ${t.message}`),t}):gi()?(this.disable(),console.warn(`
        NoSleep enabled for older iOS devices. This can interrupt
        active or long-running network requests from completing successfully.
        See https://github.com/richtr/NoSleep.js/issues/15 for more details.
      `),this.noSleepTimer=window.setInterval(()=>{document.hidden||(window.location.href=window.location.href.split("#")[0],window.setTimeout(window.stop,0))},15e3),this.enabled=!0,Promise.resolve()):this.noSleepVideo.play().then(e=>(this.enabled=!0,e)).catch(e=>{throw this.enabled=!1,e})}disable(){pi()?(this._wakeLock&&this._wakeLock.release(),this._wakeLock=null):gi()?this.noSleepTimer&&(console.warn(`
          NoSleep now disabled for older iOS devices.
        `),window.clearInterval(this.noSleepTimer),this.noSleepTimer=null):this.noSleepVideo.pause(),this.enabled=!1}}var bu=Eu;const Cu=os(bu),Su="/gifshooter/assets/01.28-D_5FERI8.png",xu="/gifshooter/assets/05.36-_eu3nG-w.png",Iu="/gifshooter/assets/06.36-D3z7LYyo.png",Bu="/gifshooter/assets/07.47-DsOIyi-K.png",Tu="/gifshooter/assets/08.39-CNuNs_2G.png",Ru="/gifshooter/assets/09.41-CKuFrfe7.png",vu="/gifshooter/assets/10.39-CrAvx7-w.png",ku="/gifshooter/assets/11.39-BW9zh7wN.png",Nu="/gifshooter/assets/12.20-CAw2TaEM.png",Du="/gifshooter/assets/13.20-BPVeinxW.png",Mu="/gifshooter/assets/14.20-DkzKJ_7Y.png",Ou="/gifshooter/assets/15.72-BoZDKdHb.png",Pu="/gifshooter/assets/16.12-DS5LuWek.png",Lu="/gifshooter/assets/17.36-DsyJH88H.png",Fu="/gifshooter/assets/18.27-CwnGWTS2.png",Uu="/gifshooter/assets/19.65-Pj4urRsn.png",Qu="/gifshooter/assets/20.28-BM0OmUHP.png",Yu="/gifshooter/assets/21.113-BrCgOvVW.png",Vu="/gifshooter/assets/22.45-DaoYFX6r.png",Gu="/gifshooter/assets/23.11-DWDKVGwL.png",qu="/gifshooter/assets/24.125-zARE9kV6.png",Zu="/gifshooter/assets/25.120-DfooVmdR.png",Wu="/gifshooter/assets/26.73-5rTYzTh5.png",Hu="/gifshooter/assets/27.121-DxQwWftk.png",Ju="/gifshooter/assets/28.31-Dx2fKfsy.png",Xu="/gifshooter/assets/29.123-b5iwxTxq.png",zu="/gifshooter/assets/30.29-Dnv3f22k.png",ju="/gifshooter/assets/31.90-ZB3oXSRJ.png",Ku="/gifshooter/assets/32.147-KdGRWNAE.png",$u="/gifshooter/assets/32.17-Bwo-nrFe.png",td="/gifshooter/assets/logo-BQwxMYjs.gif";var ed=new Cu;let{init:yr,Sprite:nd,SpriteSheet:id,keyPressed:sd,GameLoop:Er,initKeys:rd,pointerPressed:od,onInput:Cd,initPointer:Ad,getPointer:ad}=La,le=[];const vA=new URLSearchParams(window.location.search);let Ot=vA.get("room")||"notinitialized";console.log(Ot);let _n=vA.get("present")=="true";var ld=document.getElementById("qr");$e.toCanvas(ld,window.location.href.split("?")[0]+`?room=${Ot}`,function(n){n&&console.error(n),console.log("success!")});const cd=()=>(window.open(window.location.href.split("?")[0],"_self"),!1),hd=()=>(Ot=document.getElementById("room").value,_n=document.getElementById("present").checked,console.log(_n),window.open(window.location.href.split("?")[0]+`?room=${Ot}&present=${_n}`,"_self"),!1);let Dn=0;const ud={appId:"gifshootah"},Te=Rh(ud,Ot);Te.onPeerJoin(n=>{Dn+=1,document.getElementById("online").textContent=`${Dn} peers`});Te.onPeerLeave(n=>{Dn-=1,document.getElementById("online").textContent=`${Dn} peers`});const[br,dd]=Te.makeAction("shoot");dd((n,t)=>{le.push(n)});Ot&&Ot!="notinitialized"?(document.getElementById("setting").style.display="none",document.getElementById("home").style.display="block",document.getElementById("home").onclick=cd):document.getElementById("go").onclick=hd;const cn={};let hn=0;const mi=[];document.getElementById("logo").src=td;const xt=[Su,xu,Iu,Bu,Tu,Ru,vu,ku,Nu,Du,Mu,Ou,Pu,Lu,Fu,Uu,Qu,Yu,Vu,Gu,qu,Zu,Wu,Hu,Ju,Xu,zu,ju,Ku,$u];let gt=Object.keys(Te.getPeers()).length%xt.length;const fd=n=>{var t=n.split("."),e=parseInt(t[t.length-2]);return new Promise(function(i,s){if(cn[n])return i(cn[n]);{let r=new Image;r.src=n,r.onload=function(){let o=id({image:r,frameWidth:r.width/e,frameHeight:r.height,animations:{walk:{frames:`0..${e-1}`,frameRate:15}}});return cn[n]=o,i(cn[n])}}})};let Tt={};const Cr=async(n,t)=>{if(Tt[n]&&Tt[n].url==t)return Tt[n].sprite;let e=await fd(t),i=nd({x:-1e3,y:-1e3,dx:0,dy:0,ddx:0,ddy:0,anchor:{x:.5,y:.5},animations:e.animations});return Tt[n]={url:t,sprite:i},i};if(_n){let{canvas:n,context:t}=yr("game");Ad(),rd();let e=document.getElementById("qr");e.style.display="block",n.width=window.innerWidth,n.height=window.innerHeight;for(let r=0;r<120;r++){const o=new OffscreenCanvas(n.width,n.height);mi.push(o)}let i=0;Er({clearCanvas:!0,update:function(){if(le.length){const r=le[0];le=le.slice(1),i=xt.length,Cr(r.peerId,xt[r.spriteUrlIndex]).then(o=>{console.log("raw",r),o.x=r.x*-1*t.canvas.width+t.canvas.width/2,o.y=r.y*-1*t.canvas.height+t.canvas.height/2,console.log(o.x,o.y)})}if(sd("enter")&&(gt=(gt+1)%xt.length),od("left")){let r=ad();const o={spriteUrlIndex:gt,peerId:Te.selfId,x:r.x/t.canvas.width,y:r.ycontext.canvas.height};br(o),le.push(o)}for(let r of Object.keys(Tt))Tt[r].sprite.update()},render:function(){hn++,hn=hn%mi.length;let r=mi[hn];if(i>0){let o=r.getContext("2d");o.globalAlpha=.01,o.fillRect(0,0,r.width,r.height),o.globalAlpha=1,i-=1}t.drawImage(r,0,0);for(let o of Object.keys(Tt))Tt[o].sprite.render();r.getContext("2d").drawImage(n,0,0)}}).start()}else if(Ot!="notinitialized"){document.getElementById("phone").style.display="block";let n,t;document.getElementById("reset").onclick=()=>{n=null,t=null};let e,{canvasShoot:i,contextShoot:s}=yr("shootbutton"),r=document.getElementById("shootbutton"),o=document.getElementById("expand");r.width=o.clientWidth,r.height=o.clientHeight,console.log(i,s,"canvas"),document.getElementById("nextgif").onclick=()=>{gt=(gt+1)%xt.length},document.getElementById("previousgif").onclick=()=>{gt=(gt+xt.length-1)%xt.length};let A=!1;r.ontouchstart=()=>{ed.enable(),A=!0},r.ontouchend=()=>{A=!1},window.addEventListener("deviceorientation",async l=>{n||(n=l.alpha,t=l.beta);var c=l.alpha-n,h=l.beta-t;if(c<-180&&(c=-180),c>180&&(c=180),h<-90&&(h=-90),h>90&&(h=90),c=c/180,h=h/90,A){const u={spriteUrlIndex:gt,peerId:Te.selfId,x:c,alpha:l.alpha,y:h,beta:l.beta};console.log(u),br(u)}}),Er({clearCanvas:!0,update:function(){Cr("preview",xt[gt]).then(l=>{l.x=r.width/3+r.width/6,l.y=r.height/2,l.width=o.clientWidth/2,l.height=o.clientHeight/2,e=l}),e&&e.update()},render:function(){e&&e.render()}}).start()}
