var Na=Object.defineProperty;var Ba=(n,t,e)=>t in n?Na(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var xs=(n,t,e)=>Ba(n,typeof t!="symbol"?t+"":t,e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function e(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(s){if(s.ep)return;s.ep=!0;const r=e(s);fetch(s.href,r)}})();/**
 * @preserve
 * Kontra.js v10.0.2
 */function Pa(n){return n*Math.PI/180}function ka(n){return n*180/Math.PI}function La(n,t){return Math.atan2(t.y-n.y,t.x-n.x)}function xr(n,t){let e=Math.sin(t),i=Math.cos(t);return{x:n.x*i-n.y*e,y:n.x*e+n.y*i}}function Da(n,t,e){return{x:n.x+Math.cos(t)*e,y:n.y+Math.sin(t)*e}}function Oa(n,t,e){return n*(1-e)+t*e}function Ma(n,t,e){return(e-n)/(t-n)}function pe(n,t,e){return Math.min(Math.max(n,e),t)}function Ua(n,t){t==null?localStorage.removeItem(n):localStorage.setItem(n,JSON.stringify(t))}function Fa(n){let t=localStorage.getItem(n);try{t=JSON.parse(t)}catch{}return t}function Sr(n,t){let e=_e(n),i=_e(t);return n.radius&&e.width!=e.height||t.radius&&i.width!=i.height?!1:([e,i]=[e,i].map(s=>((s==e?n:t).radius&&(s.radius=s.width/2,s.x+=s.radius,s.y+=s.radius),s)),n.radius&&t.radius?Math.hypot(e.x-i.x,e.y-i.y)<e.radius+i.radius:n.radius||t.radius?Ar(n.radius?e:i,n.radius?t:n):e.x<i.x+i.width&&e.x+e.width>i.x&&e.y<i.y+i.height&&e.y+e.height>i.y)}function _e(n){let{x:t=0,y:e=0,width:i,height:s,radius:r}=n.world||n;return n.mapwidth&&(i=n.mapwidth,s=n.mapheight),r&&(i=r.x*2,s=r.y*2),n.anchor&&(t-=i*n.anchor.x,e-=s*n.anchor.y),i<0&&(t+=i,i*=-1),s<0&&(e+=s,s*=-1),{x:t,y:e,width:i,height:s}}function $a(n,t,e="y"){return[n,t]=[n,t].map(_e),n[e]-t[e]}let Zt=()=>{},Cr="position:absolute;width:1px;height:1px;overflow:hidden;clip:rect(0,0,0,0);",mi={preventScroll:!0};function wi(n,t){let e=t.parentNode;n.setAttribute("data-kontra",""),e?([...e.querySelectorAll(":scope > [data-kontra]")].pop()||t).after(n):t.nodeName=="CANVAS"?document.body.append(n):t.append(n)}function me(n,t){let e=n.indexOf(t);if(e!=-1)return n.splice(e,1),!0}function Ar(n,t){let{x:e,y:i,width:s,height:r}=_e(t);do e-=t.sx||0,i-=t.sy||0;while(t=t.parent);let o=n.x-Math.max(e,Math.min(n.x,e+s)),a=n.y-Math.max(i,Math.min(n.y,i+r));return o*o+a*a<n.radius*n.radius}let he={};function ft(n,t){he[n]=he[n]||[],he[n].push(t)}function Tr(n,t){he[n]=(he[n]||[]).filter(e=>e!=t)}function Pt(n,...t){(he[n]||[]).map(e=>e(...t))}let Ht,dn,Ss={get(n,t){return t=="_proxy"?!0:Zt}};function ct(){return Ht}function at(){return dn}function Ha(n,{contextless:t=!1}={}){if(Ht=document.getElementById(n)||n||document.querySelector("canvas"),t&&(Ht=Ht||new Proxy({},Ss)),!Ht)throw Error("You must provide a canvas element for the game");return dn=Ht.getContext("2d")||new Proxy({},Ss),dn.imageSmoothingEnabled=!1,Pt("init"),{canvas:Ht,context:dn}}class Dn{constructor({spriteSheet:t,frames:e,frameRate:i,loop:s=!0,name:r}){let{width:o,height:a,spacing:l=0,margin:h=0}=t.frame;Object.assign(this,{spriteSheet:t,frames:e,frameRate:i,loop:s,name:r,width:o,height:a,spacing:l,margin:h,isStopped:!1,_f:0,_a:0})}clone(){return new Dn(this)}start(){this.isStopped=!1,this.loop||this.reset()}stop(){this.isStopped=!0}reset(){this._f=0,this._a=0}update(t=1/60){if(!this.isStopped){if(!this.loop&&this._f==this.frames.length-1){this.stop();return}for(this._a+=t;this._a*this.frameRate>=1;)this._f=++this._f%this.frames.length,this._a-=1/this.frameRate}}render({x:t,y:e,width:i=this.width,height:s=this.height,context:r=at()}){let o=this.frames[this._f]/this.spriteSheet._f|0,a=this.frames[this._f]%this.spriteSheet._f|0;r.drawImage(this.spriteSheet.image,this.margin+a*this.width+(a*2+1)*this.spacing,this.margin+o*this.height+(o*2+1)*this.spacing,this.width,this.height,t,e,i,s)}}function vr(){return new Dn(...arguments)}let qa=/(jpeg|jpg|gif|png|webp)$/,za=/(wav|mp3|ogg|aac)$/,Ir=/^\//,Ya=/\/$/,Rr=new WeakMap,Nr="",Br="",Pr="";function On(n,t){return new URL(n,t).href}function Fi(n,t){return[n.replace(Ya,""),n?t.replace(Ir,""):t].filter(e=>e).join("/")}function $i(n){return n.split(".").pop()}function Hi(n){let t=n.replace("."+$i(n),"");return t.split("/").length==2?t.replace(Ir,""):t}function Wa(n){return{wav:n.canPlayType('audio/wav; codecs="1"'),mp3:n.canPlayType("audio/mpeg;"),ogg:n.canPlayType('audio/ogg; codecs="vorbis"'),aac:n.canPlayType("audio/aac;")}}let Yt={},ae={},Wt={};function qi(){window.__k||(window.__k={dm:Rr,u:On,d:Wt,i:Yt})}function ja(n){Nr=n}function Ga(n){Br=n}function Ka(n){Pr=n}function kr(n){return qi(),new Promise((t,e)=>{let i,s,r;if(i=Fi(Nr,n),Yt[i])return t(Yt[i]);s=new Image,s.onload=function(){r=On(i,window.location.href),Yt[Hi(n)]=Yt[i]=Yt[r]=this,Pt("assetLoaded",this,n),t(this)},s.onerror=function(){e("Unable to load image "+i)},s.src=i})}function Lr(n){return new Promise((t,e)=>{let i=n,s,r,o,a;if(s=new Audio,r=Wa(s),n=[].concat(n).reduce((l,h)=>l||(r[$i(h)]?h:null),0),!n)return e("cannot play any of the audio formats provided "+i);if(o=Fi(Br,n),ae[o])return t(ae[o]);s.addEventListener("canplay",function(){a=On(o,window.location.href),ae[Hi(n)]=ae[o]=ae[a]=this,Pt("assetLoaded",this,n),t(this)}),s.onerror=function(){e("Unable to load audio "+o)},s.src=o,s.load()})}function Dr(n){qi();let t,e;return t=Fi(Pr,n),Wt[t]?Promise.resolve(Wt[t]):fetch(t).then(i=>{if(!i.ok)throw i;return i.clone().json().catch(()=>i.text())}).then(i=>(e=On(t,window.location.href),typeof i=="object"&&Rr.set(i,e),Wt[Hi(n)]=Wt[t]=Wt[e]=i,Pt("assetLoaded",i,n),i))}function Va(...n){return qi(),Promise.all(n.map(t=>{let e=$i([].concat(t)[0]);return e.match(qa)?kr(t):e.match(za)?Lr(t):Dr(t)}))}class Gt{constructor(t=0,e=0,i={}){t.x!=null?(this.x=t.x,this.y=t.y):(this.x=t,this.y=e),i._c&&(this.clamp(i._a,i._b,i._d,i._e),this.x=t,this.y=e)}set(t){this.x=t.x,this.y=t.y}add(t){return new Gt(this.x+t.x,this.y+t.y,this)}subtract(t){return new Gt(this.x-t.x,this.y-t.y,this)}scale(t){return new Gt(this.x*t,this.y*t)}normalize(t=this.length()||1){return new Gt(this.x/t,this.y/t)}dot(t){return this.x*t.x+this.y*t.y}length(){return Math.hypot(this.x,this.y)}distance(t){return Math.hypot(this.x-t.x,this.y-t.y)}angle(t){return Math.acos(this.dot(t)/(this.length()*t.length()))}direction(){return Math.atan2(this.y,this.x)}clamp(t,e,i,s){this._c=!0,this._a=t,this._b=e,this._d=i,this._e=s}get x(){return this._x}get y(){return this._y}set x(t){this._x=this._c?pe(this._a,this._d,t):t}set y(t){this._y=this._c?pe(this._b,this._e,t):t}}function fn(){return new Gt(...arguments)}class Za{constructor(t){return this.init(t)}init(t={}){this.position=fn(),this.velocity=fn(),this.acceleration=fn(),this.ttl=1/0,Object.assign(this,t)}update(t){this.advance(t)}advance(t){let e=this.acceleration;t&&(e=e.scale(t)),this.velocity=this.velocity.add(e);let i=this.velocity;t&&(i=i.scale(t)),this.position=this.position.add(i),this._pc(),this.ttl--}get dx(){return this.velocity.x}get dy(){return this.velocity.y}set dx(t){this.velocity.x=t}set dy(t){this.velocity.y=t}get ddx(){return this.acceleration.x}get ddy(){return this.acceleration.y}set ddx(t){this.acceleration.x=t}set ddy(t){this.acceleration.y=t}isAlive(){return this.ttl>0}_pc(){}}class Re extends Za{init({width:t=0,height:e=0,context:i=at(),render:s=this.draw,update:r=this.advance,children:o=[],anchor:a={x:0,y:0},opacity:l=1,rotation:h=0,drotation:u=0,ddrotation:d=0,scaleX:f=1,scaleY:p=1,...w}={}){this._c=[],super.init({width:t,height:e,context:i,anchor:a,opacity:l,rotation:h,drotation:u,ddrotation:d,scaleX:f,scaleY:p,...w}),this._di=!0,this._uw(),this.addChild(o),this._rf=s,this._uf=r,ft("init",()=>{this.context??(this.context=at())})}update(t){this._uf(t),this.children.map(e=>e.update&&e.update(t))}render(){let t=this.context;t.save(),(this.x||this.y)&&t.translate(this.x,this.y),this.rotation&&t.rotate(this.rotation),(this.scaleX!=1||this.scaleY!=1)&&t.scale(this.scaleX,this.scaleY);let e=this.width,i=this.height;this.radius&&(e=i=this.radius*2);let s=-e*this.anchor.x,r=-i*this.anchor.y;(s||r)&&t.translate(s,r),this.context.globalAlpha=this.opacity,this._rf(),(s||r)&&t.translate(-s,-r),this.children.map(a=>a.render&&a.render()),t.restore()}draw(){}_pc(){this._uw(),this.children.map(t=>t._pc())}get x(){return this.position.x}get y(){return this.position.y}set x(t){this.position.x=t,this._pc()}set y(t){this.position.y=t,this._pc()}get width(){return this._w}set width(t){this._w=t,this._pc()}get height(){return this._h}set height(t){this._h=t,this._pc()}_uw(){if(!this._di)return;let{_wx:t=0,_wy:e=0,_wo:i=1,_wrot:s=0,_wsx:r=1,_wsy:o=1}=this.parent||{};this._wx=this.x,this._wy=this.y,this._ww=this.width,this._wh=this.height,this.radius&&(this._wrx=this.radius,this._wry=this.radius),this._wo=i*this.opacity,this._wsx=r*this.scaleX,this._wsy=o*this.scaleY,this._wx=this._wx*r,this._wy=this._wy*o,this._ww=this.width*this._wsx,this._wh=this.height*this._wsy,this.radius&&(this._wrx=this.radius*this._wsx,this._wry=this.radius*this._wsy),this._wrot=s+this.rotation;let{x:a,y:l}=xr({x:this._wx,y:this._wy},s);this._wx=a,this._wy=l,this._wx+=t,this._wy+=e}get world(){return{x:this._wx,y:this._wy,width:this._ww,height:this._wh,radius:this.radius?{x:this._wrx,y:this._wry}:void 0,opacity:this._wo,rotation:this._wrot,scaleX:this._wsx,scaleY:this._wsy}}set children(t){this.removeChild(this._c),this.addChild(t)}get children(){return this._c}addChild(...t){t.flat().map(e=>{this.children.push(e),e.parent=this,e._pc=e._pc||Zt,e._pc()})}removeChild(...t){t.flat().map(e=>{me(this.children,e)&&(e.parent=null,e._pc())})}get radius(){return this._r}set radius(t){this._r=t,this._pc()}get opacity(){return this._opa}set opacity(t){this._opa=pe(0,1,t),this._pc()}get rotation(){return this._rot}set rotation(t){this._rot=t,this._pc()}advance(t){super.advance(t),this.drotation+=this.ddrotation,this.rotation+=this.drotation}setScale(t,e=t){this.scaleX=t,this.scaleY=e}get scaleX(){return this._scx}set scaleX(t){this._scx=t,this._pc()}get scaleY(){return this._scy}set scaleY(t){this._scy=t,this._pc()}}function Ja(){return new Re(...arguments)}let zi=class extends Re{init({image:t,width:e=t?t.width:void 0,height:i=t?t.height:void 0,...s}={}){super.init({image:t,width:e,height:i,...s})}get animations(){return this._a}set animations(t){let e,i;this._a={};for(e in t)this._a[e]=t[e].clone(),i=i||this._a[e];this.currentAnimation=i,this.width=this.width||i.width,this.height=this.height||i.height}playAnimation(t){var e;(e=this.currentAnimation)==null||e.stop(),this.currentAnimation=this.animations[t],this.currentAnimation.start()}advance(t){var e;super.advance(t),(e=this.currentAnimation)==null||e.update(t)}draw(){if(this.image&&this.context.drawImage(this.image,0,0,this.image.width,this.image.height),this.currentAnimation&&this.currentAnimation.render({x:0,y:0,width:this.width,height:this.height,context:this.context}),this.color){if(this.context.fillStyle=this.color,this.radius){this.context.beginPath(),this.context.arc(this.radius,this.radius,this.radius,0,Math.PI*2),this.context.fill();return}this.context.fillRect(0,0,this.width,this.height)}}};function Xa(){return new zi(...arguments)}let Qa=/(\d+)(\w+)/;function tl(n){if(!n)return{computed:0};let t=n.match(Qa),e=+t[1],i=t[2];return{size:e,unit:i,computed:e}}class Or extends Re{init({text:t="",textAlign:e="",lineHeight:i=1,font:s=(o=>(o=at())==null?void 0:o.font)(),...r}={}){t=""+t,super.init({text:t,textAlign:e,lineHeight:i,font:s,...r}),this.context&&this._p(),ft("init",()=>{this.font??(this.font=at().font),this._p()})}get width(){return this._w}set width(t){this._d=!0,this._w=t,this._fw=t}get text(){return this._t}set text(t){this._d=!0,this._t=""+t}get font(){return this._f}set font(t){this._d=!0,this._f=t,this._fs=tl(t).computed}get lineHeight(){return this._lh}set lineHeight(t){this._d=!0,this._lh=t}render(){this._d&&this._p(),super.render()}_p(){this._s=[],this._d=!1;let t=this.context,e=[this.text];if(t.font=this.font,e=this.text.split(`
`),this._fw&&e.map(i=>{let s=i.split(" "),r=s.shift(),o=r;s.map(a=>{o+=" "+a,t.measureText(o).width>this._fw&&(this._s.push(r),o=a),r=o}),this._s.push(o)}),!this._s.length&&this.text.includes(`
`)){let i=0;e.map(s=>{this._s.push(s),i=Math.max(i,t.measureText(s).width)}),this._w=this._fw||i}this._s.length||(this._s.push(this.text),this._w=this._fw||t.measureText(this.text).width),this.height=this._fs+(this._s.length-1)*this._fs*this.lineHeight,this._uw()}draw(){let t=0,e=this.textAlign,i=this.context;e=this.textAlign||(i.canvas.dir=="rtl"?"right":"left"),t=e=="right"?this.width:e=="center"?this.width/2|0:0,this._s.map((s,r)=>{i.textBaseline="top",i.textAlign=e,i.fillStyle=this.color,i.font=this.font,this.strokeColor&&(i.strokeStyle=this.strokeColor,i.lineWidth=this.lineWidth??1,i.strokeText(s,t,this._fs*this.lineHeight*r)),i.fillText(s,t,this._fs*this.lineHeight*r)})}}function Mr(){return new Or(...arguments)}let kt=new WeakMap,En={},Mn={},Ur={0:"left",1:"middle",2:"right"};function el(n=ct()){return kt.get(n)}function Fr(n){let t=n._lf.length?n._lf:n._cf;for(let e=t.length-1;e>=0;e--){let i=t[e];if(i.collidesWithPointer?i.collidesWithPointer(n):Ar(n,i))return i}}function rt(n,t){return parseFloat(n.getPropertyValue(t))||0}function nl(n){let{canvas:t,_s:e}=n,i=t.getBoundingClientRect(),s=e.transform!="none"?e.transform.replace("matrix(","").split(","):[1,1,1,1],r=parseFloat(s[0]),o=parseFloat(s[3]),a=(rt(e,"border-left-width")+rt(e,"border-right-width"))*r,l=(rt(e,"border-top-width")+rt(e,"border-bottom-width"))*o,h=(rt(e,"padding-left")+rt(e,"padding-right"))*r,u=(rt(e,"padding-top")+rt(e,"padding-bottom"))*o;return{scaleX:(i.width-a-h)/t.width,scaleY:(i.height-l-u)/t.height,offsetX:i.left+(rt(e,"border-left-width")+rt(e,"padding-left"))*r,offsetY:i.top+(rt(e,"border-top-width")+rt(e,"padding-top"))*o}}function Cs(n){let t=n.button!=null?Ur[n.button]:"left";Mn[t]=!0,Yi(n,"onDown")}function Qn(n){let t=n.button!=null?Ur[n.button]:"left";Mn[t]=!1,Yi(n,"onUp")}function As(n){Yi(n,"onOver")}function il(n){let t=kt.get(n.target);t._oo=null,Mn={}}function Ts(n,t,e){let i=Fr(n);i&&i[t]&&i[t](e),En[t]&&En[t](e,i),t=="onOver"&&(i!=n._oo&&n._oo&&n._oo.onOut&&n._oo.onOut(e),n._oo=i)}function Yi(n,t){n.preventDefault();let e=n.target,i=kt.get(e),{scaleX:s,scaleY:r,offsetX:o,offsetY:a}=nl(i);n.type.includes("touch")?(Array.from(n.touches).map(({clientX:h,clientY:u,identifier:d})=>{let f=i.touches[d];f||(f=i.touches[d]={start:{x:(h-o)/s,y:(u-a)/r}},i.touches.length++),f.changed=!1}),Array.from(n.changedTouches).map(({clientX:h,clientY:u,identifier:d})=>{let f=i.touches[d];f.changed=!0,f.x=i.x=(h-o)/s,f.y=i.y=(u-a)/r,Ts(i,t,n),Pt("touchChanged",n,i.touches),t=="onUp"&&(delete i.touches[d],i.touches.length--,i.touches.length||Pt("touchEnd"))})):(i.x=(n.clientX-o)/s,i.y=(n.clientY-a)/r,Ts(i,t,n))}function $r({radius:n=5,canvas:t=ct()}={}){let e=kt.get(t);if(!e){let i=window.getComputedStyle(t);e={x:0,y:0,radius:n,touches:{length:0},canvas:t,_cf:[],_lf:[],_o:[],_oo:null,_s:i},kt.set(t,e)}return t.addEventListener("mousedown",Cs),t.addEventListener("touchstart",Cs),t.addEventListener("mouseup",Qn),t.addEventListener("touchend",Qn),t.addEventListener("touchcancel",Qn),t.addEventListener("blur",il),t.addEventListener("mousemove",As),t.addEventListener("touchmove",As),e._t||(e._t=!0,ft("tick",()=>{e._lf.length=0,e._cf.map(i=>{e._lf.push(i)}),e._cf.length=0})),e}function Hr(...n){n.flat().map(t=>{let e=t.context?t.context.canvas:ct(),i=kt.get(e);if(!i)throw new ReferenceError("Pointer events not initialized for the objects canvas");t.__r||(t.__r=t.render,t.render=function(){i._cf.push(this),this.__r()},i._o.push(t))})}function sl(...n){n.flat().map(t=>{let e=t.context?t.context.canvas:ct(),i=kt.get(e);if(!i)throw new ReferenceError("Pointer events not initialized for the objects canvas");t.render=t.__r,t.__r=0,me(i._o,t)})}function rl(n){let t=n.context?n.context.canvas:ct(),e=kt.get(t);if(!e)throw new ReferenceError("Pointer events not initialized for the objects canvas");return e._o.includes(n)&&Fr(e)===n}function qr(n,t){let e=n[0].toUpperCase()+n.substr(1);En["on"+e]=t}function zr(n){let t=n[0].toUpperCase()+n.substr(1);En["on"+t]=0}function ol(n){return!!Mn[n]}class Yr extends zi{init({padX:t=0,padY:e=0,text:i,disabled:s=!1,container:r,onDown:o,onUp:a,...l}={}){super.init({padX:t,padY:e,...l}),this.textNode=Mr({...i,context:this.context}),this.width||(this.width=this.textNode.width,this.height=this.textNode.height),Hr(this),this.addChild(this.textNode),this._od=o||Zt,this._ou=a||Zt;let h=this._dn=document.createElement("button");h.style=Cr,h.textContent=this.text,s&&this.disable(),h.addEventListener("focus",()=>this.focus()),h.addEventListener("blur",()=>this.blur()),h.addEventListener("keydown",u=>this._kd(u)),h.addEventListener("keyup",u=>this._ku(u)),wi(h,r??this.context.canvas),this._uw(),this._p()}get text(){return this.textNode.text}set text(t){this._d=!0,this.textNode.text=t}get node(){return this._dn}destroy(){this._dn.remove()}_p(){this.text!=this._dn.textContent&&(this._dn.textContent=this.text),this.textNode._p();let t=this.textNode.width+this.padX*2,e=this.textNode.height+this.padY*2;this.width=Math.max(t,this.width),this.height=Math.max(e,this.height),this._uw()}render(){this._d&&this._p(),super.render()}enable(){this.disabled=this._dn.disabled=!1,this.onEnable()}disable(){this.disabled=this._dn.disabled=!0,this.onDisable()}focus(){this.disabled||(this.focused=!0,document.activeElement!=this._dn&&this._dn.focus(mi),this.onFocus())}blur(){this.focused=!1,document.activeElement==this._dn&&this._dn.blur(),this.onBlur()}onOver(){this.disabled||(this.hovered=!0)}onOut(){this.hovered=!1}onEnable(){}onDisable(){}onFocus(){}onBlur(){}onDown(){this.disabled||(this.pressed=!0,this._od())}onUp(){this.disabled||(this.pressed=!1,this._ou())}_kd(t){(t.code=="Enter"||t.code=="Space")&&this.onDown()}_ku(t){(t.code=="Enter"||t.code=="Space")&&this.onUp()}}function al(){return new Yr(...arguments)}function ll(n){let t=n.canvas;n.clearRect(0,0,t.width,t.height)}function cl({fps:n=60,clearCanvas:t=!0,update:e=Zt,render:i,context:s=at(),blur:r=!1}={}){if(!i)throw Error("You must provide a render() function");let o=0,a=1e3/n,l=1/n,h=t?ll:Zt,u,d,f,p,w,g=!0;r||(window.addEventListener("focus",()=>{g=!0}),window.addEventListener("blur",()=>{g=!1})),ft("init",()=>{w.context??(w.context=at())});function m(){if(d=requestAnimationFrame(m),!!g&&(f=performance.now(),p=f-u,u=f,!(p>1e3))){for(o+=p;o>=a;)Pt("tick"),w.update(l),o-=a;h(w.context),w.render()}}return w={update:e,render:i,isStopped:!0,context:s,start(){this.isStopped&&(u=performance.now(),this.isStopped=!1,requestAnimationFrame(m))},stop(){this.isStopped=!0,cancelAnimationFrame(d)},_frame:m,set _last(_){u=_}},w}let yt=[],xn={},Sn={},Un={0:"south",1:"east",2:"west",3:"north",4:"leftshoulder",5:"rightshoulder",6:"lefttrigger",7:"righttrigger",8:"select",9:"start",10:"leftstick",11:"rightstick",12:"dpadup",13:"dpaddown",14:"dpadleft",15:"dpadright"};function hl(n){yt[n.gamepad.index]={pressedButtons:{},axes:{}}}function ul(n){delete yt[n.gamepad.index]}function dl(){yt.map(n=>{n.pressedButtons={},n.axes={}})}function Wr(){let n=navigator.getGamepads?navigator.getGamepads():navigator.webkitGetGamepads?navigator.webkitGetGamepads:[];for(let t=0;t<n.length;t++){let e=n[t];if(!e)continue;e.buttons.map((s,r)=>{let o=Un[r],{pressed:a}=s,{pressedButtons:l}=yt[e.index],h=l[o];!h&&a?[xn[e.index],xn].map(u=>{var d;(d=u==null?void 0:u[o])==null||d.call(u,e,s,o)}):h&&!a&&[Sn[e.index],Sn].map(u=>{var d;(d=u==null?void 0:u[o])==null||d.call(u,e,s,o)}),l[o]=a});let{axes:i}=yt[e.index];i.leftstickx=e.axes[0],i.leftsticky=e.axes[1],i.rightstickx=e.axes[2],i.rightsticky=e.axes[3]}}function jr(){window.addEventListener("gamepadconnected",hl),window.addEventListener("gamepaddisconnected",ul),window.addEventListener("blur",dl),ft("tick",Wr)}function Gr(n,t,{gamepad:e,handler:i="gamepaddown"}={}){let s=i=="gamepaddown"?xn:Sn;[].concat(n).map(r=>{isNaN(e)?s[r]=t:(s[e]=s[e]||{},s[e][r]=t)})}function Kr(n,{gamepad:t,handler:e="gamepaddown"}={}){let i=e=="gamepaddown"?xn:Sn;[].concat(n).map(s=>{isNaN(t)?delete i[s]:(i[t]=i[t]||{},delete i[t][s])})}function fl(n,{gamepad:t}={}){return isNaN(t)?yt.some(e=>e.pressedButtons[n]):yt[t]?!!yt[t].pressedButtons[n]:!1}function gl(n,t){var e;return((e=yt[t])==null?void 0:e.axes[n])||0}let Cn={},en,vs=!1,An={swipe:{touches:1,threshold:10,touchend({0:n}){let t=n.x-n.start.x,e=n.y-n.start.y,i=Math.abs(t),s=Math.abs(e);if(!(i<this.threshold&&s<this.threshold))return i>s?t<0?"left":"right":e<0?"up":"down"}},pinch:{touches:2,threshold:2,touchstart({0:n,1:t}){this.prevDist=Math.hypot(n.x-t.x,n.y-t.y)},touchmove({0:n,1:t}){let e=Math.hypot(n.x-t.x,n.y-t.y);if(Math.abs(e-this.prevDist)<this.threshold)return;let i=e>this.prevDist?"out":"in";return this.prevDist=e,i}}};function Vr(){vs||(vs=!0,ft("touchChanged",(n,t)=>{Object.keys(An).map(e=>{var r;let i=An[e],s;(!en||en==e)&&t.length==i.touches&&[...Array(t.length).keys()].every(o=>t[o])&&(s=((r=i[n.type])==null?void 0:r.call(i,t))??"")&&Cn[e+s]&&(en=e,Cn[e+s](n,t))})}),ft("touchEnd",()=>{en=0}))}function Zr(n,t){[].concat(n).map(e=>{Cn[e]=t})}function Jr(n){[].concat(n).map(t=>{Cn[t]=0})}let pl={set(n,t,e){return t.startsWith("_")||(n._d=!0),Reflect.set(n,t,e)}},Is={start(n){return n?1:0},center(){return .5},end(n){return n?0:1}};class Xr extends Re{init({flow:t="column",align:e="start",justify:i="start",colGap:s=0,rowGap:r=0,numCols:o=1,dir:a="",breakpoints:l=[],...h}={}){return super.init({flow:t,align:e,justify:i,colGap:s,rowGap:r,numCols:o,dir:a,breakpoints:l,...h}),this._p(),new Proxy(this,pl)}addChild(t){this._d=!0,super.addChild(t)}removeChild(t){this._d=!0,super.removeChild(t)}render(){this._d&&this._p(),super.render()}destroy(){this.children.map(t=>t.destroy&&t.destroy())}_p(){this._d=!1,this.breakpoints.map(_=>{_.metric.call(this)&&this._b!==_&&(this._b=_,_.callback.call(this))});let t=this._g=[],e=this._cw=[],i=this._rh=[],s=this.children,r=this._nc=this.flow=="column"?1:this.flow=="row"?s.length:this.numCols,o=0,a=0;for(let _=0,E;E=s[_];_++){t[o]=t[o]||[],E._p&&E._p();let{width:C,height:x}=E.world||E;i[o]=Math.max(i[o]||0,x);let I=E.colSpan||1,T=I;do e[a]=Math.max(e[a]||0,C/T),t[o][a]=E;while(a++<=r&&--I);a>=r&&(a=0,o++)}for(;a>0&&a<r;)t[o][a++]=!1;let l=t.length,h=[].concat(this.colGap),u=[].concat(this.rowGap);this._w=e.reduce((_,E)=>_+=E,0);for(let _=0;_<r-1;_++)this._w+=h[_%h.length];this._h=i.reduce((_,E)=>_+=E,0);for(let _=0;_<l-1;_++)this._h+=u[_%u.length];this._uw();let f=this.context.canvas.dir=="rtl"&&!this.dir||this.dir=="rtl";this._rtl=f,f&&(this._g=t.map(_=>_.reverse()),this._cw=e.reverse(),h=h.reverse());let p=-this.anchor.y*this.height,w=[],g=[].concat(this.justify),m=[].concat(this.align);this._g.map((_,E)=>{let C=-this.anchor.x*this.width;_.map((x,I)=>{if(x&&!w.includes(x)){w.push(x);let T=Is[x.justifySelf||g[I%g.length]](this._rtl),N=Is[x.alignSelf||m[E%m.length]](),P=x.colSpan||1,F=e[I];if(P>1&&I+P<=this._nc)for(let A=1;A<P;A++)F+=e[I+A]+h[(I+A)%h.length];let k=F*T,L=i[E]*N,y=0,v=0,{width:S,height:b}=x.world||x;if(x.anchor&&(y=x.anchor.x,v=x.anchor.y),T==0)k=k+S*y;else if(T==.5){let A=y<.5?-1:y==.5?0:1;k=k+A*S*T}else k=k-S*(1-y);if(N==0)L=L+b*v;else if(N==.5){let A=v<.5?-1:v==.5?0:1;L=L+A*b*N}else L=L-b*(1-v);x.x=C+k,x.y=p+L}C+=e[I]+h[I%h.length]}),p+=i[E]+u[E%u.length]})}}function _l(){return new Xr(...arguments)}let Wi={},ji={},Fn={},Rt={Enter:"enter",Escape:"esc",Space:"space",ArrowLeft:"arrowleft",ArrowUp:"arrowup",ArrowRight:"arrowright",ArrowDown:"arrowdown"};function Qr(n=Zt,t){n._pd&&t.preventDefault(),n(t)}function ml(n){let t=Rt[n.code],e=Wi[t];Fn[t]=!0,Qr(e,n)}function wl(n){let t=Rt[n.code],e=ji[t];Fn[t]=!1,Qr(e,n)}function yl(){Fn={}}function to(){let n;for(n=0;n<26;n++)Rt["Key"+String.fromCharCode(n+65)]=String.fromCharCode(n+97);for(n=0;n<10;n++)Rt["Digit"+n]=Rt["Numpad"+n]=""+n;window.addEventListener("keydown",ml),window.addEventListener("keyup",wl),window.addEventListener("blur",yl)}function eo(n,t,{handler:e="keydown",preventDefault:i=!0}={}){let s=e=="keydown"?Wi:ji;t._pd=i,[].concat(n).map(r=>s[r]=t)}function no(n,{handler:t="keydown"}={}){let e=t=="keydown"?Wi:ji;[].concat(n).map(i=>delete e[i])}function bl(n){return!![].concat(n).some(t=>Fn[t])}function Tn(n,t){return Object.values(t).includes(n)}function io(n){return Object.keys(An).some(t=>n.startsWith(t))}function El(n={}){to();let t=$r(n.pointer);return Vr(),jr(),{pointer:t}}function xl(n,t,{gamepad:e,key:i}={}){[].concat(n).map(s=>{if(Tn(s,Un))Gr(s,t,e);else if(io(s))Zr(s,t);else if(Tn(s,Rt))eo(s,t,i);else if(["down","up"].includes(s))qr(s,t);else throw new TypeError(`"${s}" is not a valid input name`)})}function Sl(n,{gamepad:t,key:e}={}){[].concat(n).map(i=>{Tn(i,Un)?Kr(i,t):io(i)?Jr(i):Tn(i,Rt)?no(i,e):["down","up"].includes(i)&&zr(i)})}function so(n){let t=n.substr(n.search(/[A-Z]/));return t[0].toLowerCase()+t.substr(1)}function Cl(n,t){let e=n.prototype;e&&(e._inc||(e._inc={},e._bInc=function(s,r,...o){return this._inc[r].before.reduce((a,l)=>{let h=l(s,...a);return h||a},o)},e._aInc=function(s,r,o,...a){return this._inc[r].after.reduce((l,h)=>{let u=h(s,l,...a);return u||l},o)}),Object.getOwnPropertyNames(t).map(i=>{let s=so(i);e[s]&&(e["_o"+s]||(e["_o"+s]=e[s],e[s]=function(...o){let a=this._bInc(this,s,...o),l=e["_o"+s].call(this,...a);return this._aInc(this,s,l,...o)}),e._inc[s]||(e._inc[s]={before:[],after:[]}),i.startsWith("before")?e._inc[s].before.push(t[i]):i.startsWith("after")&&e._inc[s].after.push(t[i]))}))}function Al(n,t){let e=n.prototype;!e||!e._inc||Object.getOwnPropertyNames(t).map(i=>{let s=so(i);i.startsWith("before")?me(e._inc[s].before,t[i]):i.startsWith("after")&&me(e._inc[s].after,t[i])})}function Tl(n,t){let e=n.prototype;e&&Object.getOwnPropertyNames(t).map(i=>{e[i]||(e[i]=t[i])})}class ro{constructor({create:t,maxSize:e=1024}={}){let i;if(!t||!(i=t())||!(i.update&&i.init&&i.isAlive&&i.render))throw Error("Must provide create() function which returns an object with init(), update(), render(), and isAlive() functions");this._c=t,this.objects=[t()],this.size=0,this.maxSize=e}get(t={}){if(this.size==this.objects.length){if(this.size==this.maxSize)return;for(let i=0;i<this.size&&this.objects.length<this.maxSize;i++)this.objects.push(this._c())}let e=this.objects[this.size];return this.size++,e.init(t),e}getAliveObjects(){return this.objects.slice(0,this.size)}clear(){this.size=this.objects.length=0,this.objects.push(this._c())}update(t){let e,i=!1;for(let s=this.size;s--;)e=this.objects[s],e.update(t),e.isAlive()||(i=!0,this.size--);i&&this.objects.sort((s,r)=>r.isAlive()-s.isAlive())}render(){for(let t=this.size;t--;)this.objects[t].render()}}function vl(){return new ro(...arguments)}function Rs(n,t){let e=[],i=t.x+t.width/2,s=t.y+t.height/2,r=n.y<s,o=n.y+n.height>=s;return n.x<i&&(r&&e.push(0),o&&e.push(2)),n.x+n.width>=i&&(r&&e.push(1),o&&e.push(3)),e}class $n{constructor({maxDepth:t=3,maxObjects:e=25,bounds:i}={}){this.maxDepth=t,this.maxObjects=e;let s=ct();this.bounds=i||{x:0,y:0,width:s.width,height:s.height},this._b=!1,this._d=0,this._o=[],this._s=[],this._p=null}clear(){this._s.map(t=>{t.clear()}),this._b=!1,this._o.length=0}get(t){let e=new Set;for(;this._s.length&&this._b;)return Rs(t,this.bounds).map(i=>{this._s[i].get(t).map(s=>e.add(s))}),Array.from(e);return this._o.filter(i=>i!==t)}add(...t){t.flat().map(e=>{if(this._b){this._a(e);return}this._o.push(e),this._o.length>this.maxObjects&&this._d<this.maxDepth&&(this._sp(),this._o.map(i=>this._a(i)),this._o.length=0)})}_a(t){Rs(t,this.bounds).map(e=>{this._s[e].add(t)})}_sp(t,e,i){if(this._b=!0,!this._s.length)for(t=this.bounds.width/2|0,e=this.bounds.height/2|0,i=0;i<4;i++)this._s[i]=new $n({bounds:{x:this.bounds.x+(i%2==1?t:0),y:this.bounds.y+(i>=2?e:0),width:t,height:e},maxDepth:this.maxDepth,maxObjects:this.maxObjects}),this._s[i]._d=this._d+1}}function Il(){return new $n(...arguments)}let mt;function oo(){mt??(mt=Date.now()),mt|=0,mt=mt+2654435769|0;let n=mt^mt>>>16;return n=Math.imul(n,569420461),n=n^n>>>15,n=Math.imul(n,1935289751),((n=n^n>>>15)>>>0)/4294967296}function Rl(n,t,e=oo){return(e()*(t-n+1)|0)+n}function Nl(){return mt}function Bl(n=Date.now()){if(mt=n,typeof n=="string"){for(var t=0,e=1779033703^n.length;t<n.length;t++)e=Math.imul(e^n.charCodeAt(t),3432918353),e=e<<13|e>>>19;e=Math.imul(e^e>>>16,2246822507),e=Math.imul(e^e>>>13,3266489909),mt=(e^=e>>>16)>>>0}}function yi(n){let t=[];return n._dn?t.push(n._dn):n.children&&n.children.map(e=>{t=t.concat(yi(e))}),t}class ao{constructor({id:t,name:e=t,objects:i=[],context:s=at(),cullObjects:r=!0,cullFunction:o=Sr,sortFunction:a,...l}){this._o=[],Object.assign(this,{id:t,name:e,context:s,cullObjects:r,cullFunction:o,sortFunction:a,...l});let h=this._dn=document.createElement("section");h.tabIndex=-1,h.style=Cr,h.id=t,h.setAttribute("aria-label",e);let u=this;class d extends Re{set x(p){u.sx=p-this.centerX,super.x=p}get x(){return super.x}set y(p){u.sy=p-this.centerY,super.y=p}get y(){return super.y}}this.camera=new d({context:s,anchor:{x:.5,y:.5},render:this._rf.bind(this)}),this.add(i),this._i=()=>{this.context??(this.context=at());let f=this.context.canvas,{width:p,height:w}=f,g=p/2,m=w/2;Object.assign(this.camera,{centerX:g,centerY:m,x:g,y:m,width:p,height:w}),h.isConnected||wi(h,f)},this.context&&this._i(),ft("init",this._i)}set objects(t){this.remove(this._o),this.add(t)}get objects(){return this._o}get node(){return this._dn}add(...t){t.flat().map(e=>{this._o.push(e),e.parent=this,this._dn.append(...yi(e))})}remove(...t){t.flat().map(e=>{me(this._o,e),e.parent=null,yi(e).map(i=>{wi(i,this.context.canvas)})})}show(){this.hidden=this._dn.hidden=!1;let t=this._o.find(e=>e.focus);t?t.focus(mi):this._dn.focus(mi),this.onShow()}hide(){this.hidden=this._dn.hidden=!0,this.onHide()}destroy(){Tr("init",this._i),this._dn.remove(),this._o.map(t=>t.destroy&&t.destroy())}lookAt(t){let{x:e,y:i}=t.world||t;this.camera.x=e,this.camera.y=i}update(t){this.hidden||this._o.map(e=>e.update&&e.update(t))}_rf(){let{_o:t,context:e,_sx:i,_sy:s,camera:r,sortFunction:o,cullObjects:a,cullFunction:l}=this;e.translate(i,s);let h=t;a&&(h=h.filter(u=>l(r,u))),o&&h.sort(o),h.map(u=>u.render&&u.render())}render(){if(!this.hidden){let{context:t,camera:e}=this,{x:i,y:s,centerX:r,centerY:o}=e;t.save(),this._sx=r-i,this._sy=o-s,t.translate(this._sx,this._sy),e.render(),t.restore()}}onShow(){}onHide(){}}function Pl(){return new ao(...arguments)}function kl(n){if(+n==n)return n;let t=[],e=n.split(".."),i=+e[0],s=+e[1],r=i;if(i<s)for(;r<=s;r++)t.push(r);else for(;r>=s;r--)t.push(r);return t}let lo=class{constructor({image:t,frameWidth:e,frameHeight:i,spacing:s=0,margin:r=0,animations:o}={}){if(!t)throw Error("You must provide an Image for the SpriteSheet");this.animations={},this.image=t,this.frame={width:e,height:i,spacing:s,margin:r},this._f=(t.width-r)/e|0,this.createAnimations(o)}createAnimations(t){let e,i;for(i in t){let{frames:s,frameRate:r,loop:o}=t[i];if(e=[],s==null)throw Error("Animation "+i+" must provide a frames property");[].concat(s).map(a=>{e=e.concat(kl(a))}),this.animations[i]=vr({spriteSheet:this,frames:e,frameRate:r,loop:o,name:i})}}};function Ll(){return new lo(...arguments)}let Ns=2147483648,Bs=1073741824,Ps=536870912;function Be(n,t){return n/t|0}function Pe(n,t){return n/t|0}class co{constructor(t={}){let{width:e,height:i,tilewidth:s,tileheight:r,tilesets:o}=t,a=e*s,l=i*r,h=document.createElement("canvas");h.width=a,h.height=l,this._c=h,this._ctx=h.getContext("2d"),o.map(u=>{let{__k:d,location:f}=window,p=(d?d.dm.get(t):"")||f.href,{source:w}=u;if(w){if(!d)throw Error('You must use "load" or "loadData" to resolve tileset.source');let m=d.d[d.u(w,p)];if(!m)throw Error(`You must load the tileset source "${w}" before loading the tileset`);Object.keys(m).map(_=>{u[_]=m[_]})}let{image:g}=u;if(""+g===g){if(!d)throw Error('You must use "load" or "loadImage" to resolve tileset.image');let m=d.i[d.u(g,p)];if(!m)throw Error(`You must load the image "${g}" before loading the tileset`);u.image=m}}),Object.assign(this,{context:at(),layerMap:{},layerCanvases:{},mapwidth:a,mapheight:l,_sx:0,_sy:0,_o:[],...t}),this.context&&this._p(),ft("init",()=>{this.context??(this.context=at()),this._p()})}get sx(){return this._sx}get sy(){return this._sy}set sx(t){let e=Math.max(0,this.mapwidth-ct().width);this._sx=pe(0,e,t)}set sy(t){let e=Math.max(0,this.mapheight-ct().height);this._sy=pe(0,e,t)}set objects(t){this.remove(this._o),this.add(t)}get objects(){return this._o}add(...t){t.flat().map(e=>{this._o.push(e),e.parent=this})}remove(...t){t.flat().map(e=>{me(this._o,e),e.parent=null})}getPosition(t){let e=ct().getBoundingClientRect(),i=t.x-e.x,s=t.y-e.y;return i+=this.sx,s+=this.sy,{x:i,y:s,row:Be(s,this.tileheight),col:Pe(i,this.tilewidth)}}setTileAtLayer(t,e,i){let{layerMap:s,tileheight:r,tilewidth:o,width:a}=this,{row:l,col:h,x:u,y:d}=e,f=l??Be(d,r),p=h??Pe(u,o);s[t]&&(this._d=!0,s[t]._d=!0,s[t].data[f*a+p]=i)}setLayer(t,e){let{layerMap:i}=this;i[t]&&(this._d=!0,i[t]._d=!0,i[t].data=e)}layerCollidesWith(t,e){let{tilewidth:i,tileheight:s,layerMap:r}=this,{x:o,y:a,width:l,height:h}=_e(e),u=Be(a,s),d=Pe(o,i),f=Be(a+h,s),p=Pe(o+l,i),w=r[t];for(let g=u;g<=f;g++)for(let m=d;m<=p;m++)if(w.data[m+g*this.width])return!0;return!1}tileAtLayer(t,e){let{layerMap:i,tileheight:s,tilewidth:r,width:o}=this,{row:a,col:l,x:h,y:u}=e,d=a??Be(u,s),f=l??Pe(h,r);return i[t]?i[t].data[d*o+f]:-1}render(t=this._c,e=!0){let{_d:i,context:s,sx:r=0,sy:o=0}=this;i&&this._p();let{width:a,height:l}=ct(),h=Math.min(t.width,a),u=Math.min(t.height,l);s.drawImage(t,r,o,h,u,0,0,h,u),e&&(s.save(),(r||o)&&s.translate(-r,-o),this.objects.map(d=>d.render&&d.render()),s.restore())}renderLayer(t){let{layerCanvases:e,layerMap:i}=this,s=i[t],r=e[t],o=r==null?void 0:r.getContext("2d");if(!r){let{mapwidth:a,mapheight:l}=this;r=document.createElement("canvas"),o=r.getContext("2d"),r.width=a,r.height=l,e[t]=r,this._rl(s,o)}s._d&&(s._d=!1,o.clearRect(0,0,r.width,r.height),this._rl(s,o)),this.render(r,!1)}_p(){let{_ctx:t,layers:e=[],layerMap:i}=this;this._d=!1,e.map(s=>{let{name:r,data:o,visible:a}=s;s._d=!1,i[r]=s,o&&a!=!1&&this._rl(s,t)})}_rl(t,e){let{opacity:i,data:s=[]}=t,{tilesets:r,width:o,tilewidth:a,tileheight:l}=this;e.save(),e.globalAlpha=i,s.map((h,u)=>{if(!h)return;let d=0,f=0,p=h&Ns,w=h&Bs,g=0,m=0,_=0,E=0,C=0;d=p||w,h&=~(Ns|Bs),C=h&Ps,C&&(p&&w?_=1:p?g=1:w?m=1:E=1,f=g||m||_||E,h&=~Ps);let x;for(let A=r.length-1;A>=0&&(x=r[A],!(h/x.firstgid>=1));A--);let{image:I,spacing:T=0,margin:N=0,firstgid:P,columns:F}=x,k=h-P,L=F??I.width/(a+T)|0,y=u%o*a,v=(u/o|0)*l,S=N+k%L*(a+T),b=N+(k/L|0)*(l+T);f?(e.save(),e.translate(y+a/2,v+l/2),m||E?e.rotate(-Math.PI/2):(g||_)&&e.rotate(Math.PI/2),(_||E)&&e.scale(-1,1),y=-a/2,v=-l/2):d&&(e.save(),e.translate(y+(p?a:0),v+(w?l:0)),e.scale(p?-1:1,w?-1:1),y=d?0:y,v=d?0:v),e.drawImage(I,S,b,a,l,y,v,a,l),(d||f)&&e.restore()}),e.restore()}}function Dl(){return new co(...arguments)}let Ol={Animation:vr,AnimationClass:Dn,imageAssets:Yt,audioAssets:ae,dataAssets:Wt,setImagePath:ja,setAudioPath:Ga,setDataPath:Ka,loadImage:kr,loadAudio:Lr,loadData:Dr,load:Va,Button:al,ButtonClass:Yr,init:Ha,getCanvas:ct,getContext:at,on:ft,off:Tr,emit:Pt,GameLoop:cl,GameObject:Ja,GameObjectClass:Re,gamepadMap:Un,updateGamepad:Wr,initGamepad:jr,onGamepad:Gr,offGamepad:Kr,gamepadPressed:fl,gamepadAxis:gl,gestureMap:An,initGesture:Vr,onGesture:Zr,offGesture:Jr,Grid:_l,GridClass:Xr,degToRad:Pa,radToDeg:ka,angleToTarget:La,rotatePoint:xr,movePoint:Da,lerp:Oa,inverseLerp:Ma,clamp:pe,setStoreItem:Ua,getStoreItem:Fa,collides:Sr,getWorldRect:_e,depthSort:$a,initInput:El,onInput:xl,offInput:Sl,keyMap:Rt,initKeys:to,onKey:eo,offKey:no,keyPressed:bl,registerPlugin:Cl,unregisterPlugin:Al,extendObject:Tl,initPointer:$r,getPointer:el,track:Hr,untrack:sl,pointerOver:rl,onPointer:qr,offPointer:zr,pointerPressed:ol,Pool:vl,PoolClass:ro,Quadtree:Il,QuadtreeClass:$n,rand:oo,randInt:Rl,getSeed:Nl,seedRand:Bl,Scene:Pl,SceneClass:ao,Sprite:Xa,SpriteClass:zi,SpriteSheet:Ll,SpriteSheetClass:lo,Text:Mr,TextClass:Or,TileEngine:Dl,TileEngineClass:co,Vector:fn,VectorClass:Gt};function ks(n){if(!Number.isSafeInteger(n)||n<0)throw new Error(`positive integer expected, not ${n}`)}function Ml(n){return n instanceof Uint8Array||n!=null&&typeof n=="object"&&n.constructor.name==="Uint8Array"}function Hn(n,...t){if(!Ml(n))throw new Error("Uint8Array expected");if(t.length>0&&!t.includes(n.length))throw new Error(`Uint8Array expected of length ${t}, not of length=${n.length}`)}function Ul(n){if(typeof n!="function"||typeof n.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");ks(n.outputLen),ks(n.blockLen)}function vn(n,t=!0){if(n.destroyed)throw new Error("Hash instance has been destroyed");if(t&&n.finished)throw new Error("Hash#digest() has already been called")}function Fl(n,t){Hn(n);const e=t.outputLen;if(n.length<e)throw new Error(`digestInto() expects output buffer of length at least ${e}`)}const ti=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */const ei=n=>new DataView(n.buffer,n.byteOffset,n.byteLength),dt=(n,t)=>n<<32-t|n>>>t;new Uint8Array(new Uint32Array([287454020]).buffer)[0];function $l(n){if(typeof n!="string")throw new Error(`utf8ToBytes expected string, got ${typeof n}`);return new Uint8Array(new TextEncoder().encode(n))}function Gi(n){return typeof n=="string"&&(n=$l(n)),Hn(n),n}function Hl(...n){let t=0;for(let i=0;i<n.length;i++){const s=n[i];Hn(s),t+=s.length}const e=new Uint8Array(t);for(let i=0,s=0;i<n.length;i++){const r=n[i];e.set(r,s),s+=r.length}return e}class ho{clone(){return this._cloneInto()}}function ql(n){const t=i=>n().update(Gi(i)).digest(),e=n();return t.outputLen=e.outputLen,t.blockLen=e.blockLen,t.create=()=>n(),t}function uo(n=32){if(ti&&typeof ti.getRandomValues=="function")return ti.getRandomValues(new Uint8Array(n));throw new Error("crypto.getRandomValues must be defined")}function zl(n,t,e,i){if(typeof n.setBigUint64=="function")return n.setBigUint64(t,e,i);const s=BigInt(32),r=BigInt(4294967295),o=Number(e>>s&r),a=Number(e&r),l=i?4:0,h=i?0:4;n.setUint32(t+l,o,i),n.setUint32(t+h,a,i)}const Yl=(n,t,e)=>n&t^~n&e,Wl=(n,t,e)=>n&t^n&e^t&e;class jl extends ho{constructor(t,e,i,s){super(),this.blockLen=t,this.outputLen=e,this.padOffset=i,this.isLE=s,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(t),this.view=ei(this.buffer)}update(t){vn(this);const{view:e,buffer:i,blockLen:s}=this;t=Gi(t);const r=t.length;for(let o=0;o<r;){const a=Math.min(s-this.pos,r-o);if(a===s){const l=ei(t);for(;s<=r-o;o+=s)this.process(l,o);continue}i.set(t.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===s&&(this.process(e,0),this.pos=0)}return this.length+=t.length,this.roundClean(),this}digestInto(t){vn(this),Fl(t,this),this.finished=!0;const{buffer:e,view:i,blockLen:s,isLE:r}=this;let{pos:o}=this;e[o++]=128,this.buffer.subarray(o).fill(0),this.padOffset>s-o&&(this.process(i,0),o=0);for(let d=o;d<s;d++)e[d]=0;zl(i,s-8,BigInt(this.length*8),r),this.process(i,0);const a=ei(t),l=this.outputLen;if(l%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const h=l/4,u=this.get();if(h>u.length)throw new Error("_sha2: outputLen bigger than state");for(let d=0;d<h;d++)a.setUint32(4*d,u[d],r)}digest(){const{buffer:t,outputLen:e}=this;this.digestInto(t);const i=t.slice(0,e);return this.destroy(),i}_cloneInto(t){t||(t=new this.constructor),t.set(...this.get());const{blockLen:e,buffer:i,length:s,finished:r,destroyed:o,pos:a}=this;return t.length=s,t.pos=a,t.finished=r,t.destroyed=o,s%e&&t.buffer.set(i),t}}const Gl=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Ct=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),At=new Uint32Array(64);class Kl extends jl{constructor(){super(64,32,8,!1),this.A=Ct[0]|0,this.B=Ct[1]|0,this.C=Ct[2]|0,this.D=Ct[3]|0,this.E=Ct[4]|0,this.F=Ct[5]|0,this.G=Ct[6]|0,this.H=Ct[7]|0}get(){const{A:t,B:e,C:i,D:s,E:r,F:o,G:a,H:l}=this;return[t,e,i,s,r,o,a,l]}set(t,e,i,s,r,o,a,l){this.A=t|0,this.B=e|0,this.C=i|0,this.D=s|0,this.E=r|0,this.F=o|0,this.G=a|0,this.H=l|0}process(t,e){for(let d=0;d<16;d++,e+=4)At[d]=t.getUint32(e,!1);for(let d=16;d<64;d++){const f=At[d-15],p=At[d-2],w=dt(f,7)^dt(f,18)^f>>>3,g=dt(p,17)^dt(p,19)^p>>>10;At[d]=g+At[d-7]+w+At[d-16]|0}let{A:i,B:s,C:r,D:o,E:a,F:l,G:h,H:u}=this;for(let d=0;d<64;d++){const f=dt(a,6)^dt(a,11)^dt(a,25),p=u+f+Yl(a,l,h)+Gl[d]+At[d]|0,g=(dt(i,2)^dt(i,13)^dt(i,22))+Wl(i,s,r)|0;u=h,h=l,l=a,a=o+p|0,o=r,r=s,s=i,i=p+g|0}i=i+this.A|0,s=s+this.B|0,r=r+this.C|0,o=o+this.D|0,a=a+this.E|0,l=l+this.F|0,h=h+this.G|0,u=u+this.H|0,this.set(i,s,r,o,a,l,h,u)}roundClean(){At.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}const bi=ql(()=>new Kl);class fo extends ho{constructor(t,e){super(),this.finished=!1,this.destroyed=!1,Ul(t);const i=Gi(e);if(this.iHash=t.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const s=this.blockLen,r=new Uint8Array(s);r.set(i.length>s?t.create().update(i).digest():i);for(let o=0;o<r.length;o++)r[o]^=54;this.iHash.update(r),this.oHash=t.create();for(let o=0;o<r.length;o++)r[o]^=106;this.oHash.update(r),r.fill(0)}update(t){return vn(this),this.iHash.update(t),this}digestInto(t){vn(this),Hn(t,this.outputLen),this.finished=!0,this.iHash.digestInto(t),this.oHash.update(t),this.oHash.digestInto(t),this.destroy()}digest(){const t=new Uint8Array(this.oHash.outputLen);return this.digestInto(t),t}_cloneInto(t){t||(t=Object.create(Object.getPrototypeOf(this),{}));const{oHash:e,iHash:i,finished:s,destroyed:r,blockLen:o,outputLen:a}=this;return t=t,t.finished=s,t.destroyed=r,t.blockLen=o,t.outputLen=a,t.oHash=e._cloneInto(t.oHash),t.iHash=i._cloneInto(t.iHash),t}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const go=(n,t,e)=>new fo(n,t).update(e).digest();go.create=(n,t)=>new fo(n,t);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Ki=BigInt(0),qn=BigInt(1),Vl=BigInt(2);function Jt(n){return n instanceof Uint8Array||n!=null&&typeof n=="object"&&n.constructor.name==="Uint8Array"}function je(n){if(!Jt(n))throw new Error("Uint8Array expected")}function we(n,t){if(typeof t!="boolean")throw new Error(`${n} must be valid boolean, got "${t}".`)}const Zl=Array.from({length:256},(n,t)=>t.toString(16).padStart(2,"0"));function ye(n){je(n);let t="";for(let e=0;e<n.length;e++)t+=Zl[n[e]];return t}function po(n){const t=n.toString(16);return t.length&1?`0${t}`:t}function Vi(n){if(typeof n!="string")throw new Error("hex string expected, got "+typeof n);return BigInt(n===""?"0":`0x${n}`)}const pt={_0:48,_9:57,_A:65,_F:70,_a:97,_f:102};function Ls(n){if(n>=pt._0&&n<=pt._9)return n-pt._0;if(n>=pt._A&&n<=pt._F)return n-(pt._A-10);if(n>=pt._a&&n<=pt._f)return n-(pt._a-10)}function be(n){if(typeof n!="string")throw new Error("hex string expected, got "+typeof n);const t=n.length,e=t/2;if(t%2)throw new Error("padded hex string expected, got unpadded hex of length "+t);const i=new Uint8Array(e);for(let s=0,r=0;s<e;s++,r+=2){const o=Ls(n.charCodeAt(r)),a=Ls(n.charCodeAt(r+1));if(o===void 0||a===void 0){const l=n[r]+n[r+1];throw new Error('hex string expected, got non-hex character "'+l+'" at index '+r)}i[s]=o*16+a}return i}function bt(n){return Vi(ye(n))}function Zi(n){return je(n),Vi(ye(Uint8Array.from(n).reverse()))}function Lt(n,t){return be(n.toString(16).padStart(t*2,"0"))}function Ji(n,t){return Lt(n,t).reverse()}function Jl(n){return be(po(n))}function nt(n,t,e){let i;if(typeof t=="string")try{i=be(t)}catch(r){throw new Error(`${n} must be valid hex string, got "${t}". Cause: ${r}`)}else if(Jt(t))i=Uint8Array.from(t);else throw new Error(`${n} must be hex string or Uint8Array`);const s=i.length;if(typeof e=="number"&&s!==e)throw new Error(`${n} expected ${e} bytes, got ${s}`);return i}function Xt(...n){let t=0;for(let i=0;i<n.length;i++){const s=n[i];je(s),t+=s.length}const e=new Uint8Array(t);for(let i=0,s=0;i<n.length;i++){const r=n[i];e.set(r,s),s+=r.length}return e}function Xl(n,t){if(n.length!==t.length)return!1;let e=0;for(let i=0;i<n.length;i++)e|=n[i]^t[i];return e===0}function Ql(n){if(typeof n!="string")throw new Error(`utf8ToBytes expected string, got ${typeof n}`);return new Uint8Array(new TextEncoder().encode(n))}const ni=n=>typeof n=="bigint"&&Ki<=n;function Ee(n,t,e){return ni(n)&&ni(t)&&ni(e)&&t<=n&&n<e}function Nt(n,t,e,i){if(!Ee(t,e,i))throw new Error(`expected valid ${n}: ${e} <= n < ${i}, got ${typeof t} ${t}`)}function tc(n){let t;for(t=0;n>Ki;n>>=qn,t+=1);return t}function ec(n,t){return n>>BigInt(t)&qn}function nc(n,t,e){return n|(e?qn:Ki)<<BigInt(t)}const Xi=n=>(Vl<<BigInt(n-1))-qn,ii=n=>new Uint8Array(n),Ds=n=>Uint8Array.from(n);function _o(n,t,e){if(typeof n!="number"||n<2)throw new Error("hashLen must be a number");if(typeof t!="number"||t<2)throw new Error("qByteLen must be a number");if(typeof e!="function")throw new Error("hmacFn must be a function");let i=ii(n),s=ii(n),r=0;const o=()=>{i.fill(1),s.fill(0),r=0},a=(...d)=>e(s,i,...d),l=(d=ii())=>{s=a(Ds([0]),d),i=a(),d.length!==0&&(s=a(Ds([1]),d),i=a())},h=()=>{if(r++>=1e3)throw new Error("drbg: tried 1000 values");let d=0;const f=[];for(;d<t;){i=a();const p=i.slice();f.push(p),d+=i.length}return Xt(...f)};return(d,f)=>{o(),l(d);let p;for(;!(p=f(h()));)l();return o(),p}}const ic={bigint:n=>typeof n=="bigint",function:n=>typeof n=="function",boolean:n=>typeof n=="boolean",string:n=>typeof n=="string",stringOrUint8Array:n=>typeof n=="string"||Jt(n),isSafeInteger:n=>Number.isSafeInteger(n),array:n=>Array.isArray(n),field:(n,t)=>t.Fp.isValid(n),hash:n=>typeof n=="function"&&Number.isSafeInteger(n.outputLen)};function Ge(n,t,e={}){const i=(s,r,o)=>{const a=ic[r];if(typeof a!="function")throw new Error(`Invalid validator "${r}", expected function`);const l=n[s];if(!(o&&l===void 0)&&!a(l,n))throw new Error(`Invalid param ${String(s)}=${l} (${typeof l}), expected ${r}`)};for(const[s,r]of Object.entries(t))i(s,r,!1);for(const[s,r]of Object.entries(e))i(s,r,!0);return n}const sc=()=>{throw new Error("not implemented")};function Ei(n){const t=new WeakMap;return(e,...i)=>{const s=t.get(e);if(s!==void 0)return s;const r=n(e,...i);return t.set(e,r),r}}const rc=Object.freeze(Object.defineProperty({__proto__:null,aInRange:Nt,abool:we,abytes:je,bitGet:ec,bitLen:tc,bitMask:Xi,bitSet:nc,bytesToHex:ye,bytesToNumberBE:bt,bytesToNumberLE:Zi,concatBytes:Xt,createHmacDrbg:_o,ensureBytes:nt,equalBytes:Xl,hexToBytes:be,hexToNumber:Vi,inRange:Ee,isBytes:Jt,memoized:Ei,notImplemented:sc,numberToBytesBE:Lt,numberToBytesLE:Ji,numberToHexUnpadded:po,numberToVarBytesBE:Jl,utf8ToBytes:Ql,validateObject:Ge},Symbol.toStringTag,{value:"Module"}));/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Q=BigInt(0),V=BigInt(1),jt=BigInt(2),oc=BigInt(3),xi=BigInt(4),Os=BigInt(5),Ms=BigInt(8);BigInt(9);BigInt(16);function tt(n,t){const e=n%t;return e>=Q?e:t+e}function ac(n,t,e){if(e<=Q||t<Q)throw new Error("Expected power/modulo > 0");if(e===V)return Q;let i=V;for(;t>Q;)t&V&&(i=i*n%e),n=n*n%e,t>>=V;return i}function ot(n,t,e){let i=n;for(;t-- >Q;)i*=i,i%=e;return i}function Si(n,t){if(n===Q||t<=Q)throw new Error(`invert: expected positive integers, got n=${n} mod=${t}`);let e=tt(n,t),i=t,s=Q,r=V;for(;e!==Q;){const a=i/e,l=i%e,h=s-r*a;i=e,e=l,s=r,r=h}if(i!==V)throw new Error("invert: does not exist");return tt(s,t)}function lc(n){const t=(n-V)/jt;let e,i,s;for(e=n-V,i=0;e%jt===Q;e/=jt,i++);for(s=jt;s<n&&ac(s,t,n)!==n-V;s++);if(i===1){const o=(n+V)/xi;return function(l,h){const u=l.pow(h,o);if(!l.eql(l.sqr(u),h))throw new Error("Cannot find square root");return u}}const r=(e+V)/jt;return function(a,l){if(a.pow(l,t)===a.neg(a.ONE))throw new Error("Cannot find square root");let h=i,u=a.pow(a.mul(a.ONE,s),e),d=a.pow(l,r),f=a.pow(l,e);for(;!a.eql(f,a.ONE);){if(a.eql(f,a.ZERO))return a.ZERO;let p=1;for(let g=a.sqr(f);p<h&&!a.eql(g,a.ONE);p++)g=a.sqr(g);const w=a.pow(u,V<<BigInt(h-p-1));u=a.sqr(w),d=a.mul(d,w),f=a.mul(f,u),h=p}return d}}function cc(n){if(n%xi===oc){const t=(n+V)/xi;return function(i,s){const r=i.pow(s,t);if(!i.eql(i.sqr(r),s))throw new Error("Cannot find square root");return r}}if(n%Ms===Os){const t=(n-Os)/Ms;return function(i,s){const r=i.mul(s,jt),o=i.pow(r,t),a=i.mul(s,o),l=i.mul(i.mul(a,jt),o),h=i.mul(a,i.sub(l,i.ONE));if(!i.eql(i.sqr(h),s))throw new Error("Cannot find square root");return h}}return lc(n)}const hc=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function uc(n){const t={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},e=hc.reduce((i,s)=>(i[s]="function",i),t);return Ge(n,e)}function dc(n,t,e){if(e<Q)throw new Error("Expected power > 0");if(e===Q)return n.ONE;if(e===V)return t;let i=n.ONE,s=t;for(;e>Q;)e&V&&(i=n.mul(i,s)),s=n.sqr(s),e>>=V;return i}function fc(n,t){const e=new Array(t.length),i=t.reduce((r,o,a)=>n.is0(o)?r:(e[a]=r,n.mul(r,o)),n.ONE),s=n.inv(i);return t.reduceRight((r,o,a)=>n.is0(o)?r:(e[a]=n.mul(r,e[a]),n.mul(r,o)),s),e}function mo(n,t){const e=t!==void 0?t:n.toString(2).length,i=Math.ceil(e/8);return{nBitLength:e,nByteLength:i}}function gc(n,t,e=!1,i={}){if(n<=Q)throw new Error(`Expected Field ORDER > 0, got ${n}`);const{nBitLength:s,nByteLength:r}=mo(n,t);if(r>2048)throw new Error("Field lengths over 2048 bytes are not supported");const o=cc(n),a=Object.freeze({ORDER:n,BITS:s,BYTES:r,MASK:Xi(s),ZERO:Q,ONE:V,create:l=>tt(l,n),isValid:l=>{if(typeof l!="bigint")throw new Error(`Invalid field element: expected bigint, got ${typeof l}`);return Q<=l&&l<n},is0:l=>l===Q,isOdd:l=>(l&V)===V,neg:l=>tt(-l,n),eql:(l,h)=>l===h,sqr:l=>tt(l*l,n),add:(l,h)=>tt(l+h,n),sub:(l,h)=>tt(l-h,n),mul:(l,h)=>tt(l*h,n),pow:(l,h)=>dc(a,l,h),div:(l,h)=>tt(l*Si(h,n),n),sqrN:l=>l*l,addN:(l,h)=>l+h,subN:(l,h)=>l-h,mulN:(l,h)=>l*h,inv:l=>Si(l,n),sqrt:i.sqrt||(l=>o(a,l)),invertBatch:l=>fc(a,l),cmov:(l,h,u)=>u?h:l,toBytes:l=>e?Ji(l,r):Lt(l,r),fromBytes:l=>{if(l.length!==r)throw new Error(`Fp.fromBytes: expected ${r}, got ${l.length}`);return e?Zi(l):bt(l)}});return Object.freeze(a)}function wo(n){if(typeof n!="bigint")throw new Error("field order must be bigint");const t=n.toString(2).length;return Math.ceil(t/8)}function yo(n){const t=wo(n);return t+Math.ceil(t/2)}function pc(n,t,e=!1){const i=n.length,s=wo(t),r=yo(t);if(i<16||i<r||i>1024)throw new Error(`expected ${r}-1024 bytes of input, got ${i}`);const o=e?bt(n):Zi(n),a=tt(o,t-V)+V;return e?Ji(a,s):Lt(a,s)}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const _c=BigInt(0),si=BigInt(1),ri=new WeakMap,Us=new WeakMap;function mc(n,t){const e=(r,o)=>{const a=o.negate();return r?a:o},i=r=>{if(!Number.isSafeInteger(r)||r<=0||r>t)throw new Error(`Wrong window size=${r}, should be [1..${t}]`)},s=r=>{i(r);const o=Math.ceil(t/r)+1,a=2**(r-1);return{windows:o,windowSize:a}};return{constTimeNegate:e,unsafeLadder(r,o){let a=n.ZERO,l=r;for(;o>_c;)o&si&&(a=a.add(l)),l=l.double(),o>>=si;return a},precomputeWindow(r,o){const{windows:a,windowSize:l}=s(o),h=[];let u=r,d=u;for(let f=0;f<a;f++){d=u,h.push(d);for(let p=1;p<l;p++)d=d.add(u),h.push(d);u=d.double()}return h},wNAF(r,o,a){const{windows:l,windowSize:h}=s(r);let u=n.ZERO,d=n.BASE;const f=BigInt(2**r-1),p=2**r,w=BigInt(r);for(let g=0;g<l;g++){const m=g*h;let _=Number(a&f);a>>=w,_>h&&(_-=p,a+=si);const E=m,C=m+Math.abs(_)-1,x=g%2!==0,I=_<0;_===0?d=d.add(e(x,o[E])):u=u.add(e(I,o[C]))}return{p:u,f:d}},wNAFCached(r,o,a){const l=Us.get(r)||1;let h=ri.get(r);return h||(h=this.precomputeWindow(r,l),l!==1&&ri.set(r,a(h))),this.wNAF(l,h,o)},setWindowSize(r,o){i(o),Us.set(r,o),ri.delete(r)}}}function bo(n){return uc(n.Fp),Ge(n,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...mo(n.n,n.nBitLength),...n,p:n.Fp.ORDER})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function Fs(n){n.lowS!==void 0&&we("lowS",n.lowS),n.prehash!==void 0&&we("prehash",n.prehash)}function wc(n){const t=bo(n);Ge(t,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});const{endo:e,Fp:i,a:s}=t;if(e){if(!i.eql(s,i.ZERO))throw new Error("Endomorphism can only be defined for Koblitz curves that have a=0");if(typeof e!="object"||typeof e.beta!="bigint"||typeof e.splitScalar!="function")throw new Error("Expected endomorphism with beta: bigint and splitScalar: function")}return Object.freeze({...t})}const{bytesToNumberBE:yc,hexToBytes:bc}=rc,Kt={Err:class extends Error{constructor(t=""){super(t)}},_parseInt(n){const{Err:t}=Kt;if(n.length<2||n[0]!==2)throw new t("Invalid signature integer tag");const e=n[1],i=n.subarray(2,e+2);if(!e||i.length!==e)throw new t("Invalid signature integer: wrong length");if(i[0]&128)throw new t("Invalid signature integer: negative");if(i[0]===0&&!(i[1]&128))throw new t("Invalid signature integer: unnecessary leading zero");return{d:yc(i),l:n.subarray(e+2)}},toSig(n){const{Err:t}=Kt,e=typeof n=="string"?bc(n):n;je(e);let i=e.length;if(i<2||e[0]!=48)throw new t("Invalid signature tag");if(e[1]!==i-2)throw new t("Invalid signature: incorrect length");const{d:s,l:r}=Kt._parseInt(e.subarray(2)),{d:o,l:a}=Kt._parseInt(r);if(a.length)throw new t("Invalid signature: left bytes after parsing");return{r:s,s:o}},hexFromSig(n){const t=h=>Number.parseInt(h[0],16)&8?"00"+h:h,e=h=>{const u=h.toString(16);return u.length&1?`0${u}`:u},i=t(e(n.s)),s=t(e(n.r)),r=i.length/2,o=s.length/2,a=e(r),l=e(o);return`30${e(o+r+4)}02${l}${s}02${a}${i}`}},Tt=BigInt(0),X=BigInt(1);BigInt(2);const $s=BigInt(3);BigInt(4);function Ec(n){const t=wc(n),{Fp:e}=t,i=t.toBytes||((w,g,m)=>{const _=g.toAffine();return Xt(Uint8Array.from([4]),e.toBytes(_.x),e.toBytes(_.y))}),s=t.fromBytes||(w=>{const g=w.subarray(1),m=e.fromBytes(g.subarray(0,e.BYTES)),_=e.fromBytes(g.subarray(e.BYTES,2*e.BYTES));return{x:m,y:_}});function r(w){const{a:g,b:m}=t,_=e.sqr(w),E=e.mul(_,w);return e.add(e.add(E,e.mul(w,g)),m)}if(!e.eql(e.sqr(t.Gy),r(t.Gx)))throw new Error("bad generator point: equation left != right");function o(w){return Ee(w,X,t.n)}function a(w){const{allowedPrivateKeyLengths:g,nByteLength:m,wrapPrivateKey:_,n:E}=t;if(g&&typeof w!="bigint"){if(Jt(w)&&(w=ye(w)),typeof w!="string"||!g.includes(w.length))throw new Error("Invalid key");w=w.padStart(m*2,"0")}let C;try{C=typeof w=="bigint"?w:bt(nt("private key",w,m))}catch{throw new Error(`private key must be ${m} bytes, hex or bigint, not ${typeof w}`)}return _&&(C=tt(C,E)),Nt("private key",C,X,E),C}function l(w){if(!(w instanceof d))throw new Error("ProjectivePoint expected")}const h=Ei((w,g)=>{const{px:m,py:_,pz:E}=w;if(e.eql(E,e.ONE))return{x:m,y:_};const C=w.is0();g==null&&(g=C?e.ONE:e.inv(E));const x=e.mul(m,g),I=e.mul(_,g),T=e.mul(E,g);if(C)return{x:e.ZERO,y:e.ZERO};if(!e.eql(T,e.ONE))throw new Error("invZ was invalid");return{x,y:I}}),u=Ei(w=>{if(w.is0()){if(t.allowInfinityPoint&&!e.is0(w.py))return;throw new Error("bad point: ZERO")}const{x:g,y:m}=w.toAffine();if(!e.isValid(g)||!e.isValid(m))throw new Error("bad point: x or y not FE");const _=e.sqr(m),E=r(g);if(!e.eql(_,E))throw new Error("bad point: equation left != right");if(!w.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});class d{constructor(g,m,_){if(this.px=g,this.py=m,this.pz=_,g==null||!e.isValid(g))throw new Error("x required");if(m==null||!e.isValid(m))throw new Error("y required");if(_==null||!e.isValid(_))throw new Error("z required");Object.freeze(this)}static fromAffine(g){const{x:m,y:_}=g||{};if(!g||!e.isValid(m)||!e.isValid(_))throw new Error("invalid affine point");if(g instanceof d)throw new Error("projective point not allowed");const E=C=>e.eql(C,e.ZERO);return E(m)&&E(_)?d.ZERO:new d(m,_,e.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(g){const m=e.invertBatch(g.map(_=>_.pz));return g.map((_,E)=>_.toAffine(m[E])).map(d.fromAffine)}static fromHex(g){const m=d.fromAffine(s(nt("pointHex",g)));return m.assertValidity(),m}static fromPrivateKey(g){return d.BASE.multiply(a(g))}_setWindowSize(g){p.setWindowSize(this,g)}assertValidity(){u(this)}hasEvenY(){const{y:g}=this.toAffine();if(e.isOdd)return!e.isOdd(g);throw new Error("Field doesn't support isOdd")}equals(g){l(g);const{px:m,py:_,pz:E}=this,{px:C,py:x,pz:I}=g,T=e.eql(e.mul(m,I),e.mul(C,E)),N=e.eql(e.mul(_,I),e.mul(x,E));return T&&N}negate(){return new d(this.px,e.neg(this.py),this.pz)}double(){const{a:g,b:m}=t,_=e.mul(m,$s),{px:E,py:C,pz:x}=this;let I=e.ZERO,T=e.ZERO,N=e.ZERO,P=e.mul(E,E),F=e.mul(C,C),k=e.mul(x,x),L=e.mul(E,C);return L=e.add(L,L),N=e.mul(E,x),N=e.add(N,N),I=e.mul(g,N),T=e.mul(_,k),T=e.add(I,T),I=e.sub(F,T),T=e.add(F,T),T=e.mul(I,T),I=e.mul(L,I),N=e.mul(_,N),k=e.mul(g,k),L=e.sub(P,k),L=e.mul(g,L),L=e.add(L,N),N=e.add(P,P),P=e.add(N,P),P=e.add(P,k),P=e.mul(P,L),T=e.add(T,P),k=e.mul(C,x),k=e.add(k,k),P=e.mul(k,L),I=e.sub(I,P),N=e.mul(k,F),N=e.add(N,N),N=e.add(N,N),new d(I,T,N)}add(g){l(g);const{px:m,py:_,pz:E}=this,{px:C,py:x,pz:I}=g;let T=e.ZERO,N=e.ZERO,P=e.ZERO;const F=t.a,k=e.mul(t.b,$s);let L=e.mul(m,C),y=e.mul(_,x),v=e.mul(E,I),S=e.add(m,_),b=e.add(C,x);S=e.mul(S,b),b=e.add(L,y),S=e.sub(S,b),b=e.add(m,E);let A=e.add(C,I);return b=e.mul(b,A),A=e.add(L,v),b=e.sub(b,A),A=e.add(_,E),T=e.add(x,I),A=e.mul(A,T),T=e.add(y,v),A=e.sub(A,T),P=e.mul(F,b),T=e.mul(k,v),P=e.add(T,P),T=e.sub(y,P),P=e.add(y,P),N=e.mul(T,P),y=e.add(L,L),y=e.add(y,L),v=e.mul(F,v),b=e.mul(k,b),y=e.add(y,v),v=e.sub(L,v),v=e.mul(F,v),b=e.add(b,v),L=e.mul(y,b),N=e.add(N,L),L=e.mul(A,b),T=e.mul(S,T),T=e.sub(T,L),L=e.mul(S,y),P=e.mul(A,P),P=e.add(P,L),new d(T,N,P)}subtract(g){return this.add(g.negate())}is0(){return this.equals(d.ZERO)}wNAF(g){return p.wNAFCached(this,g,d.normalizeZ)}multiplyUnsafe(g){Nt("scalar",g,Tt,t.n);const m=d.ZERO;if(g===Tt)return m;if(g===X)return this;const{endo:_}=t;if(!_)return p.unsafeLadder(this,g);let{k1neg:E,k1:C,k2neg:x,k2:I}=_.splitScalar(g),T=m,N=m,P=this;for(;C>Tt||I>Tt;)C&X&&(T=T.add(P)),I&X&&(N=N.add(P)),P=P.double(),C>>=X,I>>=X;return E&&(T=T.negate()),x&&(N=N.negate()),N=new d(e.mul(N.px,_.beta),N.py,N.pz),T.add(N)}multiply(g){const{endo:m,n:_}=t;Nt("scalar",g,X,_);let E,C;if(m){const{k1neg:x,k1:I,k2neg:T,k2:N}=m.splitScalar(g);let{p:P,f:F}=this.wNAF(I),{p:k,f:L}=this.wNAF(N);P=p.constTimeNegate(x,P),k=p.constTimeNegate(T,k),k=new d(e.mul(k.px,m.beta),k.py,k.pz),E=P.add(k),C=F.add(L)}else{const{p:x,f:I}=this.wNAF(g);E=x,C=I}return d.normalizeZ([E,C])[0]}multiplyAndAddUnsafe(g,m,_){const E=d.BASE,C=(I,T)=>T===Tt||T===X||!I.equals(E)?I.multiplyUnsafe(T):I.multiply(T),x=C(this,m).add(C(g,_));return x.is0()?void 0:x}toAffine(g){return h(this,g)}isTorsionFree(){const{h:g,isTorsionFree:m}=t;if(g===X)return!0;if(m)return m(d,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:g,clearCofactor:m}=t;return g===X?this:m?m(d,this):this.multiplyUnsafe(t.h)}toRawBytes(g=!0){return we("isCompressed",g),this.assertValidity(),i(d,this,g)}toHex(g=!0){return we("isCompressed",g),ye(this.toRawBytes(g))}}d.BASE=new d(t.Gx,t.Gy,e.ONE),d.ZERO=new d(e.ZERO,e.ONE,e.ZERO);const f=t.nBitLength,p=mc(d,t.endo?Math.ceil(f/2):f);return{CURVE:t,ProjectivePoint:d,normPrivateKeyToScalar:a,weierstrassEquation:r,isWithinCurveOrder:o}}function xc(n){const t=bo(n);return Ge(t,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...t})}function Sc(n){const t=xc(n),{Fp:e,n:i}=t,s=e.BYTES+1,r=2*e.BYTES+1;function o(S){return tt(S,i)}function a(S){return Si(S,i)}const{ProjectivePoint:l,normPrivateKeyToScalar:h,weierstrassEquation:u,isWithinCurveOrder:d}=Ec({...t,toBytes(S,b,A){const R=b.toAffine(),B=e.toBytes(R.x),D=Xt;return we("isCompressed",A),A?D(Uint8Array.from([b.hasEvenY()?2:3]),B):D(Uint8Array.from([4]),B,e.toBytes(R.y))},fromBytes(S){const b=S.length,A=S[0],R=S.subarray(1);if(b===s&&(A===2||A===3)){const B=bt(R);if(!Ee(B,X,e.ORDER))throw new Error("Point is not on curve");const D=u(B);let U;try{U=e.sqrt(D)}catch(O){const W=O instanceof Error?": "+O.message:"";throw new Error("Point is not on curve"+W)}const $=(U&X)===X;return(A&1)===1!==$&&(U=e.neg(U)),{x:B,y:U}}else if(b===r&&A===4){const B=e.fromBytes(R.subarray(0,e.BYTES)),D=e.fromBytes(R.subarray(e.BYTES,2*e.BYTES));return{x:B,y:D}}else throw new Error(`Point of length ${b} was invalid. Expected ${s} compressed bytes or ${r} uncompressed bytes`)}}),f=S=>ye(Lt(S,t.nByteLength));function p(S){const b=i>>X;return S>b}function w(S){return p(S)?o(-S):S}const g=(S,b,A)=>bt(S.slice(b,A));class m{constructor(b,A,R){this.r=b,this.s=A,this.recovery=R,this.assertValidity()}static fromCompact(b){const A=t.nByteLength;return b=nt("compactSignature",b,A*2),new m(g(b,0,A),g(b,A,2*A))}static fromDER(b){const{r:A,s:R}=Kt.toSig(nt("DER",b));return new m(A,R)}assertValidity(){Nt("r",this.r,X,i),Nt("s",this.s,X,i)}addRecoveryBit(b){return new m(this.r,this.s,b)}recoverPublicKey(b){const{r:A,s:R,recovery:B}=this,D=T(nt("msgHash",b));if(B==null||![0,1,2,3].includes(B))throw new Error("recovery id invalid");const U=B===2||B===3?A+t.n:A;if(U>=e.ORDER)throw new Error("recovery id 2 or 3 invalid");const $=B&1?"03":"02",Z=l.fromHex($+f(U)),O=a(U),W=o(-D*O),et=o(R*O),j=l.BASE.multiplyAndAddUnsafe(Z,W,et);if(!j)throw new Error("point at infinify");return j.assertValidity(),j}hasHighS(){return p(this.s)}normalizeS(){return this.hasHighS()?new m(this.r,o(-this.s),this.recovery):this}toDERRawBytes(){return be(this.toDERHex())}toDERHex(){return Kt.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return be(this.toCompactHex())}toCompactHex(){return f(this.r)+f(this.s)}}const _={isValidPrivateKey(S){try{return h(S),!0}catch{return!1}},normPrivateKeyToScalar:h,randomPrivateKey:()=>{const S=yo(t.n);return pc(t.randomBytes(S),t.n)},precompute(S=8,b=l.BASE){return b._setWindowSize(S),b.multiply(BigInt(3)),b}};function E(S,b=!0){return l.fromPrivateKey(S).toRawBytes(b)}function C(S){const b=Jt(S),A=typeof S=="string",R=(b||A)&&S.length;return b?R===s||R===r:A?R===2*s||R===2*r:S instanceof l}function x(S,b,A=!0){if(C(S))throw new Error("first arg must be private key");if(!C(b))throw new Error("second arg must be public key");return l.fromHex(b).multiply(h(S)).toRawBytes(A)}const I=t.bits2int||function(S){const b=bt(S),A=S.length*8-t.nBitLength;return A>0?b>>BigInt(A):b},T=t.bits2int_modN||function(S){return o(I(S))},N=Xi(t.nBitLength);function P(S){return Nt(`num < 2^${t.nBitLength}`,S,Tt,N),Lt(S,t.nByteLength)}function F(S,b,A=k){if(["recovered","canonical"].some(K=>K in A))throw new Error("sign() legacy options not supported");const{hash:R,randomBytes:B}=t;let{lowS:D,prehash:U,extraEntropy:$}=A;D==null&&(D=!0),S=nt("msgHash",S),Fs(A),U&&(S=nt("prehashed msgHash",R(S)));const Z=T(S),O=h(b),W=[P(O),P(Z)];if($!=null&&$!==!1){const K=$===!0?B(e.BYTES):$;W.push(nt("extraEntropy",K))}const et=Xt(...W),j=Z;function lt(K){const Y=I(K);if(!d(Y))return;const J=a(Y),q=l.BASE.multiply(Y).toAffine(),z=o(q.x);if(z===Tt)return;const ut=o(J*o(j+z*O));if(ut===Tt)return;let Ut=(q.x===z?0:2)|Number(q.y&X),Xn=ut;return D&&p(ut)&&(Xn=w(ut),Ut^=1),new m(z,Xn,Ut)}return{seed:et,k2sig:lt}}const k={lowS:t.lowS,prehash:!1},L={lowS:t.lowS,prehash:!1};function y(S,b,A=k){const{seed:R,k2sig:B}=F(S,b,A),D=t;return _o(D.hash.outputLen,D.nByteLength,D.hmac)(R,B)}l.BASE._setWindowSize(8);function v(S,b,A,R=L){var q;const B=S;if(b=nt("msgHash",b),A=nt("publicKey",A),"strict"in R)throw new Error("options.strict was renamed to lowS");Fs(R);const{lowS:D,prehash:U}=R;let $,Z;try{if(typeof B=="string"||Jt(B))try{$=m.fromDER(B)}catch(z){if(!(z instanceof Kt.Err))throw z;$=m.fromCompact(B)}else if(typeof B=="object"&&typeof B.r=="bigint"&&typeof B.s=="bigint"){const{r:z,s:ut}=B;$=new m(z,ut)}else throw new Error("PARSE");Z=l.fromHex(A)}catch(z){if(z.message==="PARSE")throw new Error("signature must be Signature instance, Uint8Array or hex string");return!1}if(D&&$.hasHighS())return!1;U&&(b=t.hash(b));const{r:O,s:W}=$,et=T(b),j=a(W),lt=o(et*j),K=o(O*j),Y=(q=l.BASE.multiplyAndAddUnsafe(Z,lt,K))==null?void 0:q.toAffine();return Y?o(Y.x)===O:!1}return{CURVE:t,getPublicKey:E,getSharedSecret:x,sign:y,verify:v,ProjectivePoint:l,Signature:m,utils:_}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function Cc(n){return{hash:n,hmac:(t,...e)=>go(n,t,Hl(...e)),randomBytes:uo}}function Ac(n,t){const e=i=>Sc({...n,...Cc(i)});return Object.freeze({...e(t),create:e})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Ke=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),In=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),Oe=BigInt(1),Rn=BigInt(2),Hs=(n,t)=>(n+t/Rn)/t;function Eo(n){const t=Ke,e=BigInt(3),i=BigInt(6),s=BigInt(11),r=BigInt(22),o=BigInt(23),a=BigInt(44),l=BigInt(88),h=n*n*n%t,u=h*h*n%t,d=ot(u,e,t)*u%t,f=ot(d,e,t)*u%t,p=ot(f,Rn,t)*h%t,w=ot(p,s,t)*p%t,g=ot(w,r,t)*w%t,m=ot(g,a,t)*g%t,_=ot(m,l,t)*m%t,E=ot(_,a,t)*g%t,C=ot(E,e,t)*u%t,x=ot(C,o,t)*w%t,I=ot(x,i,t)*h%t,T=ot(I,Rn,t);if(!Ci.eql(Ci.sqr(T),n))throw new Error("Cannot find square root");return T}const Ci=gc(Ke,void 0,void 0,{sqrt:Eo}),Qi=Ac({a:BigInt(0),b:BigInt(7),Fp:Ci,n:In,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:n=>{const t=In,e=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),i=-Oe*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),s=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),r=e,o=BigInt("0x100000000000000000000000000000000"),a=Hs(r*n,t),l=Hs(-i*n,t);let h=tt(n-a*e-l*s,t),u=tt(-a*i-l*r,t);const d=h>o,f=u>o;if(d&&(h=t-h),f&&(u=t-u),h>o||u>o)throw new Error("splitScalar: Endomorphism failed, k="+n);return{k1neg:d,k1:h,k2neg:f,k2:u}}}},bi),xo=BigInt(0),qs={};function Nn(n,...t){let e=qs[n];if(e===void 0){const i=bi(Uint8Array.from(n,s=>s.charCodeAt(0)));e=Xt(i,i),qs[n]=e}return bi(Xt(e,...t))}const ts=n=>n.toRawBytes(!0).slice(1),Ai=n=>Lt(n,32),oi=n=>tt(n,Ke),Me=n=>tt(n,In),es=Qi.ProjectivePoint,Tc=(n,t,e)=>es.BASE.multiplyAndAddUnsafe(n,t,e);function Ti(n){let t=Qi.utils.normPrivateKeyToScalar(n),e=es.fromPrivateKey(t);return{scalar:e.hasEvenY()?t:Me(-t),bytes:ts(e)}}function So(n){Nt("x",n,Oe,Ke);const t=oi(n*n),e=oi(t*n+BigInt(7));let i=Eo(e);i%Rn!==xo&&(i=oi(-i));const s=new es(n,i,Oe);return s.assertValidity(),s}const ue=bt;function Co(...n){return Me(ue(Nn("BIP0340/challenge",...n)))}function vc(n){return Ti(n).bytes}function Ic(n,t,e=uo(32)){const i=nt("message",n),{bytes:s,scalar:r}=Ti(t),o=nt("auxRand",e,32),a=Ai(r^ue(Nn("BIP0340/aux",o))),l=Nn("BIP0340/nonce",a,s,i),h=Me(ue(l));if(h===xo)throw new Error("sign failed: k is zero");const{bytes:u,scalar:d}=Ti(h),f=Co(u,s,i),p=new Uint8Array(64);if(p.set(u,0),p.set(Ai(Me(d+f*r)),32),!Ao(p,i,s))throw new Error("sign: Invalid signature produced");return p}function Ao(n,t,e){const i=nt("signature",n,64),s=nt("message",t),r=nt("publicKey",e,32);try{const o=So(ue(r)),a=ue(i.subarray(0,32));if(!Ee(a,Oe,Ke))return!1;const l=ue(i.subarray(32,64));if(!Ee(l,Oe,In))return!1;const h=Co(Ai(a),ts(o),s),u=Tc(o,l,Me(-h));return!(!u||!u.hasEvenY()||u.toAffine().x!==a)}catch{return!1}}const ns={getPublicKey:vc,sign:Ic,verify:Ao,utils:{randomPrivateKey:Qi.utils.randomPrivateKey,lift_x:So,pointToBytes:ts,numberToBytesBE:Lt,bytesToNumberBE:bt,taggedHash:Nn,mod:tt}},Ue="Trystero",Fe=(n,t)=>Array(n).fill().map(t),zs="0123456789AaBbCcDdEeFfGgHhIiJjKkLlMmNnOoPpQqRrSsTtUuVvWwXxYyZz",vi=n=>Fe(n,()=>zs[Math.floor(Math.random()*zs.length)]).join(""),le=vi(20),ce=Promise.all.bind(Promise),is=typeof window<"u",{entries:Ys,fromEntries:Rc,keys:Nc}=Object,qt=()=>{},wt=n=>new Error(`${Ue}: ${n}`),Bc=new TextEncoder,Pc=new TextDecoder,Vt=n=>Bc.encode(n),gn=n=>Pc.decode(n),Ii=n=>n.reduce((t,e)=>t+e.toString(16).padStart(2,"0"),""),nn=(...n)=>n.join("@"),kc=(n,t,e)=>(n.relayUrls||t).slice(0,n.relayUrls?n.relayUrls.length:n.relayRedundancy||e),xt=JSON.stringify,Bn=JSON.parse,Ws=3333,re={},Lc=(n,t)=>{const e={},i=()=>{const s=new WebSocket(n);s.onclose=()=>{re[n]??(re[n]=Ws),setTimeout(i,re[n]),re[n]*=2},s.onmessage=r=>t(r.data),e.socket=s,e.url=s.url,e.ready=new Promise(r=>s.onopen=()=>{r(e),re[n]=Ws}),e.send=r=>{s.readyState===1&&s.send(r)}};return i(),e},ss="AES-GCM",ai={},Dc=n=>btoa(String.fromCharCode.apply(null,new Uint8Array(n))),Oc=n=>{const t=atob(n);return new Uint8Array(t.length).map((e,i)=>t.charCodeAt(i)).buffer},sn=async n=>{if(ai[n])return ai[n];const t=Array.from(new Uint8Array(await crypto.subtle.digest("SHA-1",Vt(n)))).map(e=>e.toString(36)).join("");return ai[n]=t,t},Mc=async(n,t,e)=>crypto.subtle.importKey("raw",await crypto.subtle.digest({name:"SHA-256"},Vt(`${n}:${t}:${e}`)),{name:ss},!1,["encrypt","decrypt"]),To="$",vo=",",Uc=async(n,t)=>{const e=crypto.getRandomValues(new Uint8Array(16));return e.join(vo)+To+Dc(await crypto.subtle.encrypt({name:ss,iv:e},await n,Vt(t)))},Fc=async(n,t)=>{const[e,i]=t.split(To);return gn(await crypto.subtle.decrypt({name:ss,iv:new Uint8Array(e.split(vo))},await n,Oc(i)))};function Io(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var Ri={exports:{}},li,js;function $c(){if(js)return li;js=1;var n=1e3,t=n*60,e=t*60,i=e*24,s=i*7,r=i*365.25;li=function(u,d){d=d||{};var f=typeof u;if(f==="string"&&u.length>0)return o(u);if(f==="number"&&isFinite(u))return d.long?l(u):a(u);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(u))};function o(u){if(u=String(u),!(u.length>100)){var d=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(u);if(d){var f=parseFloat(d[1]),p=(d[2]||"ms").toLowerCase();switch(p){case"years":case"year":case"yrs":case"yr":case"y":return f*r;case"weeks":case"week":case"w":return f*s;case"days":case"day":case"d":return f*i;case"hours":case"hour":case"hrs":case"hr":case"h":return f*e;case"minutes":case"minute":case"mins":case"min":case"m":return f*t;case"seconds":case"second":case"secs":case"sec":case"s":return f*n;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return f;default:return}}}}function a(u){var d=Math.abs(u);return d>=i?Math.round(u/i)+"d":d>=e?Math.round(u/e)+"h":d>=t?Math.round(u/t)+"m":d>=n?Math.round(u/n)+"s":u+"ms"}function l(u){var d=Math.abs(u);return d>=i?h(u,d,i,"day"):d>=e?h(u,d,e,"hour"):d>=t?h(u,d,t,"minute"):d>=n?h(u,d,n,"second"):u+" ms"}function h(u,d,f,p){var w=d>=f*1.5;return Math.round(u/f)+" "+p+(w?"s":"")}return li}function Hc(n){e.debug=e,e.default=e,e.coerce=l,e.disable=r,e.enable=s,e.enabled=o,e.humanize=$c(),e.destroy=h,Object.keys(n).forEach(u=>{e[u]=n[u]}),e.names=[],e.skips=[],e.formatters={};function t(u){let d=0;for(let f=0;f<u.length;f++)d=(d<<5)-d+u.charCodeAt(f),d|=0;return e.colors[Math.abs(d)%e.colors.length]}e.selectColor=t;function e(u){let d,f=null,p,w;function g(...m){if(!g.enabled)return;const _=g,E=Number(new Date),C=E-(d||E);_.diff=C,_.prev=d,_.curr=E,d=E,m[0]=e.coerce(m[0]),typeof m[0]!="string"&&m.unshift("%O");let x=0;m[0]=m[0].replace(/%([a-zA-Z%])/g,(T,N)=>{if(T==="%%")return"%";x++;const P=e.formatters[N];if(typeof P=="function"){const F=m[x];T=P.call(_,F),m.splice(x,1),x--}return T}),e.formatArgs.call(_,m),(_.log||e.log).apply(_,m)}return g.namespace=u,g.useColors=e.useColors(),g.color=e.selectColor(u),g.extend=i,g.destroy=e.destroy,Object.defineProperty(g,"enabled",{enumerable:!0,configurable:!1,get:()=>f!==null?f:(p!==e.namespaces&&(p=e.namespaces,w=e.enabled(u)),w),set:m=>{f=m}}),typeof e.init=="function"&&e.init(g),g}function i(u,d){const f=e(this.namespace+(typeof d>"u"?":":d)+u);return f.log=this.log,f}function s(u){e.save(u),e.namespaces=u,e.names=[],e.skips=[];let d;const f=(typeof u=="string"?u:"").split(/[\s,]+/),p=f.length;for(d=0;d<p;d++)f[d]&&(u=f[d].replace(/\*/g,".*?"),u[0]==="-"?e.skips.push(new RegExp("^"+u.slice(1)+"$")):e.names.push(new RegExp("^"+u+"$")))}function r(){const u=[...e.names.map(a),...e.skips.map(a).map(d=>"-"+d)].join(",");return e.enable(""),u}function o(u){if(u[u.length-1]==="*")return!0;let d,f;for(d=0,f=e.skips.length;d<f;d++)if(e.skips[d].test(u))return!1;for(d=0,f=e.names.length;d<f;d++)if(e.names[d].test(u))return!0;return!1}function a(u){return u.toString().substring(2,u.toString().length-2).replace(/\.\*\?$/,"*")}function l(u){return u instanceof Error?u.stack||u.message:u}function h(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return e.enable(e.load()),e}var qc=Hc;(function(n,t){var e={};t.formatArgs=s,t.save=r,t.load=o,t.useColors=i,t.storage=a(),t.destroy=(()=>{let h=!1;return()=>{h||(h=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function i(){if(typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))return!0;if(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let h;return typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&(h=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(h[1],10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function s(h){if(h[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+h[0]+(this.useColors?"%c ":" ")+"+"+n.exports.humanize(this.diff),!this.useColors)return;const u="color: "+this.color;h.splice(1,0,u,"color: inherit");let d=0,f=0;h[0].replace(/%[a-zA-Z%]/g,p=>{p!=="%%"&&(d++,p==="%c"&&(f=d))}),h.splice(f,0,u)}t.log=console.debug||console.log||(()=>{});function r(h){try{h?t.storage.setItem("debug",h):t.storage.removeItem("debug")}catch{}}function o(){let h;try{h=t.storage.getItem("debug")}catch{}return!h&&typeof process<"u"&&"env"in process&&(h=e.DEBUG),h}function a(){try{return localStorage}catch{}}n.exports=qc(t);const{formatters:l}=n.exports;l.j=function(h){try{return JSON.stringify(h)}catch(u){return"[UnexpectedJSONParseError]: "+u.message}}})(Ri,Ri.exports);var zc=Ri.exports;const Yc=Io(zc),Et=typeof window<"u"?window:self,Ni=Et.RTCPeerConnection||Et.mozRTCPeerConnection||Et.webkitRTCPeerConnection,Wc=Et.RTCSessionDescription||Et.mozRTCSessionDescription||Et.webkitRTCSessionDescription,jc=Et.RTCIceCandidate||Et.mozRTCIceCandidate||Et.webkitRTCIceCandidate;var rs={exports:{}},de=typeof Reflect=="object"?Reflect:null,Gs=de&&typeof de.apply=="function"?de.apply:function(t,e,i){return Function.prototype.apply.call(t,e,i)},pn;de&&typeof de.ownKeys=="function"?pn=de.ownKeys:Object.getOwnPropertySymbols?pn=function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:pn=function(t){return Object.getOwnPropertyNames(t)};function Gc(n){console&&console.warn&&console.warn(n)}var Ro=Number.isNaN||function(t){return t!==t};function H(){H.init.call(this)}rs.exports=H;rs.exports.once=Jc;H.EventEmitter=H;H.prototype._events=void 0;H.prototype._eventsCount=0;H.prototype._maxListeners=void 0;var Ks=10;function zn(n){if(typeof n!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof n)}Object.defineProperty(H,"defaultMaxListeners",{enumerable:!0,get:function(){return Ks},set:function(n){if(typeof n!="number"||n<0||Ro(n))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+n+".");Ks=n}});H.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};H.prototype.setMaxListeners=function(t){if(typeof t!="number"||t<0||Ro(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this};function No(n){return n._maxListeners===void 0?H.defaultMaxListeners:n._maxListeners}H.prototype.getMaxListeners=function(){return No(this)};H.prototype.emit=function(t){for(var e=[],i=1;i<arguments.length;i++)e.push(arguments[i]);var s=t==="error",r=this._events;if(r!==void 0)s=s&&r.error===void 0;else if(!s)return!1;if(s){var o;if(e.length>0&&(o=e[0]),o instanceof Error)throw o;var a=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw a.context=o,a}var l=r[t];if(l===void 0)return!1;if(typeof l=="function")Gs(l,this,e);else for(var h=l.length,u=Do(l,h),i=0;i<h;++i)Gs(u[i],this,e);return!0};function Bo(n,t,e,i){var s,r,o;if(zn(e),r=n._events,r===void 0?(r=n._events=Object.create(null),n._eventsCount=0):(r.newListener!==void 0&&(n.emit("newListener",t,e.listener?e.listener:e),r=n._events),o=r[t]),o===void 0)o=r[t]=e,++n._eventsCount;else if(typeof o=="function"?o=r[t]=i?[e,o]:[o,e]:i?o.unshift(e):o.push(e),s=No(n),s>0&&o.length>s&&!o.warned){o.warned=!0;var a=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");a.name="MaxListenersExceededWarning",a.emitter=n,a.type=t,a.count=o.length,Gc(a)}return n}H.prototype.addListener=function(t,e){return Bo(this,t,e,!1)};H.prototype.on=H.prototype.addListener;H.prototype.prependListener=function(t,e){return Bo(this,t,e,!0)};function Kc(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function Po(n,t,e){var i={fired:!1,wrapFn:void 0,target:n,type:t,listener:e},s=Kc.bind(i);return s.listener=e,i.wrapFn=s,s}H.prototype.once=function(t,e){return zn(e),this.on(t,Po(this,t,e)),this};H.prototype.prependOnceListener=function(t,e){return zn(e),this.prependListener(t,Po(this,t,e)),this};H.prototype.removeListener=function(t,e){var i,s,r,o,a;if(zn(e),s=this._events,s===void 0)return this;if(i=s[t],i===void 0)return this;if(i===e||i.listener===e)--this._eventsCount===0?this._events=Object.create(null):(delete s[t],s.removeListener&&this.emit("removeListener",t,i.listener||e));else if(typeof i!="function"){for(r=-1,o=i.length-1;o>=0;o--)if(i[o]===e||i[o].listener===e){a=i[o].listener,r=o;break}if(r<0)return this;r===0?i.shift():Vc(i,r),i.length===1&&(s[t]=i[0]),s.removeListener!==void 0&&this.emit("removeListener",t,a||e)}return this};H.prototype.off=H.prototype.removeListener;H.prototype.removeAllListeners=function(t){var e,i,s;if(i=this._events,i===void 0)return this;if(i.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):i[t]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete i[t]),this;if(arguments.length===0){var r=Object.keys(i),o;for(s=0;s<r.length;++s)o=r[s],o!=="removeListener"&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(e=i[t],typeof e=="function")this.removeListener(t,e);else if(e!==void 0)for(s=e.length-1;s>=0;s--)this.removeListener(t,e[s]);return this};function ko(n,t,e){var i=n._events;if(i===void 0)return[];var s=i[t];return s===void 0?[]:typeof s=="function"?e?[s.listener||s]:[s]:e?Zc(s):Do(s,s.length)}H.prototype.listeners=function(t){return ko(this,t,!0)};H.prototype.rawListeners=function(t){return ko(this,t,!1)};H.listenerCount=function(n,t){return typeof n.listenerCount=="function"?n.listenerCount(t):Lo.call(n,t)};H.prototype.listenerCount=Lo;function Lo(n){var t=this._events;if(t!==void 0){var e=t[n];if(typeof e=="function")return 1;if(e!==void 0)return e.length}return 0}H.prototype.eventNames=function(){return this._eventsCount>0?pn(this._events):[]};function Do(n,t){for(var e=new Array(t),i=0;i<t;++i)e[i]=n[i];return e}function Vc(n,t){for(;t+1<n.length;t++)n[t]=n[t+1];n.pop()}function Zc(n){for(var t=new Array(n.length),e=0;e<t.length;++e)t[e]=n[e].listener||n[e];return t}function Jc(n,t){return new Promise(function(e,i){function s(o){n.removeListener(t,r),i(o)}function r(){typeof n.removeListener=="function"&&n.removeListener("error",s),e([].slice.call(arguments))}Oo(n,t,r,{once:!0}),t!=="error"&&Xc(n,s,{once:!0})})}function Xc(n,t,e){typeof n.on=="function"&&Oo(n,"error",t,e)}function Oo(n,t,e,i){if(typeof n.on=="function")i.once?n.once(t,e):n.on(t,e);else if(typeof n.addEventListener=="function")n.addEventListener(t,function s(r){i.once&&n.removeEventListener(t,s),e(r)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof n)}var Qc=rs.exports,th=typeof queueMicrotask=="function"?queueMicrotask:n=>Promise.resolve().then(n),eh=class{constructor(t){if(!(t>0)||t-1&t)throw new Error("Max size for a FixedFIFO should be a power of two");this.buffer=new Array(t),this.mask=t-1,this.top=0,this.btm=0,this.next=null}clear(){this.top=this.btm=0,this.next=null,this.buffer.fill(void 0)}push(t){return this.buffer[this.top]!==void 0?!1:(this.buffer[this.top]=t,this.top=this.top+1&this.mask,!0)}shift(){const t=this.buffer[this.btm];if(t!==void 0)return this.buffer[this.btm]=void 0,this.btm=this.btm+1&this.mask,t}peek(){return this.buffer[this.btm]}isEmpty(){return this.buffer[this.btm]===void 0}};const Vs=eh;var nh=class{constructor(t){this.hwm=t||16,this.head=new Vs(this.hwm),this.tail=this.head,this.length=0}clear(){this.head=this.tail,this.head.clear(),this.length=0}push(t){if(this.length++,!this.head.push(t)){const e=this.head;this.head=e.next=new Vs(2*this.head.buffer.length),this.head.push(t)}}shift(){this.length!==0&&this.length--;const t=this.tail.shift();if(t===void 0&&this.tail.next){const e=this.tail.next;return this.tail.next=null,this.tail=e,this.tail.shift()}return t}peek(){const t=this.tail.peek();return t===void 0&&this.tail.next?this.tail.next.peek():t}isEmpty(){return this.length===0}},Mo=class{constructor(t){this.decoder=new TextDecoder(t==="utf16le"?"utf16-le":t)}decode(t){return this.decoder.decode(t,{stream:!0})}flush(){return this.decoder.decode(new Uint8Array(0))}};const ih=Mo,sh=Mo;var rh=class{constructor(t="utf8"){switch(this.encoding=oh(t),this.encoding){case"utf8":this.decoder=new sh;break;case"utf16le":case"base64":throw new Error("Unsupported encoding: "+this.encoding);default:this.decoder=new ih(this.encoding)}}push(t){return typeof t=="string"?t:this.decoder.decode(t)}write(t){return this.push(t)}end(t){let e="";return t&&(e=this.push(t)),e+=this.decoder.flush(),e}};function oh(n){switch(n=n.toLowerCase(),n){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return n;default:throw new Error("Unknown encoding: "+n)}}const{EventEmitter:ah}=Qc,Yn=new Error("Stream was destroyed"),ci=new Error("Premature close"),Uo=th,Fo=nh,lh=rh,G=(1<<29)-1,ie=1,os=2,Qt=4,$e=8,$o=G^ie,ch=G^os,Ve=16,He=32,Ne=64,Bt=128,Ze=256,as=512,te=1024,Bi=2048,ls=4096,cs=8192,ht=16384,fe=32768,Wn=65536,ee=131072,Ho=Ze|as,hh=Ve|Wn,uh=Ne|Ve,dh=ls|Bt,hs=Ze|ee,fh=G^Ve,gh=G^Ne,ph=G^(Ne|Wn),_h=G^Wn,mh=G^Ze,wh=G^(Bt|cs),yh=G^te,Zs=G^Ho,qo=G^fe,bh=G^He,zo=G^ee,Eh=G^hs,Ot=1<<18,xe=2<<18,Je=4<<18,ne=8<<18,Xe=16<<18,se=32<<18,Pi=64<<18,ge=128<<18,us=256<<18,Se=512<<18,jn=1024<<18,Yo=G^(Ot|us),Wo=G^Je,xh=G^Se,Sh=G^Xe,Ch=G^ne,jo=G^ge,Ah=G^xe,Go=G^jn,qe=Ve|Ot,Ko=G^qe,ds=ht|se,St=Qt|$e|os,it=St|ie,Vo=St|ds,Th=Wo&gh,fs=ge|fe,vh=fs&Ko,Zo=it|vh,Ih=it|te|ht,Js=it|ht|Bt,Rh=it|te|Bt,Nh=it|ls|Bt|cs,Bh=it|Ve|te|ht|Wn|ee,Ph=St|te|ht,kh=He|it|fe|Ne,Lh=it|Se|se,Dh=ne|Xe,Jo=ne|Ot,Oh=ne|Xe|it|Ot,Xs=it|Ot|ne|jn,Mh=Je|Ot,Uh=Ot|us,Fh=it|Se|Jo|se,$h=Xe|St|Se|se,Hh=xe|it|ge|Je,rn=Symbol.asyncIterator||Symbol("asyncIterator");class Xo{constructor(t,{highWaterMark:e=16384,map:i=null,mapWritable:s,byteLength:r,byteLengthWritable:o}={}){this.stream=t,this.queue=new Fo,this.highWaterMark=e,this.buffered=0,this.error=null,this.pipeline=null,this.drains=null,this.byteLength=o||r||ra,this.map=s||i,this.afterWrite=Gh.bind(this),this.afterUpdateNextTick=Zh.bind(this)}get ended(){return(this.stream._duplexState&se)!==0}push(t){return this.map!==null&&(t=this.map(t)),this.buffered+=this.byteLength(t),this.queue.push(t),this.buffered<this.highWaterMark?(this.stream._duplexState|=ne,!0):(this.stream._duplexState|=Dh,!1)}shift(){const t=this.queue.shift();return this.buffered-=this.byteLength(t),this.buffered===0&&(this.stream._duplexState&=Ch),t}end(t){typeof t=="function"?this.stream.once("finish",t):t!=null&&this.push(t),this.stream._duplexState=(this.stream._duplexState|Se)&Wo}autoBatch(t,e){const i=[],s=this.stream;for(i.push(t);(s._duplexState&Xs)===Jo;)i.push(s._writableState.shift());if(s._duplexState&it)return e(null);s._writev(i,e)}update(){const t=this.stream;t._duplexState|=xe;do{for(;(t._duplexState&Xs)===ne;){const e=this.shift();t._duplexState|=Uh,t._write(e,this.afterWrite)}t._duplexState&Mh||this.updateNonPrimary()}while(this.continueUpdate()===!0);t._duplexState&=Ah}updateNonPrimary(){const t=this.stream;if((t._duplexState&Fh)===Se){t._duplexState=(t._duplexState|Ot)&xh,t._final(jh.bind(this));return}if((t._duplexState&St)===Qt){t._duplexState&fs||(t._duplexState|=qe,t._destroy(Qo.bind(this)));return}(t._duplexState&Zo)===ie&&(t._duplexState=(t._duplexState|qe)&$o,t._open(ta.bind(this)))}continueUpdate(){return this.stream._duplexState&ge?(this.stream._duplexState&=jo,!0):!1}updateCallback(){(this.stream._duplexState&Hh)===Je?this.update():this.updateNextTick()}updateNextTick(){this.stream._duplexState&ge||(this.stream._duplexState|=ge,this.stream._duplexState&xe||Uo(this.afterUpdateNextTick))}}class qh{constructor(t,{highWaterMark:e=16384,map:i=null,mapReadable:s,byteLength:r,byteLengthReadable:o}={}){this.stream=t,this.queue=new Fo,this.highWaterMark=e===0?1:e,this.buffered=0,this.readAhead=e>0,this.error=null,this.pipeline=null,this.byteLength=o||r||ra,this.map=s||i,this.pipeTo=null,this.afterRead=Kh.bind(this),this.afterUpdateNextTick=Vh.bind(this)}get ended(){return(this.stream._duplexState&ht)!==0}pipe(t,e){if(this.pipeTo!==null)throw new Error("Can only pipe to one destination");if(typeof e!="function"&&(e=null),this.stream._duplexState|=as,this.pipeTo=t,this.pipeline=new Yh(this.stream,t,e),e&&this.stream.on("error",Qs),Ye(t))t._writableState.pipeline=this.pipeline,e&&t.on("error",Qs),t.on("finish",this.pipeline.finished.bind(this.pipeline));else{const i=this.pipeline.done.bind(this.pipeline,t),s=this.pipeline.done.bind(this.pipeline,t,null);t.on("error",i),t.on("close",s),t.on("finish",this.pipeline.finished.bind(this.pipeline))}t.on("drain",Wh.bind(this)),this.stream.emit("piping",t),t.emit("pipe",this.stream)}push(t){const e=this.stream;return t===null?(this.highWaterMark=0,e._duplexState=(e._duplexState|te)&ph,!1):this.map!==null&&(t=this.map(t),t===null)?this.buffered<this.highWaterMark:(this.buffered+=this.byteLength(t),this.queue.push(t),e._duplexState=(e._duplexState|Bt)&_h,this.buffered<this.highWaterMark)}shift(){const t=this.queue.shift();return this.buffered-=this.byteLength(t),this.buffered===0&&(this.stream._duplexState&=wh),t}unshift(t){const e=[this.map!==null?this.map(t):t];for(;this.buffered>0;)e.push(this.shift());for(let i=0;i<e.length-1;i++){const s=e[i];this.buffered+=this.byteLength(s),this.queue.push(s)}this.push(e[e.length-1])}read(){const t=this.stream;if((t._duplexState&Js)===Bt){const e=this.shift();return this.pipeTo!==null&&this.pipeTo.write(e)===!1&&(t._duplexState&=Zs),t._duplexState&Bi&&t.emit("data",e),e}return this.readAhead===!1&&(t._duplexState|=ee,this.updateNextTick()),null}drain(){const t=this.stream;for(;(t._duplexState&Js)===Bt&&t._duplexState&Ho;){const e=this.shift();this.pipeTo!==null&&this.pipeTo.write(e)===!1&&(t._duplexState&=Zs),t._duplexState&Bi&&t.emit("data",e)}}update(){const t=this.stream;t._duplexState|=He;do{for(this.drain();this.buffered<this.highWaterMark&&(t._duplexState&Bh)===ee;)t._duplexState|=hh,t._read(this.afterRead),this.drain();(t._duplexState&Nh)===dh&&(t._duplexState|=cs,t.emit("readable")),t._duplexState&uh||this.updateNonPrimary()}while(this.continueUpdate()===!0);t._duplexState&=bh}updateNonPrimary(){const t=this.stream;if((t._duplexState&Rh)===te&&(t._duplexState=(t._duplexState|ht)&yh,t.emit("end"),(t._duplexState&Vo)===ds&&(t._duplexState|=Qt),this.pipeTo!==null&&this.pipeTo.end()),(t._duplexState&St)===Qt){t._duplexState&fs||(t._duplexState|=qe,t._destroy(Qo.bind(this)));return}(t._duplexState&Zo)===ie&&(t._duplexState=(t._duplexState|qe)&$o,t._open(ta.bind(this)))}continueUpdate(){return this.stream._duplexState&fe?(this.stream._duplexState&=qo,!0):!1}updateCallback(){(this.stream._duplexState&kh)===Ne?this.update():this.updateNextTick()}updateNextTick(){this.stream._duplexState&fe||(this.stream._duplexState|=fe,this.stream._duplexState&He||Uo(this.afterUpdateNextTick))}}class zh{constructor(t){this.data=null,this.afterTransform=Xh.bind(t),this.afterFinal=null}}class Yh{constructor(t,e,i){this.from=t,this.to=e,this.afterPipe=i,this.error=null,this.pipeToFinished=!1}finished(){this.pipeToFinished=!0}done(t,e){if(e&&(this.error=e),t===this.to&&(this.to=null,this.from!==null)){(!(this.from._duplexState&ht)||!this.pipeToFinished)&&this.from.destroy(this.error||new Error("Writable stream closed prematurely"));return}if(t===this.from&&(this.from=null,this.to!==null)){t._duplexState&ht||this.to.destroy(this.error||new Error("Readable stream closed before ending"));return}this.afterPipe!==null&&this.afterPipe(this.error),this.to=this.from=this.afterPipe=null}}function Wh(){this.stream._duplexState|=as,this.updateCallback()}function jh(n){const t=this.stream;n&&t.destroy(n),t._duplexState&St||(t._duplexState|=se,t.emit("finish")),(t._duplexState&Vo)===ds&&(t._duplexState|=Qt),t._duplexState&=Yo,t._duplexState&xe?this.updateNextTick():this.update()}function Qo(n){const t=this.stream;!n&&this.error!==Yn&&(n=this.error),n&&t.emit("error",n),t._duplexState|=$e,t.emit("close");const e=t._readableState,i=t._writableState;if(e!==null&&e.pipeline!==null&&e.pipeline.done(t,n),i!==null){for(;i.drains!==null&&i.drains.length>0;)i.drains.shift().resolve(!1);i.pipeline!==null&&i.pipeline.done(t,n)}}function Gh(n){const t=this.stream;n&&t.destroy(n),t._duplexState&=Yo,this.drains!==null&&Jh(this.drains),(t._duplexState&Oh)===Xe&&(t._duplexState&=Sh,(t._duplexState&Pi)===Pi&&t.emit("drain")),this.updateCallback()}function Kh(n){n&&this.stream.destroy(n),this.stream._duplexState&=fh,this.readAhead===!1&&!(this.stream._duplexState&Ze)&&(this.stream._duplexState&=zo),this.updateCallback()}function Vh(){this.stream._duplexState&He||(this.stream._duplexState&=qo,this.update())}function Zh(){this.stream._duplexState&xe||(this.stream._duplexState&=jo,this.update())}function Jh(n){for(let t=0;t<n.length;t++)--n[t].writes===0&&(n.shift().resolve(!0),t--)}function ta(n){const t=this.stream;n&&t.destroy(n),t._duplexState&Qt||(t._duplexState&Ih||(t._duplexState|=Ne),t._duplexState&Lh||(t._duplexState|=Je),t.emit("open")),t._duplexState&=Ko,t._writableState!==null&&t._writableState.updateCallback(),t._readableState!==null&&t._readableState.updateCallback()}function Xh(n,t){t!=null&&this.push(t),this._writableState.afterWrite(n)}function Qh(n){this._readableState!==null&&(n==="data"&&(this._duplexState|=Bi|hs,this._readableState.updateNextTick()),n==="readable"&&(this._duplexState|=ls,this._readableState.updateNextTick())),this._writableState!==null&&n==="drain"&&(this._duplexState|=Pi,this._writableState.updateNextTick())}class gs extends ah{constructor(t){super(),this._duplexState=0,this._readableState=null,this._writableState=null,t&&(t.open&&(this._open=t.open),t.destroy&&(this._destroy=t.destroy),t.predestroy&&(this._predestroy=t.predestroy),t.signal&&t.signal.addEventListener("abort",au.bind(this))),this.on("newListener",Qh)}_open(t){t(null)}_destroy(t){t(null)}_predestroy(){}get readable(){return this._readableState!==null?!0:void 0}get writable(){return this._writableState!==null?!0:void 0}get destroyed(){return(this._duplexState&$e)!==0}get destroying(){return(this._duplexState&St)!==0}destroy(t){this._duplexState&St||(t||(t=Yn),this._duplexState=(this._duplexState|Qt)&Th,this._readableState!==null&&(this._readableState.highWaterMark=0,this._readableState.error=t),this._writableState!==null&&(this._writableState.highWaterMark=0,this._writableState.error=t),this._duplexState|=os,this._predestroy(),this._duplexState&=ch,this._readableState!==null&&this._readableState.updateNextTick(),this._writableState!==null&&this._writableState.updateNextTick())}}class ze extends gs{constructor(t){super(t),this._duplexState|=ie|se|ee,this._readableState=new qh(this,t),t&&(this._readableState.readAhead===!1&&(this._duplexState&=zo),t.read&&(this._read=t.read),t.eagerOpen&&this._readableState.updateNextTick(),t.encoding&&this.setEncoding(t.encoding))}setEncoding(t){const e=new lh(t),i=this._readableState.map||iu;return this._readableState.map=s,this;function s(r){const o=e.push(r);return o===""?null:i(o)}}_read(t){t(null)}pipe(t,e){return this._readableState.updateNextTick(),this._readableState.pipe(t,e),t}read(){return this._readableState.updateNextTick(),this._readableState.read()}push(t){return this._readableState.updateNextTick(),this._readableState.push(t)}unshift(t){return this._readableState.updateNextTick(),this._readableState.unshift(t)}resume(){return this._duplexState|=hs,this._readableState.updateNextTick(),this}pause(){return this._duplexState&=this._readableState.readAhead===!1?Eh:mh,this}static _fromAsyncIterator(t,e){let i;const s=new ze({...e,read(o){t.next().then(r).then(o.bind(null,null)).catch(o)},predestroy(){i=t.return()},destroy(o){if(!i)return o(null);i.then(o.bind(null,null)).catch(o)}});return s;function r(o){o.done?s.push(null):s.push(o.value)}}static from(t,e){if(ru(t))return t;if(t[rn])return this._fromAsyncIterator(t[rn](),e);Array.isArray(t)||(t=t===void 0?[]:[t]);let i=0;return new ze({...e,read(s){this.push(i===t.length?null:t[i++]),s(null)}})}static isBackpressured(t){return(t._duplexState&Ph)!==0||t._readableState.buffered>=t._readableState.highWaterMark}static isPaused(t){return(t._duplexState&Ze)===0}[rn](){const t=this;let e=null,i=null,s=null;return this.on("error",h=>{e=h}),this.on("readable",r),this.on("close",o),{[rn](){return this},next(){return new Promise(function(h,u){i=h,s=u;const d=t.read();d!==null?a(d):t._duplexState&$e&&a(null)})},return(){return l(null)},throw(h){return l(h)}};function r(){i!==null&&a(t.read())}function o(){i!==null&&a(null)}function a(h){s!==null&&(e?s(e):h===null&&!(t._duplexState&ht)?s(Yn):i({value:h,done:h===null}),s=i=null)}function l(h){return t.destroy(h),new Promise((u,d)=>{if(t._duplexState&$e)return u({value:void 0,done:!0});t.once("close",function(){h?d(h):u({value:void 0,done:!0})})})}}}class ea extends gs{constructor(t){super(t),this._duplexState|=ie|ht,this._writableState=new Xo(this,t),t&&(t.writev&&(this._writev=t.writev),t.write&&(this._write=t.write),t.final&&(this._final=t.final),t.eagerOpen&&this._writableState.updateNextTick())}cork(){this._duplexState|=jn}uncork(){this._duplexState&=Go,this._writableState.updateNextTick()}_writev(t,e){e(null)}_write(t,e){this._writableState.autoBatch(t,e)}_final(t){t(null)}static isBackpressured(t){return(t._duplexState&$h)!==0}static drained(t){if(t.destroyed)return Promise.resolve(!1);const e=t._writableState,s=(lu(t)?Math.min(1,e.queue.length):e.queue.length)+(t._duplexState&us?1:0);return s===0?Promise.resolve(!0):(e.drains===null&&(e.drains=[]),new Promise(r=>{e.drains.push({writes:s,resolve:r})}))}write(t){return this._writableState.updateNextTick(),this._writableState.push(t)}end(t){return this._writableState.updateNextTick(),this._writableState.end(t),this}}class ps extends ze{constructor(t){super(t),this._duplexState=ie|this._duplexState&ee,this._writableState=new Xo(this,t),t&&(t.writev&&(this._writev=t.writev),t.write&&(this._write=t.write),t.final&&(this._final=t.final))}cork(){this._duplexState|=jn}uncork(){this._duplexState&=Go,this._writableState.updateNextTick()}_writev(t,e){e(null)}_write(t,e){this._writableState.autoBatch(t,e)}_final(t){t(null)}write(t){return this._writableState.updateNextTick(),this._writableState.push(t)}end(t){return this._writableState.updateNextTick(),this._writableState.end(t),this}}class na extends ps{constructor(t){super(t),this._transformState=new zh(this),t&&(t.transform&&(this._transform=t.transform),t.flush&&(this._flush=t.flush))}_write(t,e){this._readableState.buffered>=this._readableState.highWaterMark?this._transformState.data=t:this._transform(t,this._transformState.afterTransform)}_read(t){if(this._transformState.data!==null){const e=this._transformState.data;this._transformState.data=null,t(null),this._transform(e,this._transformState.afterTransform)}else t(null)}destroy(t){super.destroy(t),this._transformState.data!==null&&(this._transformState.data=null,this._transformState.afterTransform())}_transform(t,e){e(null,t)}_flush(t){t(null)}_final(t){this._transformState.afterFinal=t,this._flush(eu.bind(this))}}class tu extends na{}function eu(n,t){const e=this._transformState.afterFinal;if(n)return e(n);t!=null&&this.push(t),this.push(null),e(null)}function nu(...n){return new Promise((t,e)=>ia(...n,i=>{if(i)return e(i);t()}))}function ia(n,...t){const e=Array.isArray(n)?[...n,...t]:[n,...t],i=e.length&&typeof e[e.length-1]=="function"?e.pop():null;if(e.length<2)throw new Error("Pipeline requires at least 2 streams");let s=e[0],r=null,o=null;for(let h=1;h<e.length;h++)r=e[h],Ye(s)?s.pipe(r,l):(a(s,!0,h>1,l),s.pipe(r)),s=r;if(i){let h=!1;const u=Ye(r)||!!(r._writableState&&r._writableState.autoDestroy);r.on("error",d=>{o===null&&(o=d)}),r.on("finish",()=>{h=!0,u||i(o)}),u&&r.on("close",()=>i(o||(h?null:ci)))}return r;function a(h,u,d,f){h.on("error",f),h.on("close",p);function p(){if(h._readableState&&!h._readableState.ended||d&&h._writableState&&!h._writableState.ended)return f(ci)}}function l(h){if(!(!h||o)){o=h;for(const u of e)u.destroy(h)}}}function iu(n){return n}function sa(n){return!!n._readableState||!!n._writableState}function Ye(n){return typeof n._duplexState=="number"&&sa(n)}function su(n,t={}){const e=n._readableState&&n._readableState.error||n._writableState&&n._writableState.error;return!t.all&&e===Yn?null:e}function ru(n){return Ye(n)&&n.readable}function ou(n){return typeof n=="object"&&n!==null&&typeof n.byteLength=="number"}function ra(n){return ou(n)?n.byteLength:1024}function Qs(){}function au(){this.destroy(new Error("Stream aborted."))}function lu(n){return n._writev!==ea.prototype._writev&&n._writev!==ps.prototype._writev}var cu={pipeline:ia,pipelinePromise:nu,isStream:sa,isStreamx:Ye,getStreamError:su,Stream:gs,Writable:ea,Readable:ze,Duplex:ps,Transform:na,PassThrough:tu};function tr(n,t){for(const e in t)Object.defineProperty(n,e,{value:t[e],enumerable:!0,configurable:!0});return n}function hu(n,t,e){if(!n||typeof n=="string")throw new TypeError("Please pass an Error to err-code");e||(e={}),typeof t=="object"&&(e=t,t=""),t&&(e.code=t);try{return tr(n,e)}catch{e.message=n.message,e.stack=n.stack;const s=function(){};return s.prototype=Object.create(Object.getPrototypeOf(n)),tr(new s,e)}}var uu=hu;const M=Io(uu);/* Common package for dealing with hex/string/uint8 conversions (and sha1 hashing)
*
* @author   Jimmy Wrting <jimmy@warting.se> (https://jimmy.warting.se/opensource)
* @license  MIT
*/const er="0123456789abcdef",oa=[];for(let n=0;n<256;n++)oa[n]=er[n>>4&15]+er[n&15];const nr=n=>{const t=n.length;let e="",i=0;for(;i<t;)e+=oa[n[i++]];return e};var ir="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",du=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(var on=0;on<ir.length;on++)du[ir.charCodeAt(on)]=on;new TextDecoder;const fu=new TextEncoder,gu=n=>fu.encode(n),sr=typeof window<"u"?window:self,ki=sr.crypto||sr.msCrypto||{};ki.subtle||ki.webkitSubtle;const rr=n=>{const t=new Uint8Array(n);return ki.getRandomValues(t)};/*! simple-peer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */const pu=Yc("simple-peer"),hi=64*1024,_u=5*1e3,mu=5*1e3;function or(n){return n.replace(/a=ice-options:trickle\s\n/g,"")}function wu(n){console.warn(n)}let Gn=class Li extends cu.Duplex{constructor(e){e=Object.assign({allowHalfOpen:!1},e);super(e);xs(this,"_pc");if(this.__objectMode=!!e.objectMode,this._id=nr(rr(4)).slice(0,7),this._debug("new peer %o",e),this.channelName=e.initiator?e.channelName||nr(rr(20)):null,this.initiator=e.initiator||!1,this.channelConfig=e.channelConfig||Li.channelConfig,this.channelNegotiated=this.channelConfig.negotiated,this.config=Object.assign({},Li.config,e.config),this.offerOptions=e.offerOptions||{},this.answerOptions=e.answerOptions||{},this.sdpTransform=e.sdpTransform||(i=>i),this.trickle=e.trickle!==void 0?e.trickle:!0,this.allowHalfTrickle=e.allowHalfTrickle!==void 0?e.allowHalfTrickle:!1,this.iceCompleteTimeout=e.iceCompleteTimeout||_u,this._destroying=!1,this._connected=!1,this.remoteAddress=void 0,this.remoteFamily=void 0,this.remotePort=void 0,this.localAddress=void 0,this.localFamily=void 0,this.localPort=void 0,!Ni)throw M(typeof window>"u"?new Error("No WebRTC support: Specify `opts.wrtc` option in this environment"):new Error("No WebRTC support: Not a supported browser"),"ERR_WEBRTC_SUPPORT");this._pcReady=!1,this._channelReady=!1,this._iceComplete=!1,this._iceCompleteTimer=null,this._channel=null,this._pendingCandidates=[],this._isNegotiating=!1,this._firstNegotiation=!0,this._batchedNegotiation=!1,this._queuedNegotiation=!1,this._sendersAwaitingStable=[],this._closingInterval=null,this._remoteTracks=[],this._remoteStreams=[],this._chunk=null,this._cb=null,this._interval=null;try{this._pc=new Ni(this.config)}catch(i){this.__destroy(M(i,"ERR_PC_CONSTRUCTOR"));return}this._isReactNativeWebrtc=typeof this._pc._peerConnectionId=="number",this._pc.oniceconnectionstatechange=()=>{this._onIceStateChange()},this._pc.onicegatheringstatechange=()=>{this._onIceStateChange()},this._pc.onconnectionstatechange=()=>{this._onConnectionStateChange()},this._pc.onsignalingstatechange=()=>{this._onSignalingStateChange()},this._pc.onicecandidate=i=>{this._onIceCandidate(i)},typeof this._pc.peerIdentity=="object"&&this._pc.peerIdentity.catch(i=>{this.__destroy(M(i,"ERR_PC_PEER_IDENTITY"))}),this.initiator||this.channelNegotiated?this._setupData({channel:this._pc.createDataChannel(this.channelName,this.channelConfig)}):this._pc.ondatachannel=i=>{this._setupData(i)},this._debug("initial negotiation"),this._needsNegotiation(),this._onFinishBound=()=>{this._onFinish()},this.once("finish",this._onFinishBound)}get bufferSize(){return this._channel&&this._channel.bufferedAmount||0}get connected(){return this._connected&&this._channel.readyState==="open"}address(){return{port:this.localPort,family:this.localFamily,address:this.localAddress}}signal(e){if(!this._destroying){if(this.destroyed)throw M(new Error("cannot signal after peer is destroyed"),"ERR_DESTROYED");if(typeof e=="string")try{e=JSON.parse(e)}catch{e={}}this._debug("signal()"),e.renegotiate&&this.initiator&&(this._debug("got request to renegotiate"),this._needsNegotiation()),e.transceiverRequest&&this.initiator&&(this._debug("got request for transceiver"),this.addTransceiver(e.transceiverRequest.kind,e.transceiverRequest.init)),e.candidate&&(this._pc.remoteDescription&&this._pc.remoteDescription.type?this._addIceCandidate(e.candidate):this._pendingCandidates.push(e.candidate)),e.sdp&&this._pc.setRemoteDescription(new Wc(e)).then(()=>{this.destroyed||(this._pendingCandidates.forEach(i=>{this._addIceCandidate(i)}),this._pendingCandidates=[],this._pc.remoteDescription.type==="offer"&&this._createAnswer())}).catch(i=>{this.__destroy(M(i,"ERR_SET_REMOTE_DESCRIPTION"))}),!e.sdp&&!e.candidate&&!e.renegotiate&&!e.transceiverRequest&&this.__destroy(M(new Error("signal() called with invalid signal data"),"ERR_SIGNALING"))}}_addIceCandidate(e){const i=new jc(e);this._pc.addIceCandidate(i).catch(s=>{!i.address||i.address.endsWith(".local")?wu("Ignoring unsupported ICE candidate."):this.__destroy(M(s,"ERR_ADD_ICE_CANDIDATE"))})}send(e){if(!this._destroying){if(this.destroyed)throw M(new Error("cannot send after peer is destroyed"),"ERR_DESTROYED");this._channel.send(e)}}_needsNegotiation(){this._debug("_needsNegotiation"),!this._batchedNegotiation&&(this._batchedNegotiation=!0,queueMicrotask(()=>{this._batchedNegotiation=!1,this.initiator||!this._firstNegotiation?(this._debug("starting batched negotiation"),this.negotiate()):this._debug("non-initiator initial negotiation request discarded"),this._firstNegotiation=!1}))}negotiate(){if(!this._destroying){if(this.destroyed)throw M(new Error("cannot negotiate after peer is destroyed"),"ERR_DESTROYED");this.initiator?this._isNegotiating?(this._queuedNegotiation=!0,this._debug("already negotiating, queueing")):(this._debug("start negotiation"),setTimeout(()=>{this._createOffer()},0)):this._isNegotiating?(this._queuedNegotiation=!0,this._debug("already negotiating, queueing")):(this._debug("requesting negotiation from initiator"),this.emit("signal",{type:"renegotiate",renegotiate:!0})),this._isNegotiating=!0}}_final(e){this._readableState.ended||this.push(null),e(null)}__destroy(e){this.end(),this._destroy(()=>{},e)}_destroy(e,i){this.destroyed||this._destroying||(this._destroying=!0,this._debug("destroying (error: %s)",i&&(i.message||i)),setTimeout(()=>{if(this._connected=!1,this._pcReady=!1,this._channelReady=!1,this._remoteTracks=null,this._remoteStreams=null,this._senderMap=null,clearInterval(this._closingInterval),this._closingInterval=null,clearInterval(this._interval),this._interval=null,this._chunk=null,this._cb=null,this._onFinishBound&&this.removeListener("finish",this._onFinishBound),this._onFinishBound=null,this._channel){try{this._channel.close()}catch{}this._channel.onmessage=null,this._channel.onopen=null,this._channel.onclose=null,this._channel.onerror=null}if(this._pc){try{this._pc.close()}catch{}this._pc.oniceconnectionstatechange=null,this._pc.onicegatheringstatechange=null,this._pc.onsignalingstatechange=null,this._pc.onicecandidate=null,this._pc.ontrack=null,this._pc.ondatachannel=null}this._pc=null,this._channel=null,i&&this.emit("error",i),e()},0))}_setupData(e){if(!e.channel)return this.__destroy(M(new Error("Data channel event is missing `channel` property"),"ERR_DATA_CHANNEL"));this._channel=e.channel,this._channel.binaryType="arraybuffer",typeof this._channel.bufferedAmountLowThreshold=="number"&&(this._channel.bufferedAmountLowThreshold=hi),this.channelName=this._channel.label,this._channel.onmessage=s=>{this._onChannelMessage(s)},this._channel.onbufferedamountlow=()=>{this._onChannelBufferedAmountLow()},this._channel.onopen=()=>{this._onChannelOpen()},this._channel.onclose=()=>{this._onChannelClose()},this._channel.onerror=s=>{const r=s.error instanceof Error?s.error:new Error(`Datachannel error: ${s.message} ${s.filename}:${s.lineno}:${s.colno}`);this.__destroy(M(r,"ERR_DATA_CHANNEL"))};let i=!1;this._closingInterval=setInterval(()=>{this._channel&&this._channel.readyState==="closing"?(i&&this._onChannelClose(),i=!0):i=!1},mu)}_write(e,i){if(this.destroyed)return i(M(new Error("cannot write after peer is destroyed"),"ERR_DATA_CHANNEL"));if(this._connected){try{this.send(e)}catch(s){return this.__destroy(M(s,"ERR_DATA_CHANNEL"))}this._channel.bufferedAmount>hi?(this._debug("start backpressure: bufferedAmount %d",this._channel.bufferedAmount),this._cb=i):i(null)}else this._debug("write before connect"),this._chunk=e,this._cb=i}_onFinish(){if(this.destroyed)return;const e=()=>{setTimeout(()=>this.__destroy(),1e3)};this._connected?e():this.once("connect",e)}_startIceCompleteTimeout(){this.destroyed||this._iceCompleteTimer||(this._debug("started iceComplete timeout"),this._iceCompleteTimer=setTimeout(()=>{this._iceComplete||(this._iceComplete=!0,this._debug("iceComplete timeout completed"),this.emit("iceTimeout"),this.emit("_iceComplete"))},this.iceCompleteTimeout))}_createOffer(){this.destroyed||this._pc.createOffer(this.offerOptions).then(e=>{if(this.destroyed)return;!this.trickle&&!this.allowHalfTrickle&&(e.sdp=or(e.sdp)),e.sdp=this.sdpTransform(e.sdp);const i=()=>{if(this.destroyed)return;const o=this._pc.localDescription||e;this._debug("signal"),this.emit("signal",{type:o.type,sdp:o.sdp})},s=()=>{this._debug("createOffer success"),!this.destroyed&&(this.trickle||this._iceComplete?i():this.once("_iceComplete",i))},r=o=>{this.__destroy(M(o,"ERR_SET_LOCAL_DESCRIPTION"))};this._pc.setLocalDescription(e).then(s).catch(r)}).catch(e=>{this.__destroy(M(e,"ERR_CREATE_OFFER"))})}_createAnswer(){this.destroyed||this._pc.createAnswer(this.answerOptions).then(e=>{if(this.destroyed)return;!this.trickle&&!this.allowHalfTrickle&&(e.sdp=or(e.sdp)),e.sdp=this.sdpTransform(e.sdp);const i=()=>{var a;if(this.destroyed)return;const o=this._pc.localDescription||e;this._debug("signal"),this.emit("signal",{type:o.type,sdp:o.sdp}),this.initiator||(a=this._requestMissingTransceivers)==null||a.call(this)},s=()=>{this.destroyed||(this.trickle||this._iceComplete?i():this.once("_iceComplete",i))},r=o=>{this.__destroy(M(o,"ERR_SET_LOCAL_DESCRIPTION"))};this._pc.setLocalDescription(e).then(s).catch(r)}).catch(e=>{this.__destroy(M(e,"ERR_CREATE_ANSWER"))})}_onConnectionStateChange(){this.destroyed||this._destroying||this._pc.connectionState==="failed"&&this.__destroy(M(new Error("Connection failed."),"ERR_CONNECTION_FAILURE"))}_onIceStateChange(){if(this.destroyed)return;const e=this._pc.iceConnectionState,i=this._pc.iceGatheringState;this._debug("iceStateChange (connection: %s) (gathering: %s)",e,i),this.emit("iceStateChange",e,i),(e==="connected"||e==="completed")&&(this._pcReady=!0,this._maybeReady()),e==="failed"&&this.__destroy(M(new Error("Ice connection failed."),"ERR_ICE_CONNECTION_FAILURE")),e==="closed"&&this.__destroy(M(new Error("Ice connection closed."),"ERR_ICE_CONNECTION_CLOSED"))}getStats(e){const i=s=>(Object.prototype.toString.call(s.values)==="[object Array]"&&s.values.forEach(r=>{Object.assign(s,r)}),s);this._pc.getStats.length===0||this._isReactNativeWebrtc?this._pc.getStats().then(s=>{const r=[];s.forEach(o=>{r.push(i(o))}),e(null,r)},s=>e(s)):this._pc.getStats.length>0?this._pc.getStats(s=>{if(this.destroyed)return;const r=[];s.result().forEach(o=>{const a={};o.names().forEach(l=>{a[l]=o.stat(l)}),a.id=o.id,a.type=o.type,a.timestamp=o.timestamp,r.push(i(a))}),e(null,r)},s=>e(s)):e(null,[])}_maybeReady(){if(this._debug("maybeReady pc %s channel %s",this._pcReady,this._channelReady),this._connected||this._connecting||!this._pcReady||!this._channelReady)return;this._connecting=!0;const e=()=>{this.destroyed||this._destroying||this.getStats((i,s)=>{if(this.destroyed||this._destroying)return;i&&(s=[]);const r={},o={},a={};let l=!1;s.forEach(u=>{(u.type==="remotecandidate"||u.type==="remote-candidate")&&(r[u.id]=u),(u.type==="localcandidate"||u.type==="local-candidate")&&(o[u.id]=u),(u.type==="candidatepair"||u.type==="candidate-pair")&&(a[u.id]=u)});const h=u=>{l=!0;let d=o[u.localCandidateId];d&&(d.ip||d.address)?(this.localAddress=d.ip||d.address,this.localPort=Number(d.port)):d&&d.ipAddress?(this.localAddress=d.ipAddress,this.localPort=Number(d.portNumber)):typeof u.googLocalAddress=="string"&&(d=u.googLocalAddress.split(":"),this.localAddress=d[0],this.localPort=Number(d[1])),this.localAddress&&(this.localFamily=this.localAddress.includes(":")?"IPv6":"IPv4");let f=r[u.remoteCandidateId];f&&(f.ip||f.address)?(this.remoteAddress=f.ip||f.address,this.remotePort=Number(f.port)):f&&f.ipAddress?(this.remoteAddress=f.ipAddress,this.remotePort=Number(f.portNumber)):typeof u.googRemoteAddress=="string"&&(f=u.googRemoteAddress.split(":"),this.remoteAddress=f[0],this.remotePort=Number(f[1])),this.remoteAddress&&(this.remoteFamily=this.remoteAddress.includes(":")?"IPv6":"IPv4"),this._debug("connect local: %s:%s remote: %s:%s",this.localAddress,this.localPort,this.remoteAddress,this.remotePort)};if(s.forEach(u=>{u.type==="transport"&&u.selectedCandidatePairId&&h(a[u.selectedCandidatePairId]),(u.type==="googCandidatePair"&&u.googActiveConnection==="true"||(u.type==="candidatepair"||u.type==="candidate-pair")&&u.selected)&&h(u)}),!l&&(!Object.keys(a).length||Object.keys(o).length)){setTimeout(e,100);return}else this._connecting=!1,this._connected=!0;if(this._chunk){try{this.send(this._chunk)}catch(d){return this.__destroy(M(d,"ERR_DATA_CHANNEL"))}this._chunk=null,this._debug('sent chunk from "write before connect"');const u=this._cb;this._cb=null,u(null)}typeof this._channel.bufferedAmountLowThreshold!="number"&&(this._interval=setInterval(()=>this._onInterval(),150),this._interval.unref&&this._interval.unref()),this._debug("connect"),this.emit("connect")})};e()}_onInterval(){!this._cb||!this._channel||this._channel.bufferedAmount>hi||this._onChannelBufferedAmountLow()}_onSignalingStateChange(){this.destroyed||(this._pc.signalingState==="stable"&&(this._isNegotiating=!1,this._debug("flushing sender queue",this._sendersAwaitingStable),this._sendersAwaitingStable.forEach(e=>{this._pc.removeTrack(e),this._queuedNegotiation=!0}),this._sendersAwaitingStable=[],this._queuedNegotiation?(this._debug("flushing negotiation queue"),this._queuedNegotiation=!1,this._needsNegotiation()):(this._debug("negotiated"),this.emit("negotiated"))),this._debug("signalingStateChange %s",this._pc.signalingState),this.emit("signalingStateChange",this._pc.signalingState))}_onIceCandidate(e){this.destroyed||(e.candidate&&this.trickle?this.emit("signal",{type:"candidate",candidate:{candidate:e.candidate.candidate,sdpMLineIndex:e.candidate.sdpMLineIndex,sdpMid:e.candidate.sdpMid}}):!e.candidate&&!this._iceComplete&&(this._iceComplete=!0,this.emit("_iceComplete")),e.candidate&&this._startIceCompleteTimeout())}_onChannelMessage(e){if(this.destroyed)return;let i=e.data;i instanceof ArrayBuffer?i=new Uint8Array(i):this.__objectMode===!1&&(i=gu(i)),this.push(i)}_onChannelBufferedAmountLow(){if(this.destroyed||!this._cb)return;this._debug("ending backpressure: bufferedAmount %d",this._channel.bufferedAmount);const e=this._cb;this._cb=null,e(null)}_onChannelOpen(){this._connected||this.destroyed||(this._debug("on channel open"),this._channelReady=!0,this._maybeReady())}_onChannelClose(){this.destroyed||(this._debug("on channel close"),this.__destroy())}_debug(){const e=[].slice.call(arguments);e[0]="["+this._id+"] "+e[0],pu.apply(null,e)}};Gn.WEBRTC_SUPPORT=!!Ni;Gn.config={iceServers:[{urls:["stun:stun.l.google.com:19302","stun:global.stun.twilio.com:3478"]}],sdpSemantics:"unified-plan"};Gn.channelConfig={};/*! simple-peer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */class yu extends Gn{constructor(t={}){super(t),this._pc&&(this.streams=t.streams||(t.stream?[t.stream]:[]),this._senderMap=new Map,this.streams&&this.streams.forEach(e=>{this.addStream(e)}),this._pc.ontrack=e=>{this._onTrack(e)})}addTransceiver(t,e){if(!this._destroying){if(this.destroyed)throw M(new Error("cannot addTransceiver after peer is destroyed"),"ERR_DESTROYED");if(this._debug("addTransceiver()"),this.initiator)try{this._pc.addTransceiver(t,e),this._needsNegotiation()}catch(i){this.__destroy(M(i,"ERR_ADD_TRANSCEIVER"))}else this.emit("signal",{type:"transceiverRequest",transceiverRequest:{kind:t,init:e}})}}addStream(t){if(!this._destroying){if(this.destroyed)throw M(new Error("cannot addStream after peer is destroyed"),"ERR_DESTROYED");this._debug("addStream()"),t.getTracks().forEach(e=>{this.addTrack(e,t)})}}addTrack(t,e){if(this._destroying)return;if(this.destroyed)throw M(new Error("cannot addTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("addTrack()");const i=this._senderMap.get(t)||new Map;let s=i.get(e);if(!s)s=this._pc.addTrack(t,e),i.set(e,s),this._senderMap.set(t,i),this._needsNegotiation();else throw s.removed?M(new Error("Track has been removed. You should enable/disable tracks that you want to re-add."),"ERR_SENDER_REMOVED"):M(new Error("Track has already been added to that stream."),"ERR_SENDER_ALREADY_ADDED")}replaceTrack(t,e,i){if(this._destroying)return;if(this.destroyed)throw M(new Error("cannot replaceTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("replaceTrack()");const s=this._senderMap.get(t),r=s?s.get(i):null;if(!r)throw M(new Error("Cannot replace track that was never added."),"ERR_TRACK_NOT_ADDED");e&&this._senderMap.set(e,s),r.replaceTrack!=null?r.replaceTrack(e):this.__destroy(M(new Error("replaceTrack is not supported in this browser"),"ERR_UNSUPPORTED_REPLACETRACK"))}removeTrack(t,e){if(this._destroying)return;if(this.destroyed)throw M(new Error("cannot removeTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("removeSender()");const i=this._senderMap.get(t),s=i?i.get(e):null;if(!s)throw M(new Error("Cannot remove track that was never added."),"ERR_TRACK_NOT_ADDED");try{s.removed=!0,this._pc.removeTrack(s)}catch(r){r.name==="NS_ERROR_UNEXPECTED"?this._sendersAwaitingStable.push(s):this.__destroy(M(r,"ERR_REMOVE_TRACK"))}this._needsNegotiation()}removeStream(t){if(!this._destroying){if(this.destroyed)throw M(new Error("cannot removeStream after peer is destroyed"),"ERR_DESTROYED");this._debug("removeSenders()"),t.getTracks().forEach(e=>{this.removeTrack(e,t)})}}_requestMissingTransceivers(){this._pc.getTransceivers&&this._pc.getTransceivers().forEach(t=>{!t.mid&&t.sender.track&&!t.requested&&(t.requested=!0,this.addTransceiver(t.sender.track.kind))})}_onTrack(t){this.destroyed||t.streams.forEach(e=>{this._debug("on track"),this.emit("track",t.track,e),this._remoteTracks.push({track:t.track,stream:e}),!this._remoteStreams.some(i=>i.id===e.id)&&(this._remoteStreams.push(e),queueMicrotask(()=>{this._debug("on stream"),this.emit("stream",e)}))})}}const ar="data",lr="signal",cr=(n,t)=>{const e=new yu({iceServers:[{urls:bu}],...t,initiator:n,trickle:!1}),i=r=>s.push(r);let s=[];return e.on(ar,i),{id:e._id,created:Date.now(),connection:e._pc,get channel(){return e._channel},get isDead(){return e.destroyed},signal:r=>new Promise(o=>{n||e.on(lr,o),e.signal(r)}),sendData:r=>e.send(r),destroy:()=>e.destroy(),setHandlers:r=>Object.entries(r).forEach(([o,a])=>e.on(o,a)),offerPromise:n?new Promise(r=>e.on(lr,r)):Promise.resolve(),addStream:r=>e.addStream(r),removeStream:r=>e.removeStream(r),addTrack:(r,o)=>e.addTrack(r,o),removeTrack:(r,o)=>e.removeTrack(r,o),replaceTrack:(r,o,a)=>e.replaceTrack(r,o,a),drainEarlyData:r=>{e.off(ar,i),s.forEach(r),s=null}}},bu=[...Fe(5,(n,t)=>`stun:stun${t||""}.l.google.com:19302`),"stun:global.stun.twilio.com:3478"],Eu=Object.getPrototypeOf(Uint8Array),_n=12,aa=0,mn=aa+_n,wn=mn+1,ke=wn+1,Le=ke+1,Ft=16*2**10-Le,an=255,hr="bufferedamountlow",oe=n=>"@_"+n,xu=(n,t,e)=>{const i={},s={},r={},o={},a={},l={},h={},u={onPeerJoin:qt,onPeerLeave:qt,onPeerStream:qt,onPeerTrack:qt},d=(y,v)=>(y?Array.isArray(y)?y:[y]:Nc(i)).flatMap(S=>{const b=i[S];return b?v(S,b):(console.warn(`${Ue}: no peer with id ${S} found`),[])}),f=y=>{i[y]&&(delete i[y],delete o[y],delete a[y],u.onPeerLeave(y),t(y))},p=y=>{if(s[y])return r[y];if(!y)throw wt("action type argument is required");const v=Vt(y);if(v.byteLength>_n)throw wt(`action type string "${y}" (${v.byteLength}b) exceeds byte limit (${_n}). Hint: choose a shorter name.`);const S=new Uint8Array(_n);S.set(v);let b=0;return s[y]={onComplete:qt,onProgress:qt,setOnComplete:A=>s[y]={...s[y],onComplete:A},setOnProgress:A=>s[y]={...s[y],onProgress:A},send:async(A,R,B,D)=>{if(B&&typeof B!="object")throw wt("action meta argument must be an object");const U=typeof A;if(U==="undefined")throw wt("action data cannot be undefined");const $=U!=="string",Z=A instanceof Blob,O=Z||A instanceof ArrayBuffer||A instanceof Eu;if(B&&!O)throw wt("action meta argument can only be used with binary data");const W=O?new Uint8Array(Z?await A.arrayBuffer():A):Vt($?xt(A):A),et=B?Vt(xt(B)):null,j=Math.ceil(W.byteLength/Ft)+(B?1:0)||1,lt=Fe(j,(K,Y)=>{const J=Y===j-1,q=B&&Y===0,z=new Uint8Array(Le+(q?et.byteLength:J?W.byteLength-Ft*(j-(B?2:1)):Ft));return z.set(S),z.set([b],mn),z.set([J|q<<1|O<<2|$<<3],wn),z.set([Math.round((Y+1)/j*an)],ke),z.set(B?q?et:W.subarray((Y-1)*Ft,Y*Ft):W.subarray(Y*Ft,(Y+1)*Ft),Le),z});return b=b+1&an,ce(d(R,async(K,Y)=>{const{channel:J}=Y;let q=0;for(;q<j;){const z=lt[q];if(J.bufferedAmount>J.bufferedAmountLowThreshold&&await new Promise(ut=>{const Ut=()=>{J.removeEventListener(hr,Ut),ut()};J.addEventListener(hr,Ut)}),!i[K])break;Y.sendData(z),q++,D==null||D(z[ke]/an,K,B)}}))}},r[y]||(r[y]=[s[y].send,s[y].setOnComplete,s[y].setOnProgress])},w=(y,v)=>{var j,lt;const S=new Uint8Array(v),b=gn(S.subarray(aa,mn)).replaceAll("\0",""),[A]=S.subarray(mn,wn),[R]=S.subarray(wn,ke),[B]=S.subarray(ke,Le),D=S.subarray(Le),U=!!(R&1),$=!!(R&2),Z=!!(R&4),O=!!(R&8);if(!s[b]){console.warn(`${Ue}: received message with unregistered type (${b})`);return}o[y]||(o[y]={}),(j=o[y])[b]||(j[b]={});const W=(lt=o[y][b])[A]||(lt[A]={chunks:[]});if($?W.meta=Bn(gn(D)):W.chunks.push(D),s[b].onProgress(B/an,y,W.meta),!U)return;const et=new Uint8Array(W.chunks.reduce((K,Y)=>K+Y.byteLength,0));if(W.chunks.reduce((K,Y)=>(et.set(Y,K),K+Y.byteLength),0),delete o[y][b][A],Z)s[b].onComplete(et,y,W.meta);else{const K=gn(et);s[b].onComplete(O?Bn(K):K,y)}},g=async()=>{await k(""),await new Promise(y=>setTimeout(y,99)),Ys(i).forEach(([y,v])=>{v.destroy(),delete i[y]}),e()},[m,_]=p(oe("ping")),[E,C]=p(oe("pong")),[x,I]=p(oe("signal")),[T,N]=p(oe("stream")),[P,F]=p(oe("track")),[k,L]=p(oe("leave"));return n((y,v)=>{var S;i[v]||(i[v]=y,y.setHandlers({data:b=>w(v,b),stream:b=>{u.onPeerStream(b,v,l[v]),delete l[v]},track:(b,A)=>{u.onPeerTrack(b,A,v,h[v]),delete h[v]},signal:b=>x(b,v),close:()=>f(v),error:()=>f(v)}),u.onPeerJoin(v),(S=y.drainEarlyData)==null||S.call(y,b=>w(v,b)))}),_((y,v)=>E("",v)),C((y,v)=>{var S;(S=a[v])==null||S.call(a),delete a[v]}),I((y,v)=>{var S;return(S=i[v])==null?void 0:S.signal(y)}),N((y,v)=>l[v]=y),F((y,v)=>h[v]=y),L((y,v)=>f(v)),is&&addEventListener("beforeunload",g),{makeAction:p,leave:g,ping:async y=>{if(!y)throw wt("ping() must be called with target peer ID");const v=Date.now();return m("",y),await new Promise(S=>a[y]=S),Date.now()-v},getPeers:()=>Rc(Ys(i).map(([y,v])=>[y,v.connection])),addStream:(y,v,S)=>d(v,async(b,A)=>{S&&await T(S,b),A.addStream(y)}),removeStream:(y,v)=>d(v,(S,b)=>b.removeStream(y)),addTrack:(y,v,S,b)=>d(S,async(A,R)=>{b&&await P(b,A),R.addTrack(y,v)}),removeTrack:(y,v,S)=>d(S,(b,A)=>A.removeTrack(y,v)),replaceTrack:(y,v,S,b,A)=>d(b,async(R,B)=>{A&&await P(A,R),B.replaceTrack(y,v,S)}),onPeerJoin:y=>u.onPeerJoin=y,onPeerLeave:y=>u.onPeerLeave=y,onPeerStream:y=>u.onPeerStream=y,onPeerTrack:y=>u.onPeerTrack=y}},Su=20,Cu=5333,ur=57333,Au=({init:n,subscribe:t,announce:e})=>{const i={};let s=!1,r,o,a;return(l,h,u)=>{var A;const{appId:d}=l;if((A=i[d])!=null&&A[h])return i[d][h];const f={},p={},w=nn(Ue,d,h),g=sn(w),m=sn(nn(w,le)),_=Mc(l.password||"",d,h),E=R=>async B=>({type:B.type,sdp:await R(_,B.sdp)}),C=E(Fc),x=E(Uc),I=()=>cr(!0,l.rtcConfig),T=(R,B,D)=>{var U;if(p[B]){p[B]!==R&&R.destroy();return}p[B]=R,b(R,B),(U=f[B])==null||U.forEach(($,Z)=>{Z!==D&&$.destroy()}),delete f[B]},N=(R,B)=>{p[B]===R&&delete p[B]},P=(R,B)=>{var U;if(p[R])return;const D=(U=f[R])==null?void 0:U[B];D&&(delete f[R][B],D.destroy())},F=R=>(o.push(...Fe(R,I)),ce(o.splice(0,R).map(B=>B.offerPromise.then(x).then(D=>({peer:B,offer:D}))))),k=(R,B)=>u==null?void 0:u({error:`incorrect password (${l.password}) when decrypting ${B}`,appId:d,peerId:R,roomId:h}),L=R=>async(B,D,U)=>{var lt,K,Y;const[$,Z]=await ce([g,m]);if(B!==$&&B!==Z)return;const{peerId:O,offer:W,answer:et,peer:j}=typeof D=="string"?Bn(D):D;if(!(O===le||p[O])){if(O&&!W&&!et){if((lt=f[O])!=null&&lt[R])return;const[[{peer:J,offer:q}],z]=await ce([F(1),sn(nn(w,O))]);f[O]||(f[O]=[]),f[O][R]=J,setTimeout(()=>P(O,R),y[R]*.9),J.setHandlers({connect:()=>T(J,O,R),close:()=>N(J,O)}),U(z,xt({peerId:le,offer:q}))}else if(W){if(((K=f[O])==null?void 0:K[R])&&le>O)return;const q=cr(!1,l.rtcConfig);q.setHandlers({connect:()=>T(q,O,R),close:()=>N(q,O)});let z;try{z=await C(W)}catch{k(O,"offer");return}if(q.isDead)return;const[ut,Ut]=await ce([sn(nn(w,O)),q.signal(z)]);U(ut,xt({peerId:le,answer:await x(Ut)}))}else if(et){let J;try{J=await C(et)}catch{k(O,"answer");return}if(j)j.setHandlers({connect:()=>T(j,O,R),close:()=>N(j,O)}),j.signal(J);else{const q=(Y=f[O])==null?void 0:Y[R];q&&!q.isDead&&q.signal(J)}}}};if(!l)throw wt("requires a config map as the first argument");if(!d&&!l.firebaseApp)throw wt("config map is missing appId field");if(!h)throw wt("roomId argument required");if(!s){const R=n(l);o=Fe(Su,I),r=Array.isArray(R)?R:[R],s=!0,a=setInterval(()=>o=o.filter(B=>{const D=Date.now()-B.created<ur;return D||B.destroy(),D}),ur*1.03)}const y=r.map(()=>Cu),v=[],S=r.map(async(R,B)=>t(await R,await g,await m,L(B),F));ce([g,m]).then(([R,B])=>{const D=async(U,$)=>{const Z=await e(U,R,B);typeof Z=="number"&&(y[$]=Z),v[$]=setTimeout(()=>D(U,$),y[$])};S.forEach(async(U,$)=>{await U,D(await r[$],$)})});let b=qt;return i[d]||(i[d]={}),i[d][h]=xu(R=>b=R,R=>delete p[R],()=>{delete i[d][h],v.forEach(clearTimeout),S.forEach(async R=>(await R)()),clearInterval(a)})}},Tu=5,la=29333,ca="x",ha="EVENT",ua=is&&ns.utils.randomPrivateKey(),vu=is&&Ii(ns.getPublicKey(ua)),_s={},$t={},da=()=>Math.floor(Date.now()/1e3),dr=async(n,t)=>{const e={kind:la,content:t,pubkey:vu,created_at:da(),tags:[[ca,n]]},i=Ii(new Uint8Array(await crypto.subtle.digest("SHA-256",Vt(xt([0,e.pubkey,e.created_at,e.kind,e.tags,e.content])))));return xt([ha,{...e,id:i,sig:Ii(await ns.sign(i,ua))}])},fr=(n,t)=>(_s[n]=t,xt(["REQ",n,{kinds:[la],since:da(),["#"+ca]:[t]}])),gr=n=>(delete _s[n],xt(["CLOSE",n])),Iu=Au({init:n=>kc(n,Ru,Tu).map(t=>{const e=Lc(t,i=>{var l;const[s,r,o,a]=Bn(i);if(s!==ha){const h=`${Ue}: relay failure from ${e.url} - `;s==="NOTICE"?console.warn(h+r):s==="OK"&&!o&&console.warn(h+a);return}(l=$t[r])==null||l.call($t,_s[r],o.content)});return e.ready}),subscribe:(n,t,e,i)=>{const s=vi(64),r=vi(64);return $t[s]=$t[r]=(o,a)=>i(o,a,async(l,h)=>n.send(await dr(l,h))),n.send(fr(s,t)),n.send(fr(r,e)),()=>{n.send(gr(s)),n.send(gr(r)),delete $t[s],delete $t[r]}},announce:async(n,t)=>n.send(await dr(t,xt({peerId:le})))}),Ru=["relay.nostr.net","relay.snort.social","relay.piazza.today","relay.exit.pub","nostr.lu.ke","nostr.mom","relay.urbanzap.space","nostr.data.haus","nostr.sathoarder.com","relay.nostromo.social","relay.nostr.bg","nostr.stakey.net","nostr.vulpem.com","a.nos.lol","eu.purplerelay.com","nostr2.sanhauf.com","e.nos.lol"].map(n=>"wss://"+n);var Qe={},Nu=function(){return typeof Promise=="function"&&Promise.prototype&&Promise.prototype.then},fa={},st={};let ms;const Bu=[0,26,44,70,100,134,172,196,242,292,346,404,466,532,581,655,733,815,901,991,1085,1156,1258,1364,1474,1588,1706,1828,1921,2051,2185,2323,2465,2611,2761,2876,3034,3196,3362,3532,3706];st.getSymbolSize=function(t){if(!t)throw new Error('"version" cannot be null or undefined');if(t<1||t>40)throw new Error('"version" should be in range from 1 to 40');return t*4+17};st.getSymbolTotalCodewords=function(t){return Bu[t]};st.getBCHDigit=function(n){let t=0;for(;n!==0;)t++,n>>>=1;return t};st.setToSJISFunction=function(t){if(typeof t!="function")throw new Error('"toSJISFunc" is not a valid function.');ms=t};st.isKanjiModeEnabled=function(){return typeof ms<"u"};st.toSJIS=function(t){return ms(t)};var Kn={};(function(n){n.L={bit:1},n.M={bit:0},n.Q={bit:3},n.H={bit:2};function t(e){if(typeof e!="string")throw new Error("Param is not a string");switch(e.toLowerCase()){case"l":case"low":return n.L;case"m":case"medium":return n.M;case"q":case"quartile":return n.Q;case"h":case"high":return n.H;default:throw new Error("Unknown EC Level: "+e)}}n.isValid=function(i){return i&&typeof i.bit<"u"&&i.bit>=0&&i.bit<4},n.from=function(i,s){if(n.isValid(i))return i;try{return t(i)}catch{return s}}})(Kn);function ga(){this.buffer=[],this.length=0}ga.prototype={get:function(n){const t=Math.floor(n/8);return(this.buffer[t]>>>7-n%8&1)===1},put:function(n,t){for(let e=0;e<t;e++)this.putBit((n>>>t-e-1&1)===1)},getLengthInBits:function(){return this.length},putBit:function(n){const t=Math.floor(this.length/8);this.buffer.length<=t&&this.buffer.push(0),n&&(this.buffer[t]|=128>>>this.length%8),this.length++}};var Pu=ga;function tn(n){if(!n||n<1)throw new Error("BitMatrix size must be defined and greater than 0");this.size=n,this.data=new Uint8Array(n*n),this.reservedBit=new Uint8Array(n*n)}tn.prototype.set=function(n,t,e,i){const s=n*this.size+t;this.data[s]=e,i&&(this.reservedBit[s]=!0)};tn.prototype.get=function(n,t){return this.data[n*this.size+t]};tn.prototype.xor=function(n,t,e){this.data[n*this.size+t]^=e};tn.prototype.isReserved=function(n,t){return this.reservedBit[n*this.size+t]};var ku=tn,pa={};(function(n){const t=st.getSymbolSize;n.getRowColCoords=function(i){if(i===1)return[];const s=Math.floor(i/7)+2,r=t(i),o=r===145?26:Math.ceil((r-13)/(2*s-2))*2,a=[r-7];for(let l=1;l<s-1;l++)a[l]=a[l-1]-o;return a.push(6),a.reverse()},n.getPositions=function(i){const s=[],r=n.getRowColCoords(i),o=r.length;for(let a=0;a<o;a++)for(let l=0;l<o;l++)a===0&&l===0||a===0&&l===o-1||a===o-1&&l===0||s.push([r[a],r[l]]);return s}})(pa);var _a={};const Lu=st.getSymbolSize,pr=7;_a.getPositions=function(t){const e=Lu(t);return[[0,0],[e-pr,0],[0,e-pr]]};var ma={};(function(n){n.Patterns={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7};const t={N1:3,N2:3,N3:40,N4:10};n.isValid=function(s){return s!=null&&s!==""&&!isNaN(s)&&s>=0&&s<=7},n.from=function(s){return n.isValid(s)?parseInt(s,10):void 0},n.getPenaltyN1=function(s){const r=s.size;let o=0,a=0,l=0,h=null,u=null;for(let d=0;d<r;d++){a=l=0,h=u=null;for(let f=0;f<r;f++){let p=s.get(d,f);p===h?a++:(a>=5&&(o+=t.N1+(a-5)),h=p,a=1),p=s.get(f,d),p===u?l++:(l>=5&&(o+=t.N1+(l-5)),u=p,l=1)}a>=5&&(o+=t.N1+(a-5)),l>=5&&(o+=t.N1+(l-5))}return o},n.getPenaltyN2=function(s){const r=s.size;let o=0;for(let a=0;a<r-1;a++)for(let l=0;l<r-1;l++){const h=s.get(a,l)+s.get(a,l+1)+s.get(a+1,l)+s.get(a+1,l+1);(h===4||h===0)&&o++}return o*t.N2},n.getPenaltyN3=function(s){const r=s.size;let o=0,a=0,l=0;for(let h=0;h<r;h++){a=l=0;for(let u=0;u<r;u++)a=a<<1&2047|s.get(h,u),u>=10&&(a===1488||a===93)&&o++,l=l<<1&2047|s.get(u,h),u>=10&&(l===1488||l===93)&&o++}return o*t.N3},n.getPenaltyN4=function(s){let r=0;const o=s.data.length;for(let l=0;l<o;l++)r+=s.data[l];return Math.abs(Math.ceil(r*100/o/5)-10)*t.N4};function e(i,s,r){switch(i){case n.Patterns.PATTERN000:return(s+r)%2===0;case n.Patterns.PATTERN001:return s%2===0;case n.Patterns.PATTERN010:return r%3===0;case n.Patterns.PATTERN011:return(s+r)%3===0;case n.Patterns.PATTERN100:return(Math.floor(s/2)+Math.floor(r/3))%2===0;case n.Patterns.PATTERN101:return s*r%2+s*r%3===0;case n.Patterns.PATTERN110:return(s*r%2+s*r%3)%2===0;case n.Patterns.PATTERN111:return(s*r%3+(s+r)%2)%2===0;default:throw new Error("bad maskPattern:"+i)}}n.applyMask=function(s,r){const o=r.size;for(let a=0;a<o;a++)for(let l=0;l<o;l++)r.isReserved(l,a)||r.xor(l,a,e(s,l,a))},n.getBestMask=function(s,r){const o=Object.keys(n.Patterns).length;let a=0,l=1/0;for(let h=0;h<o;h++){r(h),n.applyMask(h,s);const u=n.getPenaltyN1(s)+n.getPenaltyN2(s)+n.getPenaltyN3(s)+n.getPenaltyN4(s);n.applyMask(h,s),u<l&&(l=u,a=h)}return a}})(ma);var Vn={};const vt=Kn,ln=[1,1,1,1,1,1,1,1,1,1,2,2,1,2,2,4,1,2,4,4,2,4,4,4,2,4,6,5,2,4,6,6,2,5,8,8,4,5,8,8,4,5,8,11,4,8,10,11,4,9,12,16,4,9,16,16,6,10,12,18,6,10,17,16,6,11,16,19,6,13,18,21,7,14,21,25,8,16,20,25,8,17,23,25,9,17,23,34,9,18,25,30,10,20,27,32,12,21,29,35,12,23,34,37,12,25,34,40,13,26,35,42,14,28,38,45,15,29,40,48,16,31,43,51,17,33,45,54,18,35,48,57,19,37,51,60,19,38,53,63,20,40,56,66,21,43,59,70,22,45,62,74,24,47,65,77,25,49,68,81],cn=[7,10,13,17,10,16,22,28,15,26,36,44,20,36,52,64,26,48,72,88,36,64,96,112,40,72,108,130,48,88,132,156,60,110,160,192,72,130,192,224,80,150,224,264,96,176,260,308,104,198,288,352,120,216,320,384,132,240,360,432,144,280,408,480,168,308,448,532,180,338,504,588,196,364,546,650,224,416,600,700,224,442,644,750,252,476,690,816,270,504,750,900,300,560,810,960,312,588,870,1050,336,644,952,1110,360,700,1020,1200,390,728,1050,1260,420,784,1140,1350,450,812,1200,1440,480,868,1290,1530,510,924,1350,1620,540,980,1440,1710,570,1036,1530,1800,570,1064,1590,1890,600,1120,1680,1980,630,1204,1770,2100,660,1260,1860,2220,720,1316,1950,2310,750,1372,2040,2430];Vn.getBlocksCount=function(t,e){switch(e){case vt.L:return ln[(t-1)*4+0];case vt.M:return ln[(t-1)*4+1];case vt.Q:return ln[(t-1)*4+2];case vt.H:return ln[(t-1)*4+3];default:return}};Vn.getTotalCodewordsCount=function(t,e){switch(e){case vt.L:return cn[(t-1)*4+0];case vt.M:return cn[(t-1)*4+1];case vt.Q:return cn[(t-1)*4+2];case vt.H:return cn[(t-1)*4+3];default:return}};var wa={},Zn={};const De=new Uint8Array(512),Pn=new Uint8Array(256);(function(){let t=1;for(let e=0;e<255;e++)De[e]=t,Pn[t]=e,t<<=1,t&256&&(t^=285);for(let e=255;e<512;e++)De[e]=De[e-255]})();Zn.log=function(t){if(t<1)throw new Error("log("+t+")");return Pn[t]};Zn.exp=function(t){return De[t]};Zn.mul=function(t,e){return t===0||e===0?0:De[Pn[t]+Pn[e]]};(function(n){const t=Zn;n.mul=function(i,s){const r=new Uint8Array(i.length+s.length-1);for(let o=0;o<i.length;o++)for(let a=0;a<s.length;a++)r[o+a]^=t.mul(i[o],s[a]);return r},n.mod=function(i,s){let r=new Uint8Array(i);for(;r.length-s.length>=0;){const o=r[0];for(let l=0;l<s.length;l++)r[l]^=t.mul(s[l],o);let a=0;for(;a<r.length&&r[a]===0;)a++;r=r.slice(a)}return r},n.generateECPolynomial=function(i){let s=new Uint8Array([1]);for(let r=0;r<i;r++)s=n.mul(s,new Uint8Array([1,t.exp(r)]));return s}})(wa);const ya=wa;function ws(n){this.genPoly=void 0,this.degree=n,this.degree&&this.initialize(this.degree)}ws.prototype.initialize=function(t){this.degree=t,this.genPoly=ya.generateECPolynomial(this.degree)};ws.prototype.encode=function(t){if(!this.genPoly)throw new Error("Encoder not initialized");const e=new Uint8Array(t.length+this.degree);e.set(t);const i=ya.mod(e,this.genPoly),s=this.degree-i.length;if(s>0){const r=new Uint8Array(this.degree);return r.set(i,s),r}return i};var Du=ws,ba={},Mt={},ys={};ys.isValid=function(t){return!isNaN(t)&&t>=1&&t<=40};var gt={};const Ea="[0-9]+",Ou="[A-Z $%*+\\-./:]+";let We="(?:[u3000-u303F]|[u3040-u309F]|[u30A0-u30FF]|[uFF00-uFFEF]|[u4E00-u9FAF]|[u2605-u2606]|[u2190-u2195]|u203B|[u2010u2015u2018u2019u2025u2026u201Cu201Du2225u2260]|[u0391-u0451]|[u00A7u00A8u00B1u00B4u00D7u00F7])+";We=We.replace(/u/g,"\\u");const Mu="(?:(?![A-Z0-9 $%*+\\-./:]|"+We+`)(?:.|[\r
]))+`;gt.KANJI=new RegExp(We,"g");gt.BYTE_KANJI=new RegExp("[^A-Z0-9 $%*+\\-./:]+","g");gt.BYTE=new RegExp(Mu,"g");gt.NUMERIC=new RegExp(Ea,"g");gt.ALPHANUMERIC=new RegExp(Ou,"g");const Uu=new RegExp("^"+We+"$"),Fu=new RegExp("^"+Ea+"$"),$u=new RegExp("^[A-Z0-9 $%*+\\-./:]+$");gt.testKanji=function(t){return Uu.test(t)};gt.testNumeric=function(t){return Fu.test(t)};gt.testAlphanumeric=function(t){return $u.test(t)};(function(n){const t=ys,e=gt;n.NUMERIC={id:"Numeric",bit:1,ccBits:[10,12,14]},n.ALPHANUMERIC={id:"Alphanumeric",bit:2,ccBits:[9,11,13]},n.BYTE={id:"Byte",bit:4,ccBits:[8,16,16]},n.KANJI={id:"Kanji",bit:8,ccBits:[8,10,12]},n.MIXED={bit:-1},n.getCharCountIndicator=function(r,o){if(!r.ccBits)throw new Error("Invalid mode: "+r);if(!t.isValid(o))throw new Error("Invalid version: "+o);return o>=1&&o<10?r.ccBits[0]:o<27?r.ccBits[1]:r.ccBits[2]},n.getBestModeForData=function(r){return e.testNumeric(r)?n.NUMERIC:e.testAlphanumeric(r)?n.ALPHANUMERIC:e.testKanji(r)?n.KANJI:n.BYTE},n.toString=function(r){if(r&&r.id)return r.id;throw new Error("Invalid mode")},n.isValid=function(r){return r&&r.bit&&r.ccBits};function i(s){if(typeof s!="string")throw new Error("Param is not a string");switch(s.toLowerCase()){case"numeric":return n.NUMERIC;case"alphanumeric":return n.ALPHANUMERIC;case"kanji":return n.KANJI;case"byte":return n.BYTE;default:throw new Error("Unknown mode: "+s)}}n.from=function(r,o){if(n.isValid(r))return r;try{return i(r)}catch{return o}}})(Mt);(function(n){const t=st,e=Vn,i=Kn,s=Mt,r=ys,o=7973,a=t.getBCHDigit(o);function l(f,p,w){for(let g=1;g<=40;g++)if(p<=n.getCapacity(g,w,f))return g}function h(f,p){return s.getCharCountIndicator(f,p)+4}function u(f,p){let w=0;return f.forEach(function(g){const m=h(g.mode,p);w+=m+g.getBitsLength()}),w}function d(f,p){for(let w=1;w<=40;w++)if(u(f,w)<=n.getCapacity(w,p,s.MIXED))return w}n.from=function(p,w){return r.isValid(p)?parseInt(p,10):w},n.getCapacity=function(p,w,g){if(!r.isValid(p))throw new Error("Invalid QR Code version");typeof g>"u"&&(g=s.BYTE);const m=t.getSymbolTotalCodewords(p),_=e.getTotalCodewordsCount(p,w),E=(m-_)*8;if(g===s.MIXED)return E;const C=E-h(g,p);switch(g){case s.NUMERIC:return Math.floor(C/10*3);case s.ALPHANUMERIC:return Math.floor(C/11*2);case s.KANJI:return Math.floor(C/13);case s.BYTE:default:return Math.floor(C/8)}},n.getBestVersionForData=function(p,w){let g;const m=i.from(w,i.M);if(Array.isArray(p)){if(p.length>1)return d(p,m);if(p.length===0)return 1;g=p[0]}else g=p;return l(g.mode,g.getLength(),m)},n.getEncodedBits=function(p){if(!r.isValid(p)||p<7)throw new Error("Invalid QR Code version");let w=p<<12;for(;t.getBCHDigit(w)-a>=0;)w^=o<<t.getBCHDigit(w)-a;return p<<12|w}})(ba);var xa={};const Di=st,Sa=1335,Hu=21522,_r=Di.getBCHDigit(Sa);xa.getEncodedBits=function(t,e){const i=t.bit<<3|e;let s=i<<10;for(;Di.getBCHDigit(s)-_r>=0;)s^=Sa<<Di.getBCHDigit(s)-_r;return(i<<10|s)^Hu};var Ca={};const qu=Mt;function Ce(n){this.mode=qu.NUMERIC,this.data=n.toString()}Ce.getBitsLength=function(t){return 10*Math.floor(t/3)+(t%3?t%3*3+1:0)};Ce.prototype.getLength=function(){return this.data.length};Ce.prototype.getBitsLength=function(){return Ce.getBitsLength(this.data.length)};Ce.prototype.write=function(t){let e,i,s;for(e=0;e+3<=this.data.length;e+=3)i=this.data.substr(e,3),s=parseInt(i,10),t.put(s,10);const r=this.data.length-e;r>0&&(i=this.data.substr(e),s=parseInt(i,10),t.put(s,r*3+1))};var zu=Ce;const Yu=Mt,ui=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"," ","$","%","*","+","-",".","/",":"];function Ae(n){this.mode=Yu.ALPHANUMERIC,this.data=n}Ae.getBitsLength=function(t){return 11*Math.floor(t/2)+6*(t%2)};Ae.prototype.getLength=function(){return this.data.length};Ae.prototype.getBitsLength=function(){return Ae.getBitsLength(this.data.length)};Ae.prototype.write=function(t){let e;for(e=0;e+2<=this.data.length;e+=2){let i=ui.indexOf(this.data[e])*45;i+=ui.indexOf(this.data[e+1]),t.put(i,11)}this.data.length%2&&t.put(ui.indexOf(this.data[e]),6)};var Wu=Ae;const ju=Mt;function Te(n){this.mode=ju.BYTE,typeof n=="string"?this.data=new TextEncoder().encode(n):this.data=new Uint8Array(n)}Te.getBitsLength=function(t){return t*8};Te.prototype.getLength=function(){return this.data.length};Te.prototype.getBitsLength=function(){return Te.getBitsLength(this.data.length)};Te.prototype.write=function(n){for(let t=0,e=this.data.length;t<e;t++)n.put(this.data[t],8)};var Gu=Te;const Ku=Mt,Vu=st;function ve(n){this.mode=Ku.KANJI,this.data=n}ve.getBitsLength=function(t){return t*13};ve.prototype.getLength=function(){return this.data.length};ve.prototype.getBitsLength=function(){return ve.getBitsLength(this.data.length)};ve.prototype.write=function(n){let t;for(t=0;t<this.data.length;t++){let e=Vu.toSJIS(this.data[t]);if(e>=33088&&e<=40956)e-=33088;else if(e>=57408&&e<=60351)e-=49472;else throw new Error("Invalid SJIS character: "+this.data[t]+`
Make sure your charset is UTF-8`);e=(e>>>8&255)*192+(e&255),n.put(e,13)}};var Zu=ve,Aa={exports:{}};(function(n){var t={single_source_shortest_paths:function(e,i,s){var r={},o={};o[i]=0;var a=t.PriorityQueue.make();a.push(i,0);for(var l,h,u,d,f,p,w,g,m;!a.empty();){l=a.pop(),h=l.value,d=l.cost,f=e[h]||{};for(u in f)f.hasOwnProperty(u)&&(p=f[u],w=d+p,g=o[u],m=typeof o[u]>"u",(m||g>w)&&(o[u]=w,a.push(u,w),r[u]=h))}if(typeof s<"u"&&typeof o[s]>"u"){var _=["Could not find a path from ",i," to ",s,"."].join("");throw new Error(_)}return r},extract_shortest_path_from_predecessor_list:function(e,i){for(var s=[],r=i;r;)s.push(r),e[r],r=e[r];return s.reverse(),s},find_path:function(e,i,s){var r=t.single_source_shortest_paths(e,i,s);return t.extract_shortest_path_from_predecessor_list(r,s)},PriorityQueue:{make:function(e){var i=t.PriorityQueue,s={},r;e=e||{};for(r in i)i.hasOwnProperty(r)&&(s[r]=i[r]);return s.queue=[],s.sorter=e.sorter||i.default_sorter,s},default_sorter:function(e,i){return e.cost-i.cost},push:function(e,i){var s={value:e,cost:i};this.queue.push(s),this.queue.sort(this.sorter)},pop:function(){return this.queue.shift()},empty:function(){return this.queue.length===0}}};n.exports=t})(Aa);var Ju=Aa.exports;(function(n){const t=Mt,e=zu,i=Wu,s=Gu,r=Zu,o=gt,a=st,l=Ju;function h(_){return unescape(encodeURIComponent(_)).length}function u(_,E,C){const x=[];let I;for(;(I=_.exec(C))!==null;)x.push({data:I[0],index:I.index,mode:E,length:I[0].length});return x}function d(_){const E=u(o.NUMERIC,t.NUMERIC,_),C=u(o.ALPHANUMERIC,t.ALPHANUMERIC,_);let x,I;return a.isKanjiModeEnabled()?(x=u(o.BYTE,t.BYTE,_),I=u(o.KANJI,t.KANJI,_)):(x=u(o.BYTE_KANJI,t.BYTE,_),I=[]),E.concat(C,x,I).sort(function(N,P){return N.index-P.index}).map(function(N){return{data:N.data,mode:N.mode,length:N.length}})}function f(_,E){switch(E){case t.NUMERIC:return e.getBitsLength(_);case t.ALPHANUMERIC:return i.getBitsLength(_);case t.KANJI:return r.getBitsLength(_);case t.BYTE:return s.getBitsLength(_)}}function p(_){return _.reduce(function(E,C){const x=E.length-1>=0?E[E.length-1]:null;return x&&x.mode===C.mode?(E[E.length-1].data+=C.data,E):(E.push(C),E)},[])}function w(_){const E=[];for(let C=0;C<_.length;C++){const x=_[C];switch(x.mode){case t.NUMERIC:E.push([x,{data:x.data,mode:t.ALPHANUMERIC,length:x.length},{data:x.data,mode:t.BYTE,length:x.length}]);break;case t.ALPHANUMERIC:E.push([x,{data:x.data,mode:t.BYTE,length:x.length}]);break;case t.KANJI:E.push([x,{data:x.data,mode:t.BYTE,length:h(x.data)}]);break;case t.BYTE:E.push([{data:x.data,mode:t.BYTE,length:h(x.data)}])}}return E}function g(_,E){const C={},x={start:{}};let I=["start"];for(let T=0;T<_.length;T++){const N=_[T],P=[];for(let F=0;F<N.length;F++){const k=N[F],L=""+T+F;P.push(L),C[L]={node:k,lastCount:0},x[L]={};for(let y=0;y<I.length;y++){const v=I[y];C[v]&&C[v].node.mode===k.mode?(x[v][L]=f(C[v].lastCount+k.length,k.mode)-f(C[v].lastCount,k.mode),C[v].lastCount+=k.length):(C[v]&&(C[v].lastCount=k.length),x[v][L]=f(k.length,k.mode)+4+t.getCharCountIndicator(k.mode,E))}}I=P}for(let T=0;T<I.length;T++)x[I[T]].end=0;return{map:x,table:C}}function m(_,E){let C;const x=t.getBestModeForData(_);if(C=t.from(E,x),C!==t.BYTE&&C.bit<x.bit)throw new Error('"'+_+'" cannot be encoded with mode '+t.toString(C)+`.
 Suggested mode is: `+t.toString(x));switch(C===t.KANJI&&!a.isKanjiModeEnabled()&&(C=t.BYTE),C){case t.NUMERIC:return new e(_);case t.ALPHANUMERIC:return new i(_);case t.KANJI:return new r(_);case t.BYTE:return new s(_)}}n.fromArray=function(E){return E.reduce(function(C,x){return typeof x=="string"?C.push(m(x,null)):x.data&&C.push(m(x.data,x.mode)),C},[])},n.fromString=function(E,C){const x=d(E,a.isKanjiModeEnabled()),I=w(x),T=g(I,C),N=l.find_path(T.map,"start","end"),P=[];for(let F=1;F<N.length-1;F++)P.push(T.table[N[F]].node);return n.fromArray(p(P))},n.rawSplit=function(E){return n.fromArray(d(E,a.isKanjiModeEnabled()))}})(Ca);const Jn=st,di=Kn,Xu=Pu,Qu=ku,td=pa,ed=_a,Oi=ma,Mi=Vn,nd=Du,kn=ba,id=xa,sd=Mt,fi=Ca;function rd(n,t){const e=n.size,i=ed.getPositions(t);for(let s=0;s<i.length;s++){const r=i[s][0],o=i[s][1];for(let a=-1;a<=7;a++)if(!(r+a<=-1||e<=r+a))for(let l=-1;l<=7;l++)o+l<=-1||e<=o+l||(a>=0&&a<=6&&(l===0||l===6)||l>=0&&l<=6&&(a===0||a===6)||a>=2&&a<=4&&l>=2&&l<=4?n.set(r+a,o+l,!0,!0):n.set(r+a,o+l,!1,!0))}}function od(n){const t=n.size;for(let e=8;e<t-8;e++){const i=e%2===0;n.set(e,6,i,!0),n.set(6,e,i,!0)}}function ad(n,t){const e=td.getPositions(t);for(let i=0;i<e.length;i++){const s=e[i][0],r=e[i][1];for(let o=-2;o<=2;o++)for(let a=-2;a<=2;a++)o===-2||o===2||a===-2||a===2||o===0&&a===0?n.set(s+o,r+a,!0,!0):n.set(s+o,r+a,!1,!0)}}function ld(n,t){const e=n.size,i=kn.getEncodedBits(t);let s,r,o;for(let a=0;a<18;a++)s=Math.floor(a/3),r=a%3+e-8-3,o=(i>>a&1)===1,n.set(s,r,o,!0),n.set(r,s,o,!0)}function gi(n,t,e){const i=n.size,s=id.getEncodedBits(t,e);let r,o;for(r=0;r<15;r++)o=(s>>r&1)===1,r<6?n.set(r,8,o,!0):r<8?n.set(r+1,8,o,!0):n.set(i-15+r,8,o,!0),r<8?n.set(8,i-r-1,o,!0):r<9?n.set(8,15-r-1+1,o,!0):n.set(8,15-r-1,o,!0);n.set(i-8,8,1,!0)}function cd(n,t){const e=n.size;let i=-1,s=e-1,r=7,o=0;for(let a=e-1;a>0;a-=2)for(a===6&&a--;;){for(let l=0;l<2;l++)if(!n.isReserved(s,a-l)){let h=!1;o<t.length&&(h=(t[o]>>>r&1)===1),n.set(s,a-l,h),r--,r===-1&&(o++,r=7)}if(s+=i,s<0||e<=s){s-=i,i=-i;break}}}function hd(n,t,e){const i=new Xu;e.forEach(function(l){i.put(l.mode.bit,4),i.put(l.getLength(),sd.getCharCountIndicator(l.mode,n)),l.write(i)});const s=Jn.getSymbolTotalCodewords(n),r=Mi.getTotalCodewordsCount(n,t),o=(s-r)*8;for(i.getLengthInBits()+4<=o&&i.put(0,4);i.getLengthInBits()%8!==0;)i.putBit(0);const a=(o-i.getLengthInBits())/8;for(let l=0;l<a;l++)i.put(l%2?17:236,8);return ud(i,n,t)}function ud(n,t,e){const i=Jn.getSymbolTotalCodewords(t),s=Mi.getTotalCodewordsCount(t,e),r=i-s,o=Mi.getBlocksCount(t,e),a=i%o,l=o-a,h=Math.floor(i/o),u=Math.floor(r/o),d=u+1,f=h-u,p=new nd(f);let w=0;const g=new Array(o),m=new Array(o);let _=0;const E=new Uint8Array(n.buffer);for(let N=0;N<o;N++){const P=N<l?u:d;g[N]=E.slice(w,w+P),m[N]=p.encode(g[N]),w+=P,_=Math.max(_,P)}const C=new Uint8Array(i);let x=0,I,T;for(I=0;I<_;I++)for(T=0;T<o;T++)I<g[T].length&&(C[x++]=g[T][I]);for(I=0;I<f;I++)for(T=0;T<o;T++)C[x++]=m[T][I];return C}function dd(n,t,e,i){let s;if(Array.isArray(n))s=fi.fromArray(n);else if(typeof n=="string"){let h=t;if(!h){const u=fi.rawSplit(n);h=kn.getBestVersionForData(u,e)}s=fi.fromString(n,h||40)}else throw new Error("Invalid data");const r=kn.getBestVersionForData(s,e);if(!r)throw new Error("The amount of data is too big to be stored in a QR Code");if(!t)t=r;else if(t<r)throw new Error(`
The chosen QR Code version cannot contain this amount of data.
Minimum version required to store current data is: `+r+`.
`);const o=hd(t,e,s),a=Jn.getSymbolSize(t),l=new Qu(a);return rd(l,t),od(l),ad(l,t),gi(l,e,0),t>=7&&ld(l,t),cd(l,o),isNaN(i)&&(i=Oi.getBestMask(l,gi.bind(null,l,e))),Oi.applyMask(i,l),gi(l,e,i),{modules:l,version:t,errorCorrectionLevel:e,maskPattern:i,segments:s}}fa.create=function(t,e){if(typeof t>"u"||t==="")throw new Error("No input text");let i=di.M,s,r;return typeof e<"u"&&(i=di.from(e.errorCorrectionLevel,di.M),s=kn.from(e.version),r=Oi.from(e.maskPattern),e.toSJISFunc&&Jn.setToSJISFunction(e.toSJISFunc)),dd(t,s,i,r)};var Ta={},bs={};(function(n){function t(e){if(typeof e=="number"&&(e=e.toString()),typeof e!="string")throw new Error("Color should be defined as hex string");let i=e.slice().replace("#","").split("");if(i.length<3||i.length===5||i.length>8)throw new Error("Invalid hex color: "+e);(i.length===3||i.length===4)&&(i=Array.prototype.concat.apply([],i.map(function(r){return[r,r]}))),i.length===6&&i.push("F","F");const s=parseInt(i.join(""),16);return{r:s>>24&255,g:s>>16&255,b:s>>8&255,a:s&255,hex:"#"+i.slice(0,6).join("")}}n.getOptions=function(i){i||(i={}),i.color||(i.color={});const s=typeof i.margin>"u"||i.margin===null||i.margin<0?4:i.margin,r=i.width&&i.width>=21?i.width:void 0,o=i.scale||4;return{width:r,scale:r?4:o,margin:s,color:{dark:t(i.color.dark||"#000000ff"),light:t(i.color.light||"#ffffffff")},type:i.type,rendererOpts:i.rendererOpts||{}}},n.getScale=function(i,s){return s.width&&s.width>=i+s.margin*2?s.width/(i+s.margin*2):s.scale},n.getImageWidth=function(i,s){const r=n.getScale(i,s);return Math.floor((i+s.margin*2)*r)},n.qrToImageData=function(i,s,r){const o=s.modules.size,a=s.modules.data,l=n.getScale(o,r),h=Math.floor((o+r.margin*2)*l),u=r.margin*l,d=[r.color.light,r.color.dark];for(let f=0;f<h;f++)for(let p=0;p<h;p++){let w=(f*h+p)*4,g=r.color.light;if(f>=u&&p>=u&&f<h-u&&p<h-u){const m=Math.floor((f-u)/l),_=Math.floor((p-u)/l);g=d[a[m*o+_]?1:0]}i[w++]=g.r,i[w++]=g.g,i[w++]=g.b,i[w]=g.a}}})(bs);(function(n){const t=bs;function e(s,r,o){s.clearRect(0,0,r.width,r.height),r.style||(r.style={}),r.height=o,r.width=o,r.style.height=o+"px",r.style.width=o+"px"}function i(){try{return document.createElement("canvas")}catch{throw new Error("You need to specify a canvas element")}}n.render=function(r,o,a){let l=a,h=o;typeof l>"u"&&(!o||!o.getContext)&&(l=o,o=void 0),o||(h=i()),l=t.getOptions(l);const u=t.getImageWidth(r.modules.size,l),d=h.getContext("2d"),f=d.createImageData(u,u);return t.qrToImageData(f.data,r,l),e(d,h,u),d.putImageData(f,0,0),h},n.renderToDataURL=function(r,o,a){let l=a;typeof l>"u"&&(!o||!o.getContext)&&(l=o,o=void 0),l||(l={});const h=n.render(r,o,l),u=l.type||"image/png",d=l.rendererOpts||{};return h.toDataURL(u,d.quality)}})(Ta);var va={};const fd=bs;function mr(n,t){const e=n.a/255,i=t+'="'+n.hex+'"';return e<1?i+" "+t+'-opacity="'+e.toFixed(2).slice(1)+'"':i}function pi(n,t,e){let i=n+t;return typeof e<"u"&&(i+=" "+e),i}function gd(n,t,e){let i="",s=0,r=!1,o=0;for(let a=0;a<n.length;a++){const l=Math.floor(a%t),h=Math.floor(a/t);!l&&!r&&(r=!0),n[a]?(o++,a>0&&l>0&&n[a-1]||(i+=r?pi("M",l+e,.5+h+e):pi("m",s,0),s=0,r=!1),l+1<t&&n[a+1]||(i+=pi("h",o),o=0)):s++}return i}va.render=function(t,e,i){const s=fd.getOptions(e),r=t.modules.size,o=t.modules.data,a=r+s.margin*2,l=s.color.light.a?"<path "+mr(s.color.light,"fill")+' d="M0 0h'+a+"v"+a+'H0z"/>':"",h="<path "+mr(s.color.dark,"stroke")+' d="'+gd(o,r,s.margin)+'"/>',u='viewBox="0 0 '+a+" "+a+'"',f='<svg xmlns="http://www.w3.org/2000/svg" '+(s.width?'width="'+s.width+'" height="'+s.width+'" ':"")+u+' shape-rendering="crispEdges">'+l+h+`</svg>
`;return typeof i=="function"&&i(null,f),f};const pd=Nu,Ui=fa,Ia=Ta,_d=va;function Es(n,t,e,i,s){const r=[].slice.call(arguments,1),o=r.length,a=typeof r[o-1]=="function";if(!a&&!pd())throw new Error("Callback required as last argument");if(a){if(o<2)throw new Error("Too few arguments provided");o===2?(s=e,e=t,t=i=void 0):o===3&&(t.getContext&&typeof s>"u"?(s=i,i=void 0):(s=i,i=e,e=t,t=void 0))}else{if(o<1)throw new Error("Too few arguments provided");return o===1?(e=t,t=i=void 0):o===2&&!t.getContext&&(i=e,e=t,t=void 0),new Promise(function(l,h){try{const u=Ui.create(e,i);l(n(u,t,i))}catch(u){h(u)}})}try{const l=Ui.create(e,i);s(null,n(l,t,i))}catch(l){s(l)}}Qe.create=Ui.create;Qe.toCanvas=Es.bind(null,Ia.render);Qe.toDataURL=Es.bind(null,Ia.renderToDataURL);Qe.toString=Es.bind(null,function(n,t,e){return _d.render(n,e)});const md="/gifshooter/assets/01.28-D_5FERI8.png",wd="/gifshooter/assets/05.36-_eu3nG-w.png",yd="/gifshooter/assets/06.36-D3z7LYyo.png",bd="/gifshooter/assets/07.47-DsOIyi-K.png",Ed="/gifshooter/assets/08.39-CNuNs_2G.png",xd="/gifshooter/assets/09.41-CKuFrfe7.png",Sd="/gifshooter/assets/10.39-CrAvx7-w.png",Cd="/gifshooter/assets/11.39-BW9zh7wN.png",Ad="/gifshooter/assets/12.20-CAw2TaEM.png",Td="/gifshooter/assets/13.20-BPVeinxW.png",vd="/gifshooter/assets/14.20-DkzKJ_7Y.png",Id="/gifshooter/assets/15.72-BoZDKdHb.png",Rd="/gifshooter/assets/16.12-DS5LuWek.png",Nd="/gifshooter/assets/17.36-DsyJH88H.png",Bd="/gifshooter/assets/18.27-CwnGWTS2.png",Pd="/gifshooter/assets/19.65-Pj4urRsn.png",kd="/gifshooter/assets/20.28-BM0OmUHP.png",Ld="/gifshooter/assets/21.113-BrCgOvVW.png",Dd="/gifshooter/assets/22.45-DaoYFX6r.png",Od="/gifshooter/assets/23.11-DWDKVGwL.png",Md="/gifshooter/assets/24.125-zARE9kV6.png",Ud="/gifshooter/assets/25.120-DfooVmdR.png",Fd="/gifshooter/assets/26.73-5rTYzTh5.png",$d="/gifshooter/assets/27.121-DxQwWftk.png",Hd="/gifshooter/assets/28.31-Dx2fKfsy.png",qd="/gifshooter/assets/29.123-b5iwxTxq.png",zd="/gifshooter/assets/30.29-Dnv3f22k.png",Yd="/gifshooter/assets/31.90-ZB3oXSRJ.png",Wd="/gifshooter/assets/32.147-KdGRWNAE.png",jd="/gifshooter/assets/32.17-Bwo-nrFe.png";let{init:wr,Sprite:Gd,SpriteSheet:Kd,keyPressed:Vd,GameLoop:yr,initKeys:Zd,pointerPressed:Jd,onInput:pf,initPointer:Xd,getPointer:Qd}=Ol,yn=[];const Ra=new URLSearchParams(window.location.search);let Dt=Ra.get("room")||"notinitialized";console.log(Dt);let bn=Ra.get("present")=="true";var tf=document.getElementById("qr");Qe.toCanvas(tf,window.location.href.split("?")[0]+`?${Dt}`,function(n){n&&console.error(n),console.log("success!")});const ef=()=>(window.open(window.location.href.split("?")[0],"_self"),!1),nf=()=>(Dt=document.getElementById("room").value,bn=document.getElementById("present").checked,console.log(bn),window.open(window.location.href.split("?")[0]+`?room=${Dt}&present=${bn}`,"_self"),!1);let Ln=0;const sf={appId:"gifshootah"},Ie=Iu(sf,Dt);Ie.onPeerJoin(n=>{Ln+=1,document.getElementById("online").textContent=`${Ln} peers`});Ie.onPeerLeave(n=>{Ln-=1,document.getElementById("online").textContent=`${Ln} peers`});const[br,rf]=Ie.makeAction("shoot");rf((n,t)=>{yn.push(n)});Dt&&Dt!="notinitialized"?(document.getElementById("setting").style.display="none",document.getElementById("home").style.display="block",document.getElementById("home").onclick=ef):document.getElementById("go").onclick=nf;const hn={};let un=0;const _i=[],zt=[md,wd,yd,bd,Ed,xd,Sd,Cd,Ad,Td,vd,Id,Rd,Nd,Bd,Pd,kd,Ld,Dd,Od,Md,Ud,Fd,$d,Hd,qd,zd,Yd,Wd,jd];let _t=Object.keys(Ie.getPeers()).length%zt.length;const of=n=>{var t=n.split("."),e=parseInt(t[t.length-2]);return new Promise(function(i,s){if(hn[n])return i(hn[n]);{let r=new Image;r.src=n,r.onload=function(){let o=Kd({image:r,frameWidth:r.width/e,frameHeight:r.height,animations:{walk:{frames:`0..${e-1}`,frameRate:15}}});return hn[n]=o,i(hn[n])}}})};let It={};const Er=async(n,t)=>{if(It[n]&&It[n].url==t)return It[n].sprite;let e=await of(t),i=Gd({x:-1e3,y:-1e3,dx:0,dy:0,ddx:0,ddy:0,anchor:{x:.5,y:.5},animations:e.animations});return It[n]={url:t,sprite:i},i};if(bn){let{canvas:n,context:t}=wr("game");Xd(),Zd();let e=document.getElementById("qr");e.style.display="block",n.width=window.innerWidth,n.height=window.innerHeight;for(let s=0;s<120;s++){const r=new OffscreenCanvas(n.width,n.height);_i.push(r)}yr({clearCanvas:!0,update:function(){if(yn.length){const s=yn.pop();let r=_i[un],o=r.getContext("2d");o.globalAlpha=.1,o.fillRect(0,0,r.width,r.height),o.globalAlpha=1,Er(s.peerId,zt[s.spriteUrlIndex]).then(a=>{console.log("raw",s),a.x=s.x*-1*t.canvas.width+t.canvas.width/2,a.y=s.y*-1*t.canvas.height+t.canvas.height/2,console.log(a.x,a.y)})}if(Vd("enter")&&(_t=(_t+1)%zt.length),Jd("left")){let s=Qd();const r={spriteUrlIndex:_t,peerId:Ie.selfId,x:s.x/t.canvas.width,y:s.ycontext.canvas.height};br(r),yn.push(r)}for(let s of Object.keys(It))It[s].sprite.update()},render:function(){un++,un=un%_i.length,t.drawImage(c,0,0);for(let s of Object.keys(It))It[s].sprite.render();c.getContext("2d").drawImage(n,0,0)}}).start()}else if(Dt!="notinitialized"){document.getElementById("phone").style.display="block";let n,t;document.getElementById("reset").onclick=()=>{n=null,t=null};let e,{canvasShoot:i,contextShoot:s}=wr("shootbutton"),r=document.getElementById("shootbutton"),o=document.getElementById("expand");r.width=o.clientWidth,r.height=o.clientHeight,console.log(i,s,"canvas"),document.getElementById("nextgif").onclick=()=>{_t=(_t+1)%zt.length},document.getElementById("previousgif").onclick=()=>{_t=(_t+zt.length-1)%zt.length};let a=!1;r.ontouchstart=()=>{a=!0},r.ontouchend=()=>{a=!1},window.addEventListener("deviceorientation",async h=>{n||(n=h.alpha,t=h.beta);var u=h.alpha-n,d=h.beta-t;if(u<-180&&(u=-180),u>180&&(u=180),d<-90&&(d=-90),d>90&&(d=90),u=u/180,d=d/90,a){const f={spriteUrlIndex:_t,peerId:Ie.selfId,x:u,alpha:h.alpha,y:d,beta:h.beta};console.log(f),br(f)}}),yr({clearCanvas:!0,update:function(){Er("preview",zt[_t]).then(h=>{h.x=r.width/3+r.width/6,h.y=r.height/2,h.width=o.clientWidth/2,h.height=o.clientHeight/2,e=h}),e&&e.update()},render:function(){e&&e.render()}}).start()}
